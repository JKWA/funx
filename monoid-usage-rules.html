<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.34.2">
    <meta name="project" content="funx v0.1.5">


    <title>Funx.Monoid Usage Rules — funx v0.1.5</title>
    <link rel="stylesheet" href="dist/html-elixir-F2VRIOKR.css" />


      <link rel="canonical" href="https://hexdocs.pm/funx/monoid-usage-rules.html" />

    <script src="dist/handlebars.runtime-NWIB6V2M.js"></script>
    <script src="dist/handlebars.templates-K7URE6B4.js"></script>
    <script src="dist/sidebar_items-FD9C8F72.js"></script>
    <script src="docs_config.js"></script>
    <script async src="dist/html-YIPIRHGU.js"></script>

  </head>
  <body data-type="extras" class="page-extra">
    <script>

      try {
        var settings = JSON.parse(localStorage.getItem('ex_doc:settings') || '{}');

        if (settings.theme === 'dark' ||
           ((settings.theme === 'system' || settings.theme == null) &&
             window.matchMedia('(prefers-color-scheme: dark)').matches)
           ) {
          document.body.classList.add('dark')
        }
      } catch (error) { }
    </script>

<div class="body-wrapper">

<button id="sidebar-menu" class="sidebar-button sidebar-toggle" aria-label="toggle sidebar" aria-controls="sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<nav id="sidebar" class="sidebar">

  <div class="sidebar-header">
    <div class="sidebar-projectInfo">

      <div>
        <a href="readme.html" class="sidebar-projectName" translate="no">
funx
        </a>
        <div class="sidebar-projectVersion" translate="no">
          v0.1.5
        </div>
      </div>
    </div>
    <ul id="sidebar-listNav" class="sidebar-listNav" role="tablist">
      <li>
        <button id="extras-list-tab-button" role="tab" data-type="extras" aria-controls="extras-tab-panel" aria-selected="true" tabindex="0">
Pages
        </button>
      </li>

        <li>
          <button id="modules-list-tab-button" role="tab" data-type="modules" aria-controls="modules-tab-panel" aria-selected="false" tabindex="-1">
            Modules
          </button>
        </li>


    </ul>
  </div>

  <div id="extras-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="extras-list-tab-button">
    <ul id="extras-full-list" class="full-list"></ul>
  </div>

    <div id="modules-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="modules-list-tab-button" hidden>
      <ul id="modules-full-list" class="full-list"></ul>
    </div>


</nav>

<main class="content">
  <output role="status" id="toast"></output>

  <div id="content" class="content-inner">
    <div class="top-search">
      <div class="search-settings">
        <form class="search-bar" action="search.html">
          <label class="search-label">
            <span class="sr-only">Search documentation of funx</span>
            <input name="q" type="text" class="search-input" placeholder="Press / to search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
          </label>
          <button type="submit" class="search-button" aria-label="Submit Search">
            <i class="ri-search-2-line ri-lg" aria-hidden="true" title="Submit search"></i>
          </button>
          <button type="button" tabindex="-1" class="search-close-button" aria-hidden="true">
            <i class="ri-close-line ri-lg" title="Cancel search"></i>
          </button>
        </form>
        <div class="autocomplete">
        </div>
        <button class="icon-settings display-settings">
          <i class="ri-settings-3-line"></i>
          <span class="sr-only">Settings</span>
        </button>
      </div>
    </div>

<div id="top-content">
  <h1>

      <a href="https://github.com/JKWA/funx/blob/v0.1.5/lib/monoid/usage-rules.md#L1" title="View Source" class="icon-action" rel="help">
        <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        <span class="sr-only">View Source</span>
      </a>


    <span><code class="inline">Funx.Monoid</code> Usage Rules</span>
  </h1>

<h2 id="llm-functional-programming-foundation" class="section-heading">
  <a href="#llm-functional-programming-foundation" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">LLM Functional Programming Foundation</span>
</h2>
<p><strong>Key Concepts for LLMs:</strong></p><p><strong>CRITICAL Elixir Implementation</strong>: All monoid operations are under <a href="Funx.Monoid.html"><code class="inline">Funx.Monoid</code></a> protocol</p><ul><li><strong>NO separate Semigroup protocol</strong> - Elixir protocols cannot be extended after definition  </li><li>Always use <code class="inline">Monoid.empty/1</code>, <code class="inline">Monoid.append/2</code> or import <a href="Funx.Monoid.html"><code class="inline">Funx.Monoid</code></a></li><li>Different from Haskell's separate Semigroup and Monoid typeclasses</li></ul><p><strong>Monoid Protocol</strong>: Mathematical structure for associative combination with identity</p><ul><li><code class="inline">empty/1</code>: Returns the identity element for the monoid (like 0 for addition, [] for lists)</li><li><code class="inline">append/2</code>: Associative binary operation that combines two values</li><li><code class="inline">wrap/2</code> / <code class="inline">unwrap/1</code>: Infrastructure functions to convert between raw values and monoid wrappers</li><li>Example: <code class="inline">Monoid.append(%Sum{}, 5, 3)</code> combines numbers using addition</li></ul><p><strong>Monoid Laws</strong>: Mathematical guarantees that ensure predictable behavior  </p><ul><li><strong>Left Identity</strong>: <code class="inline">append(empty(m), x) === x</code></li><li><strong>Right Identity</strong>: <code class="inline">append(x, empty(m)) === x</code>  </li><li><strong>Associativity</strong>: <code class="inline">append(append(a, b), c) === append(a, append(b, c))</code></li><li>These laws enable safe composition and parallel computation</li><li>Example: Summing <code class="inline">[1,2,3,4]</code> can be computed as <code class="inline">(1+2)+(3+4)</code> or <code class="inline">1+(2+(3+4))</code></li></ul><p><strong>Algebraic Data Combination</strong>: Monoids represent ways to combine data</p><ul><li><strong>Sum</strong>: Numbers with addition (<code class="inline">0</code> identity, <code class="inline">+</code> operation)  </li><li><strong>Product</strong>: Numbers with multiplication (<code class="inline">1</code> identity, <code class="inline">*</code> operation)</li><li><strong>Max/Min</strong>: Numbers with comparison (<code class="inline">-∞/+∞</code> identity, <code class="inline">max/min</code> operation)</li><li><strong>List</strong>: Collections with concatenation (<code class="inline">[]</code> identity, <code class="inline">++</code> operation)</li><li><strong>All/Any</strong>: Booleans with AND/OR (<code class="inline">true/false</code> identity, <code class="inline">&amp;&amp;/||</code> operation)</li><li>Example: Combining user preferences uses monoid to merge settings</li></ul><p><strong>Higher-Level Abstractions</strong>: Monoids power utility functions</p><ul><li><code class="inline">Math.sum/1</code>, <code class="inline">Math.product/1</code> use numeric monoids internally</li><li><code class="inline">Eq.Utils.concat_all/1</code> uses All monoid for AND-ing equality checks</li><li><code class="inline">Predicate.p_all/1</code> uses All monoid for combining boolean predicates  </li><li>Example: <code class="inline">Math.sum([1,2,3])</code> internally uses Sum monoid but hides the complexity</li></ul><h2 id="llm-decision-guide-when-to-use-monoid-protocol" class="section-heading">
  <a href="#llm-decision-guide-when-to-use-monoid-protocol" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">LLM Decision Guide: When to Use Monoid Protocol</span>
</h2>
<p><strong>✅ Use Monoid Protocol when:</strong></p><ul><li>Need associative combination with identity (merging, accumulating, folding)</li><li>Building reusable combination logic for custom data types</li><li>Want parallel/distributed computation guarantees  </li><li>Creating utility functions that combine multiple values</li><li>User says: &quot;combine&quot;, &quot;merge&quot;, &quot;accumulate&quot;, &quot;fold&quot;, &quot;reduce&quot;</li></ul><p><strong>❌ Don't use Monoid Protocol when:</strong></p><ul><li>Simple one-off combinations (use direct operations like <code class="inline">+</code>, <code class="inline">++</code>)</li><li>Non-associative operations (like subtraction or division)</li><li>No meaningful identity element exists</li><li>Operations have side effects or are non-deterministic</li></ul><p><strong>⚡ Monoid Strategy Decision:</strong></p><ul><li><strong>Built-in types</strong>: Use existing monoids (Sum, Product, Max, Min, ListConcat)</li><li><strong>Custom combination</strong>: Define new monoid struct and protocol implementation  </li><li><strong>Application code</strong>: Use high-level utilities (<code class="inline">Math</code>, <code class="inline">Eq.Utils</code>, <code class="inline">Ord.Utils</code>)</li><li><strong>Library code</strong>: Expose monoids through utility functions, not raw protocol</li></ul><p><strong>⚙️ Function Choice Guide (Mathematical Purpose):</strong></p><ul><li><strong>Identity element</strong>: <code class="inline">empty/1</code> to get neutral value for combination</li><li><strong>Binary combination</strong>: <code class="inline">append/2</code> to combine two values associatively</li><li><strong>Multiple combination</strong>: <code class="inline">m_concat/2</code> to combine a list of values</li><li><strong>Utility helpers</strong>: <code class="inline">m_append/3</code> for low-level monoid operations</li></ul><h2 id="llm-context-clues" class="section-heading">
  <a href="#llm-context-clues" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">LLM Context Clues</span>
</h2>
<p><strong>User language → Monoid patterns:</strong></p><ul><li>&quot;combine all these values&quot; → Use <code class="inline">m_concat/2</code> or utility functions</li><li>&quot;merge with defaults&quot; → Use monoid with appropriate identity element</li><li>&quot;accumulate results&quot; → Use monoid for associative accumulation  </li><li>&quot;parallel computation&quot; → Monoids enable safe parallelization</li><li>&quot;sum/product/max/min&quot; → Use <code class="inline">Math</code> utilities backed by monoids</li><li>&quot;AND/OR logic&quot; → Use <code class="inline">All/Any</code> monoids for boolean combination</li></ul><h2 id="quick-reference" class="section-heading">
  <a href="#quick-reference" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Quick Reference</span>
</h2>
<ul><li>A monoid = <code class="inline">empty/1</code> (identity) + <code class="inline">append/2</code> (associative).  </li><li>Identities must be true identities (e.g. <code class="inline">0</code> for sum, <code class="inline">1</code> for product, <code class="inline">[]</code> for concatenation).  </li><li><code class="inline">wrap/2</code> and <code class="inline">unwrap/1</code> exist for infrastructure, not daily use.  </li><li><code class="inline">m_append/3</code> and <code class="inline">m_concat/2</code> are low-level helpers that power higher abstractions.  </li><li>Application code should prefer helpers in <code class="inline">Math</code>, <code class="inline">Eq.Utils</code>, <code class="inline">Ord.Utils</code>, or <code class="inline">Predicate</code>.</li></ul><h2 id="overview" class="section-heading">
  <a href="#overview" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Overview</span>
</h2>
<p><a href="Funx.Monoid.html"><code class="inline">Funx.Monoid</code></a> defines how values combine under an associative operation with an identity.<br/>Each monoid is represented by a struct (e.g. <code class="inline">%Sum{}</code>, <code class="inline">%Product{}</code>, <code class="inline">%Eq.All{}</code>, <code class="inline">%Ord{}</code>) and implements:</p><ul><li><code class="inline">Monoid.empty/1</code> → the identity element  </li><li><code class="inline">Monoid.append/2</code> → associative combination  </li><li><code class="inline">wrap/2</code> / <code class="inline">unwrap/1</code> → convert between raw values and monoid structs  </li></ul><p><strong>Important Implementation Detail</strong>: Unlike Haskell's separate Semigroup and Monoid typeclasses, Elixir's protocol system limitations require all operations under the single <a href="Funx.Monoid.html"><code class="inline">Funx.Monoid</code></a> protocol.</p><p>Monoids are rarely used directly in application code. Instead, they support utilities like <code class="inline">Math.sum/1</code>, <code class="inline">Eq.Utils.concat_all/1</code>, and <code class="inline">Ord.Utils.concat/1</code>.</p><h2 id="protocol-rules" class="section-heading">
  <a href="#protocol-rules" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Protocol Rules</span>
</h2>
<ul><li>Provide all four functions: <code class="inline">empty/1</code>, <code class="inline">append/2</code>, <code class="inline">wrap/2</code>, <code class="inline">unwrap/1</code>.  </li><li>Identity: <code class="inline">append(empty(m), x) == x == append(x, empty(m))</code>.  </li><li>Associativity: <code class="inline">append(append(a, b), c) == append(a, append(b, c))</code>.  </li><li>Purity: results must be deterministic and side-effect free.</li></ul><p><strong>Note</strong>: While not typically needed, you can define a <code class="inline">join/1</code> operation for monoids that flattens nested monoid values (e.g., combining lists of lists) using <code class="inline">m_concat/2</code>. This provides symmetry with Monad operations for flattening nested structures.  </p><h2 id="preferred-usage" class="section-heading">
  <a href="#preferred-usage" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Preferred Usage</span>
</h2>
<h3 id="go-through-utilities" class="section-heading">
  <a href="#go-through-utilities" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Go Through Utilities</span>
</h3>
<p>Use high-level helpers instead of wiring monoids manually:</p><ul><li><strong>Numbers</strong> → <code class="inline">Math.sum/1</code>, <code class="inline">Math.product/1</code>, <code class="inline">Math.max/1</code>, <code class="inline">Math.min/1</code>  </li><li><strong>Equality</strong> → <code class="inline">Eq.Utils.concat_all/1</code>, <code class="inline">Eq.Utils.concat_any/1</code>  </li><li><strong>Ordering</strong> → <code class="inline">Ord.Utils.concat/1</code>, <code class="inline">Ord.Utils.append/2</code>  </li><li><strong>Predicates</strong> → <code class="inline">Predicate.p_and/2</code>, <code class="inline">Predicate.p_or/2</code>, <code class="inline">Predicate.p_all/1</code>, <code class="inline">Predicate.p_any/1</code></li></ul><p>These functions already call <code class="inline">m_concat/2</code> and <code class="inline">m_append/3</code>.<br/>You don't need to construct <code class="inline">%Monoid.*{}</code> by hand.</p><h3 id="examples" class="section-heading">
  <a href="#examples" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Examples</span>
</h3>
<h4>Equality Composition</h4><pre><code class="makeup elixir" translate="no"><span class="kn">alias</span><span class="w"> </span><span class="nc">Funx.Eq.Utils</span><span class="p">,</span><span class="w"> </span><span class="ss">as</span><span class="p">:</span><span class="w"> </span><span class="nc">EqU</span><span class="w">

</span><span class="n">name_eq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">EqU</span><span class="o">.</span><span class="n">contramap</span><span class="p" data-group-id="6152774003-1">(</span><span class="o">&amp;</span><span class="w"> </span><span class="ni">&amp;1</span><span class="o">.</span><span class="n">name</span><span class="p" data-group-id="6152774003-1">)</span><span class="w">
</span><span class="n">age_eq</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nc">EqU</span><span class="o">.</span><span class="n">contramap</span><span class="p" data-group-id="6152774003-2">(</span><span class="o">&amp;</span><span class="w"> </span><span class="ni">&amp;1</span><span class="o">.</span><span class="n">age</span><span class="p" data-group-id="6152774003-2">)</span><span class="w">

</span><span class="nc">EqU</span><span class="o">.</span><span class="n">concat_all</span><span class="p" data-group-id="6152774003-3">(</span><span class="p" data-group-id="6152774003-4">[</span><span class="n">name_eq</span><span class="p">,</span><span class="w"> </span><span class="n">age_eq</span><span class="p" data-group-id="6152774003-4">]</span><span class="p" data-group-id="6152774003-3">)</span><span class="w">  </span><span class="c1"># AND semantics</span><span class="w">
</span><span class="nc">EqU</span><span class="o">.</span><span class="n">concat_any</span><span class="p" data-group-id="6152774003-5">(</span><span class="p" data-group-id="6152774003-6">[</span><span class="n">name_eq</span><span class="p">,</span><span class="w"> </span><span class="n">age_eq</span><span class="p" data-group-id="6152774003-6">]</span><span class="p" data-group-id="6152774003-5">)</span><span class="w">  </span><span class="c1"># OR semantics</span></code></pre><h4>Ordering Composition</h4><pre><code class="makeup elixir" translate="no"><span class="kn">alias</span><span class="w"> </span><span class="nc">Funx.Ord.Utils</span><span class="p">,</span><span class="w"> </span><span class="ss">as</span><span class="p">:</span><span class="w"> </span><span class="nc">OrdU</span><span class="w">

</span><span class="n">age</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nc">OrdU</span><span class="o">.</span><span class="n">contramap</span><span class="p" data-group-id="8436599821-1">(</span><span class="o">&amp;</span><span class="w"> </span><span class="ni">&amp;1</span><span class="o">.</span><span class="n">age</span><span class="p" data-group-id="8436599821-1">)</span><span class="w">
</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">OrdU</span><span class="o">.</span><span class="n">contramap</span><span class="p" data-group-id="8436599821-2">(</span><span class="o">&amp;</span><span class="w"> </span><span class="ni">&amp;1</span><span class="o">.</span><span class="n">name</span><span class="p" data-group-id="8436599821-2">)</span><span class="w">

</span><span class="nc">OrdU</span><span class="o">.</span><span class="n">concat</span><span class="p" data-group-id="8436599821-3">(</span><span class="p" data-group-id="8436599821-4">[</span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p" data-group-id="8436599821-4">]</span><span class="p" data-group-id="8436599821-3">)</span><span class="w">  </span><span class="c1"># lexicographic ordering</span></code></pre><h4>Math Helpers</h4><pre><code class="makeup elixir" translate="no"><span class="kn">alias</span><span class="w"> </span><span class="nc">Funx.Math</span><span class="w">

</span><span class="nc">Math</span><span class="o">.</span><span class="n">sum</span><span class="p" data-group-id="6382794357-1">(</span><span class="p" data-group-id="6382794357-2">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="6382794357-2">]</span><span class="p" data-group-id="6382794357-1">)</span><span class="w">     </span><span class="c1"># =&gt; 6</span><span class="w">
</span><span class="nc">Math</span><span class="o">.</span><span class="n">product</span><span class="p" data-group-id="6382794357-3">(</span><span class="p" data-group-id="6382794357-4">[</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p" data-group-id="6382794357-4">]</span><span class="p" data-group-id="6382794357-3">)</span><span class="w"> </span><span class="c1"># =&gt; 24</span><span class="w">
</span><span class="nc">Math</span><span class="o">.</span><span class="n">max</span><span class="p" data-group-id="6382794357-5">(</span><span class="p" data-group-id="6382794357-6">[</span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p" data-group-id="6382794357-6">]</span><span class="p" data-group-id="6382794357-5">)</span><span class="w">     </span><span class="c1"># =&gt; 7</span><span class="w">
</span><span class="nc">Math</span><span class="o">.</span><span class="n">min</span><span class="p" data-group-id="6382794357-7">(</span><span class="p" data-group-id="6382794357-8">[</span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p" data-group-id="6382794357-8">]</span><span class="p" data-group-id="6382794357-7">)</span><span class="w">     </span><span class="c1"># =&gt; 3</span></code></pre><h2 id="interop" class="section-heading">
  <a href="#interop" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Interop</span>
</h2>
<ul><li><code class="inline">Eq.Utils</code> relies on <code class="inline">Eq.All</code> and <code class="inline">Eq.Any</code> monoids for composition.</li><li><code class="inline">Ord.Utils</code> uses the <code class="inline">Ord</code> monoid for lexicographic comparison.</li><li><code class="inline">Math</code> uses monoids for numeric folds.</li></ul><p><strong>Rule of thumb:</strong> application code never wires <code class="inline">%Monoid.*{}</code> directly—always go through the utility combinators.</p><h2 id="stability-contract" class="section-heading">
  <a href="#stability-contract" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Stability Contract</span>
</h2>
<ul><li>Identities must be stable and input-independent.</li><li><code class="inline">append/2</code> must be associative for all valid values.</li><li><code class="inline">wrap/2</code> and <code class="inline">unwrap/1</code> must be inverses.</li></ul><h2 id="anti-patterns" class="section-heading">
  <a href="#anti-patterns" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Anti-Patterns</span>
</h2>
<ul><li>Hand-wiring <code class="inline">%Monoid.*{}</code> in application code.</li><li>Mixing different monoid types in one <code class="inline">append/2</code>.</li><li>Using fake identities (<code class="inline">nil</code> instead of <code class="inline">0</code> for sum).</li><li>Hiding side effects inside protocol functions.</li></ul><p><strong>Type Safety Warning</strong>: Always ensure values passed to <code class="inline">append/2</code> are of the same wrapped monoid type:</p><pre><code class="makeup elixir" translate="no"><span class="c1"># ❌ Wrong - mixing types</span><span class="w">
</span><span class="n">append</span><span class="p" data-group-id="9583887175-1">(</span><span class="p" data-group-id="9583887175-2">%</span><span class="nc" data-group-id="9583887175-2">Sum</span><span class="p" data-group-id="9583887175-2">{</span><span class="p" data-group-id="9583887175-2">}</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9583887175-3">%</span><span class="nc" data-group-id="9583887175-3">Product</span><span class="p" data-group-id="9583887175-3">{</span><span class="ss">value</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="9583887175-3">}</span><span class="p" data-group-id="9583887175-1">)</span><span class="w">  </span><span class="c1"># Invalid - type mismatch</span><span class="w">

</span><span class="c1"># ✅ Right - consistent types  </span><span class="w">
</span><span class="n">append</span><span class="p" data-group-id="9583887175-4">(</span><span class="p" data-group-id="9583887175-5">%</span><span class="nc" data-group-id="9583887175-5">Sum</span><span class="p" data-group-id="9583887175-5">{</span><span class="p" data-group-id="9583887175-5">}</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="9583887175-4">)</span><span class="w">                   </span><span class="c1"># OK: both values are integers</span></code></pre><h2 id="good-patterns" class="section-heading">
  <a href="#good-patterns" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Good Patterns</span>
</h2>
<ul><li>Use <code class="inline">Math</code>, <code class="inline">Eq.Utils</code>, <code class="inline">Ord.Utils</code>, or <code class="inline">Predicate</code> instead of raw monoids.</li><li>Keep identities explicit in library code (<code class="inline">0</code>, <code class="inline">1</code>, <code class="inline">[]</code>, <code class="inline">Float.min_finite()</code> / <code class="inline">Float.max_finite()</code>).</li><li>Let <code class="inline">m_concat/2</code> and <code class="inline">m_append/3</code> handle the wrapping/combining logic.</li></ul><h2 id="when-to-define-a-new-monoid" class="section-heading">
  <a href="#when-to-define-a-new-monoid" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">When to Define a New Monoid</span>
</h2>
<p>Define a monoid struct if you need associative combination + identity:</p><ul><li>Counters, tallies, or scores</li><li>Config merges (e.g. left-biased / right-biased maps)</li><li>&quot;Best-of&quot; or &quot;min-by/max-by&quot; selections</li><li>Predicate or decision combination</li></ul><p>Expose it through a utility module—application code should not use it raw.</p><h2 id="built-in-instances" class="section-heading">
  <a href="#built-in-instances" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Built-in Instances</span>
</h2>
<ul><li><code class="inline">%Funx.Monoid.Sum{}</code> — numeric sum (<code class="inline">0</code>)</li><li><code class="inline">%Funx.Monoid.Product{}</code> — numeric product (<code class="inline">1</code>)</li><li><code class="inline">%Funx.Monoid.Max{}</code> — maximum (<code class="inline">Float.min_finite()</code>)</li><li><code class="inline">%Funx.Monoid.Min{}</code> — minimum (<code class="inline">Float.max_finite()</code>)</li><li><code class="inline">%Funx.Monoid.ListConcat{}</code> — list concatenation (<code class="inline">[]</code>)</li><li><code class="inline">%Funx.Monoid.StringConcat{}</code> — string concatenation (<code class="inline">&quot;&quot;</code>)</li><li><code class="inline">%Funx.Monoid.Predicate.All{}</code> — predicate AND composition (identity: <code class="inline">fn _ -&gt; true end</code>)</li><li><code class="inline">%Funx.Monoid.Predicate.Any{}</code> — predicate OR composition (identity: <code class="inline">fn _ -&gt; false end</code>)</li><li><code class="inline">%Funx.Monoid.Eq.All{}</code> / <code class="inline">%Funx.Monoid.Eq.Any{}</code> — equality composition</li><li><code class="inline">%Funx.Monoid.Ord{}</code> — ordering composition</li></ul><p>These back the higher-level helpers. Use <code class="inline">Math</code>, <code class="inline">Eq.Utils</code>, <code class="inline">Ord.Utils</code>, or <code class="inline">Predicate</code> instead.</p><h2 id="llm-code-templates" class="section-heading">
  <a href="#llm-code-templates" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">LLM Code Templates</span>
</h2>
<h3 id="basic-monoid-usage-template" class="section-heading">
  <a href="#basic-monoid-usage-template" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Basic Monoid Usage Template</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="kd">defmodule</span><span class="w"> </span><span class="nc">DataAggregator</span><span class="w"> </span><span class="k" data-group-id="4001005941-1">do</span><span class="w">
  </span><span class="kn">import</span><span class="w"> </span><span class="nc">Funx.Monoid</span><span class="w">
  </span><span class="kn">alias</span><span class="w"> </span><span class="nc">Funx.Math</span><span class="w">
  
  </span><span class="c1"># Use high-level utilities instead of raw monoids</span><span class="w">
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">analyze_numbers</span><span class="p" data-group-id="4001005941-2">(</span><span class="n">numbers</span><span class="p" data-group-id="4001005941-2">)</span><span class="w"> </span><span class="k" data-group-id="4001005941-3">do</span><span class="w">
    </span><span class="p" data-group-id="4001005941-4">%{</span><span class="w">
      </span><span class="ss">sum</span><span class="p">:</span><span class="w"> </span><span class="nc">Math</span><span class="o">.</span><span class="n">sum</span><span class="p" data-group-id="4001005941-5">(</span><span class="n">numbers</span><span class="p" data-group-id="4001005941-5">)</span><span class="p">,</span><span class="w">           </span><span class="c1"># Uses Sum monoid internally</span><span class="w">
      </span><span class="ss">product</span><span class="p">:</span><span class="w"> </span><span class="nc">Math</span><span class="o">.</span><span class="n">product</span><span class="p" data-group-id="4001005941-6">(</span><span class="n">numbers</span><span class="p" data-group-id="4001005941-6">)</span><span class="p">,</span><span class="w">   </span><span class="c1"># Uses Product monoid internally  </span><span class="w">
      </span><span class="ss">maximum</span><span class="p">:</span><span class="w"> </span><span class="nc">Math</span><span class="o">.</span><span class="n">max</span><span class="p" data-group-id="4001005941-7">(</span><span class="n">numbers</span><span class="p" data-group-id="4001005941-7">)</span><span class="p">,</span><span class="w">       </span><span class="c1"># Uses Max monoid internally</span><span class="w">
      </span><span class="ss">minimum</span><span class="p">:</span><span class="w"> </span><span class="nc">Math</span><span class="o">.</span><span class="n">min</span><span class="p" data-group-id="4001005941-8">(</span><span class="n">numbers</span><span class="p" data-group-id="4001005941-8">)</span><span class="w">        </span><span class="c1"># Uses Min monoid internally</span><span class="w">
    </span><span class="p" data-group-id="4001005941-4">}</span><span class="w">
  </span><span class="k" data-group-id="4001005941-3">end</span><span class="w">
  
  </span><span class="c1"># Custom combination using monoid utilities</span><span class="w">
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">combine_stats</span><span class="p" data-group-id="4001005941-9">(</span><span class="n">stat_list</span><span class="p" data-group-id="4001005941-9">)</span><span class="w"> </span><span class="k" data-group-id="4001005941-10">do</span><span class="w">
    </span><span class="n">stat_list</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">map</span><span class="p" data-group-id="4001005941-11">(</span><span class="o">&amp;</span><span class="n">extract_numbers</span><span class="o">/</span><span class="mi">1</span><span class="p" data-group-id="4001005941-11">)</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">reduce</span><span class="p" data-group-id="4001005941-12">(</span><span class="k" data-group-id="4001005941-13">fn</span><span class="w"> </span><span class="n">nums1</span><span class="p">,</span><span class="w"> </span><span class="n">nums2</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
      </span><span class="p" data-group-id="4001005941-14">%{</span><span class="w">
        </span><span class="ss">sum</span><span class="p">:</span><span class="w"> </span><span class="nc">Math</span><span class="o">.</span><span class="n">sum</span><span class="p" data-group-id="4001005941-15">(</span><span class="p" data-group-id="4001005941-16">[</span><span class="n">nums1</span><span class="o">.</span><span class="n">sum</span><span class="p">,</span><span class="w"> </span><span class="n">nums2</span><span class="o">.</span><span class="n">sum</span><span class="p" data-group-id="4001005941-16">]</span><span class="p" data-group-id="4001005941-15">)</span><span class="p">,</span><span class="w">
        </span><span class="ss">product</span><span class="p">:</span><span class="w"> </span><span class="nc">Math</span><span class="o">.</span><span class="n">product</span><span class="p" data-group-id="4001005941-17">(</span><span class="p" data-group-id="4001005941-18">[</span><span class="n">nums1</span><span class="o">.</span><span class="n">product</span><span class="p">,</span><span class="w"> </span><span class="n">nums2</span><span class="o">.</span><span class="n">product</span><span class="p" data-group-id="4001005941-18">]</span><span class="p" data-group-id="4001005941-17">)</span><span class="p">,</span><span class="w">
        </span><span class="ss">max</span><span class="p">:</span><span class="w"> </span><span class="nc">Math</span><span class="o">.</span><span class="n">max</span><span class="p" data-group-id="4001005941-19">(</span><span class="p" data-group-id="4001005941-20">[</span><span class="n">nums1</span><span class="o">.</span><span class="n">max</span><span class="p">,</span><span class="w"> </span><span class="n">nums2</span><span class="o">.</span><span class="n">max</span><span class="p" data-group-id="4001005941-20">]</span><span class="p" data-group-id="4001005941-19">)</span><span class="p">,</span><span class="w">
        </span><span class="ss">min</span><span class="p">:</span><span class="w"> </span><span class="nc">Math</span><span class="o">.</span><span class="n">min</span><span class="p" data-group-id="4001005941-21">(</span><span class="p" data-group-id="4001005941-22">[</span><span class="n">nums1</span><span class="o">.</span><span class="n">min</span><span class="p">,</span><span class="w"> </span><span class="n">nums2</span><span class="o">.</span><span class="n">min</span><span class="p" data-group-id="4001005941-22">]</span><span class="p" data-group-id="4001005941-21">)</span><span class="w">
      </span><span class="p" data-group-id="4001005941-14">}</span><span class="w">
    </span><span class="k" data-group-id="4001005941-13">end</span><span class="p" data-group-id="4001005941-12">)</span><span class="w">
  </span><span class="k" data-group-id="4001005941-10">end</span><span class="w">
</span><span class="k" data-group-id="4001005941-1">end</span></code></pre><h3 id="custom-monoid-implementation-template" class="section-heading">
  <a href="#custom-monoid-implementation-template" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Custom Monoid Implementation Template</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="kd">defmodule</span><span class="w"> </span><span class="nc">UserPreferences</span><span class="w"> </span><span class="k" data-group-id="2002115612-1">do</span><span class="w">
  </span><span class="kd">defstruct</span><span class="w"> </span><span class="ss">theme</span><span class="p">:</span><span class="w"> </span><span class="ss">:light</span><span class="p">,</span><span class="w"> </span><span class="ss">notifications</span><span class="p">:</span><span class="w"> </span><span class="no">true</span><span class="p">,</span><span class="w"> </span><span class="ss">language</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;en&quot;</span><span class="w">
</span><span class="k" data-group-id="2002115612-1">end</span><span class="w">

</span><span class="c1"># Custom monoid for merging user preferences (right-biased)</span><span class="w">
</span><span class="kd">defmodule</span><span class="w"> </span><span class="nc">Funx.Monoid.UserPreferences</span><span class="w"> </span><span class="k" data-group-id="2002115612-2">do</span><span class="w">
  </span><span class="kd">defstruct</span><span class="w"> </span><span class="p" data-group-id="2002115612-3">[</span><span class="p" data-group-id="2002115612-3">]</span><span class="w">
  
  </span><span class="kd">defimpl</span><span class="w"> </span><span class="nc">Funx.Monoid</span><span class="w"> </span><span class="k" data-group-id="2002115612-4">do</span><span class="w">
    </span><span class="kd">def</span><span class="w"> </span><span class="nf">empty</span><span class="p" data-group-id="2002115612-5">(</span><span class="bp">_</span><span class="p" data-group-id="2002115612-5">)</span><span class="p">,</span><span class="w"> </span><span class="ss">do</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="2002115612-6">%</span><span class="nc" data-group-id="2002115612-6">UserPreferences</span><span class="p" data-group-id="2002115612-6">{</span><span class="p" data-group-id="2002115612-6">}</span><span class="w">
    
    </span><span class="kd">def</span><span class="w"> </span><span class="nf">append</span><span class="p" data-group-id="2002115612-7">(</span><span class="bp">_</span><span class="p">,</span><span class="w"> </span><span class="n">prefs1</span><span class="p">,</span><span class="w"> </span><span class="n">prefs2</span><span class="p" data-group-id="2002115612-7">)</span><span class="w"> </span><span class="k" data-group-id="2002115612-8">do</span><span class="w">
      </span><span class="c1"># Right-biased merge: prefs2 overwrites prefs1 for non-nil values</span><span class="w">
      </span><span class="p" data-group-id="2002115612-9">%</span><span class="nc" data-group-id="2002115612-9">UserPreferences</span><span class="p" data-group-id="2002115612-9">{</span><span class="w">
        </span><span class="ss">theme</span><span class="p">:</span><span class="w"> </span><span class="n">prefs2</span><span class="o">.</span><span class="n">theme</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">prefs1</span><span class="o">.</span><span class="n">theme</span><span class="p">,</span><span class="w">
        </span><span class="ss">notifications</span><span class="p">:</span><span class="w"> </span><span class="k">if</span><span class="p" data-group-id="2002115612-10">(</span><span class="n">is_nil</span><span class="p" data-group-id="2002115612-11">(</span><span class="n">prefs2</span><span class="o">.</span><span class="n">notifications</span><span class="p" data-group-id="2002115612-11">)</span><span class="p">,</span><span class="w"> </span><span class="ss">do</span><span class="p">:</span><span class="w"> </span><span class="n">prefs1</span><span class="o">.</span><span class="n">notifications</span><span class="p">,</span><span class="w"> </span><span class="ss">else</span><span class="p">:</span><span class="w"> </span><span class="n">prefs2</span><span class="o">.</span><span class="n">notifications</span><span class="p" data-group-id="2002115612-10">)</span><span class="p">,</span><span class="w">
        </span><span class="ss">language</span><span class="p">:</span><span class="w"> </span><span class="n">prefs2</span><span class="o">.</span><span class="n">language</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">prefs1</span><span class="o">.</span><span class="n">language</span><span class="w">
      </span><span class="p" data-group-id="2002115612-9">}</span><span class="w">
    </span><span class="k" data-group-id="2002115612-8">end</span><span class="w">
    
    </span><span class="kd">def</span><span class="w"> </span><span class="nf">wrap</span><span class="p" data-group-id="2002115612-12">(</span><span class="bp">_</span><span class="p">,</span><span class="w"> </span><span class="n">prefs</span><span class="p" data-group-id="2002115612-12">)</span><span class="p">,</span><span class="w"> </span><span class="ss">do</span><span class="p">:</span><span class="w"> </span><span class="n">prefs</span><span class="w">
    </span><span class="kd">def</span><span class="w"> </span><span class="nf">unwrap</span><span class="p" data-group-id="2002115612-13">(</span><span class="n">prefs</span><span class="p" data-group-id="2002115612-13">)</span><span class="p">,</span><span class="w"> </span><span class="ss">do</span><span class="p">:</span><span class="w"> </span><span class="n">prefs</span><span class="w">
  </span><span class="k" data-group-id="2002115612-4">end</span><span class="w">
</span><span class="k" data-group-id="2002115612-2">end</span><span class="w">

</span><span class="kd">defmodule</span><span class="w"> </span><span class="nc">PreferencesManager</span><span class="w"> </span><span class="k" data-group-id="2002115612-14">do</span><span class="w">
  </span><span class="kn">alias</span><span class="w"> </span><span class="nc">Funx.Monoid.Utils</span><span class="p">,</span><span class="w"> </span><span class="ss">as</span><span class="p">:</span><span class="w"> </span><span class="nc">MU</span><span class="w">
  
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">merge_user_preferences</span><span class="p" data-group-id="2002115612-15">(</span><span class="n">preference_list</span><span class="p" data-group-id="2002115612-15">)</span><span class="w"> </span><span class="k" data-group-id="2002115612-16">do</span><span class="w">
    </span><span class="c1"># Use monoid to combine multiple preference objects</span><span class="w">
    </span><span class="nc">MU</span><span class="o">.</span><span class="n">m_concat</span><span class="p" data-group-id="2002115612-17">(</span><span class="p" data-group-id="2002115612-18">%</span><span class="nc" data-group-id="2002115612-18">Funx.Monoid.UserPreferences</span><span class="p" data-group-id="2002115612-18">{</span><span class="p" data-group-id="2002115612-18">}</span><span class="p">,</span><span class="w"> </span><span class="n">preference_list</span><span class="p" data-group-id="2002115612-17">)</span><span class="w">
  </span><span class="k" data-group-id="2002115612-16">end</span><span class="w">
  
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">merge_with_defaults</span><span class="p" data-group-id="2002115612-19">(</span><span class="n">user_prefs</span><span class="p">,</span><span class="w"> </span><span class="n">defaults</span><span class="p" data-group-id="2002115612-19">)</span><span class="w"> </span><span class="k" data-group-id="2002115612-20">do</span><span class="w">
    </span><span class="c1"># Combine with defaults using monoid</span><span class="w">
    </span><span class="nc">MU</span><span class="o">.</span><span class="n">m_append</span><span class="p" data-group-id="2002115612-21">(</span><span class="p" data-group-id="2002115612-22">%</span><span class="nc" data-group-id="2002115612-22">Funx.Monoid.UserPreferences</span><span class="p" data-group-id="2002115612-22">{</span><span class="p" data-group-id="2002115612-22">}</span><span class="p">,</span><span class="w"> </span><span class="n">defaults</span><span class="p">,</span><span class="w"> </span><span class="n">user_prefs</span><span class="p" data-group-id="2002115612-21">)</span><span class="w">
  </span><span class="k" data-group-id="2002115612-20">end</span><span class="w">
</span><span class="k" data-group-id="2002115612-14">end</span></code></pre><h3 id="monoid-law-verification-template" class="section-heading">
  <a href="#monoid-law-verification-template" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Monoid Law Verification Template</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="kd">defmodule</span><span class="w"> </span><span class="nc">MonoidLawTester</span><span class="w"> </span><span class="k" data-group-id="6707879736-1">do</span><span class="w">
  </span><span class="kn">import</span><span class="w"> </span><span class="nc">Funx.Monoid</span><span class="w">
  
  </span><span class="c1"># Generic test for any monoid implementation</span><span class="w">
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">verify_monoid_laws</span><span class="p" data-group-id="6707879736-2">(</span><span class="n">monoid_module</span><span class="p">,</span><span class="w"> </span><span class="n">test_values</span><span class="p" data-group-id="6707879736-2">)</span><span class="w"> </span><span class="k" data-group-id="6707879736-3">do</span><span class="w">
    </span><span class="p" data-group-id="6707879736-4">[</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p" data-group-id="6707879736-4">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">test_values</span><span class="w">
    </span><span class="n">m</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">struct</span><span class="p" data-group-id="6707879736-5">(</span><span class="n">monoid_module</span><span class="p" data-group-id="6707879736-5">)</span><span class="w">
    
    </span><span class="c1"># Left Identity: empty + a = a</span><span class="w">
    </span><span class="n">left_identity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">append</span><span class="p" data-group-id="6707879736-6">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">empty</span><span class="p" data-group-id="6707879736-7">(</span><span class="n">m</span><span class="p" data-group-id="6707879736-7">)</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p" data-group-id="6707879736-6">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">a</span><span class="w">
    
    </span><span class="c1"># Right Identity: a + empty = a  </span><span class="w">
    </span><span class="n">right_identity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">append</span><span class="p" data-group-id="6707879736-8">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">empty</span><span class="p" data-group-id="6707879736-9">(</span><span class="n">m</span><span class="p" data-group-id="6707879736-9">)</span><span class="p" data-group-id="6707879736-8">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">a</span><span class="w">
    
    </span><span class="c1"># Associativity: (a + b) + c = a + (b + c)</span><span class="w">
    </span><span class="n">left_assoc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">append</span><span class="p" data-group-id="6707879736-10">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">append</span><span class="p" data-group-id="6707879736-11">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p" data-group-id="6707879736-11">)</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p" data-group-id="6707879736-10">)</span><span class="w">
    </span><span class="n">right_assoc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">append</span><span class="p" data-group-id="6707879736-12">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">append</span><span class="p" data-group-id="6707879736-13">(</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p" data-group-id="6707879736-13">)</span><span class="p" data-group-id="6707879736-12">)</span><span class="w">
    </span><span class="n">associativity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">left_assoc</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">right_assoc</span><span class="w">
    
    </span><span class="p" data-group-id="6707879736-14">%{</span><span class="w">
      </span><span class="ss">left_identity</span><span class="p">:</span><span class="w"> </span><span class="n">left_identity</span><span class="p">,</span><span class="w">
      </span><span class="ss">right_identity</span><span class="p">:</span><span class="w"> </span><span class="n">right_identity</span><span class="p">,</span><span class="w">
      </span><span class="ss">associativity</span><span class="p">:</span><span class="w"> </span><span class="n">associativity</span><span class="p">,</span><span class="w">
      </span><span class="ss">all_laws_hold</span><span class="p">:</span><span class="w"> </span><span class="n">left_identity</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">right_identity</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">associativity</span><span class="w">
    </span><span class="p" data-group-id="6707879736-14">}</span><span class="w">
  </span><span class="k" data-group-id="6707879736-3">end</span><span class="w">
  
  </span><span class="c1"># Test built-in monoids</span><span class="w">
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">test_built_in_monoids</span><span class="p" data-group-id="6707879736-15">(</span><span class="p" data-group-id="6707879736-15">)</span><span class="w"> </span><span class="k" data-group-id="6707879736-16">do</span><span class="w">
    </span><span class="c1"># Test Sum monoid</span><span class="w">
    </span><span class="n">sum_result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">verify_monoid_laws</span><span class="p" data-group-id="6707879736-17">(</span><span class="nc">Funx.Monoid.Sum</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6707879736-18">[</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p" data-group-id="6707879736-18">]</span><span class="p" data-group-id="6707879736-17">)</span><span class="w">
    </span><span class="nc">IO</span><span class="o">.</span><span class="n">inspect</span><span class="p" data-group-id="6707879736-19">(</span><span class="n">sum_result</span><span class="p">,</span><span class="w"> </span><span class="ss">label</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Sum monoid laws&quot;</span><span class="p" data-group-id="6707879736-19">)</span><span class="w">
    
    </span><span class="c1"># Test Product monoid  </span><span class="w">
    </span><span class="n">product_result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">verify_monoid_laws</span><span class="p" data-group-id="6707879736-20">(</span><span class="nc">Funx.Monoid.Product</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6707879736-21">[</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p" data-group-id="6707879736-21">]</span><span class="p" data-group-id="6707879736-20">)</span><span class="w">
    </span><span class="nc">IO</span><span class="o">.</span><span class="n">inspect</span><span class="p" data-group-id="6707879736-22">(</span><span class="n">product_result</span><span class="p">,</span><span class="w"> </span><span class="ss">label</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Product monoid laws&quot;</span><span class="p" data-group-id="6707879736-22">)</span><span class="w">
    
    </span><span class="c1"># Test List concatenation</span><span class="w">
    </span><span class="n">list_result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">verify_monoid_laws</span><span class="p" data-group-id="6707879736-23">(</span><span class="nc">Funx.Monoid.ListConcat</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6707879736-24">[</span><span class="p" data-group-id="6707879736-25">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="6707879736-25">]</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6707879736-26">[</span><span class="mi">3</span><span class="p" data-group-id="6707879736-26">]</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6707879736-27">[</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p" data-group-id="6707879736-27">]</span><span class="p" data-group-id="6707879736-24">]</span><span class="p" data-group-id="6707879736-23">)</span><span class="w">
    </span><span class="nc">IO</span><span class="o">.</span><span class="n">inspect</span><span class="p" data-group-id="6707879736-28">(</span><span class="n">list_result</span><span class="p">,</span><span class="w"> </span><span class="ss">label</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ListConcat monoid laws&quot;</span><span class="p" data-group-id="6707879736-28">)</span><span class="w">
  </span><span class="k" data-group-id="6707879736-16">end</span><span class="w">
</span><span class="k" data-group-id="6707879736-1">end</span></code></pre><h3 id="parallel-computation-with-monoids-template" class="section-heading">
  <a href="#parallel-computation-with-monoids-template" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Parallel Computation with Monoids Template</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="kd">defmodule</span><span class="w"> </span><span class="nc">ParallelProcessor</span><span class="w"> </span><span class="k" data-group-id="1132906863-1">do</span><span class="w">
  </span><span class="kn">alias</span><span class="w"> </span><span class="nc">Funx.Math</span><span class="w">
  
  </span><span class="c1"># Monoids enable safe parallel computation due to associativity</span><span class="w">
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">parallel_sum</span><span class="p" data-group-id="1132906863-2">(</span><span class="n">large_list</span><span class="p" data-group-id="1132906863-2">)</span><span class="w"> </span><span class="k" data-group-id="1132906863-3">do</span><span class="w">
    </span><span class="n">large_list</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">chunk_every</span><span class="p" data-group-id="1132906863-4">(</span><span class="mi">1000</span><span class="p" data-group-id="1132906863-4">)</span><span class="w">  </span><span class="c1"># Split into chunks</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Task</span><span class="o">.</span><span class="n">async_stream</span><span class="p" data-group-id="1132906863-5">(</span><span class="o">&amp;</span><span class="nc">Math</span><span class="o">.</span><span class="n">sum</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">max_concurrency</span><span class="p">:</span><span class="w"> </span><span class="nc">System</span><span class="o">.</span><span class="n">schedulers</span><span class="p" data-group-id="1132906863-6">(</span><span class="p" data-group-id="1132906863-6">)</span><span class="p" data-group-id="1132906863-5">)</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">map</span><span class="p" data-group-id="1132906863-7">(</span><span class="k" data-group-id="1132906863-8">fn</span><span class="w"> </span><span class="p" data-group-id="1132906863-9">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">partial_sum</span><span class="p" data-group-id="1132906863-9">}</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">partial_sum</span><span class="w"> </span><span class="k" data-group-id="1132906863-8">end</span><span class="p" data-group-id="1132906863-7">)</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Math</span><span class="o">.</span><span class="n">sum</span><span class="p" data-group-id="1132906863-10">(</span><span class="p" data-group-id="1132906863-10">)</span><span class="w">  </span><span class="c1"># Combine partial results</span><span class="w">
  </span><span class="k" data-group-id="1132906863-3">end</span><span class="w">
  
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">parallel_statistics</span><span class="p" data-group-id="1132906863-11">(</span><span class="n">data_chunks</span><span class="p" data-group-id="1132906863-11">)</span><span class="w"> </span><span class="k" data-group-id="1132906863-12">do</span><span class="w">
    </span><span class="c1"># Process chunks in parallel, then combine results</span><span class="w">
    </span><span class="n">stats</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data_chunks</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Task</span><span class="o">.</span><span class="n">async_stream</span><span class="p" data-group-id="1132906863-13">(</span><span class="k" data-group-id="1132906863-14">fn</span><span class="w"> </span><span class="n">chunk</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
      </span><span class="p" data-group-id="1132906863-15">%{</span><span class="w">
        </span><span class="ss">count</span><span class="p">:</span><span class="w"> </span><span class="n">length</span><span class="p" data-group-id="1132906863-16">(</span><span class="n">chunk</span><span class="p" data-group-id="1132906863-16">)</span><span class="p">,</span><span class="w">
        </span><span class="ss">sum</span><span class="p">:</span><span class="w"> </span><span class="nc">Math</span><span class="o">.</span><span class="n">sum</span><span class="p" data-group-id="1132906863-17">(</span><span class="n">chunk</span><span class="p" data-group-id="1132906863-17">)</span><span class="p">,</span><span class="w">
        </span><span class="ss">max</span><span class="p">:</span><span class="w"> </span><span class="nc">Math</span><span class="o">.</span><span class="n">max</span><span class="p" data-group-id="1132906863-18">(</span><span class="n">chunk</span><span class="p" data-group-id="1132906863-18">)</span><span class="p">,</span><span class="w">
        </span><span class="ss">min</span><span class="p">:</span><span class="w"> </span><span class="nc">Math</span><span class="o">.</span><span class="n">min</span><span class="p" data-group-id="1132906863-19">(</span><span class="n">chunk</span><span class="p" data-group-id="1132906863-19">)</span><span class="w">
      </span><span class="p" data-group-id="1132906863-15">}</span><span class="w">
    </span><span class="k" data-group-id="1132906863-14">end</span><span class="p">,</span><span class="w"> </span><span class="ss">max_concurrency</span><span class="p">:</span><span class="w"> </span><span class="nc">System</span><span class="o">.</span><span class="n">schedulers</span><span class="p" data-group-id="1132906863-20">(</span><span class="p" data-group-id="1132906863-20">)</span><span class="p" data-group-id="1132906863-13">)</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">map</span><span class="p" data-group-id="1132906863-21">(</span><span class="k" data-group-id="1132906863-22">fn</span><span class="w"> </span><span class="p" data-group-id="1132906863-23">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">stat</span><span class="p" data-group-id="1132906863-23">}</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">stat</span><span class="w"> </span><span class="k" data-group-id="1132906863-22">end</span><span class="p" data-group-id="1132906863-21">)</span><span class="w">
    
    </span><span class="c1"># Combine partial statistics using monoid properties</span><span class="w">
    </span><span class="p" data-group-id="1132906863-24">%{</span><span class="w">
      </span><span class="ss">total_count</span><span class="p">:</span><span class="w"> </span><span class="nc">Math</span><span class="o">.</span><span class="n">sum</span><span class="p" data-group-id="1132906863-25">(</span><span class="nc">Enum</span><span class="o">.</span><span class="n">map</span><span class="p" data-group-id="1132906863-26">(</span><span class="n">stats</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="ni">&amp;1</span><span class="o">.</span><span class="n">count</span><span class="p" data-group-id="1132906863-26">)</span><span class="p" data-group-id="1132906863-25">)</span><span class="p">,</span><span class="w">
      </span><span class="ss">total_sum</span><span class="p">:</span><span class="w"> </span><span class="nc">Math</span><span class="o">.</span><span class="n">sum</span><span class="p" data-group-id="1132906863-27">(</span><span class="nc">Enum</span><span class="o">.</span><span class="n">map</span><span class="p" data-group-id="1132906863-28">(</span><span class="n">stats</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="ni">&amp;1</span><span class="o">.</span><span class="n">sum</span><span class="p" data-group-id="1132906863-28">)</span><span class="p" data-group-id="1132906863-27">)</span><span class="p">,</span><span class="w">
      </span><span class="ss">overall_max</span><span class="p">:</span><span class="w"> </span><span class="nc">Math</span><span class="o">.</span><span class="n">max</span><span class="p" data-group-id="1132906863-29">(</span><span class="nc">Enum</span><span class="o">.</span><span class="n">map</span><span class="p" data-group-id="1132906863-30">(</span><span class="n">stats</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="ni">&amp;1</span><span class="o">.</span><span class="n">max</span><span class="p" data-group-id="1132906863-30">)</span><span class="p" data-group-id="1132906863-29">)</span><span class="p">,</span><span class="w">
      </span><span class="ss">overall_min</span><span class="p">:</span><span class="w"> </span><span class="nc">Math</span><span class="o">.</span><span class="n">min</span><span class="p" data-group-id="1132906863-31">(</span><span class="nc">Enum</span><span class="o">.</span><span class="n">map</span><span class="p" data-group-id="1132906863-32">(</span><span class="n">stats</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="ni">&amp;1</span><span class="o">.</span><span class="n">min</span><span class="p" data-group-id="1132906863-32">)</span><span class="p" data-group-id="1132906863-31">)</span><span class="w">
    </span><span class="p" data-group-id="1132906863-24">}</span><span class="w">
  </span><span class="k" data-group-id="1132906863-12">end</span><span class="w">
</span><span class="k" data-group-id="1132906863-1">end</span></code></pre><h3 id="utils-integration-template" class="section-heading">
  <a href="#utils-integration-template" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Utils Integration Template</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="kd">defmodule</span><span class="w"> </span><span class="nc">MonoidWithUtils</span><span class="w"> </span><span class="k" data-group-id="8468759065-1">do</span><span class="w">
  </span><span class="kn">alias</span><span class="w"> </span><span class="nc">Funx.Utils</span><span class="w">
  </span><span class="kn">alias</span><span class="w"> </span><span class="nc">Funx.Math</span><span class="w">
  
  </span><span class="c1"># Create curried monoid operations</span><span class="w">
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">build_aggregators</span><span class="p" data-group-id="8468759065-2">(</span><span class="p" data-group-id="8468759065-2">)</span><span class="w"> </span><span class="k" data-group-id="8468759065-3">do</span><span class="w">
    </span><span class="c1"># Curry math operations for reuse</span><span class="w">
    </span><span class="n">sum_reducer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Utils</span><span class="o">.</span><span class="n">curry_r</span><span class="p" data-group-id="8468759065-4">(</span><span class="o">&amp;</span><span class="nc">Math</span><span class="o">.</span><span class="n">sum</span><span class="o">/</span><span class="mi">1</span><span class="p" data-group-id="8468759065-4">)</span><span class="w">
    </span><span class="n">product_reducer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Utils</span><span class="o">.</span><span class="n">curry_r</span><span class="p" data-group-id="8468759065-5">(</span><span class="o">&amp;</span><span class="nc">Math</span><span class="o">.</span><span class="n">product</span><span class="o">/</span><span class="mi">1</span><span class="p" data-group-id="8468759065-5">)</span><span class="w">
    </span><span class="n">max_finder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Utils</span><span class="o">.</span><span class="n">curry_r</span><span class="p" data-group-id="8468759065-6">(</span><span class="o">&amp;</span><span class="nc">Math</span><span class="o">.</span><span class="n">max</span><span class="o">/</span><span class="mi">1</span><span class="p" data-group-id="8468759065-6">)</span><span class="w">
    
    </span><span class="c1"># Create specialized aggregators</span><span class="w">
    </span><span class="n">sum_by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="8468759065-7">fn</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
      </span><span class="k" data-group-id="8468759065-8">fn</span><span class="w"> </span><span class="n">data_list</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
        </span><span class="n">data_list</span><span class="w">
        </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">map</span><span class="p" data-group-id="8468759065-9">(</span><span class="o">&amp;</span><span class="nc">Map</span><span class="o">.</span><span class="n">get</span><span class="p" data-group-id="8468759065-10">(</span><span class="ni">&amp;1</span><span class="p">,</span><span class="w"> </span><span class="n">key</span><span class="p" data-group-id="8468759065-10">)</span><span class="p" data-group-id="8468759065-9">)</span><span class="w">
        </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Math</span><span class="o">.</span><span class="n">sum</span><span class="p" data-group-id="8468759065-11">(</span><span class="p" data-group-id="8468759065-11">)</span><span class="w">
      </span><span class="k" data-group-id="8468759065-8">end</span><span class="w">
    </span><span class="k" data-group-id="8468759065-7">end</span><span class="w">
    
    </span><span class="n">product_by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="8468759065-12">fn</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
      </span><span class="k" data-group-id="8468759065-13">fn</span><span class="w"> </span><span class="n">data_list</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
        </span><span class="n">data_list</span><span class="w">
        </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">map</span><span class="p" data-group-id="8468759065-14">(</span><span class="o">&amp;</span><span class="nc">Map</span><span class="o">.</span><span class="n">get</span><span class="p" data-group-id="8468759065-15">(</span><span class="ni">&amp;1</span><span class="p">,</span><span class="w"> </span><span class="n">key</span><span class="p" data-group-id="8468759065-15">)</span><span class="p" data-group-id="8468759065-14">)</span><span class="w">  
        </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Math</span><span class="o">.</span><span class="n">product</span><span class="p" data-group-id="8468759065-16">(</span><span class="p" data-group-id="8468759065-16">)</span><span class="w">
      </span><span class="k" data-group-id="8468759065-13">end</span><span class="w">
    </span><span class="k" data-group-id="8468759065-12">end</span><span class="w">
    
    </span><span class="p" data-group-id="8468759065-17">%{</span><span class="w">
      </span><span class="ss">sum_reducer</span><span class="p">:</span><span class="w"> </span><span class="n">sum_reducer</span><span class="p">,</span><span class="w">
      </span><span class="ss">product_reducer</span><span class="p">:</span><span class="w"> </span><span class="n">product_reducer</span><span class="p">,</span><span class="w">
      </span><span class="ss">max_finder</span><span class="p">:</span><span class="w"> </span><span class="n">max_finder</span><span class="p">,</span><span class="w">
      </span><span class="ss">sum_by</span><span class="p">:</span><span class="w"> </span><span class="n">sum_by</span><span class="p">,</span><span class="w">
      </span><span class="ss">product_by</span><span class="p">:</span><span class="w"> </span><span class="n">product_by</span><span class="w">
    </span><span class="p" data-group-id="8468759065-17">}</span><span class="w">
  </span><span class="k" data-group-id="8468759065-3">end</span><span class="w">
  
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">analyze_grouped_data</span><span class="p" data-group-id="8468759065-18">(</span><span class="n">grouped_data</span><span class="p" data-group-id="8468759065-18">)</span><span class="w"> </span><span class="k" data-group-id="8468759065-19">do</span><span class="w">
    </span><span class="n">aggregators</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">build_aggregators</span><span class="p" data-group-id="8468759065-20">(</span><span class="p" data-group-id="8468759065-20">)</span><span class="w">
    
    </span><span class="c1"># Apply different aggregations to different groups</span><span class="w">
    </span><span class="k">for</span><span class="w"> </span><span class="p" data-group-id="8468759065-21">{</span><span class="n">group</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p" data-group-id="8468759065-21">}</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">grouped_data</span><span class="w"> </span><span class="k" data-group-id="8468759065-22">do</span><span class="w">
      </span><span class="p" data-group-id="8468759065-23">{</span><span class="n">group</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8468759065-24">%{</span><span class="w">
        </span><span class="ss">total_score</span><span class="p">:</span><span class="w"> </span><span class="n">aggregators</span><span class="o">.</span><span class="n">sum_by</span><span class="o">.</span><span class="p" data-group-id="8468759065-25">(</span><span class="ss">:score</span><span class="p" data-group-id="8468759065-25">)</span><span class="o">.</span><span class="p" data-group-id="8468759065-26">(</span><span class="n">data</span><span class="p" data-group-id="8468759065-26">)</span><span class="p">,</span><span class="w">
        </span><span class="ss">multiplied_weights</span><span class="p">:</span><span class="w"> </span><span class="n">aggregators</span><span class="o">.</span><span class="n">product_by</span><span class="o">.</span><span class="p" data-group-id="8468759065-27">(</span><span class="ss">:weight</span><span class="p" data-group-id="8468759065-27">)</span><span class="o">.</span><span class="p" data-group-id="8468759065-28">(</span><span class="n">data</span><span class="p" data-group-id="8468759065-28">)</span><span class="p">,</span><span class="w">
        </span><span class="ss">count</span><span class="p">:</span><span class="w"> </span><span class="n">length</span><span class="p" data-group-id="8468759065-29">(</span><span class="n">data</span><span class="p" data-group-id="8468759065-29">)</span><span class="w">
      </span><span class="p" data-group-id="8468759065-24">}</span><span class="p" data-group-id="8468759065-23">}</span><span class="w">
    </span><span class="k" data-group-id="8468759065-22">end</span><span class="w">
  </span><span class="k" data-group-id="8468759065-19">end</span><span class="w">
</span><span class="k" data-group-id="8468759065-1">end</span></code></pre><h3 id="predicate-integration-template" class="section-heading">
  <a href="#predicate-integration-template" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Predicate Integration Template</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="kd">defmodule</span><span class="w"> </span><span class="nc">MonoidPredicateIntegration</span><span class="w"> </span><span class="k" data-group-id="0675885668-1">do</span><span class="w">
  </span><span class="kn">alias</span><span class="w"> </span><span class="nc">Funx.Predicate</span><span class="w">
  </span><span class="kn">alias</span><span class="w"> </span><span class="nc">Funx.Monoid.Utils</span><span class="p">,</span><span class="w"> </span><span class="ss">as</span><span class="p">:</span><span class="w"> </span><span class="nc">MU</span><span class="w">
  </span><span class="kn">alias</span><span class="w"> </span><span class="nc">Funx.Monoid.Predicate</span><span class="o">.</span><span class="p" data-group-id="0675885668-2">{</span><span class="nc">All</span><span class="p">,</span><span class="w"> </span><span class="nc">Any</span><span class="p" data-group-id="0675885668-2">}</span><span class="w">
  
  </span><span class="c1"># Predicates use specific monoids internally for combination</span><span class="w">
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">build_complex_validators</span><span class="p" data-group-id="0675885668-3">(</span><span class="p" data-group-id="0675885668-3">)</span><span class="w"> </span><span class="k" data-group-id="0675885668-4">do</span><span class="w">
    </span><span class="c1"># Individual predicates  </span><span class="w">
    </span><span class="n">is_adult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="0675885668-5">fn</span><span class="w"> </span><span class="n">person</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">person</span><span class="o">.</span><span class="n">age</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">18</span><span class="w"> </span><span class="k" data-group-id="0675885668-5">end</span><span class="w">
    </span><span class="n">has_email</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="0675885668-6">fn</span><span class="w"> </span><span class="n">person</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">String</span><span class="o">.</span><span class="n">contains?</span><span class="p" data-group-id="0675885668-7">(</span><span class="n">person</span><span class="o">.</span><span class="n">email</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;@&quot;</span><span class="p" data-group-id="0675885668-7">)</span><span class="w"> </span><span class="k" data-group-id="0675885668-6">end</span><span class="w">
    </span><span class="n">has_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="0675885668-8">fn</span><span class="w"> </span><span class="n">person</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">String</span><span class="o">.</span><span class="n">length</span><span class="p" data-group-id="0675885668-9">(</span><span class="n">person</span><span class="o">.</span><span class="n">name</span><span class="p" data-group-id="0675885668-9">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k" data-group-id="0675885668-8">end</span><span class="w">
    </span><span class="n">is_verified</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="0675885668-10">fn</span><span class="w"> </span><span class="n">person</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">person</span><span class="o">.</span><span class="n">verified</span><span class="w"> </span><span class="k" data-group-id="0675885668-10">end</span><span class="w">
    
    </span><span class="c1"># Combine using predicate utilities (which use Predicate.All/Any monoids internally)</span><span class="w">
    </span><span class="c1"># p_all uses m_concat with %All{} monoid</span><span class="w">
    </span><span class="n">strict_validator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">p_all</span><span class="p" data-group-id="0675885668-11">(</span><span class="p" data-group-id="0675885668-12">[</span><span class="n">is_adult</span><span class="p">,</span><span class="w"> </span><span class="n">has_email</span><span class="p">,</span><span class="w"> </span><span class="n">has_name</span><span class="p">,</span><span class="w"> </span><span class="n">is_verified</span><span class="p" data-group-id="0675885668-12">]</span><span class="p" data-group-id="0675885668-11">)</span><span class="w">
    </span><span class="n">basic_validator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">p_all</span><span class="p" data-group-id="0675885668-13">(</span><span class="p" data-group-id="0675885668-14">[</span><span class="n">has_email</span><span class="p">,</span><span class="w"> </span><span class="n">has_name</span><span class="p" data-group-id="0675885668-14">]</span><span class="p" data-group-id="0675885668-13">)</span><span class="w">
    
    </span><span class="c1"># p_any uses m_concat with %Any{} monoid  </span><span class="w">
    </span><span class="n">flexible_validator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">p_any</span><span class="p" data-group-id="0675885668-15">(</span><span class="p" data-group-id="0675885668-16">[</span><span class="n">is_adult</span><span class="p">,</span><span class="w"> </span><span class="n">is_verified</span><span class="p" data-group-id="0675885668-16">]</span><span class="p" data-group-id="0675885668-15">)</span><span class="w">
    
    </span><span class="p" data-group-id="0675885668-17">%{</span><span class="w">
      </span><span class="ss">strict</span><span class="p">:</span><span class="w"> </span><span class="n">strict_validator</span><span class="p">,</span><span class="w">
      </span><span class="ss">basic</span><span class="p">:</span><span class="w"> </span><span class="n">basic_validator</span><span class="p">,</span><span class="w">
      </span><span class="ss">flexible</span><span class="p">:</span><span class="w"> </span><span class="n">flexible_validator</span><span class="w">
    </span><span class="p" data-group-id="0675885668-17">}</span><span class="w">
  </span><span class="k" data-group-id="0675885668-4">end</span><span class="w">
  
  </span><span class="c1"># Show how predicates compose via specific monoid types</span><span class="w">
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">demonstrate_predicate_monoid_connection</span><span class="p" data-group-id="0675885668-18">(</span><span class="p" data-group-id="0675885668-18">)</span><span class="w"> </span><span class="k" data-group-id="0675885668-19">do</span><span class="w">
    </span><span class="c1"># These predicates use Predicate.All/Any monoids internally</span><span class="w">
    </span><span class="n">predicate1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="0675885668-20">fn</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k" data-group-id="0675885668-20">end</span><span class="w">
    </span><span class="n">predicate2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="0675885668-21">fn</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="k" data-group-id="0675885668-21">end</span><span class="w">  
    </span><span class="n">predicate3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="0675885668-22">fn</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">rem</span><span class="p" data-group-id="0675885668-23">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="0675885668-23">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k" data-group-id="0675885668-22">end</span><span class="w">
    
    </span><span class="c1"># p_all uses m_concat(%All{}, predicates) for AND combination</span><span class="w">
    </span><span class="n">all_validator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">p_all</span><span class="p" data-group-id="0675885668-24">(</span><span class="p" data-group-id="0675885668-25">[</span><span class="n">predicate1</span><span class="p">,</span><span class="w"> </span><span class="n">predicate2</span><span class="p">,</span><span class="w"> </span><span class="n">predicate3</span><span class="p" data-group-id="0675885668-25">]</span><span class="p" data-group-id="0675885668-24">)</span><span class="w">
    
    </span><span class="c1"># p_any uses m_concat(%Any{}, predicates) for OR combination  </span><span class="w">
    </span><span class="n">any_validator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">p_any</span><span class="p" data-group-id="0675885668-26">(</span><span class="p" data-group-id="0675885668-27">[</span><span class="n">predicate1</span><span class="p">,</span><span class="w"> </span><span class="n">predicate2</span><span class="p">,</span><span class="w"> </span><span class="n">predicate3</span><span class="p" data-group-id="0675885668-27">]</span><span class="p" data-group-id="0675885668-26">)</span><span class="w">
    
    </span><span class="c1"># You could also use monoids directly (though predicates are cleaner)</span><span class="w">
    </span><span class="n">manual_all</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">MU</span><span class="o">.</span><span class="n">m_concat</span><span class="p" data-group-id="0675885668-28">(</span><span class="p" data-group-id="0675885668-29">%</span><span class="nc" data-group-id="0675885668-29">All</span><span class="p" data-group-id="0675885668-29">{</span><span class="p" data-group-id="0675885668-29">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0675885668-30">[</span><span class="n">predicate1</span><span class="p">,</span><span class="w"> </span><span class="n">predicate2</span><span class="p">,</span><span class="w"> </span><span class="n">predicate3</span><span class="p" data-group-id="0675885668-30">]</span><span class="p" data-group-id="0675885668-28">)</span><span class="w">
    </span><span class="n">manual_any</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">MU</span><span class="o">.</span><span class="n">m_concat</span><span class="p" data-group-id="0675885668-31">(</span><span class="p" data-group-id="0675885668-32">%</span><span class="nc" data-group-id="0675885668-32">Any</span><span class="p" data-group-id="0675885668-32">{</span><span class="p" data-group-id="0675885668-32">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0675885668-33">[</span><span class="n">predicate1</span><span class="p">,</span><span class="w"> </span><span class="n">predicate2</span><span class="p">,</span><span class="w"> </span><span class="n">predicate3</span><span class="p" data-group-id="0675885668-33">]</span><span class="p" data-group-id="0675885668-31">)</span><span class="w">
    
    </span><span class="c1"># Test values</span><span class="w">
    </span><span class="n">test_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">42</span><span class="w">
    
    </span><span class="p" data-group-id="0675885668-34">%{</span><span class="w">
      </span><span class="ss">predicate_all</span><span class="p">:</span><span class="w"> </span><span class="n">all_validator</span><span class="o">.</span><span class="p" data-group-id="0675885668-35">(</span><span class="n">test_value</span><span class="p" data-group-id="0675885668-35">)</span><span class="p">,</span><span class="w">  </span><span class="c1"># true (42 &gt; 0 AND 42 &lt; 100 AND even)</span><span class="w">
      </span><span class="ss">predicate_any</span><span class="p">:</span><span class="w"> </span><span class="n">any_validator</span><span class="o">.</span><span class="p" data-group-id="0675885668-36">(</span><span class="n">test_value</span><span class="p" data-group-id="0675885668-36">)</span><span class="p">,</span><span class="w">  </span><span class="c1"># true (42 &gt; 0 OR 42 &lt; 100 OR even)</span><span class="w">
      </span><span class="ss">manual_all</span><span class="p">:</span><span class="w"> </span><span class="n">manual_all</span><span class="o">.</span><span class="p" data-group-id="0675885668-37">(</span><span class="n">test_value</span><span class="p" data-group-id="0675885668-37">)</span><span class="p">,</span><span class="w">        </span><span class="c1"># Same result as predicate_all</span><span class="w">
      </span><span class="ss">manual_any</span><span class="p">:</span><span class="w"> </span><span class="n">manual_any</span><span class="o">.</span><span class="p" data-group-id="0675885668-38">(</span><span class="n">test_value</span><span class="p" data-group-id="0675885668-38">)</span><span class="w">         </span><span class="c1"># Same result as predicate_any</span><span class="w">
    </span><span class="p" data-group-id="0675885668-34">}</span><span class="w">
  </span><span class="k" data-group-id="0675885668-19">end</span><span class="w">
  
  </span><span class="c1"># Show the monoid identities that predicates rely on</span><span class="w">
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">demonstrate_predicate_monoid_laws</span><span class="p" data-group-id="0675885668-39">(</span><span class="p" data-group-id="0675885668-39">)</span><span class="w"> </span><span class="k" data-group-id="0675885668-40">do</span><span class="w">
    </span><span class="kn">import</span><span class="w"> </span><span class="nc">Funx.Monoid</span><span class="w">
    
    </span><span class="c1"># All monoid: identity is function that always returns true</span><span class="w">
    </span><span class="n">all_identity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">empty</span><span class="p" data-group-id="0675885668-41">(</span><span class="p" data-group-id="0675885668-42">%</span><span class="nc" data-group-id="0675885668-42">All</span><span class="p" data-group-id="0675885668-42">{</span><span class="p" data-group-id="0675885668-42">}</span><span class="p" data-group-id="0675885668-41">)</span><span class="w">
    </span><span class="nc">IO</span><span class="o">.</span><span class="n">inspect</span><span class="p" data-group-id="0675885668-43">(</span><span class="n">all_identity</span><span class="o">.</span><span class="p" data-group-id="0675885668-44">(</span><span class="ss">:anything</span><span class="p" data-group-id="0675885668-44">)</span><span class="p">,</span><span class="w"> </span><span class="ss">label</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;All monoid identity&quot;</span><span class="p" data-group-id="0675885668-43">)</span><span class="w">  </span><span class="c1"># true</span><span class="w">
    
    </span><span class="c1"># Any monoid: identity is function that always returns false  </span><span class="w">
    </span><span class="n">any_identity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">empty</span><span class="p" data-group-id="0675885668-45">(</span><span class="p" data-group-id="0675885668-46">%</span><span class="nc" data-group-id="0675885668-46">Any</span><span class="p" data-group-id="0675885668-46">{</span><span class="p" data-group-id="0675885668-46">}</span><span class="p" data-group-id="0675885668-45">)</span><span class="w">
    </span><span class="nc">IO</span><span class="o">.</span><span class="n">inspect</span><span class="p" data-group-id="0675885668-47">(</span><span class="n">any_identity</span><span class="o">.</span><span class="p" data-group-id="0675885668-48">(</span><span class="ss">:anything</span><span class="p" data-group-id="0675885668-48">)</span><span class="p">,</span><span class="w"> </span><span class="ss">label</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Any monoid identity&quot;</span><span class="p" data-group-id="0675885668-47">)</span><span class="w">  </span><span class="c1"># false</span><span class="w">
    
    </span><span class="c1"># This is why p_all([]) returns true and p_any([]) returns false</span><span class="w">
    </span><span class="n">empty_all</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">p_all</span><span class="p" data-group-id="0675885668-49">(</span><span class="p" data-group-id="0675885668-50">[</span><span class="p" data-group-id="0675885668-50">]</span><span class="p" data-group-id="0675885668-49">)</span><span class="w">
    </span><span class="n">empty_any</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">p_any</span><span class="p" data-group-id="0675885668-51">(</span><span class="p" data-group-id="0675885668-52">[</span><span class="p" data-group-id="0675885668-52">]</span><span class="p" data-group-id="0675885668-51">)</span><span class="w">
    
    </span><span class="p" data-group-id="0675885668-53">%{</span><span class="w">
      </span><span class="ss">empty_all_result</span><span class="p">:</span><span class="w"> </span><span class="n">empty_all</span><span class="o">.</span><span class="p" data-group-id="0675885668-54">(</span><span class="ss">:test</span><span class="p" data-group-id="0675885668-54">)</span><span class="p">,</span><span class="w">  </span><span class="c1"># true (All identity)</span><span class="w">
      </span><span class="ss">empty_any_result</span><span class="p">:</span><span class="w"> </span><span class="n">empty_any</span><span class="o">.</span><span class="p" data-group-id="0675885668-55">(</span><span class="ss">:test</span><span class="p" data-group-id="0675885668-55">)</span><span class="w">   </span><span class="c1"># false (Any identity)</span><span class="w">
    </span><span class="p" data-group-id="0675885668-53">}</span><span class="w">
  </span><span class="k" data-group-id="0675885668-40">end</span><span class="w">
</span><span class="k" data-group-id="0675885668-1">end</span></code></pre><h2 id="llm-testing-guidance" class="section-heading">
  <a href="#llm-testing-guidance" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">LLM Testing Guidance</span>
</h2>
<h3 id="test-monoid-laws" class="section-heading">
  <a href="#test-monoid-laws" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Test Monoid Laws</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="kd">defmodule</span><span class="w"> </span><span class="nc">MonoidTest</span><span class="w"> </span><span class="k" data-group-id="0853349161-1">do</span><span class="w">
  </span><span class="kn">use</span><span class="w"> </span><span class="nc">ExUnit.Case</span><span class="w">
  </span><span class="kn">import</span><span class="w"> </span><span class="nc">Funx.Monoid</span><span class="w">
  
  </span><span class="c1"># Test that custom monoids satisfy laws</span><span class="w">
  </span><span class="n">test</span><span class="w"> </span><span class="s">&quot;UserPreferences monoid satisfies laws&quot;</span><span class="w"> </span><span class="k" data-group-id="0853349161-2">do</span><span class="w">
    </span><span class="n">prefs1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="0853349161-3">%</span><span class="nc" data-group-id="0853349161-3">UserPreferences</span><span class="p" data-group-id="0853349161-3">{</span><span class="ss">theme</span><span class="p">:</span><span class="w"> </span><span class="ss">:dark</span><span class="p">,</span><span class="w"> </span><span class="ss">language</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;en&quot;</span><span class="p" data-group-id="0853349161-3">}</span><span class="w">
    </span><span class="n">prefs2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="0853349161-4">%</span><span class="nc" data-group-id="0853349161-4">UserPreferences</span><span class="p" data-group-id="0853349161-4">{</span><span class="ss">notifications</span><span class="p">:</span><span class="w"> </span><span class="no">false</span><span class="p" data-group-id="0853349161-4">}</span><span class="w">
    </span><span class="n">prefs3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="0853349161-5">%</span><span class="nc" data-group-id="0853349161-5">UserPreferences</span><span class="p" data-group-id="0853349161-5">{</span><span class="ss">theme</span><span class="p">:</span><span class="w"> </span><span class="ss">:light</span><span class="p">,</span><span class="w"> </span><span class="ss">language</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;es&quot;</span><span class="p" data-group-id="0853349161-5">}</span><span class="w">
    
    </span><span class="n">monoid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="0853349161-6">%</span><span class="nc" data-group-id="0853349161-6">Funx.Monoid.UserPreferences</span><span class="p" data-group-id="0853349161-6">{</span><span class="p" data-group-id="0853349161-6">}</span><span class="w">
    
    </span><span class="c1"># Test left identity: empty + a = a</span><span class="w">
    </span><span class="n">assert</span><span class="w"> </span><span class="n">append</span><span class="p" data-group-id="0853349161-7">(</span><span class="n">monoid</span><span class="p">,</span><span class="w"> </span><span class="n">empty</span><span class="p" data-group-id="0853349161-8">(</span><span class="n">monoid</span><span class="p" data-group-id="0853349161-8">)</span><span class="p">,</span><span class="w"> </span><span class="n">prefs1</span><span class="p" data-group-id="0853349161-7">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">prefs1</span><span class="w">
    
    </span><span class="c1"># Test right identity: a + empty = a</span><span class="w">
    </span><span class="n">assert</span><span class="w"> </span><span class="n">append</span><span class="p" data-group-id="0853349161-9">(</span><span class="n">monoid</span><span class="p">,</span><span class="w"> </span><span class="n">prefs1</span><span class="p">,</span><span class="w"> </span><span class="n">empty</span><span class="p" data-group-id="0853349161-10">(</span><span class="n">monoid</span><span class="p" data-group-id="0853349161-10">)</span><span class="p" data-group-id="0853349161-9">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">prefs1</span><span class="w">
    
    </span><span class="c1"># Test associativity: (a + b) + c = a + (b + c)</span><span class="w">
    </span><span class="n">left_assoc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">append</span><span class="p" data-group-id="0853349161-11">(</span><span class="n">monoid</span><span class="p">,</span><span class="w"> </span><span class="n">append</span><span class="p" data-group-id="0853349161-12">(</span><span class="n">monoid</span><span class="p">,</span><span class="w"> </span><span class="n">prefs1</span><span class="p">,</span><span class="w"> </span><span class="n">prefs2</span><span class="p" data-group-id="0853349161-12">)</span><span class="p">,</span><span class="w"> </span><span class="n">prefs3</span><span class="p" data-group-id="0853349161-11">)</span><span class="w">
    </span><span class="n">right_assoc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">append</span><span class="p" data-group-id="0853349161-13">(</span><span class="n">monoid</span><span class="p">,</span><span class="w"> </span><span class="n">prefs1</span><span class="p">,</span><span class="w"> </span><span class="n">append</span><span class="p" data-group-id="0853349161-14">(</span><span class="n">monoid</span><span class="p">,</span><span class="w"> </span><span class="n">prefs2</span><span class="p">,</span><span class="w"> </span><span class="n">prefs3</span><span class="p" data-group-id="0853349161-14">)</span><span class="p" data-group-id="0853349161-13">)</span><span class="w">
    </span><span class="n">assert</span><span class="w"> </span><span class="n">left_assoc</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">right_assoc</span><span class="w">
  </span><span class="k" data-group-id="0853349161-2">end</span><span class="w">
  
  </span><span class="n">test</span><span class="w"> </span><span class="s">&quot;Math utilities use monoids correctly&quot;</span><span class="w"> </span><span class="k" data-group-id="0853349161-15">do</span><span class="w">
    </span><span class="n">numbers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="0853349161-16">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p" data-group-id="0853349161-16">]</span><span class="w">
    
    </span><span class="c1"># These should be equivalent to manual monoid operations</span><span class="w">
    </span><span class="n">assert</span><span class="w"> </span><span class="nc">Math</span><span class="o">.</span><span class="n">sum</span><span class="p" data-group-id="0853349161-17">(</span><span class="n">numbers</span><span class="p" data-group-id="0853349161-17">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">15</span><span class="w">
    </span><span class="n">assert</span><span class="w"> </span><span class="nc">Math</span><span class="o">.</span><span class="n">product</span><span class="p" data-group-id="0853349161-18">(</span><span class="n">numbers</span><span class="p" data-group-id="0853349161-18">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">120</span><span class="w">
    
    </span><span class="c1"># Test empty list behavior (should return identity)</span><span class="w">
    </span><span class="n">assert</span><span class="w"> </span><span class="nc">Math</span><span class="o">.</span><span class="n">sum</span><span class="p" data-group-id="0853349161-19">(</span><span class="p" data-group-id="0853349161-20">[</span><span class="p" data-group-id="0853349161-20">]</span><span class="p" data-group-id="0853349161-19">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w">
    </span><span class="n">assert</span><span class="w"> </span><span class="nc">Math</span><span class="o">.</span><span class="n">product</span><span class="p" data-group-id="0853349161-21">(</span><span class="p" data-group-id="0853349161-22">[</span><span class="p" data-group-id="0853349161-22">]</span><span class="p" data-group-id="0853349161-21">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w">
  </span><span class="k" data-group-id="0853349161-15">end</span><span class="w">
</span><span class="k" data-group-id="0853349161-1">end</span></code></pre><h3 id="test-higher-level-utilities" class="section-heading">
  <a href="#test-higher-level-utilities" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Test Higher-Level Utilities</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="n">test</span><span class="w"> </span><span class="s">&quot;utility functions hide monoid complexity&quot;</span><span class="w"> </span><span class="k" data-group-id="6499734083-1">do</span><span class="w">
  </span><span class="c1"># Test that utilities work without exposing monoid details</span><span class="w">
  </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="6499734083-2">[</span><span class="w">
    </span><span class="p" data-group-id="6499734083-3">%{</span><span class="ss">score</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="ss">weight</span><span class="p">:</span><span class="w"> </span><span class="mf">0.5</span><span class="p" data-group-id="6499734083-3">}</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="6499734083-4">%{</span><span class="ss">score</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="ss">weight</span><span class="p">:</span><span class="w"> </span><span class="mf">1.0</span><span class="p" data-group-id="6499734083-4">}</span><span class="p">,</span><span class="w">  
    </span><span class="p" data-group-id="6499734083-5">%{</span><span class="ss">score</span><span class="p">:</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="ss">weight</span><span class="p">:</span><span class="w"> </span><span class="mf">0.8</span><span class="p" data-group-id="6499734083-5">}</span><span class="w">
  </span><span class="p" data-group-id="6499734083-2">]</span><span class="w">
  
  </span><span class="n">total_score</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">map</span><span class="p" data-group-id="6499734083-6">(</span><span class="o">&amp;</span><span class="w"> </span><span class="ni">&amp;1</span><span class="o">.</span><span class="n">score</span><span class="p" data-group-id="6499734083-6">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Math</span><span class="o">.</span><span class="n">sum</span><span class="p" data-group-id="6499734083-7">(</span><span class="p" data-group-id="6499734083-7">)</span><span class="w">
  </span><span class="n">assert</span><span class="w"> </span><span class="n">total_score</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">45</span><span class="w">
  
  </span><span class="n">total_weight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">map</span><span class="p" data-group-id="6499734083-8">(</span><span class="o">&amp;</span><span class="w"> </span><span class="ni">&amp;1</span><span class="o">.</span><span class="n">weight</span><span class="p" data-group-id="6499734083-8">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Math</span><span class="o">.</span><span class="n">sum</span><span class="p" data-group-id="6499734083-9">(</span><span class="p" data-group-id="6499734083-9">)</span><span class="w">
  </span><span class="n">assert</span><span class="w"> </span><span class="n">total_weight</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">2.3</span><span class="w">
</span><span class="k" data-group-id="6499734083-1">end</span></code></pre><h2 id="llm-debugging-tips" class="section-heading">
  <a href="#llm-debugging-tips" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">LLM Debugging Tips</span>
</h2>
<h3 id="debug-monoid-operations" class="section-heading">
  <a href="#debug-monoid-operations" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Debug Monoid Operations</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="kd">def</span><span class="w"> </span><span class="nf">debug_monoid_combination</span><span class="p" data-group-id="5573742461-1">(</span><span class="n">monoid</span><span class="p">,</span><span class="w"> </span><span class="n">values</span><span class="p" data-group-id="5573742461-1">)</span><span class="w"> </span><span class="k" data-group-id="5573742461-2">do</span><span class="w">
  </span><span class="nc">IO</span><span class="o">.</span><span class="n">puts</span><span class="p" data-group-id="5573742461-3">(</span><span class="s">&quot;Debugging monoid: </span><span class="si" data-group-id="5573742461-4">#{</span><span class="n">inspect</span><span class="p" data-group-id="5573742461-5">(</span><span class="n">monoid</span><span class="p" data-group-id="5573742461-5">)</span><span class="si" data-group-id="5573742461-4">}</span><span class="s">&quot;</span><span class="p" data-group-id="5573742461-3">)</span><span class="w">
  </span><span class="nc">IO</span><span class="o">.</span><span class="n">puts</span><span class="p" data-group-id="5573742461-6">(</span><span class="s">&quot;Identity: </span><span class="si" data-group-id="5573742461-7">#{</span><span class="n">inspect</span><span class="p" data-group-id="5573742461-8">(</span><span class="n">empty</span><span class="p" data-group-id="5573742461-9">(</span><span class="n">monoid</span><span class="p" data-group-id="5573742461-9">)</span><span class="p" data-group-id="5573742461-8">)</span><span class="si" data-group-id="5573742461-7">}</span><span class="s">&quot;</span><span class="p" data-group-id="5573742461-6">)</span><span class="w">
  
  </span><span class="c1"># Show step-by-step combination</span><span class="w">
  </span><span class="nc">Enum</span><span class="o">.</span><span class="n">reduce</span><span class="p" data-group-id="5573742461-10">(</span><span class="n">values</span><span class="p">,</span><span class="w"> </span><span class="n">empty</span><span class="p" data-group-id="5573742461-11">(</span><span class="n">monoid</span><span class="p" data-group-id="5573742461-11">)</span><span class="p">,</span><span class="w"> </span><span class="k" data-group-id="5573742461-12">fn</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">acc</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
    </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">append</span><span class="p" data-group-id="5573742461-13">(</span><span class="n">monoid</span><span class="p">,</span><span class="w"> </span><span class="n">acc</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p" data-group-id="5573742461-13">)</span><span class="w">
    </span><span class="nc">IO</span><span class="o">.</span><span class="n">puts</span><span class="p" data-group-id="5573742461-14">(</span><span class="s">&quot;</span><span class="si" data-group-id="5573742461-15">#{</span><span class="n">inspect</span><span class="p" data-group-id="5573742461-16">(</span><span class="n">acc</span><span class="p" data-group-id="5573742461-16">)</span><span class="si" data-group-id="5573742461-15">}</span><span class="s"> + </span><span class="si" data-group-id="5573742461-17">#{</span><span class="n">inspect</span><span class="p" data-group-id="5573742461-18">(</span><span class="n">value</span><span class="p" data-group-id="5573742461-18">)</span><span class="si" data-group-id="5573742461-17">}</span><span class="s"> = </span><span class="si" data-group-id="5573742461-19">#{</span><span class="n">inspect</span><span class="p" data-group-id="5573742461-20">(</span><span class="n">result</span><span class="p" data-group-id="5573742461-20">)</span><span class="si" data-group-id="5573742461-19">}</span><span class="s">&quot;</span><span class="p" data-group-id="5573742461-14">)</span><span class="w">
    </span><span class="n">result</span><span class="w">
  </span><span class="k" data-group-id="5573742461-12">end</span><span class="p" data-group-id="5573742461-10">)</span><span class="w">
</span><span class="k" data-group-id="5573742461-2">end</span><span class="w">

</span><span class="c1"># Usage:</span><span class="w">
</span><span class="c1"># debug_monoid_combination(%Funx.Monoid.Sum{}, [1, 2, 3, 4])</span></code></pre><h3 id="verify-associativity-for-parallel-computing" class="section-heading">
  <a href="#verify-associativity-for-parallel-computing" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Verify Associativity for Parallel Computing</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="kd">def</span><span class="w"> </span><span class="nf">verify_parallel_safety</span><span class="p" data-group-id="4091050421-1">(</span><span class="n">operation</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">chunk_size</span><span class="p" data-group-id="4091050421-1">)</span><span class="w"> </span><span class="k" data-group-id="4091050421-2">do</span><span class="w">
  </span><span class="c1"># Sequential computation</span><span class="w">
  </span><span class="n">sequential_result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">operation</span><span class="o">.</span><span class="p" data-group-id="4091050421-3">(</span><span class="n">data</span><span class="p" data-group-id="4091050421-3">)</span><span class="w">
  
  </span><span class="c1"># Parallel computation (different groupings)</span><span class="w">
  </span><span class="n">parallel_result1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">chunk_every</span><span class="p" data-group-id="4091050421-4">(</span><span class="n">chunk_size</span><span class="p" data-group-id="4091050421-4">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">map</span><span class="p" data-group-id="4091050421-5">(</span><span class="n">operation</span><span class="p" data-group-id="4091050421-5">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">operation</span><span class="o">.</span><span class="p" data-group-id="4091050421-6">(</span><span class="p" data-group-id="4091050421-6">)</span><span class="w">
  
  </span><span class="n">parallel_result2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">chunk_every</span><span class="p" data-group-id="4091050421-7">(</span><span class="n">chunk_size</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="4091050421-7">)</span><span class="w">  </span><span class="c1"># Different chunk size</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">map</span><span class="p" data-group-id="4091050421-8">(</span><span class="n">operation</span><span class="p" data-group-id="4091050421-8">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">operation</span><span class="o">.</span><span class="p" data-group-id="4091050421-9">(</span><span class="p" data-group-id="4091050421-9">)</span><span class="w">
  
  </span><span class="p" data-group-id="4091050421-10">%{</span><span class="w">
    </span><span class="ss">sequential</span><span class="p">:</span><span class="w"> </span><span class="n">sequential_result</span><span class="p">,</span><span class="w">
    </span><span class="ss">parallel1</span><span class="p">:</span><span class="w"> </span><span class="n">parallel_result1</span><span class="p">,</span><span class="w">
    </span><span class="ss">parallel2</span><span class="p">:</span><span class="w"> </span><span class="n">parallel_result2</span><span class="p">,</span><span class="w">
    </span><span class="ss">results_match</span><span class="p">:</span><span class="w"> </span><span class="n">sequential_result</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">parallel_result1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> 
                   </span><span class="n">parallel_result1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">parallel_result2</span><span class="w">
  </span><span class="p" data-group-id="4091050421-10">}</span><span class="w">
</span><span class="k" data-group-id="4091050421-2">end</span><span class="w">

</span><span class="c1"># Test with Math.sum (which uses Sum monoid)</span><span class="w">
</span><span class="c1"># verify_parallel_safety(&amp;Math.sum/1, [1,2,3,4,5,6,7,8], 3)</span></code></pre><h2 id="llm-common-mistakes-to-avoid" class="section-heading">
  <a href="#llm-common-mistakes-to-avoid" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">LLM Common Mistakes to Avoid</span>
</h2>
<p><strong>❌ Don't use raw monoids in application code</strong></p><pre><code class="makeup elixir" translate="no"><span class="c1"># ❌ Wrong: manually constructing monoids</span><span class="w">
</span><span class="kd">def</span><span class="w"> </span><span class="nf">sum_values</span><span class="p" data-group-id="7183949630-1">(</span><span class="n">numbers</span><span class="p" data-group-id="7183949630-1">)</span><span class="w"> </span><span class="k" data-group-id="7183949630-2">do</span><span class="w">
  </span><span class="n">sum_monoid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="7183949630-3">%</span><span class="nc" data-group-id="7183949630-3">Funx.Monoid.Sum</span><span class="p" data-group-id="7183949630-3">{</span><span class="p" data-group-id="7183949630-3">}</span><span class="w">
  </span><span class="nc">Enum</span><span class="o">.</span><span class="n">reduce</span><span class="p" data-group-id="7183949630-4">(</span><span class="n">numbers</span><span class="p">,</span><span class="w"> </span><span class="nc">Monoid</span><span class="o">.</span><span class="n">empty</span><span class="p" data-group-id="7183949630-5">(</span><span class="n">sum_monoid</span><span class="p" data-group-id="7183949630-5">)</span><span class="p">,</span><span class="w"> </span><span class="k" data-group-id="7183949630-6">fn</span><span class="w"> </span><span class="n">num</span><span class="p">,</span><span class="w"> </span><span class="n">acc</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
    </span><span class="nc">Monoid</span><span class="o">.</span><span class="n">append</span><span class="p" data-group-id="7183949630-7">(</span><span class="n">sum_monoid</span><span class="p">,</span><span class="w"> </span><span class="n">acc</span><span class="p">,</span><span class="w"> </span><span class="n">num</span><span class="p" data-group-id="7183949630-7">)</span><span class="w">
  </span><span class="k" data-group-id="7183949630-6">end</span><span class="p" data-group-id="7183949630-4">)</span><span class="w">
</span><span class="k" data-group-id="7183949630-2">end</span><span class="w">

</span><span class="c1"># ✅ Correct: use utility functions</span><span class="w">
</span><span class="kd">def</span><span class="w"> </span><span class="nf">sum_values</span><span class="p" data-group-id="7183949630-8">(</span><span class="n">numbers</span><span class="p" data-group-id="7183949630-8">)</span><span class="w"> </span><span class="k" data-group-id="7183949630-9">do</span><span class="w">
  </span><span class="nc">Math</span><span class="o">.</span><span class="n">sum</span><span class="p" data-group-id="7183949630-10">(</span><span class="n">numbers</span><span class="p" data-group-id="7183949630-10">)</span><span class="w">  </span><span class="c1"># Much simpler and clearer</span><span class="w">
</span><span class="k" data-group-id="7183949630-9">end</span></code></pre><p><strong>❌ Don't ignore monoid laws</strong></p><pre><code class="makeup elixir" translate="no"><span class="c1"># ❌ Wrong: non-associative operation</span><span class="w">
</span><span class="kd">defmodule</span><span class="w"> </span><span class="nc">BrokenMonoid</span><span class="w"> </span><span class="k" data-group-id="6374240709-1">do</span><span class="w">
  </span><span class="kd">defstruct</span><span class="w"> </span><span class="p" data-group-id="6374240709-2">[</span><span class="p" data-group-id="6374240709-2">]</span><span class="w">
  
  </span><span class="kd">defimpl</span><span class="w"> </span><span class="nc">Funx.Monoid</span><span class="w"> </span><span class="k" data-group-id="6374240709-3">do</span><span class="w">
    </span><span class="kd">def</span><span class="w"> </span><span class="nf">empty</span><span class="p" data-group-id="6374240709-4">(</span><span class="bp">_</span><span class="p" data-group-id="6374240709-4">)</span><span class="p">,</span><span class="w"> </span><span class="ss">do</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
    </span><span class="kd">def</span><span class="w"> </span><span class="nf">append</span><span class="p" data-group-id="6374240709-5">(</span><span class="bp">_</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p" data-group-id="6374240709-5">)</span><span class="p">,</span><span class="w"> </span><span class="ss">do</span><span class="p">:</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">b</span><span class="w">  </span><span class="c1"># Subtraction is NOT associative!</span><span class="w">
    </span><span class="kd">def</span><span class="w"> </span><span class="nf">wrap</span><span class="p" data-group-id="6374240709-6">(</span><span class="bp">_</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p" data-group-id="6374240709-6">)</span><span class="p">,</span><span class="w"> </span><span class="ss">do</span><span class="p">:</span><span class="w"> </span><span class="n">x</span><span class="w">
    </span><span class="kd">def</span><span class="w"> </span><span class="nf">unwrap</span><span class="p" data-group-id="6374240709-7">(</span><span class="n">x</span><span class="p" data-group-id="6374240709-7">)</span><span class="p">,</span><span class="w"> </span><span class="ss">do</span><span class="p">:</span><span class="w"> </span><span class="n">x</span><span class="w">
  </span><span class="k" data-group-id="6374240709-3">end</span><span class="w">
</span><span class="k" data-group-id="6374240709-1">end</span><span class="w">

</span><span class="c1"># ✅ Correct: ensure associativity</span><span class="w">
</span><span class="kd">defmodule</span><span class="w"> </span><span class="nc">CorrectMonoid</span><span class="w"> </span><span class="k" data-group-id="6374240709-8">do</span><span class="w">
  </span><span class="kd">defstruct</span><span class="w"> </span><span class="p" data-group-id="6374240709-9">[</span><span class="p" data-group-id="6374240709-9">]</span><span class="w">
  
  </span><span class="kd">defimpl</span><span class="w"> </span><span class="nc">Funx.Monoid</span><span class="w"> </span><span class="k" data-group-id="6374240709-10">do</span><span class="w">
    </span><span class="kd">def</span><span class="w"> </span><span class="nf">empty</span><span class="p" data-group-id="6374240709-11">(</span><span class="bp">_</span><span class="p" data-group-id="6374240709-11">)</span><span class="p">,</span><span class="w"> </span><span class="ss">do</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
    </span><span class="kd">def</span><span class="w"> </span><span class="nf">append</span><span class="p" data-group-id="6374240709-12">(</span><span class="bp">_</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p" data-group-id="6374240709-12">)</span><span class="p">,</span><span class="w"> </span><span class="ss">do</span><span class="p">:</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="w">  </span><span class="c1"># Addition IS associative</span><span class="w">
    </span><span class="kd">def</span><span class="w"> </span><span class="nf">wrap</span><span class="p" data-group-id="6374240709-13">(</span><span class="bp">_</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p" data-group-id="6374240709-13">)</span><span class="p">,</span><span class="w"> </span><span class="ss">do</span><span class="p">:</span><span class="w"> </span><span class="n">x</span><span class="w">
    </span><span class="kd">def</span><span class="w"> </span><span class="nf">unwrap</span><span class="p" data-group-id="6374240709-14">(</span><span class="n">x</span><span class="p" data-group-id="6374240709-14">)</span><span class="p">,</span><span class="w"> </span><span class="ss">do</span><span class="p">:</span><span class="w"> </span><span class="n">x</span><span class="w">
  </span><span class="k" data-group-id="6374240709-10">end</span><span class="w">
</span><span class="k" data-group-id="6374240709-8">end</span></code></pre><p><strong>❌ Don't use wrong identity elements</strong></p><pre><code class="makeup elixir" translate="no"><span class="c1"># ❌ Wrong: nil is not identity for addition</span><span class="w">
</span><span class="kd">defmodule</span><span class="w"> </span><span class="nc">BadSumMonoid</span><span class="w"> </span><span class="k" data-group-id="1312926847-1">do</span><span class="w">  
  </span><span class="kd">defstruct</span><span class="w"> </span><span class="p" data-group-id="1312926847-2">[</span><span class="p" data-group-id="1312926847-2">]</span><span class="w">
  
  </span><span class="kd">defimpl</span><span class="w"> </span><span class="nc">Funx.Monoid</span><span class="w"> </span><span class="k" data-group-id="1312926847-3">do</span><span class="w">
    </span><span class="kd">def</span><span class="w"> </span><span class="nf">empty</span><span class="p" data-group-id="1312926847-4">(</span><span class="bp">_</span><span class="p" data-group-id="1312926847-4">)</span><span class="p">,</span><span class="w"> </span><span class="ss">do</span><span class="p">:</span><span class="w"> </span><span class="no">nil</span><span class="w">  </span><span class="c1"># Wrong! nil + 5 != 5</span><span class="w">
    </span><span class="kd">def</span><span class="w"> </span><span class="nf">append</span><span class="p" data-group-id="1312926847-5">(</span><span class="bp">_</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p" data-group-id="1312926847-5">)</span><span class="p">,</span><span class="w"> </span><span class="ss">do</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="1312926847-6">(</span><span class="n">a</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="1312926847-6">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p" data-group-id="1312926847-7">(</span><span class="n">b</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="1312926847-7">)</span><span class="w">
    </span><span class="kd">def</span><span class="w"> </span><span class="nf">wrap</span><span class="p" data-group-id="1312926847-8">(</span><span class="bp">_</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p" data-group-id="1312926847-8">)</span><span class="p">,</span><span class="w"> </span><span class="ss">do</span><span class="p">:</span><span class="w"> </span><span class="n">x</span><span class="w">  
    </span><span class="kd">def</span><span class="w"> </span><span class="nf">unwrap</span><span class="p" data-group-id="1312926847-9">(</span><span class="n">x</span><span class="p" data-group-id="1312926847-9">)</span><span class="p">,</span><span class="w"> </span><span class="ss">do</span><span class="p">:</span><span class="w"> </span><span class="n">x</span><span class="w">
  </span><span class="k" data-group-id="1312926847-3">end</span><span class="w">
</span><span class="k" data-group-id="1312926847-1">end</span><span class="w">

</span><span class="c1"># ✅ Correct: 0 is the true identity for addition</span><span class="w">
</span><span class="kd">defmodule</span><span class="w"> </span><span class="nc">GoodSumMonoid</span><span class="w"> </span><span class="k" data-group-id="1312926847-10">do</span><span class="w">
  </span><span class="kd">defstruct</span><span class="w"> </span><span class="p" data-group-id="1312926847-11">[</span><span class="p" data-group-id="1312926847-11">]</span><span class="w">
  
  </span><span class="kd">defimpl</span><span class="w"> </span><span class="nc">Funx.Monoid</span><span class="w"> </span><span class="k" data-group-id="1312926847-12">do</span><span class="w">
    </span><span class="kd">def</span><span class="w"> </span><span class="nf">empty</span><span class="p" data-group-id="1312926847-13">(</span><span class="bp">_</span><span class="p" data-group-id="1312926847-13">)</span><span class="p">,</span><span class="w"> </span><span class="ss">do</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">  </span><span class="c1"># Correct! 0 + x = x</span><span class="w">
    </span><span class="kd">def</span><span class="w"> </span><span class="nf">append</span><span class="p" data-group-id="1312926847-14">(</span><span class="bp">_</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p" data-group-id="1312926847-14">)</span><span class="p">,</span><span class="w"> </span><span class="ss">do</span><span class="p">:</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="w">
    </span><span class="kd">def</span><span class="w"> </span><span class="nf">wrap</span><span class="p" data-group-id="1312926847-15">(</span><span class="bp">_</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p" data-group-id="1312926847-15">)</span><span class="p">,</span><span class="w"> </span><span class="ss">do</span><span class="p">:</span><span class="w"> </span><span class="n">x</span><span class="w">
    </span><span class="kd">def</span><span class="w"> </span><span class="nf">unwrap</span><span class="p" data-group-id="1312926847-16">(</span><span class="n">x</span><span class="p" data-group-id="1312926847-16">)</span><span class="p">,</span><span class="w"> </span><span class="ss">do</span><span class="p">:</span><span class="w"> </span><span class="n">x</span><span class="w">
  </span><span class="k" data-group-id="1312926847-12">end</span><span class="w">
</span><span class="k" data-group-id="1312926847-10">end</span></code></pre><h2 id="summary" class="section-heading">
  <a href="#summary" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Summary</span>
</h2>
<p><a href="Funx.Monoid.html"><code class="inline">Funx.Monoid</code></a> provides the mathematical foundation for associative combination with identity. Use it to:</p><ul><li><strong>Build reusable combination logic</strong>: Define monoids for custom data types that need merging</li><li><strong>Enable parallel computation</strong>: Monoid laws guarantee safe parallelization and chunking</li><li><strong>Power utility functions</strong>: <code class="inline">Math</code>, <code class="inline">Eq.Utils</code>, <code class="inline">Ord.Utils</code>, and <code class="inline">Predicate</code> all use monoids internally</li><li><strong>Compose complex operations</strong>: Chain monoid operations for sophisticated data processing</li><li><strong>Ensure mathematical correctness</strong>: Monoid laws provide guarantees about behavior</li></ul><p><strong>Key Implementation Detail</strong>: Unlike Haskell's separate Semigroup and Monoid typeclasses, all operations are under the single <a href="Funx.Monoid.html"><code class="inline">Funx.Monoid</code></a> protocol due to Elixir's protocol limitations.</p><p><strong>Best Practice</strong>: Use high-level utilities (<code class="inline">Math.sum/1</code>, <code class="inline">Eq.Utils.concat_all/1</code>) instead of raw monoid operations. Define custom monoids for domain-specific combination needs, but expose them through utility modules rather than direct protocol usage.</p><p>Remember: Monoids are about <strong>predictable combination</strong>. If your operation is associative and has a true identity element, it's probably a monoid and can leverage all the mathematical guarantees and optimizations that come with that structure.</p>
</div>

<div class="bottom-actions" id="bottom-actions">
  <div class="bottom-actions-item">

      <a href="monad-reader-usage-rules.html" class="bottom-actions-button" rel="prev">
        <span class="subheader">
          ← Previous Page
        </span>
        <span class="title">
Funx.Monad.Reader Usage Rules
        </span>
      </a>

  </div>
  <div class="bottom-actions-item">

      <a href="ord-usage-rules.html" class="bottom-actions-button" rel="next">
        <span class="subheader">
          Next Page →
        </span>
        <span class="title">
Funx.Ord Usage Rules
        </span>
      </a>

  </div>
</div>
    <footer class="footer">
      <p>

          <span class="line">
            <a href="https://hex.pm/packages/funx/0.1.5" class="footer-hex-package">Hex Package</a>

            <a href="https://preview.hex.pm/preview/funx/0.1.5">Hex Preview</a>

              (<a href="https://preview.hex.pm/preview/funx/0.1.5/show/lib/monoid/usage-rules.md">current file</a>)

          </span>

        <span class="line">
          <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
            Search HexDocs
          </button>

            <a href="funx.epub" title="ePub version">
              Download ePub version
            </a>

        </span>
      </p>

      <p class="built-using">
        Built using
        <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.34.2) for the

          <a href="https://elixir-lang.org" title="Elixir" target="_blank" translate="no">Elixir programming language</a>

      </p>

    </footer>
  </div>
</main>
</div>

  </body>
</html>
