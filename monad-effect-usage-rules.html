<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.34.2">
    <meta name="project" content="funx v0.1.5">


    <title>Funx.Monad.Effect Usage Rules — funx v0.1.5</title>
    <link rel="stylesheet" href="dist/html-elixir-F2VRIOKR.css" />


      <link rel="canonical" href="https://hexdocs.pm/funx/monad-effect-usage-rules.html" />

    <script src="dist/handlebars.runtime-NWIB6V2M.js"></script>
    <script src="dist/handlebars.templates-K7URE6B4.js"></script>
    <script src="dist/sidebar_items-FD9C8F72.js"></script>
    <script src="docs_config.js"></script>
    <script async src="dist/html-YIPIRHGU.js"></script>

  </head>
  <body data-type="extras" class="page-extra">
    <script>

      try {
        var settings = JSON.parse(localStorage.getItem('ex_doc:settings') || '{}');

        if (settings.theme === 'dark' ||
           ((settings.theme === 'system' || settings.theme == null) &&
             window.matchMedia('(prefers-color-scheme: dark)').matches)
           ) {
          document.body.classList.add('dark')
        }
      } catch (error) { }
    </script>

<div class="body-wrapper">

<button id="sidebar-menu" class="sidebar-button sidebar-toggle" aria-label="toggle sidebar" aria-controls="sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<nav id="sidebar" class="sidebar">

  <div class="sidebar-header">
    <div class="sidebar-projectInfo">

      <div>
        <a href="readme.html" class="sidebar-projectName" translate="no">
funx
        </a>
        <div class="sidebar-projectVersion" translate="no">
          v0.1.5
        </div>
      </div>
    </div>
    <ul id="sidebar-listNav" class="sidebar-listNav" role="tablist">
      <li>
        <button id="extras-list-tab-button" role="tab" data-type="extras" aria-controls="extras-tab-panel" aria-selected="true" tabindex="0">
Pages
        </button>
      </li>

        <li>
          <button id="modules-list-tab-button" role="tab" data-type="modules" aria-controls="modules-tab-panel" aria-selected="false" tabindex="-1">
            Modules
          </button>
        </li>


    </ul>
  </div>

  <div id="extras-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="extras-list-tab-button">
    <ul id="extras-full-list" class="full-list"></ul>
  </div>

    <div id="modules-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="modules-list-tab-button" hidden>
      <ul id="modules-full-list" class="full-list"></ul>
    </div>


</nav>

<main class="content">
  <output role="status" id="toast"></output>

  <div id="content" class="content-inner">
    <div class="top-search">
      <div class="search-settings">
        <form class="search-bar" action="search.html">
          <label class="search-label">
            <span class="sr-only">Search documentation of funx</span>
            <input name="q" type="text" class="search-input" placeholder="Press / to search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
          </label>
          <button type="submit" class="search-button" aria-label="Submit Search">
            <i class="ri-search-2-line ri-lg" aria-hidden="true" title="Submit search"></i>
          </button>
          <button type="button" tabindex="-1" class="search-close-button" aria-hidden="true">
            <i class="ri-close-line ri-lg" title="Cancel search"></i>
          </button>
        </form>
        <div class="autocomplete">
        </div>
        <button class="icon-settings display-settings">
          <i class="ri-settings-3-line"></i>
          <span class="sr-only">Settings</span>
        </button>
      </div>
    </div>

<div id="top-content">
  <h1>

      <a href="https://github.com/JKWA/funx/blob/v0.1.5/lib/monad/effect/usage-rules.md#L1" title="View Source" class="icon-action" rel="help">
        <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        <span class="sr-only">View Source</span>
      </a>


    <span><code class="inline">Funx.Monad.Effect</code> Usage Rules</span>
  </h1>

<h2 id="quick-navigation-index" class="section-heading">
  <a href="#quick-navigation-index" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Quick Navigation Index</span>
</h2>
<ul><li><strong>Construction</strong>: <code class="inline">right/2</code>, <code class="inline">left/2</code>, <code class="inline">lift_func/2</code>, <code class="inline">lift_either/2</code>, <code class="inline">lift_maybe/3</code></li><li><strong>Composition</strong>: <code class="inline">map/2</code>, <code class="inline">bind/2</code>, <code class="inline">ap/2</code>, <code class="inline">traverse/2</code>, <code class="inline">traverse_a/2</code></li><li><strong>Execution</strong>: <code class="inline">run/1</code>, <code class="inline">run/2</code>, <code class="inline">Context</code>, <a href="https://hexdocs.pm/elixir/Task.Supervisor.html"><code class="inline">Task.Supervisor</code></a> integration</li><li><strong>Validation</strong>: <code class="inline">validate/2</code>, error accumulation patterns</li><li><strong>Observability</strong>: <code class="inline">span_name</code>, telemetry events, trace hierarchies</li></ul><h2 id="llm-functional-programming-foundation" class="section-heading">
  <a href="#llm-functional-programming-foundation" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">LLM Functional Programming Foundation</span>
</h2>
<p><strong>Key Concepts for LLMs:</strong></p><p><strong>CRITICAL Elixir Implementation</strong>: All monadic operations are under <a href="Funx.Monad.html"><code class="inline">Funx.Monad</code></a> protocol</p><ul><li><strong>NO separate Functor/Applicative protocols</strong> - Elixir protocols cannot be extended after definition</li><li><strong>Use <code class="inline">import Funx.Monad</code></strong> for access to <code class="inline">map/2</code>, <code class="inline">bind/2</code>, <code class="inline">ap/2</code> - protocol-based, not macros</li><li><strong>Avoid <code class="inline">use Funx.Monad</code></strong> - Effect composition works via protocol dispatch, not macro injection</li><li>Different from Haskell's separate Functor, Applicative, Monad typeclasses</li></ul><p><strong>Effect</strong>: A deferred computation description that may succeed (<code class="inline">Right</code>) or fail (<code class="inline">Left</code>)</p><ul><li><strong>Pure descriptions</strong>: Effects are pure instructions, not computations - execution is deferred</li><li><strong>Concurrent by default</strong>: Unlike ZIO, Effect runs concurrently - challenge is sequential control  </li><li><strong>Controlled execution boundary</strong>: <code class="inline">run/2</code> provides timeouts, isolation, and telemetry</li><li><strong>Reader integration</strong>: Built-in environment access for dependency injection</li><li><strong>Exception-safe</strong>: Automatically wraps exceptions in structured <code class="inline">EffectError</code></li></ul><p><strong>Theoretical Foundation</strong>: Based on Philip Wadler's 1995 solution to the I/O problem</p><ul><li><strong>The Problem</strong>: Side effects break referential transparency in functional programming</li><li><strong>Wadler's Solution</strong>: Model effects as pure instructions, defer execution to controlled boundary</li><li><strong>Key Insight</strong>: Instructions for producing side effects can remain pure even when effects themselves are impure</li><li><strong>Effect Implementation</strong>: Pure descriptions of computations + controlled execution in <code class="inline">run/2</code></li><li><strong>Preserves FP</strong>: Maintains composability and reasoning while enabling real-world I/O</li></ul><p><strong>Elixir-Specific Design</strong>: Unlike most Effect libraries, Funx.Effect has <strong>two distinct structs</strong></p><ul><li><strong><code class="inline">Effect.Right</code></strong>: Describes a computation intended to succeed</li><li><strong><code class="inline">Effect.Left</code></strong>: Describes a computation intended to fail  </li><li><strong>Pattern matching friendly</strong>: Can match on Effect structure before execution</li><li><strong>Structural short-circuiting</strong>: <code class="inline">Effect.Left</code> detected during traversal—no task scheduled if Left matched early</li><li><strong>Implementation quirk</strong>: Makes functional composition cleaner in Elixir's pattern-matching environment</li></ul><p><strong>Kleisli Function</strong>: A function <code class="inline">a -&gt; Effect b</code> (takes unwrapped value, returns wrapped Effect)</p><ul><li><strong>Primary use</strong>: <code class="inline">traverse/2</code> and <code class="inline">traverse_a/2</code> for list operations  </li><li><strong>Individual use</strong>: <code class="inline">Monad.bind/2</code> for single Effect values</li><li><strong>Context-aware</strong>: Propagates trace context through execution</li><li>Example: <code class="inline">fetch_user :: UserId -&gt; Effect User</code></li></ul><p><strong>Key List Operation Patterns:</strong></p><ul><li><code class="inline">sequence([Effect a])</code> → <code class="inline">Effect [a]</code> (fail-fast, sequential execution)</li><li><code class="inline">sequence_a([Effect a])</code> → <code class="inline">Effect [a]</code> (parallel execution, collect all errors)</li><li><code class="inline">traverse([a], kleisli_fn)</code> → <code class="inline">Effect [b]</code> (sequential: apply Kleisli, fail-fast)</li><li><code class="inline">traverse_a([a], kleisli_fn)</code> → <code class="inline">Effect [b]</code> (parallel: apply Kleisli, accumulate errors)</li></ul><p><strong>Performance Critical</strong>: <code class="inline">bind</code> chains run sequentially, <code class="inline">traverse_a</code> runs in parallel</p><p><strong>Functor</strong>: Something you can <code class="inline">map</code> over while preserving structure</p><ul><li><code class="inline">Monad.map/2 :: (a -&gt; b) -&gt; Effect a -&gt; Effect b</code></li><li>Transforms the success value, leaves Left unchanged, preserves async structure</li></ul><p><strong>Applicative</strong>: Allows applying functions inside a context</p><ul><li><code class="inline">Monad.ap/2 :: Effect (a -&gt; b) -&gt; Effect a -&gt; Effect b</code>  </li><li>Can combine multiple Effect values with proper trace context merging</li></ul><p><strong>Monad</strong>: Supports <code class="inline">bind</code> for chaining dependent computations</p><ul><li><code class="inline">Monad.bind/2 :: Effect a -&gt; (a -&gt; Effect b) -&gt; Effect b</code></li><li>Flattens nested Effect values automatically, maintains trace lineage</li></ul><p><strong>Reader Pattern</strong>: Access to runtime environment within effects</p><ul><li><code class="inline">ask/0</code> - Returns environment as Right</li><li><code class="inline">asks/1</code> - Applies function to environment, returns result as Right</li><li><code class="inline">fail/0</code> - Returns environment as Left (failure mode)</li><li><code class="inline">fails/1</code> - Applies function to environment, returns result as Left</li></ul><p><strong>Dependency Injection</strong>: Inject behavior, not configuration</p><ul><li>Environment provides implementations: <code class="inline">%{store: MyStore, logger: MyLogger}</code></li><li>Effects remain decoupled from specific implementations</li><li>Enables evolutionary design - defer architectural decisions safely</li></ul><p><strong>Monad Relationships</strong>: Effect combines familiar monadic patterns</p><ul><li><strong>Effect ≈ Reader + Either + Async</strong>: Reads environment, produces Either results, defers execution</li><li><strong>Reader integration</strong>: <code class="inline">ask/0</code>, <code class="inline">asks/1</code>, <code class="inline">fail/0</code>, <code class="inline">fails/1</code> for environment access</li><li><strong>Either foundation</strong>: Operations return <code class="inline">Either.Right</code>/<code class="inline">Either.Left</code> when executed  </li><li><strong>Async deferred</strong>: Unlike Reader/Either, execution is deferred until <code class="inline">run/2</code></li><li><strong>Mathematical</strong>: <code class="inline">Effect env a ≈ env -&gt; Task (Either error a)</code> (execution semantics only)</li><li><strong>Key difference</strong>: Unlike <a href="https://hexdocs.pm/elixir/Task.html"><code class="inline">Task</code></a>, Effect descriptions are inert until <code class="inline">run/2</code>—nothing scheduled until execution</li></ul><p><strong>Context &amp; Observability</strong>:</p><ul><li>Every Effect carries <code class="inline">Effect.Context</code> with trace_id, span_name, timeout</li><li>Automatic telemetry emission on <code class="inline">run/2</code> with <code class="inline">[:funx, :effect, :run, :start/:stop]</code></li><li>Spans are linked hierarchically through parent_trace_id</li><li>Exception handling wraps all errors in structured <code class="inline">EffectError</code></li></ul><h2 id="llm-decision-guide-when-to-use-effect" class="section-heading">
  <a href="#llm-decision-guide-when-to-use-effect" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">LLM Decision Guide: When to Use Effect</span>
</h2>
<p><strong>✅ Use Effect when:</strong></p><ul><li>Deferred asynchronous computation (database calls, HTTP requests, file I/O)</li><li>Need full observability and tracing in concurrent systems  </li><li>Complex workflows requiring both fail-fast and error accumulation</li><li>Integration with Task.Supervisor for fault tolerance</li><li>Reader-style dependency injection with environment access</li><li>User says: &quot;async&quot;, &quot;concurrent&quot;, &quot;observable&quot;, &quot;traced&quot;, &quot;supervised&quot;</li></ul><p><strong>❌ Use Either when:</strong></p><ul><li>Synchronous operations that don't need deferral</li><li>Simple error handling without telemetry overhead</li><li>No need for tracing or span management</li><li>User says: &quot;simple validation&quot;, &quot;immediate result&quot;, &quot;no async&quot;</li></ul><p><strong>❌ Use Maybe when:</strong></p><ul><li>Simple presence/absence without error context</li><li>No async requirements</li><li>User says: &quot;optional&quot;, &quot;might not exist&quot;</li></ul><p><strong>⚡ Effect Strategy Decision:</strong></p><ul><li><strong>Simple async operation</strong>: Use <code class="inline">right/1</code> and <code class="inline">left/1</code> constructors</li><li><strong>Chain dependent async operations</strong>: Use <code class="inline">bind/2</code> for Effect sequencing</li><li><strong>Transform success values</strong>: Use <code class="inline">map/2</code> with regular functions  </li><li><strong>Combine multiple Effects</strong>: Use <code class="inline">ap/2</code> for applicative patterns</li><li><strong>Environment access</strong>: Use <code class="inline">ask/0</code>, <code class="inline">asks/1</code>, <code class="inline">fail/0</code>, <code class="inline">fails/1</code></li><li><strong>List processing (fail-fast)</strong>: Use <code class="inline">traverse/2</code> and <code class="inline">sequence/1</code></li><li><strong>List processing (parallel, accumulate errors)</strong>: Use <code class="inline">traverse_a/2</code> and <code class="inline">sequence_a/1</code></li><li><strong>Validation with error accumulation</strong>: Use <code class="inline">validate/2</code></li><li><strong>Performance optimization</strong>: <code class="inline">bind</code> cheap checks before expensive ones</li><li><strong>Exception-safe lifting</strong>: Use <code class="inline">lift_func/2</code>, <code class="inline">lift_either/2</code>, etc.</li></ul><p><strong>⚙️ Function Choice Guide (Mathematical Purpose):</strong></p><ul><li><strong>Chain dependent async lookups</strong>: <code class="inline">bind/2</code> with functions returning Effect</li><li><strong>Transform success values</strong>: <code class="inline">map/2</code> with functions returning plain values</li><li><strong>Apply functions to multiple Effects</strong>: <code class="inline">ap/2</code> for combining contexts</li><li><strong>Access runtime environment</strong>: <code class="inline">ask/0</code> for full env, <code class="inline">asks/1</code> with selector</li><li><strong>Fail with environment context</strong>: <code class="inline">fail/0</code> or <code class="inline">fails/1</code></li><li><strong>Work with lists (fail-fast)</strong>: <code class="inline">sequence/1</code>, <code class="inline">traverse/2</code></li><li><strong>Work with lists (collect errors)</strong>: <code class="inline">sequence_a/1</code>, <code class="inline">traverse_a/2</code></li><li><strong>Lift synchronous operations</strong>: <code class="inline">lift_func/2</code>, <code class="inline">lift_predicate/3</code></li><li><strong>Convert from other types</strong>: <code class="inline">lift_either/2</code>, <code class="inline">lift_maybe/3</code></li></ul><h2 id="llm-context-mapping" class="section-heading">
  <a href="#llm-context-mapping" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">LLM Context Mapping</span>
</h2>
<p><strong>User Intent → Effect Patterns:</strong></p><ul><li>&quot;fetch user then profile&quot; → <code class="inline">bind/2</code> chaining dependent operations</li><li>&quot;combine multiple API calls&quot; → <code class="inline">traverse_a/2</code> for parallel processing  </li><li>&quot;validate with all errors&quot; → <code class="inline">validate/2</code> with multiple validators</li><li>&quot;trace this operation&quot; → Add <code class="inline">span_name</code> to context</li><li>&quot;handle database errors&quot; → <code class="inline">map_left/2</code> for error transformation</li><li>&quot;access config in effect&quot; → <code class="inline">asks/1</code> to read from environment</li><li>&quot;process list async&quot; → <code class="inline">traverse_a/2</code> for error accumulation</li><li>&quot;async database call&quot; → <code class="inline">lift_func/2</code> wrapping database operation</li><li>&quot;supervised task execution&quot; → Pass <code class="inline">:task_supervisor</code> to <code class="inline">run/2</code></li></ul><h2 id="syntax-patterns" class="section-heading">
  <a href="#syntax-patterns" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Syntax Patterns</span>
</h2>
<ul><li><strong>Construction</strong>: <code class="inline">Effect.right(value)</code>, <code class="inline">Effect.left(error)</code></li><li><strong>Composition</strong>: <code class="inline">import Funx.Monad</code> then <code class="inline">|&gt; bind(fn x -&gt; ... end)</code></li><li><strong>Execution</strong>: <strong>Always call <code class="inline">run/2</code></strong> - Effects are lazy until executed</li><li><strong>Environment</strong>: <code class="inline">asks/1</code> for dependency injection, <code class="inline">run/2</code> provides environment</li><li><strong>Error handling</strong>: All exceptions wrapped in <code class="inline">EffectError</code>, use <code class="inline">map_left/2</code> for transformation</li><li><strong>Tracing</strong>: <code class="inline">span_name</code> creates hierarchical spans, context bound at creation</li></ul><h2 id="overview" class="section-heading">
  <a href="#overview" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Overview</span>
</h2>
<p><a href="Funx.Monad.Effect.html"><code class="inline">Funx.Monad.Effect</code></a> handles deferred asynchronous computations with full observability.</p><p>Use Effect for:</p><ul><li>Asynchronous operations (database, HTTP, file I/O)</li><li>Complex workflows requiring tracing and telemetry  </li><li>Error accumulation across multiple async operations</li><li>Reader-style dependency injection with environment access</li><li>Integration with Task.Supervisor for fault tolerance</li></ul><p><strong>Key insight</strong>: Effect represents <strong>&quot;deferred observable async computation&quot;</strong> - build up a pure description of what to do, then <code class="inline">run/2</code> executes it with full observability and exception safety.</p><p><strong>Remember</strong>: Effects are pure until executed - this preserves functional programming benefits while enabling real-world I/O.</p><h2 id="constructors" class="section-heading">
  <a href="#constructors" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Constructors</span>
</h2>
<h3 id="right-2-describe-a-computation-intended-to-succeed" class="section-heading">
  <a href="#right-2-describe-a-computation-intended-to-succeed" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text"><code class="inline">right/2</code> - Describe a Computation Intended to Succeed</span>
</h3>
<p>Creates an <code class="inline">Effect.Right</code> struct describing a computation that should succeed:</p><pre><code class="makeup elixir" translate="no"><span class="nc">Effect</span><span class="o">.</span><span class="n">right</span><span class="p" data-group-id="6536657227-1">(</span><span class="mi">42</span><span class="p" data-group-id="6536657227-1">)</span><span class="w">                    </span><span class="c1"># Creates %Effect.Right{} - success intent</span><span class="w">
</span><span class="nc">Effect</span><span class="o">.</span><span class="n">right</span><span class="p" data-group-id="6536657227-2">(</span><span class="mi">42</span><span class="p">,</span><span class="w"> </span><span class="ss">span_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;calc&quot;</span><span class="p" data-group-id="6536657227-2">)</span><span class="w"> </span><span class="c1"># With tracing context</span></code></pre><h3 id="left-2-describe-a-computation-intended-to-fail" class="section-heading">
  <a href="#left-2-describe-a-computation-intended-to-fail" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text"><code class="inline">left/2</code> - Describe a Computation Intended to Fail</span>
</h3>
<p>Creates an <code class="inline">Effect.Left</code> struct describing a computation that should fail:</p><pre><code class="makeup elixir" translate="no"><span class="nc">Effect</span><span class="o">.</span><span class="n">left</span><span class="p" data-group-id="1058919610-1">(</span><span class="s">&quot;error&quot;</span><span class="p" data-group-id="1058919610-1">)</span><span class="w">                      </span><span class="c1"># Creates %Effect.Left{} - failure intent</span><span class="w">
</span><span class="nc">Effect</span><span class="o">.</span><span class="n">left</span><span class="p" data-group-id="1058919610-2">(</span><span class="s">&quot;error&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">span_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;fail&quot;</span><span class="p" data-group-id="1058919610-2">)</span><span class="w">  </span><span class="c1"># With tracing context</span></code></pre><p><strong>Key insight</strong>: These create <strong>different struct types</strong> (<code class="inline">Effect.Right</code> vs <code class="inline">Effect.Left</code>), not the same struct with different content. This enables pattern matching on Effect structure before execution.</p><h3 id="pure-2-alias-for-right-2" class="section-heading">
  <a href="#pure-2-alias-for-right-2" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text"><code class="inline">pure/2</code> - Alias for <code class="inline">right/2</code></span>
</h3>
<p>Alternative constructor for successful effects (Applicative identity):</p><pre><code class="makeup elixir" translate="no"><span class="nc">Effect</span><span class="o">.</span><span class="n">pure</span><span class="p" data-group-id="8722846227-1">(</span><span class="mi">42</span><span class="p" data-group-id="8722846227-1">)</span><span class="w">                     </span><span class="c1"># Same as Effect.right(42) - creates Effect.Right</span><span class="w">
</span><span class="nc">Effect</span><span class="o">.</span><span class="n">pure</span><span class="p" data-group-id="8722846227-2">(</span><span class="mi">42</span><span class="p">,</span><span class="w"> </span><span class="ss">trace_id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;xyz&quot;</span><span class="p" data-group-id="8722846227-2">)</span><span class="w">   </span><span class="c1"># With custom trace context</span></code></pre><p><strong>Note</strong>: <code class="inline">pure/2</code> does not change concurrency or evaluation semantics—it creates an <code class="inline">Effect.Right</code> struct. Use in applicative patterns where you need the identity element for composition.</p><h2 id="execution" class="section-heading">
  <a href="#execution" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Execution</span>
</h2>
<h3 id="run-1-execute-the-effect" class="section-heading">
  <a href="#run-1-execute-the-effect" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text"><code class="inline">run/1</code> - Execute the Effect</span>
</h3>
<p>Executes the deferred computation and returns an Either result:</p><pre><code class="makeup elixir" translate="no"><span class="kn">import</span><span class="w"> </span><span class="nc">Funx.Monad</span><span class="w">

</span><span class="nc">Effect</span><span class="o">.</span><span class="n">right</span><span class="p" data-group-id="6734991998-1">(</span><span class="mi">42</span><span class="p" data-group-id="6734991998-1">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="6734991998-2">(</span><span class="p" data-group-id="6734991998-2">)</span><span class="w">                     </span><span class="c1"># %Either.Right{right: 42}</span><span class="w">

</span><span class="nc">Effect</span><span class="o">.</span><span class="n">left</span><span class="p" data-group-id="6734991998-3">(</span><span class="s">&quot;error&quot;</span><span class="p" data-group-id="6734991998-3">)</span><span class="w">  
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="6734991998-4">(</span><span class="p" data-group-id="6734991998-4">)</span><span class="w">                     </span><span class="c1"># %Either.Left{left: &quot;error&quot;}</span></code></pre><h3 id="run-2-execute-with-environment" class="section-heading">
  <a href="#run-2-execute-with-environment" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text"><code class="inline">run/2</code> - Execute with Environment</span>
</h3>
<p>Passes runtime environment to the effect:</p><pre><code class="makeup elixir" translate="no"><span class="nc">Effect</span><span class="o">.</span><span class="n">asks</span><span class="p" data-group-id="1115281492-1">(</span><span class="k" data-group-id="1115281492-2">fn</span><span class="w"> </span><span class="n">env</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">env</span><span class="p" data-group-id="1115281492-3">[</span><span class="ss">:user_id</span><span class="p" data-group-id="1115281492-3">]</span><span class="w"> </span><span class="k" data-group-id="1115281492-2">end</span><span class="p" data-group-id="1115281492-1">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="1115281492-4">(</span><span class="p" data-group-id="1115281492-5">%{</span><span class="ss">user_id</span><span class="p">:</span><span class="w"> </span><span class="mi">123</span><span class="p" data-group-id="1115281492-5">}</span><span class="p" data-group-id="1115281492-4">)</span><span class="w">     </span><span class="c1"># %Either.Right{right: 123}</span></code></pre><h3 id="run-3-execute-with-environment-and-options" class="section-heading">
  <a href="#run-3-execute-with-environment-and-options" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text"><code class="inline">run/3</code> - Execute with Environment and Options</span>
</h3>
<p>Supports additional execution options:</p><pre><code class="makeup elixir" translate="no"><span class="p" data-group-id="3959346589-1">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">supervisor</span><span class="p" data-group-id="3959346589-1">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Task.Supervisor</span><span class="o">.</span><span class="n">start_link</span><span class="p" data-group-id="3959346589-2">(</span><span class="p" data-group-id="3959346589-2">)</span><span class="w">

</span><span class="nc">Effect</span><span class="o">.</span><span class="n">right</span><span class="p" data-group-id="3959346589-3">(</span><span class="mi">42</span><span class="p" data-group-id="3959346589-3">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="3959346589-4">(</span><span class="p" data-group-id="3959346589-5">%{</span><span class="p" data-group-id="3959346589-5">}</span><span class="p">,</span><span class="w"> </span><span class="ss">task_supervisor</span><span class="p">:</span><span class="w"> </span><span class="n">supervisor</span><span class="p">,</span><span class="w"> </span><span class="ss">span_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;supervised&quot;</span><span class="p" data-group-id="3959346589-4">)</span></code></pre><h2 id="core-operations" class="section-heading">
  <a href="#core-operations" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Core Operations</span>
</h2>
<h3 id="map-2-transform-success-values" class="section-heading">
  <a href="#map-2-transform-success-values" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text"><code class="inline">map/2</code> - Transform Success Values</span>
</h3>
<p>Applies a function to the success value inside an Effect:</p><pre><code class="makeup elixir" translate="no"><span class="kn">import</span><span class="w"> </span><span class="nc">Funx.Monad</span><span class="w">

</span><span class="nc">Effect</span><span class="o">.</span><span class="n">right</span><span class="p" data-group-id="1003701920-1">(</span><span class="mi">5</span><span class="p" data-group-id="1003701920-1">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="n">map</span><span class="p" data-group-id="1003701920-2">(</span><span class="k" data-group-id="1003701920-3">fn</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="k" data-group-id="1003701920-3">end</span><span class="p" data-group-id="1003701920-2">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="1003701920-4">(</span><span class="p" data-group-id="1003701920-4">)</span><span class="w">                     </span><span class="c1"># right(10)</span><span class="w">

</span><span class="nc">Effect</span><span class="o">.</span><span class="n">left</span><span class="p" data-group-id="1003701920-5">(</span><span class="s">&quot;error&quot;</span><span class="p" data-group-id="1003701920-5">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="n">map</span><span class="p" data-group-id="1003701920-6">(</span><span class="k" data-group-id="1003701920-7">fn</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="k" data-group-id="1003701920-7">end</span><span class="p" data-group-id="1003701920-6">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="1003701920-8">(</span><span class="p" data-group-id="1003701920-8">)</span><span class="w">                     </span><span class="c1"># left(&quot;error&quot;) - function never runs</span></code></pre><p><strong>Use <code class="inline">map</code> when:</strong></p><ul><li>You want to transform the success value if present</li><li>The transformation function returns a plain value (not wrapped in Effect)</li><li>You want to preserve the Effect structure and async nature</li></ul><h3 id="bind-2-chain-dependent-async-operations" class="section-heading">
  <a href="#bind-2-chain-dependent-async-operations" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text"><code class="inline">bind/2</code> - Chain Dependent Async Operations</span>
</h3>
<p>Chains operations that return Effect values, automatically flattening:</p><pre><code class="makeup elixir" translate="no"><span class="kn">import</span><span class="w"> </span><span class="nc">Funx.Monad</span><span class="w">

</span><span class="c1"># These functions return Effect values  </span><span class="w">
</span><span class="n">fetch_user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="6206216408-1">fn</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> 
  </span><span class="nc">Effect</span><span class="o">.</span><span class="n">lift_func</span><span class="p" data-group-id="6206216408-2">(</span><span class="k" data-group-id="6206216408-3">fn</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">Database</span><span class="o">.</span><span class="n">get_user</span><span class="p" data-group-id="6206216408-4">(</span><span class="n">id</span><span class="p" data-group-id="6206216408-4">)</span><span class="w"> </span><span class="k" data-group-id="6206216408-3">end</span><span class="p" data-group-id="6206216408-2">)</span><span class="w"> 
</span><span class="k" data-group-id="6206216408-1">end</span><span class="w">

</span><span class="n">fetch_profile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="6206216408-5">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> 
  </span><span class="nc">Effect</span><span class="o">.</span><span class="n">lift_func</span><span class="p" data-group-id="6206216408-6">(</span><span class="k" data-group-id="6206216408-7">fn</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">Database</span><span class="o">.</span><span class="n">get_profile</span><span class="p" data-group-id="6206216408-8">(</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p" data-group-id="6206216408-8">)</span><span class="w"> </span><span class="k" data-group-id="6206216408-7">end</span><span class="p" data-group-id="6206216408-6">)</span><span class="w">
</span><span class="k" data-group-id="6206216408-5">end</span><span class="w">

</span><span class="nc">Effect</span><span class="o">.</span><span class="n">right</span><span class="p" data-group-id="6206216408-9">(</span><span class="mi">123</span><span class="p" data-group-id="6206216408-9">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="n">bind</span><span class="p" data-group-id="6206216408-10">(</span><span class="n">fetch_user</span><span class="p" data-group-id="6206216408-10">)</span><span class="w">           </span><span class="c1"># Effect User</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="n">bind</span><span class="p" data-group-id="6206216408-11">(</span><span class="n">fetch_profile</span><span class="p" data-group-id="6206216408-11">)</span><span class="w">        </span><span class="c1"># Effect Profile  </span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="6206216408-12">(</span><span class="n">env</span><span class="p" data-group-id="6206216408-12">)</span></code></pre><p><strong>Use <code class="inline">bind</code> when:</strong></p><ul><li>You're chaining async operations that each return Effect</li><li>Each step depends on the result of the previous async step</li><li>You want automatic short-circuiting on Left with trace preservation</li><li>You need sequential execution (each operation waits for the previous)</li></ul><p><strong>Common bind pattern (sequential execution):</strong></p><pre><code class="makeup elixir" translate="no"><span class="kd">def</span><span class="w"> </span><span class="nf">process_user_workflow</span><span class="p" data-group-id="7329403338-1">(</span><span class="n">user_id</span><span class="p">,</span><span class="w"> </span><span class="n">env</span><span class="p" data-group-id="7329403338-1">)</span><span class="w"> </span><span class="k" data-group-id="7329403338-2">do</span><span class="w">
  </span><span class="nc">Effect</span><span class="o">.</span><span class="n">right</span><span class="p" data-group-id="7329403338-3">(</span><span class="n">user_id</span><span class="p" data-group-id="7329403338-3">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">bind</span><span class="p" data-group-id="7329403338-4">(</span><span class="o">&amp;</span><span class="n">fetch_user_async</span><span class="o">/</span><span class="mi">1</span><span class="p" data-group-id="7329403338-4">)</span><span class="w">       </span><span class="c1"># UserId -&gt; Effect User</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">bind</span><span class="p" data-group-id="7329403338-5">(</span><span class="o">&amp;</span><span class="n">fetch_permissions_async</span><span class="o">/</span><span class="mi">1</span><span class="p" data-group-id="7329403338-5">)</span><span class="w"> </span><span class="c1"># User -&gt; Effect Permissions</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">bind</span><span class="p" data-group-id="7329403338-6">(</span><span class="o">&amp;</span><span class="n">validate_access_async</span><span class="o">/</span><span class="mi">1</span><span class="p" data-group-id="7329403338-6">)</span><span class="w">   </span><span class="c1"># Permissions -&gt; Effect AccessToken</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="7329403338-7">(</span><span class="n">env</span><span class="p" data-group-id="7329403338-7">)</span><span class="w">
</span><span class="k" data-group-id="7329403338-2">end</span></code></pre><h3 id="ap-2-apply-functions-across-effect-values" class="section-heading">
  <a href="#ap-2-apply-functions-across-effect-values" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text"><code class="inline">ap/2</code> - Apply Functions Across Effect Values</span>
</h3>
<p>Applies a function in an Effect to a value in an Effect:</p><pre><code class="makeup elixir" translate="no"><span class="kn">import</span><span class="w"> </span><span class="nc">Funx.Monad</span><span class="w">

</span><span class="c1"># Apply a wrapped function to wrapped values</span><span class="w">
</span><span class="nc">Effect</span><span class="o">.</span><span class="n">right</span><span class="p" data-group-id="3132865400-1">(</span><span class="k" data-group-id="3132865400-2">fn</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="k" data-group-id="3132865400-2">end</span><span class="p" data-group-id="3132865400-1">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="n">ap</span><span class="p" data-group-id="3132865400-3">(</span><span class="nc">Effect</span><span class="o">.</span><span class="n">right</span><span class="p" data-group-id="3132865400-4">(</span><span class="mi">5</span><span class="p" data-group-id="3132865400-4">)</span><span class="p" data-group-id="3132865400-3">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="3132865400-5">(</span><span class="p" data-group-id="3132865400-5">)</span><span class="w">                     </span><span class="c1"># right(15)</span><span class="w">

</span><span class="c1"># Combine multiple Effect values  </span><span class="w">
</span><span class="n">add</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="3132865400-6">fn</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k" data-group-id="3132865400-7">fn</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="k" data-group-id="3132865400-7">end</span><span class="w"> </span><span class="k" data-group-id="3132865400-6">end</span><span class="w">

</span><span class="nc">Effect</span><span class="o">.</span><span class="n">right</span><span class="p" data-group-id="3132865400-8">(</span><span class="n">add</span><span class="p" data-group-id="3132865400-8">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="n">ap</span><span class="p" data-group-id="3132865400-9">(</span><span class="nc">Effect</span><span class="o">.</span><span class="n">right</span><span class="p" data-group-id="3132865400-10">(</span><span class="mi">3</span><span class="p" data-group-id="3132865400-10">)</span><span class="p" data-group-id="3132865400-9">)</span><span class="w">              </span><span class="c1"># Effect(fn y -&gt; 3 + y end)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="n">ap</span><span class="p" data-group-id="3132865400-11">(</span><span class="nc">Effect</span><span class="o">.</span><span class="n">right</span><span class="p" data-group-id="3132865400-12">(</span><span class="mi">4</span><span class="p" data-group-id="3132865400-12">)</span><span class="p" data-group-id="3132865400-11">)</span><span class="w">              </span><span class="c1"># Effect(7)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="3132865400-13">(</span><span class="p" data-group-id="3132865400-13">)</span><span class="w">                     </span><span class="c1"># right(7)</span><span class="w">

</span><span class="c1"># If any value is Left, result is Left</span><span class="w">
</span><span class="nc">Effect</span><span class="o">.</span><span class="n">right</span><span class="p" data-group-id="3132865400-14">(</span><span class="n">add</span><span class="p" data-group-id="3132865400-14">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="n">ap</span><span class="p" data-group-id="3132865400-15">(</span><span class="nc">Effect</span><span class="o">.</span><span class="n">left</span><span class="p" data-group-id="3132865400-16">(</span><span class="s">&quot;error&quot;</span><span class="p" data-group-id="3132865400-16">)</span><span class="p" data-group-id="3132865400-15">)</span><span class="w">         
</span><span class="o">|&gt;</span><span class="w"> </span><span class="n">ap</span><span class="p" data-group-id="3132865400-17">(</span><span class="nc">Effect</span><span class="o">.</span><span class="n">right</span><span class="p" data-group-id="3132865400-18">(</span><span class="mi">4</span><span class="p" data-group-id="3132865400-18">)</span><span class="p" data-group-id="3132865400-17">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="3132865400-19">(</span><span class="p" data-group-id="3132865400-19">)</span><span class="w">                     </span><span class="c1"># left(&quot;error&quot;)</span></code></pre><p><strong>Use <code class="inline">ap</code> when:</strong></p><ul><li>You want to apply a function to multiple Effect values</li><li>You need all async operations to complete for the computation to succeed</li><li>You're implementing applicative patterns with trace context preservation</li></ul><p><strong>Concurrency note</strong>: <code class="inline">ap/2</code> enables applicative composition. Provided both arguments are constructed independently, effects may run concurrently. However, if Effects are constructed in dependency chains, they will run sequentially.</p><h2 id="reader-operations" class="section-heading">
  <a href="#reader-operations" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Reader Operations</span>
</h2>
<h3 id="ask-0-access-full-environment" class="section-heading">
  <a href="#ask-0-access-full-environment" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text"><code class="inline">ask/0</code> - Access Full Environment</span>
</h3>
<p>Returns the runtime environment passed to <code class="inline">run/2</code> as a Right:</p><pre><code class="makeup elixir" translate="no"><span class="nc">Effect</span><span class="o">.</span><span class="n">ask</span><span class="p" data-group-id="4375114957-1">(</span><span class="p" data-group-id="4375114957-1">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="n">map</span><span class="p" data-group-id="4375114957-2">(</span><span class="k" data-group-id="4375114957-3">fn</span><span class="w"> </span><span class="n">env</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">env</span><span class="p" data-group-id="4375114957-4">[</span><span class="ss">:database_url</span><span class="p" data-group-id="4375114957-4">]</span><span class="w"> </span><span class="k" data-group-id="4375114957-3">end</span><span class="p" data-group-id="4375114957-2">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="4375114957-5">(</span><span class="p" data-group-id="4375114957-6">%{</span><span class="ss">database_url</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;postgres://...&quot;</span><span class="p" data-group-id="4375114957-6">}</span><span class="p" data-group-id="4375114957-5">)</span><span class="w">  </span><span class="c1"># right(&quot;postgres://...&quot;)</span></code></pre><h3 id="asks-1-extract-from-environment" class="section-heading">
  <a href="#asks-1-extract-from-environment" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text"><code class="inline">asks/1</code> - Extract from Environment</span>
</h3>
<p>Applies a function to extract specific values from the environment:</p><pre><code class="makeup elixir" translate="no"><span class="nc">Effect</span><span class="o">.</span><span class="n">asks</span><span class="p" data-group-id="3492142317-1">(</span><span class="k" data-group-id="3492142317-2">fn</span><span class="w"> </span><span class="n">env</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">env</span><span class="p" data-group-id="3492142317-3">[</span><span class="ss">:config</span><span class="p" data-group-id="3492142317-3">]</span><span class="p" data-group-id="3492142317-4">[</span><span class="ss">:timeout</span><span class="p" data-group-id="3492142317-4">]</span><span class="w"> </span><span class="k" data-group-id="3492142317-2">end</span><span class="p" data-group-id="3492142317-1">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="3492142317-5">(</span><span class="p" data-group-id="3492142317-6">%{</span><span class="ss">config</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="3492142317-7">%{</span><span class="ss">timeout</span><span class="p">:</span><span class="w"> </span><span class="mi">5000</span><span class="p" data-group-id="3492142317-7">}</span><span class="p" data-group-id="3492142317-6">}</span><span class="p" data-group-id="3492142317-5">)</span><span class="w">        </span><span class="c1"># right(5000)</span></code></pre><h3 id="fail-0-fail-with-full-environment" class="section-heading">
  <a href="#fail-0-fail-with-full-environment" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text"><code class="inline">fail/0</code> - Fail with Full Environment</span>
</h3>
<p>Returns the runtime environment as a Left (failure case):</p><pre><code class="makeup elixir" translate="no"><span class="nc">Effect</span><span class="o">.</span><span class="n">fail</span><span class="p" data-group-id="1823026682-1">(</span><span class="p" data-group-id="1823026682-1">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="1823026682-2">(</span><span class="p" data-group-id="1823026682-3">%{</span><span class="ss">error</span><span class="p">:</span><span class="w"> </span><span class="ss">:invalid_token</span><span class="p" data-group-id="1823026682-3">}</span><span class="p" data-group-id="1823026682-2">)</span><span class="w">           </span><span class="c1"># left(%{error: :invalid_token})</span></code></pre><h3 id="fails-1-fail-with-processed-environment" class="section-heading">
  <a href="#fails-1-fail-with-processed-environment" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text"><code class="inline">fails/1</code> - Fail with Processed Environment</span>
</h3>
<p>Applies a function to the environment and returns result as Left:</p><pre><code class="makeup elixir" translate="no"><span class="nc">Effect</span><span class="o">.</span><span class="n">fails</span><span class="p" data-group-id="6078551929-1">(</span><span class="k" data-group-id="6078551929-2">fn</span><span class="w"> </span><span class="n">env</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p" data-group-id="6078551929-3">{</span><span class="ss">:unauthorized</span><span class="p">,</span><span class="w"> </span><span class="n">env</span><span class="p" data-group-id="6078551929-4">[</span><span class="ss">:user_id</span><span class="p" data-group-id="6078551929-4">]</span><span class="p" data-group-id="6078551929-3">}</span><span class="w"> </span><span class="k" data-group-id="6078551929-2">end</span><span class="p" data-group-id="6078551929-1">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="6078551929-5">(</span><span class="p" data-group-id="6078551929-6">%{</span><span class="ss">user_id</span><span class="p">:</span><span class="w"> </span><span class="mi">42</span><span class="p" data-group-id="6078551929-6">}</span><span class="p" data-group-id="6078551929-5">)</span><span class="w">                     </span><span class="c1"># left({:unauthorized, 42})</span></code></pre><p><strong>Reader Pattern Usage:</strong></p><pre><code class="makeup elixir" translate="no"><span class="kd">def</span><span class="w"> </span><span class="nf">fetch_with_config</span><span class="w"> </span><span class="k" data-group-id="7734829128-1">do</span><span class="w">
  </span><span class="nc">Effect</span><span class="o">.</span><span class="n">asks</span><span class="p" data-group-id="7734829128-2">(</span><span class="k" data-group-id="7734829128-3">fn</span><span class="w"> </span><span class="n">env</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p" data-group-id="7734829128-4">{</span><span class="n">env</span><span class="p" data-group-id="7734829128-5">[</span><span class="ss">:api_base</span><span class="p" data-group-id="7734829128-5">]</span><span class="p">,</span><span class="w"> </span><span class="n">env</span><span class="p" data-group-id="7734829128-6">[</span><span class="ss">:auth_token</span><span class="p" data-group-id="7734829128-6">]</span><span class="p" data-group-id="7734829128-4">}</span><span class="w"> </span><span class="k" data-group-id="7734829128-3">end</span><span class="p" data-group-id="7734829128-2">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">bind</span><span class="p" data-group-id="7734829128-7">(</span><span class="k" data-group-id="7734829128-8">fn</span><span class="w"> </span><span class="p" data-group-id="7734829128-9">{</span><span class="n">base</span><span class="p">,</span><span class="w"> </span><span class="n">token</span><span class="p" data-group-id="7734829128-9">}</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
    </span><span class="nc">Effect</span><span class="o">.</span><span class="n">lift_func</span><span class="p" data-group-id="7734829128-10">(</span><span class="k" data-group-id="7734829128-11">fn</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">HTTPClient</span><span class="o">.</span><span class="n">get</span><span class="p" data-group-id="7734829128-12">(</span><span class="s">&quot;</span><span class="si" data-group-id="7734829128-13">#{</span><span class="n">base</span><span class="si" data-group-id="7734829128-13">}</span><span class="s">/users&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">headers</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="7734829128-14">[</span><span class="p" data-group-id="7734829128-15">{</span><span class="s">&quot;auth&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">token</span><span class="p" data-group-id="7734829128-15">}</span><span class="p" data-group-id="7734829128-14">]</span><span class="p" data-group-id="7734829128-12">)</span><span class="w"> </span><span class="k" data-group-id="7734829128-11">end</span><span class="p" data-group-id="7734829128-10">)</span><span class="w">
  </span><span class="k" data-group-id="7734829128-8">end</span><span class="p" data-group-id="7734829128-7">)</span><span class="w">
</span><span class="k" data-group-id="7734829128-1">end</span></code></pre><p><strong>Understanding the Monad Stack:</strong></p><pre><code class="makeup elixir" translate="no"><span class="c1"># Effect combines three familiar patterns:</span><span class="w">

</span><span class="c1"># 1. Reader: Environment access</span><span class="w">
</span><span class="nc">Effect</span><span class="o">.</span><span class="n">asks</span><span class="p" data-group-id="7290009116-1">(</span><span class="k" data-group-id="7290009116-2">fn</span><span class="w"> </span><span class="n">env</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">env</span><span class="p" data-group-id="7290009116-3">[</span><span class="ss">:database_config</span><span class="p" data-group-id="7290009116-3">]</span><span class="w"> </span><span class="k" data-group-id="7290009116-2">end</span><span class="p" data-group-id="7290009116-1">)</span><span class="w">

</span><span class="c1"># 2. Either: Success/failure handling  </span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="n">bind</span><span class="p" data-group-id="7290009116-4">(</span><span class="k" data-group-id="7290009116-5">fn</span><span class="w"> </span><span class="n">config</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
  </span><span class="k">case</span><span class="w"> </span><span class="nc">Database</span><span class="o">.</span><span class="n">connect</span><span class="p" data-group-id="7290009116-6">(</span><span class="n">config</span><span class="p" data-group-id="7290009116-6">)</span><span class="w"> </span><span class="k" data-group-id="7290009116-7">do</span><span class="w">
    </span><span class="p" data-group-id="7290009116-8">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">conn</span><span class="p" data-group-id="7290009116-8">}</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">right</span><span class="p" data-group-id="7290009116-9">(</span><span class="n">conn</span><span class="p" data-group-id="7290009116-9">)</span><span class="w">      </span><span class="c1"># Success path</span><span class="w">
    </span><span class="p" data-group-id="7290009116-10">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="n">reason</span><span class="p" data-group-id="7290009116-10">}</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">left</span><span class="p" data-group-id="7290009116-11">(</span><span class="n">reason</span><span class="p" data-group-id="7290009116-11">)</span><span class="w"> </span><span class="c1"># Failure path</span><span class="w">
  </span><span class="k" data-group-id="7290009116-7">end</span><span class="w">
</span><span class="k" data-group-id="7290009116-5">end</span><span class="p" data-group-id="7290009116-4">)</span><span class="w">

</span><span class="c1"># 3. Async: Deferred execution until run/2</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="7290009116-12">(</span><span class="p" data-group-id="7290009116-13">%{</span><span class="ss">database_config</span><span class="p">:</span><span class="w"> </span><span class="n">config</span><span class="p" data-group-id="7290009116-13">}</span><span class="p" data-group-id="7290009116-12">)</span><span class="w">  </span><span class="c1"># Returns Either.Right or Either.Left</span><span class="w">

</span><span class="c1"># Mathematically: Effect env a ≈ env -&gt; Task (Either error a)</span></code></pre><h2 id="context-observability" class="section-heading">
  <a href="#context-observability" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Context &amp; Observability</span>
</h2>
<h3 id="effect-context-tracing-and-telemetry" class="section-heading">
  <a href="#effect-context-tracing-and-telemetry" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Effect.Context - Tracing and Telemetry</span>
</h3>
<p>Every Effect carries context for observability:</p><pre><code class="makeup elixir" translate="no"><span class="c1"># Create context with span name and timeout</span><span class="w">
</span><span class="n">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Effect.Context</span><span class="o">.</span><span class="n">new</span><span class="p" data-group-id="3558050728-1">(</span><span class="w">
  </span><span class="ss">span_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;fetch_user_data&quot;</span><span class="p">,</span><span class="w">
  </span><span class="ss">timeout</span><span class="p">:</span><span class="w"> </span><span class="mi">10_000</span><span class="p">,</span><span class="w">
  </span><span class="ss">trace_id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;custom-trace-id&quot;</span><span class="w">
</span><span class="p" data-group-id="3558050728-1">)</span><span class="w">

</span><span class="nc">Effect</span><span class="o">.</span><span class="n">right</span><span class="p" data-group-id="3558050728-2">(</span><span class="n">user_id</span><span class="p">,</span><span class="w"> </span><span class="n">context</span><span class="p" data-group-id="3558050728-2">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="n">bind</span><span class="p" data-group-id="3558050728-3">(</span><span class="o">&amp;</span><span class="n">fetch_user_async</span><span class="o">/</span><span class="mi">1</span><span class="p" data-group-id="3558050728-3">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="3558050728-4">(</span><span class="n">env</span><span class="p" data-group-id="3558050728-4">)</span><span class="w">

</span><span class="c1"># Telemetry events emitted:</span><span class="w">
</span><span class="c1"># [:funx, :effect, :run, :start] - when execution begins  </span><span class="w">
</span><span class="c1"># [:funx, :effect, :run, :stop]  - when execution completes</span></code></pre><h3 id="span-naming-and-hierarchies" class="section-heading">
  <a href="#span-naming-and-hierarchies" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Span Naming and Hierarchies</span>
</h3>
<p>Effects automatically create hierarchical spans:</p><pre><code class="makeup elixir" translate="no"><span class="c1"># Parent effect</span><span class="w">
</span><span class="n">parent_effect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">right</span><span class="p" data-group-id="9921586285-1">(</span><span class="mi">42</span><span class="p">,</span><span class="w"> </span><span class="ss">span_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;parent_operation&quot;</span><span class="p" data-group-id="9921586285-1">)</span><span class="w">

</span><span class="c1"># Child operations create nested spans</span><span class="w">
</span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parent_effect</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="n">bind</span><span class="p" data-group-id="9921586285-2">(</span><span class="k" data-group-id="9921586285-3">fn</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> 
  </span><span class="nc">Effect</span><span class="o">.</span><span class="n">right</span><span class="p" data-group-id="9921586285-4">(</span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="ss">span_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;double_value&quot;</span><span class="p" data-group-id="9921586285-4">)</span><span class="w">  </span><span class="c1"># Creates &quot;bind -&gt; parent_operation&quot;</span><span class="w">
</span><span class="k" data-group-id="9921586285-3">end</span><span class="p" data-group-id="9921586285-2">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="n">map</span><span class="p" data-group-id="9921586285-5">(</span><span class="k" data-group-id="9921586285-6">fn</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w">  </span><span class="c1"># Creates &quot;map -&gt; bind -&gt; parent_operation&quot;</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="9921586285-7">(</span><span class="n">env</span><span class="p">,</span><span class="w"> </span><span class="ss">span_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;execute&quot;</span><span class="p" data-group-id="9921586285-7">)</span><span class="w">  </span><span class="c1"># Promotes to &quot;execute -&gt; map -&gt; bind -&gt; parent_operation&quot;</span></code></pre><h3 id="telemetry-events" class="section-heading">
  <a href="#telemetry-events" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Telemetry Events</span>
</h3>
<p>Effect automatically emits structured telemetry events for observability:</p><p><strong>Core Events:</strong></p><pre><code class="makeup elixir" translate="no"><span class="c1"># When Effect execution begins</span><span class="w">
</span><span class="p" data-group-id="2808656798-1">[</span><span class="ss">:funx</span><span class="p">,</span><span class="w"> </span><span class="ss">:effect</span><span class="p">,</span><span class="w"> </span><span class="ss">:run</span><span class="p">,</span><span class="w"> </span><span class="ss">:start</span><span class="p" data-group-id="2808656798-1">]</span><span class="w">

</span><span class="c1"># When Effect execution completes</span><span class="w">
</span><span class="p" data-group-id="2808656798-2">[</span><span class="ss">:funx</span><span class="p">,</span><span class="w"> </span><span class="ss">:effect</span><span class="p">,</span><span class="w"> </span><span class="ss">:run</span><span class="p">,</span><span class="w"> </span><span class="ss">:stop</span><span class="p" data-group-id="2808656798-2">]</span></code></pre><p><strong>Event Metadata:</strong></p><pre><code class="makeup elixir" translate="no"><span class="p" data-group-id="0616746380-1">%{</span><span class="w">
  </span><span class="ss">span_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;user_operation&quot;</span><span class="p">,</span><span class="w">        </span><span class="c1"># Current span name</span><span class="w">
  </span><span class="ss">trace_id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;abc123...&quot;</span><span class="p">,</span><span class="w">             </span><span class="c1"># Unique trace identifier  </span><span class="w">
  </span><span class="ss">parent_trace_id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;def456...&quot;</span><span class="p">,</span><span class="w">      </span><span class="c1"># Parent span if nested</span><span class="w">
  </span><span class="ss">timeout</span><span class="p">:</span><span class="w"> </span><span class="mi">5000</span><span class="p">,</span><span class="w">                     </span><span class="c1"># Configured timeout</span><span class="w">
  </span><span class="c1"># Plus any custom metadata from Context</span><span class="w">
</span><span class="p" data-group-id="0616746380-1">}</span></code></pre><p><strong>Measurements:</strong></p><pre><code class="makeup elixir" translate="no"><span class="p" data-group-id="9376324599-1">%{</span><span class="w">
  </span><span class="ss">duration</span><span class="p">:</span><span class="w"> </span><span class="mi">1_234_567</span><span class="p">,</span><span class="w">  </span><span class="c1"># Execution time in nanoseconds (for :stop events)</span><span class="w">
  </span><span class="ss">count</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">              </span><span class="c1"># Always 1 for Effect executions</span><span class="w">
</span><span class="p" data-group-id="9376324599-1">}</span></code></pre><p><strong>Example telemetry handler:</strong></p><pre><code class="makeup elixir" translate="no"><span class="nc">:telemetry</span><span class="o">.</span><span class="n">attach_many</span><span class="p" data-group-id="5758235861-1">(</span><span class="w">
  </span><span class="s">&quot;effect-observer&quot;</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="5758235861-2">[</span><span class="p" data-group-id="5758235861-3">[</span><span class="ss">:funx</span><span class="p">,</span><span class="w"> </span><span class="ss">:effect</span><span class="p">,</span><span class="w"> </span><span class="ss">:run</span><span class="p">,</span><span class="w"> </span><span class="ss">:start</span><span class="p" data-group-id="5758235861-3">]</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5758235861-4">[</span><span class="ss">:funx</span><span class="p">,</span><span class="w"> </span><span class="ss">:effect</span><span class="p">,</span><span class="w"> </span><span class="ss">:run</span><span class="p">,</span><span class="w"> </span><span class="ss">:stop</span><span class="p" data-group-id="5758235861-4">]</span><span class="p" data-group-id="5758235861-2">]</span><span class="p">,</span><span class="w">
  </span><span class="k" data-group-id="5758235861-5">fn</span><span class="w"> </span><span class="n">event</span><span class="p">,</span><span class="w"> </span><span class="n">measurements</span><span class="p">,</span><span class="w"> </span><span class="n">metadata</span><span class="p">,</span><span class="w"> </span><span class="c">_config</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">event</span><span class="w"> </span><span class="k" data-group-id="5758235861-6">do</span><span class="w">
      </span><span class="p" data-group-id="5758235861-7">[</span><span class="ss">:funx</span><span class="p">,</span><span class="w"> </span><span class="ss">:effect</span><span class="p">,</span><span class="w"> </span><span class="ss">:run</span><span class="p">,</span><span class="w"> </span><span class="ss">:start</span><span class="p" data-group-id="5758235861-7">]</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
        </span><span class="nc">Logger</span><span class="o">.</span><span class="n">info</span><span class="p" data-group-id="5758235861-8">(</span><span class="s">&quot;Effect started: </span><span class="si" data-group-id="5758235861-9">#{</span><span class="n">metadata</span><span class="o">.</span><span class="n">span_name</span><span class="si" data-group-id="5758235861-9">}</span><span class="s">&quot;</span><span class="p" data-group-id="5758235861-8">)</span><span class="w">
        
      </span><span class="p" data-group-id="5758235861-10">[</span><span class="ss">:funx</span><span class="p">,</span><span class="w"> </span><span class="ss">:effect</span><span class="p">,</span><span class="w"> </span><span class="ss">:run</span><span class="p">,</span><span class="w"> </span><span class="ss">:stop</span><span class="p" data-group-id="5758235861-10">]</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
        </span><span class="n">duration_ms</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">measurements</span><span class="o">.</span><span class="n">duration</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">1_000_000</span><span class="w">
        </span><span class="nc">Logger</span><span class="o">.</span><span class="n">info</span><span class="p" data-group-id="5758235861-11">(</span><span class="s">&quot;Effect completed: </span><span class="si" data-group-id="5758235861-12">#{</span><span class="n">metadata</span><span class="o">.</span><span class="n">span_name</span><span class="si" data-group-id="5758235861-12">}</span><span class="s"> in </span><span class="si" data-group-id="5758235861-13">#{</span><span class="n">duration_ms</span><span class="si" data-group-id="5758235861-13">}</span><span class="s">ms&quot;</span><span class="p" data-group-id="5758235861-11">)</span><span class="w">
    </span><span class="k" data-group-id="5758235861-6">end</span><span class="w">
  </span><span class="k" data-group-id="5758235861-5">end</span><span class="p">,</span><span class="w">
  </span><span class="no">nil</span><span class="w">
</span><span class="p" data-group-id="5758235861-1">)</span></code></pre><h3 id="exception-handling" class="section-heading">
  <a href="#exception-handling" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Exception Handling</span>
</h3>
<p>All exceptions are automatically wrapped in <code class="inline">EffectError</code>:</p><pre><code class="makeup elixir" translate="no"><span class="nc">Effect</span><span class="o">.</span><span class="n">lift_func</span><span class="p" data-group-id="5321061361-1">(</span><span class="k" data-group-id="5321061361-2">fn</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k" data-group-id="5321061361-2">end</span><span class="p" data-group-id="5321061361-1">)</span><span class="w">  
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="5321061361-3">(</span><span class="p" data-group-id="5321061361-3">)</span><span class="w">
</span><span class="c1"># Returns: left(%EffectError{stage: :lift_func, reason: %ArithmeticError{}})</span><span class="w">

</span><span class="nc">Effect</span><span class="o">.</span><span class="n">right</span><span class="p" data-group-id="5321061361-4">(</span><span class="mi">42</span><span class="p" data-group-id="5321061361-4">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="n">map</span><span class="p" data-group-id="5321061361-5">(</span><span class="k" data-group-id="5321061361-6">fn</span><span class="w"> </span><span class="bp">_</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">raise</span><span class="w"> </span><span class="s">&quot;boom&quot;</span><span class="w"> </span><span class="k" data-group-id="5321061361-6">end</span><span class="p" data-group-id="5321061361-5">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="5321061361-7">(</span><span class="p" data-group-id="5321061361-7">)</span><span class="w">  
</span><span class="c1"># Returns: left(%EffectError{stage: :map, reason: %RuntimeError{message: &quot;boom&quot;}})</span></code></pre><p><strong>EffectError Structure:</strong></p><pre><code class="makeup elixir" translate="no"><span class="p" data-group-id="9158654565-1">%</span><span class="nc" data-group-id="9158654565-1">Funx.Errors.EffectError</span><span class="p" data-group-id="9158654565-1">{</span><span class="w">
  </span><span class="ss">stage</span><span class="p">:</span><span class="w"> </span><span class="n">atom</span><span class="p" data-group-id="9158654565-2">(</span><span class="p" data-group-id="9158654565-2">)</span><span class="p">,</span><span class="w">    </span><span class="c1"># Where error occurred: :lift_func, :map, :bind, :ap, :run</span><span class="w">
  </span><span class="ss">reason</span><span class="p">:</span><span class="w"> </span><span class="n">any</span><span class="p" data-group-id="9158654565-3">(</span><span class="p" data-group-id="9158654565-3">)</span><span class="w">     </span><span class="c1"># Original exception or error reason</span><span class="w">
</span><span class="p" data-group-id="9158654565-1">}</span></code></pre><p><strong>Common EffectError stages:</strong></p><ul><li><code class="inline">:lift_func</code> - Exception in lifted function</li><li><code class="inline">:map</code> - Exception in map transformation  </li><li><code class="inline">:bind</code> - Exception in bind function</li><li><code class="inline">:ap</code> - Exception in applicative function</li><li><code class="inline">:run</code> - Timeout or task execution failure</li><li><code class="inline">:lift_either</code> - Exception in Either-returning function</li></ul><h2 id="list-operations" class="section-heading">
  <a href="#list-operations" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">List Operations</span>
</h2>
<h3 id="sequence-1-fail-fast-processing" class="section-heading">
  <a href="#sequence-1-fail-fast-processing" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text"><code class="inline">sequence/1</code> - Fail-Fast Processing</span>
</h3>
<p>Processes a list of Effects, stopping at the first Left:</p><pre><code class="makeup elixir" translate="no"><span class="n">effects</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="4783538177-1">[</span><span class="w">
  </span><span class="nc">Effect</span><span class="o">.</span><span class="n">right</span><span class="p" data-group-id="4783538177-2">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">span_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;first&quot;</span><span class="p" data-group-id="4783538177-2">)</span><span class="p">,</span><span class="w">
  </span><span class="nc">Effect</span><span class="o">.</span><span class="n">right</span><span class="p" data-group-id="4783538177-3">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="ss">span_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;second&quot;</span><span class="p" data-group-id="4783538177-3">)</span><span class="p">,</span><span class="w"> 
  </span><span class="nc">Effect</span><span class="o">.</span><span class="n">right</span><span class="p" data-group-id="4783538177-4">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="ss">span_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;third&quot;</span><span class="p" data-group-id="4783538177-4">)</span><span class="w">
</span><span class="p" data-group-id="4783538177-1">]</span><span class="w">

</span><span class="nc">Effect</span><span class="o">.</span><span class="n">sequence</span><span class="p" data-group-id="4783538177-5">(</span><span class="n">effects</span><span class="p" data-group-id="4783538177-5">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="4783538177-6">(</span><span class="p" data-group-id="4783538177-6">)</span><span class="w">                     </span><span class="c1"># right([1, 2, 3])</span><span class="w">

</span><span class="c1"># With failure - stops at first Left (pattern matching optimization)</span><span class="w">
</span><span class="n">effects_with_error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="4783538177-7">[</span><span class="w">
  </span><span class="nc">Effect</span><span class="o">.</span><span class="n">right</span><span class="p" data-group-id="4783538177-8">(</span><span class="mi">1</span><span class="p" data-group-id="4783538177-8">)</span><span class="p">,</span><span class="w">
  </span><span class="nc">Effect</span><span class="o">.</span><span class="n">left</span><span class="p" data-group-id="4783538177-9">(</span><span class="s">&quot;error&quot;</span><span class="p" data-group-id="4783538177-9">)</span><span class="p">,</span><span class="w">    </span><span class="c1"># %Effect.Left{} - can short-circuit here</span><span class="w">
  </span><span class="nc">Effect</span><span class="o">.</span><span class="n">right</span><span class="p" data-group-id="4783538177-10">(</span><span class="mi">3</span><span class="p" data-group-id="4783538177-10">)</span><span class="w">          </span><span class="c1"># Never executes because Left found</span><span class="w">
</span><span class="p" data-group-id="4783538177-7">]</span><span class="w">

</span><span class="nc">Effect</span><span class="o">.</span><span class="n">sequence</span><span class="p" data-group-id="4783538177-11">(</span><span class="n">effects_with_error</span><span class="p" data-group-id="4783538177-11">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="4783538177-12">(</span><span class="p" data-group-id="4783538177-12">)</span><span class="w">                     </span><span class="c1"># left(&quot;error&quot;)</span></code></pre><p><strong>Elixir-specific optimization</strong>: Because <code class="inline">Effect.left/2</code> creates an <code class="inline">%Effect.Left{}</code> struct, traversals can pattern match for structural short-circuiting—no task is scheduled if a Left is detected early during traversal construction.</p><h3 id="sequence_a-1-error-accumulation" class="section-heading">
  <a href="#sequence_a-1-error-accumulation" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text"><code class="inline">sequence_a/1</code> - Error Accumulation</span>
</h3>
<p>Processes all Effects and accumulates any errors:</p><pre><code class="makeup elixir" translate="no"><span class="n">effects_with_errors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="8200067597-1">[</span><span class="w">
  </span><span class="nc">Effect</span><span class="o">.</span><span class="n">right</span><span class="p" data-group-id="8200067597-2">(</span><span class="mi">1</span><span class="p" data-group-id="8200067597-2">)</span><span class="p">,</span><span class="w">
  </span><span class="nc">Effect</span><span class="o">.</span><span class="n">left</span><span class="p" data-group-id="8200067597-3">(</span><span class="s">&quot;Error 1&quot;</span><span class="p" data-group-id="8200067597-3">)</span><span class="p">,</span><span class="w">
  </span><span class="nc">Effect</span><span class="o">.</span><span class="n">left</span><span class="p" data-group-id="8200067597-4">(</span><span class="s">&quot;Error 2&quot;</span><span class="p" data-group-id="8200067597-4">)</span><span class="p">,</span><span class="w"> 
  </span><span class="nc">Effect</span><span class="o">.</span><span class="n">right</span><span class="p" data-group-id="8200067597-5">(</span><span class="mi">4</span><span class="p" data-group-id="8200067597-5">)</span><span class="w">
</span><span class="p" data-group-id="8200067597-1">]</span><span class="w">

</span><span class="nc">Effect</span><span class="o">.</span><span class="n">sequence_a</span><span class="p" data-group-id="8200067597-6">(</span><span class="n">effects_with_errors</span><span class="p" data-group-id="8200067597-6">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="8200067597-7">(</span><span class="p" data-group-id="8200067597-7">)</span><span class="w">                     </span><span class="c1"># left([&quot;Error 1&quot;, &quot;Error 2&quot;])</span><span class="w">

</span><span class="c1"># All succeed</span><span class="w">
</span><span class="n">all_success</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="8200067597-8">[</span><span class="nc">Effect</span><span class="o">.</span><span class="n">right</span><span class="p" data-group-id="8200067597-9">(</span><span class="mi">1</span><span class="p" data-group-id="8200067597-9">)</span><span class="p">,</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">right</span><span class="p" data-group-id="8200067597-10">(</span><span class="mi">2</span><span class="p" data-group-id="8200067597-10">)</span><span class="p">,</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">right</span><span class="p" data-group-id="8200067597-11">(</span><span class="mi">3</span><span class="p" data-group-id="8200067597-11">)</span><span class="p" data-group-id="8200067597-8">]</span><span class="w">

</span><span class="nc">Effect</span><span class="o">.</span><span class="n">sequence_a</span><span class="p" data-group-id="8200067597-12">(</span><span class="n">all_success</span><span class="p" data-group-id="8200067597-12">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="8200067597-13">(</span><span class="p" data-group-id="8200067597-13">)</span><span class="w">                     </span><span class="c1"># right([1, 2, 3])</span></code></pre><h3 id="traverse-2-apply-kleisli-function-fail-fast" class="section-heading">
  <a href="#traverse-2-apply-kleisli-function-fail-fast" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text"><code class="inline">traverse/2</code> - Apply Kleisli Function (Fail-Fast)</span>
</h3>
<p>Applies a Kleisli function to each element, stopping at first failure:</p><pre><code class="makeup elixir" translate="no"><span class="n">validate_positive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="1407446398-1">fn</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
  </span><span class="nc">Effect</span><span class="o">.</span><span class="n">lift_predicate</span><span class="p" data-group-id="1407446398-2">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="p" data-group-id="1407446398-3">(</span><span class="ni">&amp;1</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="1407446398-3">)</span><span class="p">,</span><span class="w"> </span><span class="k" data-group-id="1407446398-4">fn</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s">&quot;</span><span class="si" data-group-id="1407446398-5">#{</span><span class="n">x</span><span class="si" data-group-id="1407446398-5">}</span><span class="s"> is not positive&quot;</span><span class="w"> </span><span class="k" data-group-id="1407446398-4">end</span><span class="p" data-group-id="1407446398-2">)</span><span class="w">
</span><span class="k" data-group-id="1407446398-1">end</span><span class="w">

</span><span class="nc">Effect</span><span class="o">.</span><span class="n">traverse</span><span class="p" data-group-id="1407446398-6">(</span><span class="p" data-group-id="1407446398-7">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="1407446398-7">]</span><span class="p">,</span><span class="w"> </span><span class="n">validate_positive</span><span class="p" data-group-id="1407446398-6">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="1407446398-8">(</span><span class="p" data-group-id="1407446398-8">)</span><span class="w">                     </span><span class="c1"># right([1, 2, 3])</span><span class="w">

</span><span class="nc">Effect</span><span class="o">.</span><span class="n">traverse</span><span class="p" data-group-id="1407446398-9">(</span><span class="p" data-group-id="1407446398-10">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="1407446398-10">]</span><span class="p">,</span><span class="w"> </span><span class="n">validate_positive</span><span class="p" data-group-id="1407446398-9">)</span><span class="w">  
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="1407446398-11">(</span><span class="p" data-group-id="1407446398-11">)</span><span class="w">                     </span><span class="c1"># left(&quot;-2 is not positive&quot;)</span></code></pre><h3 id="traverse_a-2-apply-kleisli-function-accumulate-errors" class="section-heading">
  <a href="#traverse_a-2-apply-kleisli-function-accumulate-errors" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text"><code class="inline">traverse_a/2</code> - Apply Kleisli Function (Accumulate Errors)</span>
</h3>
<p>Applies a Kleisli function to each element, collecting all errors:</p><pre><code class="makeup elixir" translate="no"><span class="nc">Effect</span><span class="o">.</span><span class="n">traverse_a</span><span class="p" data-group-id="9287910041-1">(</span><span class="p" data-group-id="9287910041-2">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">3</span><span class="p" data-group-id="9287910041-2">]</span><span class="p">,</span><span class="w"> </span><span class="n">validate_positive</span><span class="p" data-group-id="9287910041-1">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="9287910041-3">(</span><span class="p" data-group-id="9287910041-3">)</span><span class="w">                     </span><span class="c1"># left([&quot;-2 is not positive&quot;, &quot;-3 is not positive&quot;])</span></code></pre><p><strong>Use <code class="inline">traverse</code> vs <code class="inline">traverse_a</code>:</strong></p><ul><li><strong>traverse</strong>: When you need all operations to succeed (fail-fast, sequential)</li><li><strong>traverse_a</strong>: When you want to see all validation errors (accumulate, parallel)</li></ul><p><strong>Key Performance Difference</strong>: <code class="inline">traverse_a</code> runs all operations concurrently, <code class="inline">traverse</code> stops at first failure.</p><h3 id="validate-2-multi-validator-error-accumulation" class="section-heading">
  <a href="#validate-2-multi-validator-error-accumulation" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text"><code class="inline">validate/2</code> - Multi-Validator Error Accumulation</span>
</h3>
<p>Validates a value using multiple validator functions:</p><pre><code class="makeup elixir" translate="no"><span class="n">validate_positive</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="6711406835-1">fn</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
  </span><span class="nc">Effect</span><span class="o">.</span><span class="n">lift_predicate</span><span class="p" data-group-id="6711406835-2">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="p" data-group-id="6711406835-3">(</span><span class="ni">&amp;1</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="6711406835-3">)</span><span class="p">,</span><span class="w"> </span><span class="k" data-group-id="6711406835-4">fn</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s">&quot;</span><span class="si" data-group-id="6711406835-5">#{</span><span class="n">n</span><span class="si" data-group-id="6711406835-5">}</span><span class="s"> must be positive&quot;</span><span class="w"> </span><span class="k" data-group-id="6711406835-4">end</span><span class="p" data-group-id="6711406835-2">)</span><span class="w">
</span><span class="k" data-group-id="6711406835-1">end</span><span class="w">

</span><span class="n">validate_even</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="6711406835-6">fn</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
  </span><span class="nc">Effect</span><span class="o">.</span><span class="n">lift_predicate</span><span class="p" data-group-id="6711406835-7">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="p" data-group-id="6711406835-8">(</span><span class="n">rem</span><span class="p" data-group-id="6711406835-9">(</span><span class="ni">&amp;1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="6711406835-9">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="6711406835-8">)</span><span class="p">,</span><span class="w"> </span><span class="k" data-group-id="6711406835-10">fn</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s">&quot;</span><span class="si" data-group-id="6711406835-11">#{</span><span class="n">n</span><span class="si" data-group-id="6711406835-11">}</span><span class="s"> must be even&quot;</span><span class="w"> </span><span class="k" data-group-id="6711406835-10">end</span><span class="p" data-group-id="6711406835-7">)</span><span class="w">
</span><span class="k" data-group-id="6711406835-6">end</span><span class="w">

</span><span class="c1"># All validators pass</span><span class="w">
</span><span class="nc">Effect</span><span class="o">.</span><span class="n">validate</span><span class="p" data-group-id="6711406835-12">(</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6711406835-13">[</span><span class="n">validate_positive</span><span class="p">,</span><span class="w"> </span><span class="n">validate_even</span><span class="p" data-group-id="6711406835-13">]</span><span class="p" data-group-id="6711406835-12">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="6711406835-14">(</span><span class="p" data-group-id="6711406835-14">)</span><span class="w">                     </span><span class="c1"># right(4)</span><span class="w">

</span><span class="c1"># Multiple validators fail - accumulates errors</span><span class="w">
</span><span class="nc">Effect</span><span class="o">.</span><span class="n">validate</span><span class="p" data-group-id="6711406835-15">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6711406835-16">[</span><span class="n">validate_positive</span><span class="p">,</span><span class="w"> </span><span class="n">validate_even</span><span class="p" data-group-id="6711406835-16">]</span><span class="p" data-group-id="6711406835-15">)</span><span class="w">  
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="6711406835-17">(</span><span class="p" data-group-id="6711406835-17">)</span><span class="w">                     </span><span class="c1"># left([&quot;-3 must be positive&quot;, &quot;-3 must be even&quot;])</span></code></pre><h2 id="lifting-operations" class="section-heading">
  <a href="#lifting-operations" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Lifting Operations</span>
</h2>
<h3 id="lift_func-2-lift-synchronous-function" class="section-heading">
  <a href="#lift_func-2-lift-synchronous-function" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text"><code class="inline">lift_func/2</code> - Lift Synchronous Function</span>
</h3>
<p>Lifts a zero-arity function into an Effect, executing it asynchronously:</p><pre><code class="makeup elixir" translate="no"><span class="nc">Effect</span><span class="o">.</span><span class="n">lift_func</span><span class="p" data-group-id="4855643331-1">(</span><span class="k" data-group-id="4855643331-2">fn</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">expensive_computation</span><span class="p" data-group-id="4855643331-3">(</span><span class="p" data-group-id="4855643331-3">)</span><span class="w"> </span><span class="k" data-group-id="4855643331-2">end</span><span class="p" data-group-id="4855643331-1">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="4855643331-4">(</span><span class="p" data-group-id="4855643331-4">)</span><span class="w">                     </span><span class="c1"># Runs async, returns right(result)</span><span class="w">

</span><span class="c1"># Exception handling</span><span class="w">
</span><span class="nc">Effect</span><span class="o">.</span><span class="n">lift_func</span><span class="p" data-group-id="4855643331-5">(</span><span class="k" data-group-id="4855643331-6">fn</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">raise</span><span class="w"> </span><span class="s">&quot;boom&quot;</span><span class="w"> </span><span class="k" data-group-id="4855643331-6">end</span><span class="p" data-group-id="4855643331-5">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="4855643331-7">(</span><span class="p" data-group-id="4855643331-7">)</span><span class="w">                     </span><span class="c1"># left(%EffectError{stage: :lift_func, reason: %RuntimeError{}})</span></code></pre><h3 id="lift_either-2-lift-either-returning-function" class="section-heading">
  <a href="#lift_either-2-lift-either-returning-function" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text"><code class="inline">lift_either/2</code> - Lift Either-Returning Function</span>
</h3>
<p>Lifts a function that returns Either into an Effect:</p><pre><code class="makeup elixir" translate="no"><span class="nc">Effect</span><span class="o">.</span><span class="n">lift_either</span><span class="p" data-group-id="3695098922-1">(</span><span class="k" data-group-id="3695098922-2">fn</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">validate_email</span><span class="p" data-group-id="3695098922-3">(</span><span class="s">&quot;user@example.com&quot;</span><span class="p" data-group-id="3695098922-3">)</span><span class="w"> </span><span class="k" data-group-id="3695098922-2">end</span><span class="p" data-group-id="3695098922-1">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="3695098922-4">(</span><span class="p" data-group-id="3695098922-4">)</span><span class="w">                     </span><span class="c1"># Defers Either evaluation until run</span></code></pre><h3 id="lift_maybe-3-lift-maybe-with-fallback" class="section-heading">
  <a href="#lift_maybe-3-lift-maybe-with-fallback" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text"><code class="inline">lift_maybe/3</code> - Lift Maybe with Fallback</span>
</h3>
<p>Converts a Maybe into an Effect with error fallback:</p><pre><code class="makeup elixir" translate="no"><span class="n">maybe_user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Maybe</span><span class="o">.</span><span class="n">just</span><span class="p" data-group-id="0244923751-1">(</span><span class="p" data-group-id="0244923751-2">%</span><span class="nc" data-group-id="0244923751-2">User</span><span class="p" data-group-id="0244923751-2">{</span><span class="ss">id</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="0244923751-2">}</span><span class="p" data-group-id="0244923751-1">)</span><span class="w">

</span><span class="nc">Effect</span><span class="o">.</span><span class="n">lift_maybe</span><span class="p" data-group-id="0244923751-3">(</span><span class="n">maybe_user</span><span class="p">,</span><span class="w"> </span><span class="k" data-group-id="0244923751-4">fn</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s">&quot;User not found&quot;</span><span class="w"> </span><span class="k" data-group-id="0244923751-4">end</span><span class="p" data-group-id="0244923751-3">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="0244923751-5">(</span><span class="p" data-group-id="0244923751-5">)</span><span class="w">                     </span><span class="c1"># right(%User{id: 1})</span><span class="w">

</span><span class="nc">Effect</span><span class="o">.</span><span class="n">lift_maybe</span><span class="p" data-group-id="0244923751-6">(</span><span class="nc">Maybe</span><span class="o">.</span><span class="n">nothing</span><span class="p" data-group-id="0244923751-7">(</span><span class="p" data-group-id="0244923751-7">)</span><span class="p">,</span><span class="w"> </span><span class="k" data-group-id="0244923751-8">fn</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s">&quot;User not found&quot;</span><span class="w"> </span><span class="k" data-group-id="0244923751-8">end</span><span class="p" data-group-id="0244923751-6">)</span><span class="w">  
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="0244923751-9">(</span><span class="p" data-group-id="0244923751-9">)</span><span class="w">                     </span><span class="c1"># left(&quot;User not found&quot;)</span></code></pre><h3 id="lift_predicate-3-lift-predicate-check" class="section-heading">
  <a href="#lift_predicate-3-lift-predicate-check" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text"><code class="inline">lift_predicate/3</code> - Lift Predicate Check</span>
</h3>
<p>Lifts a predicate validation into an Effect:</p><pre><code class="makeup elixir" translate="no"><span class="nc">Effect</span><span class="o">.</span><span class="n">lift_predicate</span><span class="p" data-group-id="2133805554-1">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="p" data-group-id="2133805554-2">(</span><span class="ni">&amp;1</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">5</span><span class="p" data-group-id="2133805554-2">)</span><span class="p">,</span><span class="w"> </span><span class="k" data-group-id="2133805554-3">fn</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s">&quot;</span><span class="si" data-group-id="2133805554-4">#{</span><span class="n">x</span><span class="si" data-group-id="2133805554-4">}</span><span class="s"> too small&quot;</span><span class="w"> </span><span class="k" data-group-id="2133805554-3">end</span><span class="p" data-group-id="2133805554-1">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="2133805554-5">(</span><span class="p" data-group-id="2133805554-5">)</span><span class="w">                     </span><span class="c1"># right(10)</span><span class="w">

</span><span class="nc">Effect</span><span class="o">.</span><span class="n">lift_predicate</span><span class="p" data-group-id="2133805554-6">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="p" data-group-id="2133805554-7">(</span><span class="ni">&amp;1</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">5</span><span class="p" data-group-id="2133805554-7">)</span><span class="p">,</span><span class="w"> </span><span class="k" data-group-id="2133805554-8">fn</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s">&quot;</span><span class="si" data-group-id="2133805554-9">#{</span><span class="n">x</span><span class="si" data-group-id="2133805554-9">}</span><span class="s"> too small&quot;</span><span class="w"> </span><span class="k" data-group-id="2133805554-8">end</span><span class="p" data-group-id="2133805554-6">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="2133805554-10">(</span><span class="p" data-group-id="2133805554-10">)</span><span class="w">                     </span><span class="c1"># left(&quot;3 too small&quot;)</span></code></pre><h2 id="error-handling" class="section-heading">
  <a href="#error-handling" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Error Handling</span>
</h2>
<h3 id="map_left-2-transform-left-values" class="section-heading">
  <a href="#map_left-2-transform-left-values" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text"><code class="inline">map_left/2</code> - Transform Left Values</span>
</h3>
<p>Transforms error values while leaving Right unchanged:</p><pre><code class="makeup elixir" translate="no"><span class="nc">Effect</span><span class="o">.</span><span class="n">left</span><span class="p" data-group-id="0367349366-1">(</span><span class="s">&quot;simple error&quot;</span><span class="p" data-group-id="0367349366-1">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">map_left</span><span class="p" data-group-id="0367349366-2">(</span><span class="k" data-group-id="0367349366-3">fn</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p" data-group-id="0367349366-4">%{</span><span class="ss">error</span><span class="p">:</span><span class="w"> </span><span class="n">e</span><span class="p">,</span><span class="w"> </span><span class="ss">code</span><span class="p">:</span><span class="w"> </span><span class="mi">400</span><span class="p" data-group-id="0367349366-4">}</span><span class="w"> </span><span class="k" data-group-id="0367349366-3">end</span><span class="p" data-group-id="0367349366-2">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="0367349366-5">(</span><span class="p" data-group-id="0367349366-5">)</span><span class="w">                     </span><span class="c1"># left(%{error: &quot;simple error&quot;, code: 400})</span><span class="w">

</span><span class="nc">Effect</span><span class="o">.</span><span class="n">right</span><span class="p" data-group-id="0367349366-6">(</span><span class="mi">42</span><span class="p" data-group-id="0367349366-6">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">map_left</span><span class="p" data-group-id="0367349366-7">(</span><span class="k" data-group-id="0367349366-8">fn</span><span class="w"> </span><span class="bp">_</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s">&quot;never called&quot;</span><span class="w"> </span><span class="k" data-group-id="0367349366-8">end</span><span class="p" data-group-id="0367349366-7">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="0367349366-9">(</span><span class="p" data-group-id="0367349366-9">)</span><span class="w">                     </span><span class="c1"># right(42)</span></code></pre><h3 id="flip_either-1-invert-success-failure" class="section-heading">
  <a href="#flip_either-1-invert-success-failure" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text"><code class="inline">flip_either/1</code> - Invert Success/Failure</span>
</h3>
<p>Swaps Right and Left values:</p><pre><code class="makeup elixir" translate="no"><span class="nc">Effect</span><span class="o">.</span><span class="n">flip_either</span><span class="p" data-group-id="8673596700-1">(</span><span class="nc">Effect</span><span class="o">.</span><span class="n">right</span><span class="p" data-group-id="8673596700-2">(</span><span class="s">&quot;success&quot;</span><span class="p" data-group-id="8673596700-2">)</span><span class="p" data-group-id="8673596700-1">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="8673596700-3">(</span><span class="p" data-group-id="8673596700-3">)</span><span class="w">                     </span><span class="c1"># left(&quot;success&quot;)</span><span class="w">

</span><span class="nc">Effect</span><span class="o">.</span><span class="n">flip_either</span><span class="p" data-group-id="8673596700-4">(</span><span class="nc">Effect</span><span class="o">.</span><span class="n">left</span><span class="p" data-group-id="8673596700-5">(</span><span class="s">&quot;error&quot;</span><span class="p" data-group-id="8673596700-5">)</span><span class="p" data-group-id="8673596700-4">)</span><span class="w">  
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="8673596700-6">(</span><span class="p" data-group-id="8673596700-6">)</span><span class="w">                     </span><span class="c1"># right(&quot;error&quot;)</span></code></pre><h2 id="common-patterns" class="section-heading">
  <a href="#common-patterns" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Common Patterns</span>
</h2>
<h3 id="async-pipeline-with-error-handling" class="section-heading">
  <a href="#async-pipeline-with-error-handling" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Async Pipeline with Error Handling</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="kd">def</span><span class="w"> </span><span class="nf">process_user_registration</span><span class="p" data-group-id="1318785152-1">(</span><span class="n">email</span><span class="p">,</span><span class="w"> </span><span class="n">password</span><span class="p">,</span><span class="w"> </span><span class="n">env</span><span class="p" data-group-id="1318785152-1">)</span><span class="w"> </span><span class="k" data-group-id="1318785152-2">do</span><span class="w">
  </span><span class="nc">Effect</span><span class="o">.</span><span class="n">right</span><span class="p" data-group-id="1318785152-3">(</span><span class="p" data-group-id="1318785152-4">{</span><span class="n">email</span><span class="p">,</span><span class="w"> </span><span class="n">password</span><span class="p" data-group-id="1318785152-4">}</span><span class="p" data-group-id="1318785152-3">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">bind</span><span class="p" data-group-id="1318785152-5">(</span><span class="k" data-group-id="1318785152-6">fn</span><span class="w"> </span><span class="p" data-group-id="1318785152-7">{</span><span class="n">e</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p" data-group-id="1318785152-7">}</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">validate_email_async</span><span class="p" data-group-id="1318785152-8">(</span><span class="n">e</span><span class="p" data-group-id="1318785152-8">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">map</span><span class="p" data-group-id="1318785152-9">(</span><span class="k" data-group-id="1318785152-10">fn</span><span class="w"> </span><span class="bp">_</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p" data-group-id="1318785152-11">{</span><span class="n">e</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p" data-group-id="1318785152-11">}</span><span class="w"> </span><span class="k" data-group-id="1318785152-10">end</span><span class="p" data-group-id="1318785152-9">)</span><span class="w"> </span><span class="k" data-group-id="1318785152-6">end</span><span class="p" data-group-id="1318785152-5">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">bind</span><span class="p" data-group-id="1318785152-12">(</span><span class="k" data-group-id="1318785152-13">fn</span><span class="w"> </span><span class="p" data-group-id="1318785152-14">{</span><span class="n">e</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p" data-group-id="1318785152-14">}</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">hash_password_async</span><span class="p" data-group-id="1318785152-15">(</span><span class="n">p</span><span class="p" data-group-id="1318785152-15">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">map</span><span class="p" data-group-id="1318785152-16">(</span><span class="k" data-group-id="1318785152-17">fn</span><span class="w"> </span><span class="n">h</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p" data-group-id="1318785152-18">{</span><span class="n">e</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="p" data-group-id="1318785152-18">}</span><span class="w"> </span><span class="k" data-group-id="1318785152-17">end</span><span class="p" data-group-id="1318785152-16">)</span><span class="w"> </span><span class="k" data-group-id="1318785152-13">end</span><span class="p" data-group-id="1318785152-12">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">bind</span><span class="p" data-group-id="1318785152-19">(</span><span class="k" data-group-id="1318785152-20">fn</span><span class="w"> </span><span class="p" data-group-id="1318785152-21">{</span><span class="n">e</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="p" data-group-id="1318785152-21">}</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">create_user_async</span><span class="p" data-group-id="1318785152-22">(</span><span class="n">e</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="p" data-group-id="1318785152-22">)</span><span class="w"> </span><span class="k" data-group-id="1318785152-20">end</span><span class="p" data-group-id="1318785152-19">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">bind</span><span class="p" data-group-id="1318785152-23">(</span><span class="o">&amp;</span><span class="n">send_welcome_email_async</span><span class="o">/</span><span class="mi">1</span><span class="p" data-group-id="1318785152-23">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="1318785152-24">(</span><span class="n">env</span><span class="p" data-group-id="1318785152-24">)</span><span class="w">
</span><span class="k" data-group-id="1318785152-2">end</span></code></pre><h3 id="parallel-api-calls-with-error-accumulation" class="section-heading">
  <a href="#parallel-api-calls-with-error-accumulation" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Parallel API Calls with Error Accumulation</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="kd">def</span><span class="w"> </span><span class="nf">fetch_dashboard_data</span><span class="p" data-group-id="6057840909-1">(</span><span class="n">user_id</span><span class="p">,</span><span class="w"> </span><span class="n">env</span><span class="p" data-group-id="6057840909-1">)</span><span class="w"> </span><span class="k" data-group-id="6057840909-2">do</span><span class="w">
  </span><span class="n">api_calls</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="6057840909-3">[</span><span class="w">
    </span><span class="n">fetch_user_profile</span><span class="p" data-group-id="6057840909-4">(</span><span class="n">user_id</span><span class="p" data-group-id="6057840909-4">)</span><span class="p">,</span><span class="w">
    </span><span class="n">fetch_recent_orders</span><span class="p" data-group-id="6057840909-5">(</span><span class="n">user_id</span><span class="p" data-group-id="6057840909-5">)</span><span class="p">,</span><span class="w">  
    </span><span class="n">fetch_recommendations</span><span class="p" data-group-id="6057840909-6">(</span><span class="n">user_id</span><span class="p" data-group-id="6057840909-6">)</span><span class="w">
  </span><span class="p" data-group-id="6057840909-3">]</span><span class="w">
  
  </span><span class="nc">Effect</span><span class="o">.</span><span class="n">sequence_a</span><span class="p" data-group-id="6057840909-7">(</span><span class="n">api_calls</span><span class="p">,</span><span class="w"> </span><span class="ss">span_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;dashboard_data&quot;</span><span class="p" data-group-id="6057840909-7">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">map</span><span class="p" data-group-id="6057840909-8">(</span><span class="k" data-group-id="6057840909-9">fn</span><span class="w"> </span><span class="p" data-group-id="6057840909-10">[</span><span class="n">profile</span><span class="p">,</span><span class="w"> </span><span class="n">orders</span><span class="p">,</span><span class="w"> </span><span class="n">recs</span><span class="p" data-group-id="6057840909-10">]</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> 
    </span><span class="p" data-group-id="6057840909-11">%{</span><span class="ss">profile</span><span class="p">:</span><span class="w"> </span><span class="n">profile</span><span class="p">,</span><span class="w"> </span><span class="ss">orders</span><span class="p">:</span><span class="w"> </span><span class="n">orders</span><span class="p">,</span><span class="w"> </span><span class="ss">recommendations</span><span class="p">:</span><span class="w"> </span><span class="n">recs</span><span class="p" data-group-id="6057840909-11">}</span><span class="w">
  </span><span class="k" data-group-id="6057840909-9">end</span><span class="p" data-group-id="6057840909-8">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="6057840909-12">(</span><span class="n">env</span><span class="p" data-group-id="6057840909-12">)</span><span class="w">
</span><span class="k" data-group-id="6057840909-2">end</span></code></pre><h3 id="performance-optimized-validation-pipeline" class="section-heading">
  <a href="#performance-optimized-validation-pipeline" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Performance-Optimized Validation Pipeline</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="kd">def</span><span class="w"> </span><span class="nf">validate_ride_access</span><span class="p" data-group-id="2054913835-1">(</span><span class="n">patron</span><span class="p">,</span><span class="w"> </span><span class="n">ride</span><span class="p">,</span><span class="w"> </span><span class="n">env</span><span class="p" data-group-id="2054913835-1">)</span><span class="w"> </span><span class="k" data-group-id="2054913835-2">do</span><span class="w">
  </span><span class="c1"># Fast local checks first (milliseconds)</span><span class="w">
  </span><span class="nc">Effect</span><span class="o">.</span><span class="n">right</span><span class="p" data-group-id="2054913835-3">(</span><span class="n">patron</span><span class="p" data-group-id="2054913835-3">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">bind</span><span class="p" data-group-id="2054913835-4">(</span><span class="o">&amp;</span><span class="n">validate_age_height</span><span class="o">/</span><span class="mi">1</span><span class="p" data-group-id="2054913835-4">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">bind</span><span class="p" data-group-id="2054913835-5">(</span><span class="o">&amp;</span><span class="n">validate_ticket_tier</span><span class="o">/</span><span class="mi">1</span><span class="p" data-group-id="2054913835-5">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">bind</span><span class="p" data-group-id="2054913835-6">(</span><span class="k" data-group-id="2054913835-7">fn</span><span class="w"> </span><span class="n">patron</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
    </span><span class="c1"># Only do expensive I/O checks for eligible patrons (500ms)</span><span class="w">
    </span><span class="n">check_ride_maintenance_status</span><span class="p" data-group-id="2054913835-8">(</span><span class="n">ride</span><span class="p">,</span><span class="w"> </span><span class="n">env</span><span class="p" data-group-id="2054913835-8">)</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">map</span><span class="p" data-group-id="2054913835-9">(</span><span class="k" data-group-id="2054913835-10">fn</span><span class="w"> </span><span class="bp">_</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">patron</span><span class="w"> </span><span class="k" data-group-id="2054913835-10">end</span><span class="p" data-group-id="2054913835-9">)</span><span class="w">
  </span><span class="k" data-group-id="2054913835-7">end</span><span class="p" data-group-id="2054913835-6">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="2054913835-11">(</span><span class="n">env</span><span class="p" data-group-id="2054913835-11">)</span><span class="w">
</span><span class="k" data-group-id="2054913835-2">end</span><span class="w">

</span><span class="c1"># bind chains: Sequential execution, short-circuit on first failure  </span><span class="w">
</span><span class="c1"># traverse_a: Parallel execution, collect all errors</span></code></pre><h3 id="dependency-injection-with-reader" class="section-heading">
  <a href="#dependency-injection-with-reader" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Dependency Injection with Reader</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="c1"># Effect stays decoupled from specific implementations</span><span class="w">
</span><span class="kd">def</span><span class="w"> </span><span class="nf">save_user_data</span><span class="p" data-group-id="8002110029-1">(</span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="n">env</span><span class="p" data-group-id="8002110029-1">)</span><span class="w"> </span><span class="k" data-group-id="8002110029-2">do</span><span class="w">
  </span><span class="nc">Effect</span><span class="o">.</span><span class="n">asks</span><span class="p" data-group-id="8002110029-3">(</span><span class="k" data-group-id="8002110029-4">fn</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p" data-group-id="8002110029-5">{</span><span class="n">e</span><span class="p" data-group-id="8002110029-6">[</span><span class="ss">:store</span><span class="p" data-group-id="8002110029-6">]</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p" data-group-id="8002110029-7">[</span><span class="ss">:logger</span><span class="p" data-group-id="8002110029-7">]</span><span class="p" data-group-id="8002110029-5">}</span><span class="w"> </span><span class="k" data-group-id="8002110029-4">end</span><span class="p" data-group-id="8002110029-3">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">bind</span><span class="p" data-group-id="8002110029-8">(</span><span class="k" data-group-id="8002110029-9">fn</span><span class="w"> </span><span class="p" data-group-id="8002110029-10">{</span><span class="n">store</span><span class="p">,</span><span class="w"> </span><span class="n">logger</span><span class="p" data-group-id="8002110029-10">}</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
    </span><span class="nc">Effect</span><span class="o">.</span><span class="n">lift_func</span><span class="p" data-group-id="8002110029-11">(</span><span class="k" data-group-id="8002110029-12">fn</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p" data-group-id="8002110029-13">(</span><span class="s">&quot;Saving user </span><span class="si" data-group-id="8002110029-14">#{</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="si" data-group-id="8002110029-14">}</span><span class="s">&quot;</span><span class="p" data-group-id="8002110029-13">)</span><span class="w"> </span><span class="k" data-group-id="8002110029-12">end</span><span class="p" data-group-id="8002110029-11">)</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">bind</span><span class="p" data-group-id="8002110029-15">(</span><span class="k" data-group-id="8002110029-16">fn</span><span class="w"> </span><span class="bp">_</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">store</span><span class="o">.</span><span class="n">save</span><span class="p" data-group-id="8002110029-17">(</span><span class="n">user</span><span class="p" data-group-id="8002110029-17">)</span><span class="w"> </span><span class="k" data-group-id="8002110029-16">end</span><span class="p" data-group-id="8002110029-15">)</span><span class="w">
  </span><span class="k" data-group-id="8002110029-9">end</span><span class="p" data-group-id="8002110029-8">)</span><span class="w">  
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="8002110029-18">(</span><span class="n">env</span><span class="p" data-group-id="8002110029-18">)</span><span class="w">
</span><span class="k" data-group-id="8002110029-2">end</span><span class="w">

</span><span class="c1"># Runtime injection enables evolutionary design</span><span class="w">
</span><span class="n">dev_env</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="8002110029-19">%{</span><span class="ss">store</span><span class="p">:</span><span class="w"> </span><span class="nc">InMemoryStore</span><span class="p">,</span><span class="w"> </span><span class="ss">logger</span><span class="p">:</span><span class="w"> </span><span class="nc">ConsoleLogger</span><span class="p" data-group-id="8002110029-19">}</span><span class="w">
</span><span class="n">prod_env</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="8002110029-20">%{</span><span class="ss">store</span><span class="p">:</span><span class="w"> </span><span class="nc">PostgreSQLStore</span><span class="p">,</span><span class="w"> </span><span class="ss">logger</span><span class="p">:</span><span class="w"> </span><span class="nc">TelemetryLogger</span><span class="p" data-group-id="8002110029-20">}</span></code></pre><h3 id="timeout-and-supervision" class="section-heading">
  <a href="#timeout-and-supervision" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Timeout and Supervision</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="p" data-group-id="3014124681-1">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">sup</span><span class="p" data-group-id="3014124681-1">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Task.Supervisor</span><span class="o">.</span><span class="n">start_link</span><span class="p" data-group-id="3014124681-2">(</span><span class="p" data-group-id="3014124681-2">)</span><span class="w">

</span><span class="n">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Effect.Context</span><span class="o">.</span><span class="n">new</span><span class="p" data-group-id="3014124681-3">(</span><span class="w">
  </span><span class="ss">span_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;long_running_task&quot;</span><span class="p">,</span><span class="w">
  </span><span class="ss">timeout</span><span class="p">:</span><span class="w"> </span><span class="mi">30_000</span><span class="w">
</span><span class="p" data-group-id="3014124681-3">)</span><span class="w">

</span><span class="nc">Effect</span><span class="o">.</span><span class="n">lift_func</span><span class="p" data-group-id="3014124681-4">(</span><span class="k" data-group-id="3014124681-5">fn</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">very_expensive_operation</span><span class="p" data-group-id="3014124681-6">(</span><span class="p" data-group-id="3014124681-6">)</span><span class="w"> </span><span class="k" data-group-id="3014124681-5">end</span><span class="p">,</span><span class="w"> </span><span class="n">context</span><span class="p" data-group-id="3014124681-4">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="3014124681-7">(</span><span class="p" data-group-id="3014124681-8">%{</span><span class="p" data-group-id="3014124681-8">}</span><span class="p">,</span><span class="w"> </span><span class="ss">task_supervisor</span><span class="p">:</span><span class="w"> </span><span class="n">sup</span><span class="p" data-group-id="3014124681-7">)</span></code></pre><h2 id="elixir-interoperability" class="section-heading">
  <a href="#elixir-interoperability" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Elixir Interoperability</span>
</h2>
<h3 id="from_result-2-convert-result-tuples" class="section-heading">
  <a href="#from_result-2-convert-result-tuples" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text"><code class="inline">from_result/2</code> - Convert Result Tuples</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="nc">Effect</span><span class="o">.</span><span class="n">from_result</span><span class="p" data-group-id="8946991638-1">(</span><span class="p" data-group-id="8946991638-2">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="mi">42</span><span class="p" data-group-id="8946991638-2">}</span><span class="p" data-group-id="8946991638-1">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="8946991638-3">(</span><span class="p" data-group-id="8946991638-3">)</span><span class="w">                     </span><span class="c1"># right(42)</span><span class="w">

</span><span class="nc">Effect</span><span class="o">.</span><span class="n">from_result</span><span class="p" data-group-id="8946991638-4">(</span><span class="p" data-group-id="8946991638-5">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;failed&quot;</span><span class="p" data-group-id="8946991638-5">}</span><span class="p" data-group-id="8946991638-4">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="8946991638-6">(</span><span class="p" data-group-id="8946991638-6">)</span><span class="w">                     </span><span class="c1"># left(&quot;failed&quot;)</span></code></pre><h3 id="to_result-1-convert-to-result-tuples" class="section-heading">
  <a href="#to_result-1-convert-to-result-tuples" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text"><code class="inline">to_result/1</code> - Convert to Result Tuples</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="nc">Effect</span><span class="o">.</span><span class="n">to_result</span><span class="p" data-group-id="6909073817-1">(</span><span class="nc">Effect</span><span class="o">.</span><span class="n">right</span><span class="p" data-group-id="6909073817-2">(</span><span class="mi">42</span><span class="p" data-group-id="6909073817-2">)</span><span class="p" data-group-id="6909073817-1">)</span><span class="w">              </span><span class="c1"># {:ok, 42}</span><span class="w">
</span><span class="nc">Effect</span><span class="o">.</span><span class="n">to_result</span><span class="p" data-group-id="6909073817-3">(</span><span class="nc">Effect</span><span class="o">.</span><span class="n">left</span><span class="p" data-group-id="6909073817-4">(</span><span class="s">&quot;error&quot;</span><span class="p" data-group-id="6909073817-4">)</span><span class="p" data-group-id="6909073817-3">)</span><span class="w">          </span><span class="c1"># {:error, &quot;error&quot;}</span></code></pre><h3 id="from_try-2-exception-safe-kleisli" class="section-heading">
  <a href="#from_try-2-exception-safe-kleisli" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text"><code class="inline">from_try/2</code> - Exception-Safe Kleisli</span>
</h3>
<p>Creates a Kleisli function that catches exceptions:</p><pre><code class="makeup elixir" translate="no"><span class="n">safe_div</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">from_try</span><span class="p" data-group-id="4212402053-1">(</span><span class="k" data-group-id="4212402053-2">fn</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="k" data-group-id="4212402053-2">end</span><span class="p" data-group-id="4212402053-1">)</span><span class="w">

</span><span class="nc">Effect</span><span class="o">.</span><span class="n">right</span><span class="p" data-group-id="4212402053-3">(</span><span class="mi">2</span><span class="p" data-group-id="4212402053-3">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="n">bind</span><span class="p" data-group-id="4212402053-4">(</span><span class="n">safe_div</span><span class="p" data-group-id="4212402053-4">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="4212402053-5">(</span><span class="p" data-group-id="4212402053-5">)</span><span class="w">                     </span><span class="c1"># right(5.0)</span><span class="w">

</span><span class="nc">Effect</span><span class="o">.</span><span class="n">right</span><span class="p" data-group-id="4212402053-6">(</span><span class="mi">0</span><span class="p" data-group-id="4212402053-6">)</span><span class="w">  
</span><span class="o">|&gt;</span><span class="w"> </span><span class="n">bind</span><span class="p" data-group-id="4212402053-7">(</span><span class="n">safe_div</span><span class="p" data-group-id="4212402053-7">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="4212402053-8">(</span><span class="p" data-group-id="4212402053-8">)</span><span class="w">                     </span><span class="c1"># left(%ArithmeticError{})</span></code></pre><h3 id="to_try-1-extract-or-raise" class="section-heading">
  <a href="#to_try-1-extract-or-raise" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text"><code class="inline">to_try!/1</code> - Extract or Raise</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="nc">Effect</span><span class="o">.</span><span class="n">to_try!</span><span class="p" data-group-id="0952013718-1">(</span><span class="nc">Effect</span><span class="o">.</span><span class="n">right</span><span class="p" data-group-id="0952013718-2">(</span><span class="mi">42</span><span class="p" data-group-id="0952013718-2">)</span><span class="p" data-group-id="0952013718-1">)</span><span class="w">                </span><span class="c1"># 42</span><span class="w">

</span><span class="nc">Effect</span><span class="o">.</span><span class="n">to_try!</span><span class="p" data-group-id="0952013718-3">(</span><span class="nc">Effect</span><span class="o">.</span><span class="n">left</span><span class="p" data-group-id="0952013718-4">(</span><span class="p" data-group-id="0952013718-5">%</span><span class="nc" data-group-id="0952013718-5">RuntimeError</span><span class="p" data-group-id="0952013718-5">{</span><span class="ss">message</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;boom&quot;</span><span class="p" data-group-id="0952013718-5">}</span><span class="p" data-group-id="0952013718-4">)</span><span class="p" data-group-id="0952013718-3">)</span><span class="w">  
</span><span class="c1"># raises RuntimeError: &quot;boom&quot;</span></code></pre><h2 id="testing-strategies" class="section-heading">
  <a href="#testing-strategies" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Testing Strategies</span>
</h2>
<h3 id="property-based-testing" class="section-heading">
  <a href="#property-based-testing" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Property-Based Testing</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="kd">defmodule</span><span class="w"> </span><span class="nc">EffectPropertyTest</span><span class="w"> </span><span class="k" data-group-id="1329402523-1">do</span><span class="w">
  </span><span class="kn">use</span><span class="w"> </span><span class="nc">ExUnit.Case</span><span class="w">
  </span><span class="kn">use</span><span class="w"> </span><span class="nc">StreamData</span><span class="w">
  </span><span class="kn">import</span><span class="w"> </span><span class="nc">Funx.Monad</span><span class="w">

  </span><span class="n">property</span><span class="w"> </span><span class="s">&quot;map preserves Right structure&quot;</span><span class="w"> </span><span class="k" data-group-id="1329402523-2">do</span><span class="w">
    </span><span class="n">check</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">term</span><span class="p" data-group-id="1329402523-3">(</span><span class="p" data-group-id="1329402523-3">)</span><span class="p">,</span><span class="w">
              </span><span class="n">f</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nc">StreamData</span><span class="o">.</span><span class="n">constant</span><span class="p" data-group-id="1329402523-4">(</span><span class="k" data-group-id="1329402523-5">fn</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k" data-group-id="1329402523-5">end</span><span class="p" data-group-id="1329402523-4">)</span><span class="w"> </span><span class="k" data-group-id="1329402523-6">do</span><span class="w">
      </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">right</span><span class="p" data-group-id="1329402523-7">(</span><span class="n">value</span><span class="p" data-group-id="1329402523-7">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">map</span><span class="p" data-group-id="1329402523-8">(</span><span class="n">f</span><span class="p" data-group-id="1329402523-8">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="1329402523-9">(</span><span class="p" data-group-id="1329402523-9">)</span><span class="w">
      </span><span class="n">assert</span><span class="w"> </span><span class="n">match?</span><span class="p" data-group-id="1329402523-10">(</span><span class="p" data-group-id="1329402523-11">%</span><span class="nc" data-group-id="1329402523-11">Either.Right</span><span class="p" data-group-id="1329402523-11">{</span><span class="p" data-group-id="1329402523-11">}</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p" data-group-id="1329402523-10">)</span><span class="w">
    </span><span class="k" data-group-id="1329402523-6">end</span><span class="w">
  </span><span class="k" data-group-id="1329402523-2">end</span><span class="w">

  </span><span class="n">property</span><span class="w"> </span><span class="s">&quot;bind chains preserve trace context&quot;</span><span class="w"> </span><span class="k" data-group-id="1329402523-12">do</span><span class="w">
    </span><span class="n">check</span><span class="w"> </span><span class="n">all</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">integer</span><span class="p" data-group-id="1329402523-13">(</span><span class="p" data-group-id="1329402523-13">)</span><span class="w"> </span><span class="k" data-group-id="1329402523-14">do</span><span class="w">
      </span><span class="n">effect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">right</span><span class="p" data-group-id="1329402523-15">(</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="ss">span_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;test&quot;</span><span class="p" data-group-id="1329402523-15">)</span><span class="w">
      </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">bind</span><span class="p" data-group-id="1329402523-16">(</span><span class="k" data-group-id="1329402523-17">fn</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">right</span><span class="p" data-group-id="1329402523-18">(</span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="ss">span_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;double&quot;</span><span class="p" data-group-id="1329402523-18">)</span><span class="w"> </span><span class="k" data-group-id="1329402523-17">end</span><span class="p" data-group-id="1329402523-16">)</span><span class="w">
      
      </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="1329402523-19">(</span><span class="n">effect</span><span class="p" data-group-id="1329402523-19">)</span><span class="w">
      </span><span class="n">assert</span><span class="w"> </span><span class="n">match?</span><span class="p" data-group-id="1329402523-20">(</span><span class="p" data-group-id="1329402523-21">%</span><span class="nc" data-group-id="1329402523-21">Either.Right</span><span class="p" data-group-id="1329402523-21">{</span><span class="ss">right</span><span class="p">:</span><span class="w"> </span><span class="n">doubled</span><span class="p" data-group-id="1329402523-21">}</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p" data-group-id="1329402523-20">)</span><span class="w"> </span><span class="ow">when</span><span class="w"> </span><span class="n">doubled</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w">
    </span><span class="k" data-group-id="1329402523-14">end</span><span class="w">
  </span><span class="k" data-group-id="1329402523-12">end</span><span class="w">
</span><span class="k" data-group-id="1329402523-1">end</span></code></pre><h3 id="unit-testing-with-telemetry" class="section-heading">
  <a href="#unit-testing-with-telemetry" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Unit Testing with Telemetry</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="kd">defmodule</span><span class="w"> </span><span class="nc">EffectTest</span><span class="w"> </span><span class="k" data-group-id="8061577658-1">do</span><span class="w">
  </span><span class="kn">use</span><span class="w"> </span><span class="nc">ExUnit.Case</span><span class="w">
  </span><span class="kn">import</span><span class="w"> </span><span class="nc">Funx.Monad</span><span class="w">

  </span><span class="n">setup</span><span class="w"> </span><span class="k" data-group-id="8061577658-2">do</span><span class="w">
    </span><span class="nc">:telemetry</span><span class="o">.</span><span class="n">attach_many</span><span class="p" data-group-id="8061577658-3">(</span><span class="w">
      </span><span class="s">&quot;test-handler&quot;</span><span class="p">,</span><span class="w">
      </span><span class="p" data-group-id="8061577658-4">[</span><span class="p" data-group-id="8061577658-5">[</span><span class="ss">:funx</span><span class="p">,</span><span class="w"> </span><span class="ss">:effect</span><span class="p">,</span><span class="w"> </span><span class="ss">:run</span><span class="p">,</span><span class="w"> </span><span class="ss">:start</span><span class="p" data-group-id="8061577658-5">]</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8061577658-6">[</span><span class="ss">:funx</span><span class="p">,</span><span class="w"> </span><span class="ss">:effect</span><span class="p">,</span><span class="w"> </span><span class="ss">:run</span><span class="p">,</span><span class="w"> </span><span class="ss">:stop</span><span class="p" data-group-id="8061577658-6">]</span><span class="p" data-group-id="8061577658-4">]</span><span class="p">,</span><span class="w">
      </span><span class="k" data-group-id="8061577658-7">fn</span><span class="w"> </span><span class="n">event</span><span class="p">,</span><span class="w"> </span><span class="n">measurements</span><span class="p">,</span><span class="w"> </span><span class="n">metadata</span><span class="p">,</span><span class="w"> </span><span class="bp">_</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
        </span><span class="n">send</span><span class="p" data-group-id="8061577658-8">(</span><span class="n">self</span><span class="p" data-group-id="8061577658-9">(</span><span class="p" data-group-id="8061577658-9">)</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8061577658-10">{</span><span class="ss">:telemetry</span><span class="p">,</span><span class="w"> </span><span class="n">event</span><span class="p">,</span><span class="w"> </span><span class="n">measurements</span><span class="p">,</span><span class="w"> </span><span class="n">metadata</span><span class="p" data-group-id="8061577658-10">}</span><span class="p" data-group-id="8061577658-8">)</span><span class="w">
      </span><span class="k" data-group-id="8061577658-7">end</span><span class="p">,</span><span class="w">
      </span><span class="no">nil</span><span class="w">
    </span><span class="p" data-group-id="8061577658-3">)</span><span class="w">
    
    </span><span class="n">on_exit</span><span class="p" data-group-id="8061577658-11">(</span><span class="k" data-group-id="8061577658-12">fn</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">:telemetry</span><span class="o">.</span><span class="n">detach</span><span class="p" data-group-id="8061577658-13">(</span><span class="s">&quot;test-handler&quot;</span><span class="p" data-group-id="8061577658-13">)</span><span class="w"> </span><span class="k" data-group-id="8061577658-12">end</span><span class="p" data-group-id="8061577658-11">)</span><span class="w">
  </span><span class="k" data-group-id="8061577658-2">end</span><span class="w">

  </span><span class="n">test</span><span class="w"> </span><span class="s">&quot;async pipeline emits correct telemetry&quot;</span><span class="w"> </span><span class="k" data-group-id="8061577658-14">do</span><span class="w">
    </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">right</span><span class="p" data-group-id="8061577658-15">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="ss">span_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;start&quot;</span><span class="p" data-group-id="8061577658-15">)</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">bind</span><span class="p" data-group-id="8061577658-16">(</span><span class="k" data-group-id="8061577658-17">fn</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">right</span><span class="p" data-group-id="8061577658-18">(</span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="ss">span_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;double&quot;</span><span class="p" data-group-id="8061577658-18">)</span><span class="w"> </span><span class="k" data-group-id="8061577658-17">end</span><span class="p" data-group-id="8061577658-16">)</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="8061577658-19">(</span><span class="p" data-group-id="8061577658-19">)</span><span class="w">

    </span><span class="n">assert</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nc">Either</span><span class="o">.</span><span class="n">right</span><span class="p" data-group-id="8061577658-20">(</span><span class="mi">20</span><span class="p" data-group-id="8061577658-20">)</span><span class="w">
    
    </span><span class="n">assert_received</span><span class="w"> </span><span class="p" data-group-id="8061577658-21">{</span><span class="ss">:telemetry</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8061577658-22">[</span><span class="ss">:funx</span><span class="p">,</span><span class="w"> </span><span class="ss">:effect</span><span class="p">,</span><span class="w"> </span><span class="ss">:run</span><span class="p">,</span><span class="w"> </span><span class="ss">:stop</span><span class="p" data-group-id="8061577658-22">]</span><span class="p">,</span><span class="w"> </span><span class="bp">_</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8061577658-23">%{</span><span class="ss">span_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;start&quot;</span><span class="p" data-group-id="8061577658-23">}</span><span class="p" data-group-id="8061577658-21">}</span><span class="w">
    </span><span class="n">assert_received</span><span class="w"> </span><span class="p" data-group-id="8061577658-24">{</span><span class="ss">:telemetry</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8061577658-25">[</span><span class="ss">:funx</span><span class="p">,</span><span class="w"> </span><span class="ss">:effect</span><span class="p">,</span><span class="w"> </span><span class="ss">:run</span><span class="p">,</span><span class="w"> </span><span class="ss">:stop</span><span class="p" data-group-id="8061577658-25">]</span><span class="p">,</span><span class="w"> </span><span class="bp">_</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8061577658-26">%{</span><span class="ss">span_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;double&quot;</span><span class="p" data-group-id="8061577658-26">}</span><span class="p" data-group-id="8061577658-24">}</span><span class="w">  
    </span><span class="n">assert_received</span><span class="w"> </span><span class="p" data-group-id="8061577658-27">{</span><span class="ss">:telemetry</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8061577658-28">[</span><span class="ss">:funx</span><span class="p">,</span><span class="w"> </span><span class="ss">:effect</span><span class="p">,</span><span class="w"> </span><span class="ss">:run</span><span class="p">,</span><span class="w"> </span><span class="ss">:stop</span><span class="p" data-group-id="8061577658-28">]</span><span class="p">,</span><span class="w"> </span><span class="bp">_</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8061577658-29">%{</span><span class="ss">span_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bind -&gt; start&quot;</span><span class="p" data-group-id="8061577658-29">}</span><span class="p" data-group-id="8061577658-27">}</span><span class="w">
  </span><span class="k" data-group-id="8061577658-14">end</span><span class="w">

  </span><span class="n">test</span><span class="w"> </span><span class="s">&quot;error accumulation in traverse_a&quot;</span><span class="w"> </span><span class="k" data-group-id="8061577658-30">do</span><span class="w">
    </span><span class="n">validator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="8061577658-31">fn</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
      </span><span class="k">if</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="ss">do</span><span class="p">:</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">right</span><span class="p" data-group-id="8061577658-32">(</span><span class="n">x</span><span class="p" data-group-id="8061577658-32">)</span><span class="p">,</span><span class="w"> </span><span class="ss">else</span><span class="p">:</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">left</span><span class="p" data-group-id="8061577658-33">(</span><span class="s">&quot;negative: </span><span class="si" data-group-id="8061577658-34">#{</span><span class="n">x</span><span class="si" data-group-id="8061577658-34">}</span><span class="s">&quot;</span><span class="p" data-group-id="8061577658-33">)</span><span class="w">
    </span><span class="k" data-group-id="8061577658-31">end</span><span class="w">
    
    </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">traverse_a</span><span class="p" data-group-id="8061577658-35">(</span><span class="p" data-group-id="8061577658-36">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">4</span><span class="p" data-group-id="8061577658-36">]</span><span class="p">,</span><span class="w"> </span><span class="n">validator</span><span class="p" data-group-id="8061577658-35">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="8061577658-37">(</span><span class="p" data-group-id="8061577658-37">)</span><span class="w">
    
    </span><span class="n">assert</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nc">Either</span><span class="o">.</span><span class="n">left</span><span class="p" data-group-id="8061577658-38">(</span><span class="p" data-group-id="8061577658-39">[</span><span class="s">&quot;negative: -2&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;negative: -4&quot;</span><span class="p" data-group-id="8061577658-39">]</span><span class="p" data-group-id="8061577658-38">)</span><span class="w">
  </span><span class="k" data-group-id="8061577658-30">end</span><span class="w">
</span><span class="k" data-group-id="8061577658-1">end</span></code></pre><h2 id="performance-considerations" class="section-heading">
  <a href="#performance-considerations" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Performance Considerations</span>
</h2>
<h3 id="sequential-vs-parallel-execution-patterns" class="section-heading">
  <a href="#sequential-vs-parallel-execution-patterns" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Sequential vs Parallel Execution Patterns</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="c1"># ❌ Sequential: 1.5 seconds total (3 × 500ms each)</span><span class="w">
</span><span class="kd">def</span><span class="w"> </span><span class="nf">check_maintenance_sequential</span><span class="p" data-group-id="7553067877-1">(</span><span class="n">ride</span><span class="p" data-group-id="7553067877-1">)</span><span class="w"> </span><span class="k" data-group-id="7553067877-2">do</span><span class="w">
  </span><span class="nc">Effect</span><span class="o">.</span><span class="n">right</span><span class="p" data-group-id="7553067877-3">(</span><span class="n">ride</span><span class="p" data-group-id="7553067877-3">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">bind</span><span class="p" data-group-id="7553067877-4">(</span><span class="o">&amp;</span><span class="n">check_scheduled_maintenance</span><span class="o">/</span><span class="mi">1</span><span class="p" data-group-id="7553067877-4">)</span><span class="w">  </span><span class="c1"># 500ms</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">bind</span><span class="p" data-group-id="7553067877-5">(</span><span class="o">&amp;</span><span class="n">check_unscheduled_maintenance</span><span class="o">/</span><span class="mi">1</span><span class="p" data-group-id="7553067877-5">)</span><span class="w"> </span><span class="c1"># 500ms  </span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">bind</span><span class="p" data-group-id="7553067877-6">(</span><span class="o">&amp;</span><span class="n">check_compliance_hold</span><span class="o">/</span><span class="mi">1</span><span class="p" data-group-id="7553067877-6">)</span><span class="w">        </span><span class="c1"># 500ms</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="7553067877-7">(</span><span class="p" data-group-id="7553067877-7">)</span><span class="w">
</span><span class="k" data-group-id="7553067877-2">end</span><span class="w">

</span><span class="c1"># ✅ Parallel: 500ms total (all run concurrently)  </span><span class="w">
</span><span class="kd">def</span><span class="w"> </span><span class="nf">check_maintenance_parallel</span><span class="p" data-group-id="7553067877-8">(</span><span class="n">ride</span><span class="p" data-group-id="7553067877-8">)</span><span class="w"> </span><span class="k" data-group-id="7553067877-9">do</span><span class="w">
  </span><span class="n">checks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="7553067877-10">[</span><span class="w">
    </span><span class="n">check_scheduled_maintenance</span><span class="p" data-group-id="7553067877-11">(</span><span class="n">ride</span><span class="p" data-group-id="7553067877-11">)</span><span class="p">,</span><span class="w">     </span><span class="c1"># 500ms concurrent</span><span class="w">
    </span><span class="n">check_unscheduled_maintenance</span><span class="p" data-group-id="7553067877-12">(</span><span class="n">ride</span><span class="p" data-group-id="7553067877-12">)</span><span class="p">,</span><span class="w">   </span><span class="c1"># 500ms concurrent</span><span class="w">
    </span><span class="n">check_compliance_hold</span><span class="p" data-group-id="7553067877-13">(</span><span class="n">ride</span><span class="p" data-group-id="7553067877-13">)</span><span class="w">            </span><span class="c1"># 500ms concurrent</span><span class="w">
  </span><span class="p" data-group-id="7553067877-10">]</span><span class="w">
  
  </span><span class="nc">Effect</span><span class="o">.</span><span class="n">sequence_a</span><span class="p" data-group-id="7553067877-14">(</span><span class="n">checks</span><span class="p" data-group-id="7553067877-14">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="7553067877-15">(</span><span class="p" data-group-id="7553067877-15">)</span><span class="w">  </span><span class="c1"># All run in parallel</span><span class="w">
</span><span class="k" data-group-id="7553067877-9">end</span><span class="w">

</span><span class="c1"># Rule: Use bind for dependent operations, traverse_a for independent operations</span></code></pre><h3 id="smart-performance-optimization" class="section-heading">
  <a href="#smart-performance-optimization" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Smart Performance Optimization</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="c1"># ✅ Fast eligibility checks before expensive I/O</span><span class="w">
</span><span class="kd">def</span><span class="w"> </span><span class="nf">validate_access_optimized</span><span class="p" data-group-id="7332696108-1">(</span><span class="n">patron</span><span class="p">,</span><span class="w"> </span><span class="n">ride</span><span class="p" data-group-id="7332696108-1">)</span><span class="w"> </span><span class="k" data-group-id="7332696108-2">do</span><span class="w">
  </span><span class="nc">Effect</span><span class="o">.</span><span class="n">right</span><span class="p" data-group-id="7332696108-3">(</span><span class="n">patron</span><span class="p" data-group-id="7332696108-3">)</span><span class="w">
  </span><span class="c1"># Fast local validations first (1-2ms total)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">bind</span><span class="p" data-group-id="7332696108-4">(</span><span class="o">&amp;</span><span class="n">validate_age</span><span class="o">/</span><span class="mi">1</span><span class="p" data-group-id="7332696108-4">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">bind</span><span class="p" data-group-id="7332696108-5">(</span><span class="o">&amp;</span><span class="n">validate_height</span><span class="o">/</span><span class="mi">1</span><span class="p" data-group-id="7332696108-5">)</span><span class="w"> 
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">bind</span><span class="p" data-group-id="7332696108-6">(</span><span class="o">&amp;</span><span class="n">validate_ticket</span><span class="o">/</span><span class="mi">1</span><span class="p" data-group-id="7332696108-6">)</span><span class="w">
  </span><span class="c1"># Only do expensive I/O for eligible patrons (500ms)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">bind</span><span class="p" data-group-id="7332696108-7">(</span><span class="k" data-group-id="7332696108-8">fn</span><span class="w"> </span><span class="bp">_</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">check_ride_online_status</span><span class="p" data-group-id="7332696108-9">(</span><span class="n">ride</span><span class="p" data-group-id="7332696108-9">)</span><span class="w"> </span><span class="k" data-group-id="7332696108-8">end</span><span class="p" data-group-id="7332696108-7">)</span><span class="w">
</span><span class="k" data-group-id="7332696108-2">end</span><span class="w">

</span><span class="c1"># Best case: Ineligible patron rejected in 2ms</span><span class="w">
</span><span class="c1"># Worst case: Eligible patron checked in 502ms</span></code></pre><h3 id="context-propagation-overhead" class="section-heading">
  <a href="#context-propagation-overhead" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Context Propagation Overhead</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="c1"># Context merging and span creation has minimal overhead</span><span class="w">
</span><span class="c1"># But consider span naming strategy for high-volume operations</span><span class="w">

</span><span class="c1"># Good: Generic span names for repeated operations</span><span class="w">
</span><span class="nc">Effect</span><span class="o">.</span><span class="n">lift_func</span><span class="p" data-group-id="0532072358-1">(</span><span class="k" data-group-id="0532072358-2">fn</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">process_item</span><span class="p" data-group-id="0532072358-3">(</span><span class="n">item</span><span class="p" data-group-id="0532072358-3">)</span><span class="w"> </span><span class="k" data-group-id="0532072358-2">end</span><span class="p">,</span><span class="w"> </span><span class="ss">span_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;process_item&quot;</span><span class="p" data-group-id="0532072358-1">)</span><span class="w">

</span><span class="c1"># Avoid: Unique span names that create too many distinct spans  </span><span class="w">
</span><span class="c1"># Effect.lift_func(fn -&gt; process_item(item) end, span_name: &quot;process_item_#{item.id}&quot;)</span></code></pre><h3 id="memory-usage" class="section-heading">
  <a href="#memory-usage" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Memory Usage</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="c1"># Effects are lightweight until executed</span><span class="w">
</span><span class="c1"># Deferred nature means no computation until run/2</span><span class="w">

</span><span class="c1"># Efficient for conditional execution</span><span class="w">
</span><span class="n">user_effect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">admin_user?</span><span class="w"> </span><span class="k" data-group-id="2855867620-1">do</span><span class="w">
  </span><span class="nc">Effect</span><span class="o">.</span><span class="n">lift_func</span><span class="p" data-group-id="2855867620-2">(</span><span class="k" data-group-id="2855867620-3">fn</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">expensive_admin_operation</span><span class="p" data-group-id="2855867620-4">(</span><span class="p" data-group-id="2855867620-4">)</span><span class="w"> </span><span class="k" data-group-id="2855867620-3">end</span><span class="p" data-group-id="2855867620-2">)</span><span class="w">
</span><span class="k" data-group-id="2855867620-1">else</span><span class="w">
  </span><span class="nc">Effect</span><span class="o">.</span><span class="n">right</span><span class="p" data-group-id="2855867620-5">(</span><span class="ss">:skip</span><span class="p" data-group-id="2855867620-5">)</span><span class="w">
</span><span class="k" data-group-id="2855867620-1">end</span><span class="w">

</span><span class="c1"># Only runs expensive operation if needed</span><span class="w">
</span><span class="nc">Effect</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="2855867620-6">(</span><span class="n">user_effect</span><span class="p" data-group-id="2855867620-6">)</span></code></pre><h2 id="troubleshooting-common-issues" class="section-heading">
  <a href="#troubleshooting-common-issues" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Troubleshooting Common Issues</span>
</h2>
<h3 id="issue-forgetting-to-call-run-2" class="section-heading">
  <a href="#issue-forgetting-to-call-run-2" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Issue: Forgetting to Call <code class="inline">run/2</code></span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="c1"># ❌ Problem: Effect never executes</span><span class="w">
</span><span class="n">effect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">right</span><span class="p" data-group-id="0166395958-1">(</span><span class="mi">42</span><span class="p" data-group-id="0166395958-1">)</span><span class="w">
</span><span class="c1"># Missing Effect.run(effect) - nothing happens!</span><span class="w">

</span><span class="c1"># ✅ Solution: Always call run to execute</span><span class="w">
</span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">right</span><span class="p" data-group-id="0166395958-2">(</span><span class="mi">42</span><span class="p" data-group-id="0166395958-2">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="0166395958-3">(</span><span class="p" data-group-id="0166395958-3">)</span></code></pre><h3 id="issue-nested-effect-values" class="section-heading">
  <a href="#issue-nested-effect-values" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Issue: Nested Effect Values</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="c1"># ❌ Problem: Manual nesting creates Effect Effect a</span><span class="w">
</span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">right</span><span class="p" data-group-id="6398473187-1">(</span><span class="n">user_id</span><span class="p" data-group-id="6398473187-1">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="n">map</span><span class="p" data-group-id="6398473187-2">(</span><span class="o">&amp;</span><span class="n">fetch_user_effect</span><span class="o">/</span><span class="mi">1</span><span class="p" data-group-id="6398473187-2">)</span><span class="w">  </span><span class="c1"># fetch_user_effect returns Effect User  </span><span class="w">
</span><span class="c1"># Result: Effect (Effect User) - nested!</span><span class="w">

</span><span class="c1"># ✅ Solution: Use bind for functions that return Effect</span><span class="w">
</span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">right</span><span class="p" data-group-id="6398473187-3">(</span><span class="n">user_id</span><span class="p" data-group-id="6398473187-3">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="n">bind</span><span class="p" data-group-id="6398473187-4">(</span><span class="o">&amp;</span><span class="n">fetch_user_effect</span><span class="o">/</span><span class="mi">1</span><span class="p" data-group-id="6398473187-4">)</span><span class="w">  </span><span class="c1"># Automatically flattens to Effect User</span></code></pre><h3 id="issue-blocking-on-async-operations" class="section-heading">
  <a href="#issue-blocking-on-async-operations" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Issue: Blocking on Async Operations</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="c1"># ❌ Problem: Sequential execution loses concurrency benefits</span><span class="w">
</span><span class="kd">def</span><span class="w"> </span><span class="nf">fetch_data_slow</span><span class="p" data-group-id="9895802629-1">(</span><span class="n">ids</span><span class="p" data-group-id="9895802629-1">)</span><span class="w"> </span><span class="k" data-group-id="9895802629-2">do</span><span class="w">
  </span><span class="nc">Enum</span><span class="o">.</span><span class="n">reduce</span><span class="p" data-group-id="9895802629-3">(</span><span class="n">ids</span><span class="p">,</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">right</span><span class="p" data-group-id="9895802629-4">(</span><span class="p" data-group-id="9895802629-5">[</span><span class="p" data-group-id="9895802629-5">]</span><span class="p" data-group-id="9895802629-4">)</span><span class="p">,</span><span class="w"> </span><span class="k" data-group-id="9895802629-6">fn</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">acc</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
    </span><span class="n">acc</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">bind</span><span class="p" data-group-id="9895802629-7">(</span><span class="k" data-group-id="9895802629-8">fn</span><span class="w"> </span><span class="n">results</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
      </span><span class="n">fetch_item</span><span class="p" data-group-id="9895802629-9">(</span><span class="n">id</span><span class="p" data-group-id="9895802629-9">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">map</span><span class="p" data-group-id="9895802629-10">(</span><span class="k" data-group-id="9895802629-11">fn</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p" data-group-id="9895802629-12">[</span><span class="n">item</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">results</span><span class="p" data-group-id="9895802629-12">]</span><span class="w"> </span><span class="k" data-group-id="9895802629-11">end</span><span class="p" data-group-id="9895802629-10">)</span><span class="w">
    </span><span class="k" data-group-id="9895802629-8">end</span><span class="p" data-group-id="9895802629-7">)</span><span class="w">
  </span><span class="k" data-group-id="9895802629-6">end</span><span class="p" data-group-id="9895802629-3">)</span><span class="w">
</span><span class="k" data-group-id="9895802629-2">end</span><span class="w">

</span><span class="c1"># ✅ Solution: Use traverse_a for concurrent processing</span><span class="w">
</span><span class="kd">def</span><span class="w"> </span><span class="nf">fetch_data_fast</span><span class="p" data-group-id="9895802629-13">(</span><span class="n">ids</span><span class="p" data-group-id="9895802629-13">)</span><span class="w"> </span><span class="k" data-group-id="9895802629-14">do</span><span class="w">
  </span><span class="nc">Effect</span><span class="o">.</span><span class="n">traverse_a</span><span class="p" data-group-id="9895802629-15">(</span><span class="n">ids</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">fetch_item</span><span class="o">/</span><span class="mi">1</span><span class="p" data-group-id="9895802629-15">)</span><span class="w">
</span><span class="k" data-group-id="9895802629-14">end</span></code></pre><h3 id="issue-losing-error-context" class="section-heading">
  <a href="#issue-losing-error-context" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Issue: Losing Error Context</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="c1"># ❌ Problem: Generic error handling loses specifics</span><span class="w">
</span><span class="nc">Effect</span><span class="o">.</span><span class="n">lift_func</span><span class="p" data-group-id="4353421213-1">(</span><span class="k" data-group-id="4353421213-2">fn</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">Database</span><span class="o">.</span><span class="n">query</span><span class="p" data-group-id="4353421213-3">(</span><span class="s">&quot;SELECT * FROM users&quot;</span><span class="p" data-group-id="4353421213-3">)</span><span class="w"> </span><span class="k" data-group-id="4353421213-2">end</span><span class="p" data-group-id="4353421213-1">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="n">map_left</span><span class="p" data-group-id="4353421213-4">(</span><span class="k" data-group-id="4353421213-5">fn</span><span class="w"> </span><span class="bp">_</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s">&quot;database error&quot;</span><span class="w"> </span><span class="k" data-group-id="4353421213-5">end</span><span class="p" data-group-id="4353421213-4">)</span><span class="w">  </span><span class="c1"># Lost original error details</span><span class="w">

</span><span class="c1"># ✅ Solution: Preserve error context  </span><span class="w">
</span><span class="nc">Effect</span><span class="o">.</span><span class="n">lift_func</span><span class="p" data-group-id="4353421213-6">(</span><span class="k" data-group-id="4353421213-7">fn</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">Database</span><span class="o">.</span><span class="n">query</span><span class="p" data-group-id="4353421213-8">(</span><span class="s">&quot;SELECT * FROM users&quot;</span><span class="p" data-group-id="4353421213-8">)</span><span class="w"> </span><span class="k" data-group-id="4353421213-7">end</span><span class="p" data-group-id="4353421213-6">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="n">map_left</span><span class="p" data-group-id="4353421213-9">(</span><span class="k" data-group-id="4353421213-10">fn</span><span class="w"> 
  </span><span class="p" data-group-id="4353421213-11">%</span><span class="nc" data-group-id="4353421213-11">EffectError</span><span class="p" data-group-id="4353421213-11">{</span><span class="ss">reason</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="4353421213-12">%</span><span class="nc" data-group-id="4353421213-12">DBConnection.Error</span><span class="p" data-group-id="4353421213-12">{</span><span class="p" data-group-id="4353421213-12">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">db_err</span><span class="p" data-group-id="4353421213-11">}</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> 
    </span><span class="p" data-group-id="4353421213-13">%{</span><span class="ss">error</span><span class="p">:</span><span class="w"> </span><span class="ss">:database</span><span class="p">,</span><span class="w"> </span><span class="ss">details</span><span class="p">:</span><span class="w"> </span><span class="n">db_err</span><span class="p">,</span><span class="w"> </span><span class="ss">operation</span><span class="p">:</span><span class="w"> </span><span class="ss">:fetch_users</span><span class="p" data-group-id="4353421213-13">}</span><span class="w">
  </span><span class="n">error</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> 
    </span><span class="p" data-group-id="4353421213-14">%{</span><span class="ss">error</span><span class="p">:</span><span class="w"> </span><span class="ss">:unknown</span><span class="p">,</span><span class="w"> </span><span class="ss">details</span><span class="p">:</span><span class="w"> </span><span class="n">error</span><span class="p">,</span><span class="w"> </span><span class="ss">operation</span><span class="p">:</span><span class="w"> </span><span class="ss">:fetch_users</span><span class="p" data-group-id="4353421213-14">}</span><span class="w">
</span><span class="k" data-group-id="4353421213-10">end</span><span class="p" data-group-id="4353421213-9">)</span></code></pre><h3 id="issue-trace-context-confusion" class="section-heading">
  <a href="#issue-trace-context-confusion" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Issue: Trace Context Confusion</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="c1"># ❌ Problem: Inconsistent span naming makes tracing hard to follow</span><span class="w">
</span><span class="nc">Effect</span><span class="o">.</span><span class="n">right</span><span class="p" data-group-id="6898778446-1">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="ss">span_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;a&quot;</span><span class="p" data-group-id="6898778446-1">)</span><span class="w"> 
</span><span class="o">|&gt;</span><span class="w"> </span><span class="n">bind</span><span class="p" data-group-id="6898778446-2">(</span><span class="k" data-group-id="6898778446-3">fn</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">right</span><span class="p" data-group-id="6898778446-4">(</span><span class="n">process</span><span class="p" data-group-id="6898778446-5">(</span><span class="n">x</span><span class="p" data-group-id="6898778446-5">)</span><span class="p">,</span><span class="w"> </span><span class="ss">span_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;x&quot;</span><span class="p" data-group-id="6898778446-4">)</span><span class="w"> </span><span class="k" data-group-id="6898778446-3">end</span><span class="p" data-group-id="6898778446-2">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="n">map</span><span class="p" data-group-id="6898778446-6">(</span><span class="k" data-group-id="6898778446-7">fn</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">transform</span><span class="p" data-group-id="6898778446-8">(</span><span class="n">y</span><span class="p" data-group-id="6898778446-8">)</span><span class="p">)</span><span class="w">  </span><span class="c1"># No span name context lost</span><span class="w">

</span><span class="c1"># ✅ Solution: Consistent span naming strategy</span><span class="w">
</span><span class="nc">Effect</span><span class="o">.</span><span class="n">right</span><span class="p" data-group-id="6898778446-9">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="ss">span_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;load_user_data&quot;</span><span class="p" data-group-id="6898778446-9">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="n">bind</span><span class="p" data-group-id="6898778446-10">(</span><span class="k" data-group-id="6898778446-11">fn</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">right</span><span class="p" data-group-id="6898778446-12">(</span><span class="n">process</span><span class="p" data-group-id="6898778446-13">(</span><span class="n">x</span><span class="p" data-group-id="6898778446-13">)</span><span class="p">,</span><span class="w"> </span><span class="ss">span_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;validate_user_data&quot;</span><span class="p" data-group-id="6898778446-12">)</span><span class="w"> </span><span class="k" data-group-id="6898778446-11">end</span><span class="p" data-group-id="6898778446-10">)</span><span class="w">  
</span><span class="o">|&gt;</span><span class="w"> </span><span class="n">map</span><span class="p" data-group-id="6898778446-14">(</span><span class="k" data-group-id="6898778446-15">fn</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">transform</span><span class="p" data-group-id="6898778446-16">(</span><span class="n">y</span><span class="p" data-group-id="6898778446-16">)</span><span class="p">)</span><span class="w">  </span><span class="c1"># Inherits &quot;map -&gt; validate_user_data&quot;</span></code></pre><h2 id="when-not-to-use-effect" class="section-heading">
  <a href="#when-not-to-use-effect" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">When Not to Use Effect</span>
</h2>
<h3 id="use-either-instead-when" class="section-heading">
  <a href="#use-either-instead-when" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Use Either Instead When</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="c1"># ❌ Effect overhead for simple sync validation</span><span class="w">
</span><span class="kd">def</span><span class="w"> </span><span class="nf">validate_email_sync</span><span class="p" data-group-id="3463888031-1">(</span><span class="n">email</span><span class="p" data-group-id="3463888031-1">)</span><span class="w"> </span><span class="k" data-group-id="3463888031-2">do</span><span class="w">
  </span><span class="nc">Effect</span><span class="o">.</span><span class="n">lift_predicate</span><span class="p" data-group-id="3463888031-3">(</span><span class="n">email</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">valid_email_format?</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="k" data-group-id="3463888031-4">fn</span><span class="w"> </span><span class="bp">_</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s">&quot;invalid email&quot;</span><span class="w"> </span><span class="k" data-group-id="3463888031-4">end</span><span class="p" data-group-id="3463888031-3">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="3463888031-5">(</span><span class="p" data-group-id="3463888031-5">)</span><span class="w">
</span><span class="k" data-group-id="3463888031-2">end</span><span class="w">

</span><span class="c1"># ✅ Either for immediate sync operations  </span><span class="w">
</span><span class="kd">def</span><span class="w"> </span><span class="nf">validate_email_sync</span><span class="p" data-group-id="3463888031-6">(</span><span class="n">email</span><span class="p" data-group-id="3463888031-6">)</span><span class="w"> </span><span class="k" data-group-id="3463888031-7">do</span><span class="w">
  </span><span class="k">if</span><span class="w"> </span><span class="n">valid_email_format?</span><span class="p" data-group-id="3463888031-8">(</span><span class="n">email</span><span class="p" data-group-id="3463888031-8">)</span><span class="w"> </span><span class="k" data-group-id="3463888031-9">do</span><span class="w">
    </span><span class="nc">Either</span><span class="o">.</span><span class="n">right</span><span class="p" data-group-id="3463888031-10">(</span><span class="n">email</span><span class="p" data-group-id="3463888031-10">)</span><span class="w">
  </span><span class="k" data-group-id="3463888031-9">else</span><span class="w">
    </span><span class="nc">Either</span><span class="o">.</span><span class="n">left</span><span class="p" data-group-id="3463888031-11">(</span><span class="s">&quot;invalid email&quot;</span><span class="p" data-group-id="3463888031-11">)</span><span class="w">
  </span><span class="k" data-group-id="3463888031-9">end</span><span class="w">
</span><span class="k" data-group-id="3463888031-7">end</span></code></pre><h3 id="use-otp-genserver-instead-for-long-running-tasks" class="section-heading">
  <a href="#use-otp-genserver-instead-for-long-running-tasks" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Use OTP/GenServer Instead for Long-Running Tasks</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="c1"># ❌ Effect for persistent background workers</span><span class="w">
</span><span class="kd">def</span><span class="w"> </span><span class="nf">start_queue_processor</span><span class="w"> </span><span class="k" data-group-id="2699964008-1">do</span><span class="w">
  </span><span class="nc">Effect</span><span class="o">.</span><span class="n">lift_func</span><span class="p" data-group-id="2699964008-2">(</span><span class="k" data-group-id="2699964008-3">fn</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
    </span><span class="n">spawn</span><span class="p" data-group-id="2699964008-4">(</span><span class="k" data-group-id="2699964008-5">fn</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> 
      </span><span class="c1"># This runs forever - Effect is wrong abstraction</span><span class="w">
      </span><span class="n">continuously_process_queue</span><span class="p" data-group-id="2699964008-6">(</span><span class="p" data-group-id="2699964008-6">)</span><span class="w">
    </span><span class="k" data-group-id="2699964008-5">end</span><span class="p" data-group-id="2699964008-4">)</span><span class="w">
  </span><span class="k" data-group-id="2699964008-3">end</span><span class="p" data-group-id="2699964008-2">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="2699964008-7">(</span><span class="p" data-group-id="2699964008-7">)</span><span class="w">
</span><span class="k" data-group-id="2699964008-1">end</span><span class="w">

</span><span class="c1"># ✅ GenServer for stateful, long-running services</span><span class="w">
</span><span class="kd">defmodule</span><span class="w"> </span><span class="nc">QueueProcessor</span><span class="w"> </span><span class="k" data-group-id="2699964008-8">do</span><span class="w">
  </span><span class="kn">use</span><span class="w"> </span><span class="nc">GenServer</span><span class="w">

  </span><span class="kd">def</span><span class="w"> </span><span class="nf">start_link</span><span class="p" data-group-id="2699964008-9">(</span><span class="n">opts</span><span class="p" data-group-id="2699964008-9">)</span><span class="w"> </span><span class="k" data-group-id="2699964008-10">do</span><span class="w">
    </span><span class="nc">GenServer</span><span class="o">.</span><span class="n">start_link</span><span class="p" data-group-id="2699964008-11">(</span><span class="bp">__MODULE__</span><span class="p">,</span><span class="w"> </span><span class="n">opts</span><span class="p">,</span><span class="w"> </span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="bp">__MODULE__</span><span class="p" data-group-id="2699964008-11">)</span><span class="w">
  </span><span class="k" data-group-id="2699964008-10">end</span><span class="w">

  </span><span class="kd">def</span><span class="w"> </span><span class="nf">init</span><span class="p" data-group-id="2699964008-12">(</span><span class="c">_opts</span><span class="p" data-group-id="2699964008-12">)</span><span class="w"> </span><span class="k" data-group-id="2699964008-13">do</span><span class="w">
    </span><span class="n">schedule_work</span><span class="p" data-group-id="2699964008-14">(</span><span class="p" data-group-id="2699964008-14">)</span><span class="w">
    </span><span class="p" data-group-id="2699964008-15">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2699964008-16">%{</span><span class="ss">processed</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="2699964008-16">}</span><span class="p" data-group-id="2699964008-15">}</span><span class="w">
  </span><span class="k" data-group-id="2699964008-13">end</span><span class="w">

  </span><span class="kd">def</span><span class="w"> </span><span class="nf">handle_info</span><span class="p" data-group-id="2699964008-17">(</span><span class="ss">:work</span><span class="p">,</span><span class="w"> </span><span class="n">state</span><span class="p" data-group-id="2699964008-17">)</span><span class="w"> </span><span class="k" data-group-id="2699964008-18">do</span><span class="w">
    </span><span class="n">process_next_item</span><span class="p" data-group-id="2699964008-19">(</span><span class="p" data-group-id="2699964008-19">)</span><span class="w">
    </span><span class="n">schedule_work</span><span class="p" data-group-id="2699964008-20">(</span><span class="p" data-group-id="2699964008-20">)</span><span class="w">
    </span><span class="p" data-group-id="2699964008-21">{</span><span class="ss">:noreply</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2699964008-22">%{</span><span class="n">state</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="ss">processed</span><span class="p">:</span><span class="w"> </span><span class="n">state</span><span class="o">.</span><span class="n">processed</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="2699964008-22">}</span><span class="p" data-group-id="2699964008-21">}</span><span class="w">
  </span><span class="k" data-group-id="2699964008-18">end</span><span class="w">

  </span><span class="kd">defp</span><span class="w"> </span><span class="nf">schedule_work</span><span class="w"> </span><span class="k" data-group-id="2699964008-23">do</span><span class="w">
    </span><span class="nc">Process</span><span class="o">.</span><span class="n">send_after</span><span class="p" data-group-id="2699964008-24">(</span><span class="n">self</span><span class="p" data-group-id="2699964008-25">(</span><span class="p" data-group-id="2699964008-25">)</span><span class="p">,</span><span class="w"> </span><span class="ss">:work</span><span class="p">,</span><span class="w"> </span><span class="mi">1000</span><span class="p" data-group-id="2699964008-24">)</span><span class="w">
  </span><span class="k" data-group-id="2699964008-23">end</span><span class="w">
</span><span class="k" data-group-id="2699964008-8">end</span></code></pre><h3 id="use-job-queues-instead-for-high-volume-processing" class="section-heading">
  <a href="#use-job-queues-instead-for-high-volume-processing" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Use Job Queues Instead for High-Volume Processing</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="c1"># ❌ Effect for job queues - no back-pressure or persistence</span><span class="w">
</span><span class="kd">def</span><span class="w"> </span><span class="nf">process_user_sign_ups</span><span class="p" data-group-id="3264069817-1">(</span><span class="n">user_ids</span><span class="p" data-group-id="3264069817-1">)</span><span class="w"> </span><span class="k" data-group-id="3264069817-2">do</span><span class="w">
  </span><span class="nc">Effect</span><span class="o">.</span><span class="n">traverse_a</span><span class="p" data-group-id="3264069817-3">(</span><span class="n">user_ids</span><span class="p">,</span><span class="w"> </span><span class="k" data-group-id="3264069817-4">fn</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
    </span><span class="nc">Effect</span><span class="o">.</span><span class="n">lift_func</span><span class="p" data-group-id="3264069817-5">(</span><span class="k" data-group-id="3264069817-6">fn</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">send_welcome_email</span><span class="p" data-group-id="3264069817-7">(</span><span class="n">id</span><span class="p" data-group-id="3264069817-7">)</span><span class="w"> </span><span class="k" data-group-id="3264069817-6">end</span><span class="p" data-group-id="3264069817-5">)</span><span class="w">
  </span><span class="k" data-group-id="3264069817-4">end</span><span class="p" data-group-id="3264069817-3">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="3264069817-8">(</span><span class="p" data-group-id="3264069817-8">)</span><span class="w">
</span><span class="k" data-group-id="3264069817-2">end</span><span class="w">

</span><span class="c1"># ✅ Oban for reliable job processing with back-pressure</span><span class="w">
</span><span class="kd">defmodule</span><span class="w"> </span><span class="nc">WelcomeEmailWorker</span><span class="w"> </span><span class="k" data-group-id="3264069817-9">do</span><span class="w">
  </span><span class="kn">use</span><span class="w"> </span><span class="nc">Oban.Worker</span><span class="p">,</span><span class="w"> </span><span class="ss">queue</span><span class="p">:</span><span class="w"> </span><span class="ss">:emails</span><span class="p">,</span><span class="w"> </span><span class="ss">max_attempts</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="w">

  </span><span class="na">@impl</span><span class="w"> </span><span class="nc">Oban.Worker</span><span class="w">
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">perform</span><span class="p" data-group-id="3264069817-10">(</span><span class="p" data-group-id="3264069817-11">%</span><span class="nc" data-group-id="3264069817-11">Oban.Job</span><span class="p" data-group-id="3264069817-11">{</span><span class="ss">args</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="3264069817-12">%{</span><span class="s">&quot;user_id&quot;</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="n">user_id</span><span class="p" data-group-id="3264069817-12">}</span><span class="p" data-group-id="3264069817-11">}</span><span class="p" data-group-id="3264069817-10">)</span><span class="w"> </span><span class="k" data-group-id="3264069817-13">do</span><span class="w">
    </span><span class="n">send_welcome_email</span><span class="p" data-group-id="3264069817-14">(</span><span class="n">user_id</span><span class="p" data-group-id="3264069817-14">)</span><span class="w">
    </span><span class="ss">:ok</span><span class="w">
  </span><span class="k" data-group-id="3264069817-13">end</span><span class="w">
</span><span class="k" data-group-id="3264069817-9">end</span><span class="w">

</span><span class="c1"># Enqueue jobs with back-pressure and persistence</span><span class="w">
</span><span class="kd">def</span><span class="w"> </span><span class="nf">process_user_sign_ups</span><span class="p" data-group-id="3264069817-15">(</span><span class="n">user_ids</span><span class="p" data-group-id="3264069817-15">)</span><span class="w"> </span><span class="k" data-group-id="3264069817-16">do</span><span class="w">
  </span><span class="n">jobs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">map</span><span class="p" data-group-id="3264069817-17">(</span><span class="n">user_ids</span><span class="p">,</span><span class="w"> </span><span class="k" data-group-id="3264069817-18">fn</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
    </span><span class="nc">WelcomeEmailWorker</span><span class="o">.</span><span class="n">new</span><span class="p" data-group-id="3264069817-19">(</span><span class="p" data-group-id="3264069817-20">%{</span><span class="ss">user_id</span><span class="p">:</span><span class="w"> </span><span class="n">id</span><span class="p" data-group-id="3264069817-20">}</span><span class="p" data-group-id="3264069817-19">)</span><span class="w">
  </span><span class="k" data-group-id="3264069817-18">end</span><span class="p" data-group-id="3264069817-17">)</span><span class="w">
  
  </span><span class="nc">Oban</span><span class="o">.</span><span class="n">insert_all</span><span class="p" data-group-id="3264069817-21">(</span><span class="n">jobs</span><span class="p" data-group-id="3264069817-21">)</span><span class="w">
</span><span class="k" data-group-id="3264069817-16">end</span></code></pre><h3 id="use-streaming-libraries-instead-for-data-pipelines" class="section-heading">
  <a href="#use-streaming-libraries-instead-for-data-pipelines" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Use Streaming Libraries Instead for Data Pipelines</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="c1"># ❌ Effect for large data processing - memory issues</span><span class="w">
</span><span class="kd">def</span><span class="w"> </span><span class="nf">process_large_dataset</span><span class="p" data-group-id="0689513517-1">(</span><span class="n">data</span><span class="p" data-group-id="0689513517-1">)</span><span class="w"> </span><span class="k" data-group-id="0689513517-2">do</span><span class="w">
  </span><span class="nc">Effect</span><span class="o">.</span><span class="n">traverse_a</span><span class="p" data-group-id="0689513517-3">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="k" data-group-id="0689513517-4">fn</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
    </span><span class="nc">Effect</span><span class="o">.</span><span class="n">lift_func</span><span class="p" data-group-id="0689513517-5">(</span><span class="k" data-group-id="0689513517-6">fn</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">expensive_transformation</span><span class="p" data-group-id="0689513517-7">(</span><span class="n">item</span><span class="p" data-group-id="0689513517-7">)</span><span class="w"> </span><span class="k" data-group-id="0689513517-6">end</span><span class="p" data-group-id="0689513517-5">)</span><span class="w">
  </span><span class="k" data-group-id="0689513517-4">end</span><span class="p" data-group-id="0689513517-3">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="0689513517-8">(</span><span class="p" data-group-id="0689513517-8">)</span><span class="w">
</span><span class="k" data-group-id="0689513517-2">end</span><span class="w">

</span><span class="c1"># ✅ Flow for back-pressured stream processing</span><span class="w">
</span><span class="kd">def</span><span class="w"> </span><span class="nf">process_large_dataset</span><span class="p" data-group-id="0689513517-9">(</span><span class="n">data</span><span class="p" data-group-id="0689513517-9">)</span><span class="w"> </span><span class="k" data-group-id="0689513517-10">do</span><span class="w">
  </span><span class="n">data</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Flow</span><span class="o">.</span><span class="n">from_enumerable</span><span class="p" data-group-id="0689513517-11">(</span><span class="ss">max_demand</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p" data-group-id="0689513517-11">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Flow</span><span class="o">.</span><span class="n">map</span><span class="p" data-group-id="0689513517-12">(</span><span class="o">&amp;</span><span class="n">expensive_transformation</span><span class="o">/</span><span class="mi">1</span><span class="p" data-group-id="0689513517-12">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Flow</span><span class="o">.</span><span class="n">partition</span><span class="p" data-group-id="0689513517-13">(</span><span class="p" data-group-id="0689513517-13">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Flow</span><span class="o">.</span><span class="n">reduce</span><span class="p" data-group-id="0689513517-14">(</span><span class="k" data-group-id="0689513517-15">fn</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p" data-group-id="0689513517-16">[</span><span class="p" data-group-id="0689513517-16">]</span><span class="w"> </span><span class="k" data-group-id="0689513517-15">end</span><span class="p">,</span><span class="w"> </span><span class="k" data-group-id="0689513517-17">fn</span><span class="w"> </span><span class="n">item</span><span class="p">,</span><span class="w"> </span><span class="n">acc</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p" data-group-id="0689513517-18">[</span><span class="n">item</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">acc</span><span class="p" data-group-id="0689513517-18">]</span><span class="w"> </span><span class="k" data-group-id="0689513517-17">end</span><span class="p" data-group-id="0689513517-14">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">to_list</span><span class="p" data-group-id="0689513517-19">(</span><span class="p" data-group-id="0689513517-19">)</span><span class="w">
</span><span class="k" data-group-id="0689513517-10">end</span><span class="w">

</span><span class="c1"># ✅ Broadway for robust event processing</span><span class="w">
</span><span class="kd">defmodule</span><span class="w"> </span><span class="nc">DataProcessor</span><span class="w"> </span><span class="k" data-group-id="0689513517-20">do</span><span class="w">
  </span><span class="kn">use</span><span class="w"> </span><span class="nc">Broadway</span><span class="w">

  </span><span class="kd">def</span><span class="w"> </span><span class="nf">start_link</span><span class="p" data-group-id="0689513517-21">(</span><span class="c">_opts</span><span class="p" data-group-id="0689513517-21">)</span><span class="w"> </span><span class="k" data-group-id="0689513517-22">do</span><span class="w">
    </span><span class="nc">Broadway</span><span class="o">.</span><span class="n">start_link</span><span class="p" data-group-id="0689513517-23">(</span><span class="bp">__MODULE__</span><span class="p">,</span><span class="w">
      </span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="bp">__MODULE__</span><span class="p">,</span><span class="w">
      </span><span class="ss">producer</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="0689513517-24">[</span><span class="w">
        </span><span class="ss">module</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="0689513517-25">{</span><span class="nc">BroadwayRabbitMQ.Producer</span><span class="p">,</span><span class="w"> </span><span class="ss">queue</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;data_queue&quot;</span><span class="p" data-group-id="0689513517-25">}</span><span class="w">
      </span><span class="p" data-group-id="0689513517-24">]</span><span class="p">,</span><span class="w">
      </span><span class="ss">processors</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="0689513517-26">[</span><span class="w">
        </span><span class="ss">default</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="0689513517-27">[</span><span class="ss">concurrency</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p" data-group-id="0689513517-27">]</span><span class="w">
      </span><span class="p" data-group-id="0689513517-26">]</span><span class="w">
    </span><span class="p" data-group-id="0689513517-23">)</span><span class="w">
  </span><span class="k" data-group-id="0689513517-22">end</span><span class="w">

  </span><span class="kd">def</span><span class="w"> </span><span class="nf">handle_message</span><span class="p" data-group-id="0689513517-28">(</span><span class="c">_processor</span><span class="p">,</span><span class="w"> </span><span class="n">message</span><span class="p">,</span><span class="w"> </span><span class="c">_context</span><span class="p" data-group-id="0689513517-28">)</span><span class="w"> </span><span class="k" data-group-id="0689513517-29">do</span><span class="w">
    </span><span class="n">message</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Message</span><span class="o">.</span><span class="n">update_data</span><span class="p" data-group-id="0689513517-30">(</span><span class="o">&amp;</span><span class="n">expensive_transformation</span><span class="o">/</span><span class="mi">1</span><span class="p" data-group-id="0689513517-30">)</span><span class="w">
  </span><span class="k" data-group-id="0689513517-29">end</span><span class="w">
</span><span class="k" data-group-id="0689513517-20">end</span></code></pre><h3 id="but-effect-enables-evolutionary-design" class="section-heading">
  <a href="#but-effect-enables-evolutionary-design" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">But Effect Enables Evolutionary Design</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="c1"># Start simple - Effect allows architectural evolution</span><span class="w">
</span><span class="kd">def</span><span class="w"> </span><span class="nf">check_user_status</span><span class="p" data-group-id="8014879326-1">(</span><span class="n">user_id</span><span class="p" data-group-id="8014879326-1">)</span><span class="w"> </span><span class="k" data-group-id="8014879326-2">do</span><span class="w">
  </span><span class="c1"># Initially: simple boolean check</span><span class="w">
  </span><span class="nc">Effect</span><span class="o">.</span><span class="n">right</span><span class="p" data-group-id="8014879326-3">(</span><span class="n">user_id</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="8014879326-3">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="8014879326-4">(</span><span class="p" data-group-id="8014879326-4">)</span><span class="w">
</span><span class="k" data-group-id="8014879326-2">end</span><span class="w">

</span><span class="c1"># Later: evolve to database lookup without changing interface  </span><span class="w">
</span><span class="kd">def</span><span class="w"> </span><span class="nf">check_user_status</span><span class="p" data-group-id="8014879326-5">(</span><span class="n">user_id</span><span class="p" data-group-id="8014879326-5">)</span><span class="w"> </span><span class="k" data-group-id="8014879326-6">do</span><span class="w">
  </span><span class="nc">Effect</span><span class="o">.</span><span class="n">asks</span><span class="p" data-group-id="8014879326-7">(</span><span class="k" data-group-id="8014879326-8">fn</span><span class="w"> </span><span class="n">env</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">env</span><span class="p" data-group-id="8014879326-9">[</span><span class="ss">:user_store</span><span class="p" data-group-id="8014879326-9">]</span><span class="w"> </span><span class="k" data-group-id="8014879326-8">end</span><span class="p" data-group-id="8014879326-7">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">bind</span><span class="p" data-group-id="8014879326-10">(</span><span class="k" data-group-id="8014879326-11">fn</span><span class="w"> </span><span class="n">store</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">store</span><span class="o">.</span><span class="n">get_user_status</span><span class="p" data-group-id="8014879326-12">(</span><span class="n">user_id</span><span class="p" data-group-id="8014879326-12">)</span><span class="w"> </span><span class="k" data-group-id="8014879326-11">end</span><span class="p" data-group-id="8014879326-10">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="8014879326-13">(</span><span class="n">env</span><span class="p" data-group-id="8014879326-13">)</span><span class="w">
</span><span class="k" data-group-id="8014879326-6">end</span><span class="w">

</span><span class="c1"># Finally: evolve to complex validation with multiple services</span><span class="w">
</span><span class="kd">def</span><span class="w"> </span><span class="nf">check_user_status</span><span class="p" data-group-id="8014879326-14">(</span><span class="n">user_id</span><span class="p" data-group-id="8014879326-14">)</span><span class="w"> </span><span class="k" data-group-id="8014879326-15">do</span><span class="w">
  </span><span class="n">status_checks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="8014879326-16">[</span><span class="w">
    </span><span class="n">check_account_standing</span><span class="p" data-group-id="8014879326-17">(</span><span class="n">user_id</span><span class="p" data-group-id="8014879326-17">)</span><span class="p">,</span><span class="w">
    </span><span class="n">check_payment_status</span><span class="p" data-group-id="8014879326-18">(</span><span class="n">user_id</span><span class="p" data-group-id="8014879326-18">)</span><span class="p">,</span><span class="w"> 
    </span><span class="n">check_compliance_status</span><span class="p" data-group-id="8014879326-19">(</span><span class="n">user_id</span><span class="p" data-group-id="8014879326-19">)</span><span class="w">
  </span><span class="p" data-group-id="8014879326-16">]</span><span class="w">
  
  </span><span class="nc">Effect</span><span class="o">.</span><span class="n">sequence_a</span><span class="p" data-group-id="8014879326-20">(</span><span class="n">status_checks</span><span class="p" data-group-id="8014879326-20">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">map</span><span class="p" data-group-id="8014879326-21">(</span><span class="o">&amp;</span><span class="n">all_checks_passed?</span><span class="o">/</span><span class="mi">1</span><span class="p" data-group-id="8014879326-21">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="8014879326-22">(</span><span class="n">env</span><span class="p" data-group-id="8014879326-22">)</span><span class="w">
</span><span class="k" data-group-id="8014879326-15">end</span></code></pre><h3 id="use-plain-values-when" class="section-heading">
  <a href="#use-plain-values-when" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Use Plain Values When</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="c1"># ❌ Effect for pure computations</span><span class="w">
</span><span class="kd">def</span><span class="w"> </span><span class="nf">calculate_tax_async</span><span class="p" data-group-id="2901905403-1">(</span><span class="n">amount</span><span class="p" data-group-id="2901905403-1">)</span><span class="w"> </span><span class="k" data-group-id="2901905403-2">do</span><span class="w">
  </span><span class="nc">Effect</span><span class="o">.</span><span class="n">lift_func</span><span class="p" data-group-id="2901905403-3">(</span><span class="k" data-group-id="2901905403-4">fn</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">amount</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.1</span><span class="w"> </span><span class="k" data-group-id="2901905403-4">end</span><span class="p" data-group-id="2901905403-3">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="2901905403-5">(</span><span class="p" data-group-id="2901905403-5">)</span><span class="w">
</span><span class="k" data-group-id="2901905403-2">end</span><span class="w">

</span><span class="c1"># ✅ Plain computation for pure functions</span><span class="w">
</span><span class="kd">def</span><span class="w"> </span><span class="nf">calculate_tax</span><span class="p" data-group-id="2901905403-6">(</span><span class="n">amount</span><span class="p" data-group-id="2901905403-6">)</span><span class="w"> </span><span class="k" data-group-id="2901905403-7">do</span><span class="w">
  </span><span class="n">amount</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.1</span><span class="w">
</span><span class="k" data-group-id="2901905403-7">end</span></code></pre><h3 id="effect-s-sweet-spot-basic-async-i-o" class="section-heading">
  <a href="#effect-s-sweet-spot-basic-async-i-o" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Effect's Sweet Spot: Basic Async I/O</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="c1"># ✅ Effect is perfect for basic async operations</span><span class="w">
</span><span class="kd">def</span><span class="w"> </span><span class="nf">fetch_user_dashboard</span><span class="p" data-group-id="4119419478-1">(</span><span class="n">user_id</span><span class="p">,</span><span class="w"> </span><span class="n">env</span><span class="p" data-group-id="4119419478-1">)</span><span class="w"> </span><span class="k" data-group-id="4119419478-2">do</span><span class="w">
  </span><span class="n">parallel_requests</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="4119419478-3">[</span><span class="w">
    </span><span class="n">fetch_user_profile</span><span class="p" data-group-id="4119419478-4">(</span><span class="n">user_id</span><span class="p" data-group-id="4119419478-4">)</span><span class="p">,</span><span class="w">      </span><span class="c1"># HTTP request</span><span class="w">
    </span><span class="n">fetch_recent_orders</span><span class="p" data-group-id="4119419478-5">(</span><span class="n">user_id</span><span class="p" data-group-id="4119419478-5">)</span><span class="p">,</span><span class="w">     </span><span class="c1"># Database query</span><span class="w">
    </span><span class="n">fetch_notifications</span><span class="p" data-group-id="4119419478-6">(</span><span class="n">user_id</span><span class="p" data-group-id="4119419478-6">)</span><span class="w">      </span><span class="c1"># Cache lookup</span><span class="w">
  </span><span class="p" data-group-id="4119419478-3">]</span><span class="w">
  
  </span><span class="nc">Effect</span><span class="o">.</span><span class="n">sequence_a</span><span class="p" data-group-id="4119419478-7">(</span><span class="n">parallel_requests</span><span class="p" data-group-id="4119419478-7">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">map</span><span class="p" data-group-id="4119419478-8">(</span><span class="o">&amp;</span><span class="n">build_dashboard_response</span><span class="o">/</span><span class="mi">1</span><span class="p" data-group-id="4119419478-8">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="4119419478-9">(</span><span class="n">env</span><span class="p" data-group-id="4119419478-9">)</span><span class="w">
</span><span class="k" data-group-id="4119419478-2">end</span><span class="w">

</span><span class="c1"># ✅ Effect handles composition of discrete async operations well</span><span class="w">
</span><span class="kd">def</span><span class="w"> </span><span class="nf">process_payment</span><span class="p" data-group-id="4119419478-10">(</span><span class="n">payment_data</span><span class="p">,</span><span class="w"> </span><span class="n">env</span><span class="p" data-group-id="4119419478-10">)</span><span class="w"> </span><span class="k" data-group-id="4119419478-11">do</span><span class="w">
  </span><span class="nc">Effect</span><span class="o">.</span><span class="n">right</span><span class="p" data-group-id="4119419478-12">(</span><span class="n">payment_data</span><span class="p" data-group-id="4119419478-12">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">bind</span><span class="p" data-group-id="4119419478-13">(</span><span class="o">&amp;</span><span class="n">validate_payment_info</span><span class="o">/</span><span class="mi">1</span><span class="p" data-group-id="4119419478-13">)</span><span class="w">     </span><span class="c1"># Quick validation</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">bind</span><span class="p" data-group-id="4119419478-14">(</span><span class="o">&amp;</span><span class="n">charge_payment_processor</span><span class="o">/</span><span class="mi">1</span><span class="p" data-group-id="4119419478-14">)</span><span class="w">  </span><span class="c1"># External API call</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">bind</span><span class="p" data-group-id="4119419478-15">(</span><span class="o">&amp;</span><span class="n">update_user_account</span><span class="o">/</span><span class="mi">1</span><span class="p" data-group-id="4119419478-15">)</span><span class="w">       </span><span class="c1"># Database update</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">bind</span><span class="p" data-group-id="4119419478-16">(</span><span class="o">&amp;</span><span class="n">send_receipt_email</span><span class="o">/</span><span class="mi">1</span><span class="p" data-group-id="4119419478-16">)</span><span class="w">        </span><span class="c1"># Email service call</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Effect</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="4119419478-17">(</span><span class="n">env</span><span class="p" data-group-id="4119419478-17">)</span><span class="w">
</span><span class="k" data-group-id="4119419478-11">end</span></code></pre><h2 id="architecture-decision-guide" class="section-heading">
  <a href="#architecture-decision-guide" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Architecture Decision Guide</span>
</h2>
<p><strong>Use Effect for:</strong></p><ul><li>✅ <strong>Basic async I/O</strong>: Database calls, HTTP requests, file operations</li><li>✅ <strong>Composed workflows</strong>: 3-10 step async pipelines with error handling</li><li>✅ <strong>Request/response patterns</strong>: Web request processing, API calls</li><li>✅ <strong>Short-lived tasks</strong>: Operations completing in seconds to minutes</li><li>✅ <strong>Functional composition</strong>: When you need monadic error handling</li></ul><p><strong>Use OTP (GenServer/Agent) for:</strong></p><ul><li>✅ <strong>Stateful services</strong>: Caches, connection pools, rate limiters  </li><li>✅ <strong>Long-running processes</strong>: Background workers, schedulers, monitors</li><li>✅ <strong>System resources</strong>: Database connections, file handles, network sockets</li><li>✅ <strong>Fault tolerance</strong>: Supervised processes that can restart</li><li>✅ <strong>Message passing</strong>: Actor-based communication patterns</li></ul><p><strong>Use Job Queues (Oban/Exq) for:</strong></p><ul><li>✅ <strong>Reliable processing</strong>: Jobs that must complete eventually</li><li>✅ <strong>Back-pressure</strong>: High-volume work that needs rate limiting</li><li>✅ <strong>Persistence</strong>: Jobs that survive application restarts</li><li>✅ <strong>Retry logic</strong>: Complex retry strategies with exponential backoff</li><li>✅ <strong>Scheduled work</strong>: Cron-like scheduling, delayed execution</li></ul><p><strong>Use Streaming (Flow/Broadway) for:</strong>  </p><ul><li>✅ <strong>Large datasets</strong>: Processing data that doesn't fit in memory</li><li>✅ <strong>Continuous streams</strong>: Real-time event processing</li><li>✅ <strong>ETL pipelines</strong>: Extract, transform, load operations</li><li>✅ <strong>Back-pressured workflows</strong>: Producer/consumer with flow control</li><li>✅ <strong>Parallel processing</strong>: CPU-intensive batch operations</li></ul><p><strong>Rule of thumb:</strong> If it runs for more than a few minutes, processes thousands of items, or needs to survive application restarts, Effect is probably the wrong tool.</p><h2 id="summary" class="section-heading">
  <a href="#summary" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Summary</span>
</h2>
<p>Effect provides pure descriptions of asynchronous computations with full observability:</p><p><strong>Core Philosophy:</strong></p><ul><li><strong>Pure descriptions</strong>: Effects are instructions, not computations - execution is deferred</li><li><strong>Concurrent by default</strong>: Effects run in parallel unless explicitly sequenced  </li><li><strong>Controlled execution</strong>: <code class="inline">run/2</code> provides isolation, timeouts, and telemetry</li><li><strong>Evolutionary design</strong>: Start simple, evolve complexity without changing interfaces</li></ul><p><strong>Core Operations:</strong></p><ul><li><code class="inline">right/2</code>: Describe successful async computations</li><li><code class="inline">left/2</code>: Describe failed async computations  </li><li><code class="inline">run/2</code>: Execute the deferred Effect with environment and full observability</li><li><code class="inline">map/2</code>: Transform success values while preserving async structure</li><li><code class="inline">bind/2</code>: Chain dependent operations sequentially with trace propagation</li><li><code class="inline">traverse_a/2</code>: Process lists in parallel with error accumulation</li></ul><p><strong>Key Performance Patterns:</strong></p><ul><li><strong>Sequential processing</strong>: Use <code class="inline">bind/2</code> for dependent operations (slower but controlled)</li><li><strong>Parallel processing</strong>: Use <code class="inline">traverse_a/2</code> for independent operations (faster)</li><li><strong>Performance optimization</strong>: <code class="inline">bind</code> cheap local checks before expensive I/O</li><li><strong>Dependency injection</strong>: Use Reader pattern for evolutionary architecture</li></ul><p><strong>Mathematical Properties:</strong></p><ul><li><strong>Functor</strong>: <code class="inline">map</code> preserves structure and async context  </li><li><strong>Applicative</strong>: <code class="inline">traverse_a</code> enables parallel processing with error collection</li><li><strong>Monad</strong>: <code class="inline">bind</code> enables dependent sequencing with automatic flattening</li><li><strong>Reader</strong>: <code class="inline">asks/1</code> enables dependency injection and evolutionary design</li><li><strong>Monad Transformer</strong>: Effect ≈ ReaderT (EitherT (Task a)) - Reader over Either over Task</li><li><strong>Transformer note</strong>: In languages with higher-kinded types, this could use transformer layering. In Elixir, Effect encodes the combined stack explicitly.</li></ul><h2 id="law-reference-for-llm-verification" class="section-heading">
  <a href="#law-reference-for-llm-verification" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Law Reference for LLM Verification</span>
</h2>
<p>LLMs can use these mathematical laws to verify correctness of Effect code:</p><table><thead><tr><th style="text-align: left;">Law</th><th style="text-align: left;">Operation</th><th style="text-align: left;">Expression</th><th style="text-align: left;">Validity</th></tr></thead><tbody><tr><td style="text-align: left;"><strong>Functor Identity</strong></td><td style="text-align: left;"><code class="inline">map/2</code></td><td style="text-align: left;"><code class="inline">map(fn x -&gt; x end, fx) == fx</code></td><td style="text-align: left;">✅ Always</td></tr><tr><td style="text-align: left;"><strong>Functor Composition</strong></td><td style="text-align: left;"><code class="inline">map/2</code></td><td style="text-align: left;"><code class="inline">map(g, map(f, fx)) == map(fn x -&gt; g.(f.(x)) end, fx)</code></td><td style="text-align: left;">✅ Always</td></tr><tr><td style="text-align: left;"><strong>Applicative Identity</strong></td><td style="text-align: left;"><code class="inline">ap/2</code></td><td style="text-align: left;"><code class="inline">ap(pure(fn x -&gt; x end), fx) == fx</code></td><td style="text-align: left;">✅ Always</td></tr><tr><td style="text-align: left;"><strong>Applicative Composition</strong></td><td style="text-align: left;"><code class="inline">ap/2</code></td><td style="text-align: left;">Complex composition law with <code class="inline">pure</code></td><td style="text-align: left;">✅ Always</td></tr><tr><td style="text-align: left;"><strong>Applicative Homomorphism</strong></td><td style="text-align: left;"><code class="inline">ap/2</code></td><td style="text-align: left;"><code class="inline">ap(pure(f), pure(x)) == pure(f.(x))</code></td><td style="text-align: left;">✅ Always</td></tr><tr><td style="text-align: left;"><strong>Monad Left Identity</strong></td><td style="text-align: left;"><code class="inline">bind/2</code></td><td style="text-align: left;"><code class="inline">bind(pure(x), f) == f.(x)</code></td><td style="text-align: left;">✅ Always</td></tr><tr><td style="text-align: left;"><strong>Monad Right Identity</strong></td><td style="text-align: left;"><code class="inline">bind/2</code></td><td style="text-align: left;"><code class="inline">bind(mx, &amp;pure/1) == mx</code></td><td style="text-align: left;">✅ Always</td></tr><tr><td style="text-align: left;"><strong>Monad Associativity</strong></td><td style="text-align: left;"><code class="inline">bind/2</code></td><td style="text-align: left;"><code class="inline">bind(bind(mx, f), g) == bind(mx, fn x -&gt; bind(f.(x), g) end)</code></td><td style="text-align: left;">✅ Always</td></tr><tr><td style="text-align: left;"><strong>Reader Ask Law</strong></td><td style="text-align: left;"><code class="inline">asks/1</code></td><td style="text-align: left;"><code class="inline">asks(fn env -&gt; env end) == ask()</code></td><td style="text-align: left;">✅ Always</td></tr><tr><td style="text-align: left;"><strong>Reader Local Law</strong></td><td style="text-align: left;">Environment</td><td style="text-align: left;">Laws about environment propagation</td><td style="text-align: left;">✅ Always</td></tr></tbody></table><p><strong>LLM Verification Usage</strong>: If user code violates these laws, it's likely incorrect Effect usage.</p><p><strong>Observability Features:</strong></p><ul><li>Automatic telemetry emission with structured events</li><li>Hierarchical span creation preserving trace lineage  </li><li>Exception safety with structured <code class="inline">EffectError</code> wrapping</li><li>Context propagation enabling distributed tracing</li></ul><h2 id="final-llm-guidance" class="section-heading">
  <a href="#final-llm-guidance" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Final LLM Guidance</span>
</h2>
<p><strong>Effect in One Sentence</strong>: Pure descriptions of observable async computations that enable both performance optimization and evolutionary design.</p><p><strong>Key Mental Model for LLMs</strong>:</p><ul><li><strong>Construction</strong>: Build pure descriptions (<code class="inline">Effect.right/left</code>)</li><li><strong>Composition</strong>: Chain with <code class="inline">bind</code> (sequential) or <code class="inline">traverse_a</code> (parallel)  </li><li><strong>Execution</strong>: Run with <code class="inline">run/2</code> for actual I/O with full observability</li><li><strong>Context</strong>: Thread environment for dependency injection via Reader pattern</li></ul><p><strong>Critical Success Factors</strong>:</p><ol><li><strong>Always call <code class="inline">run/2</code></strong> - Effects are lazy descriptions until executed</li><li><strong>Use <code class="inline">bind</code> for dependent operations</strong> - sequential execution with short-circuiting</li><li><strong>Use <code class="inline">traverse_a</code> for independent operations</strong> - parallel execution with error accumulation</li><li><strong>Leverage context for evolutionary design</strong> - inject dependencies, not configurations</li><li><strong>Trust the telemetry</strong> - automatic observability with structured events</li></ol><p><strong>When LLMs Should Recommend Effect</strong>:</p><ul><li>User mentions async I/O, concurrency, observability, or tracing</li><li>Building composed workflows with multiple async steps</li><li>Need both fail-fast and error accumulation patterns</li><li>Require dependency injection for evolutionary architecture</li></ul><p>Remember: Effect represents &quot;pure descriptions of observable async computation&quot; - separate what to do from when to do it, enabling both performance optimization and evolutionary design.</p>
</div>

<div class="bottom-actions" id="bottom-actions">
  <div class="bottom-actions-item">

      <a href="monad-either-usage-rules.html" class="bottom-actions-button" rel="prev">
        <span class="subheader">
          ← Previous Page
        </span>
        <span class="title">
Funx.Monad.Either Usage Rules
        </span>
      </a>

  </div>
  <div class="bottom-actions-item">

      <a href="monad-identity-usage-rules.html" class="bottom-actions-button" rel="next">
        <span class="subheader">
          Next Page →
        </span>
        <span class="title">
Funx.Monad.Identity Usage Rules
        </span>
      </a>

  </div>
</div>
    <footer class="footer">
      <p>

          <span class="line">
            <a href="https://hex.pm/packages/funx/0.1.5" class="footer-hex-package">Hex Package</a>

            <a href="https://preview.hex.pm/preview/funx/0.1.5">Hex Preview</a>

              (<a href="https://preview.hex.pm/preview/funx/0.1.5/show/lib/monad/effect/usage-rules.md">current file</a>)

          </span>

        <span class="line">
          <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
            Search HexDocs
          </button>

            <a href="funx.epub" title="ePub version">
              Download ePub version
            </a>

        </span>
      </p>

      <p class="built-using">
        Built using
        <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.34.2) for the

          <a href="https://elixir-lang.org" title="Elixir" target="_blank" translate="no">Elixir programming language</a>

      </p>

    </footer>
  </div>
</main>
</div>

  </body>
</html>
