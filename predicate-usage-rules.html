<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.34.2">
    <meta name="project" content="funx v0.1.4">


    <title>Funx.Predicate Usage Rules — funx v0.1.4</title>
    <link rel="stylesheet" href="dist/html-elixir-F2VRIOKR.css" />


      <link rel="canonical" href="https://hexdocs.pm/funx/predicate-usage-rules.html" />

    <script src="dist/handlebars.runtime-NWIB6V2M.js"></script>
    <script src="dist/handlebars.templates-K7URE6B4.js"></script>
    <script src="dist/sidebar_items-BB212813.js"></script>
    <script src="docs_config.js"></script>
    <script async src="dist/html-YIPIRHGU.js"></script>

  </head>
  <body data-type="extras" class="page-extra">
    <script>

      try {
        var settings = JSON.parse(localStorage.getItem('ex_doc:settings') || '{}');

        if (settings.theme === 'dark' ||
           ((settings.theme === 'system' || settings.theme == null) &&
             window.matchMedia('(prefers-color-scheme: dark)').matches)
           ) {
          document.body.classList.add('dark')
        }
      } catch (error) { }
    </script>

<div class="body-wrapper">

<button id="sidebar-menu" class="sidebar-button sidebar-toggle" aria-label="toggle sidebar" aria-controls="sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<nav id="sidebar" class="sidebar">

  <div class="sidebar-header">
    <div class="sidebar-projectInfo">

      <div>
        <a href="readme.html" class="sidebar-projectName" translate="no">
funx
        </a>
        <div class="sidebar-projectVersion" translate="no">
          v0.1.4
        </div>
      </div>
    </div>
    <ul id="sidebar-listNav" class="sidebar-listNav" role="tablist">
      <li>
        <button id="extras-list-tab-button" role="tab" data-type="extras" aria-controls="extras-tab-panel" aria-selected="true" tabindex="0">
Pages
        </button>
      </li>

        <li>
          <button id="modules-list-tab-button" role="tab" data-type="modules" aria-controls="modules-tab-panel" aria-selected="false" tabindex="-1">
            Modules
          </button>
        </li>


    </ul>
  </div>

  <div id="extras-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="extras-list-tab-button">
    <ul id="extras-full-list" class="full-list"></ul>
  </div>

    <div id="modules-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="modules-list-tab-button" hidden>
      <ul id="modules-full-list" class="full-list"></ul>
    </div>


</nav>

<main class="content">
  <output role="status" id="toast"></output>

  <div id="content" class="content-inner">
    <div class="top-search">
      <div class="search-settings">
        <form class="search-bar" action="search.html">
          <label class="search-label">
            <span class="sr-only">Search documentation of funx</span>
            <input name="q" type="text" class="search-input" placeholder="Press / to search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
          </label>
          <button type="submit" class="search-button" aria-label="Submit Search">
            <i class="ri-search-2-line ri-lg" aria-hidden="true" title="Submit search"></i>
          </button>
          <button type="button" tabindex="-1" class="search-close-button" aria-hidden="true">
            <i class="ri-close-line ri-lg" title="Cancel search"></i>
          </button>
        </form>
        <div class="autocomplete">
        </div>
        <button class="icon-settings display-settings">
          <i class="ri-settings-3-line"></i>
          <span class="sr-only">Settings</span>
        </button>
      </div>
    </div>

<div id="top-content">
  <h1>

      <a href="https://github.com/JKWA/funx/blob/v0.1.4/lib/predicate/usage-rules.md#L1" title="View Source" class="icon-action" rel="help">
        <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        <span class="sr-only">View Source</span>
      </a>


    <span><code class="inline">Funx.Predicate</code> Usage Rules</span>
  </h1>

<h2 id="llm-functional-programming-foundation" class="section-heading">
  <a href="#llm-functional-programming-foundation" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">LLM Functional Programming Foundation</span>
</h2>
<p><strong>Key Concepts for LLMs:</strong></p><p><strong>Predicate</strong>: A function that tests conditions and returns boolean values</p><ul><li><strong>Type signature</strong>: <code class="inline">a -&gt; boolean</code> (takes a value, returns true/false)</li><li><strong>Purpose</strong>: Enable composable, reusable validation and filtering logic</li><li><strong>Mathematical foundation</strong>: Based on Boolean algebra with logical operations</li><li><strong>Composition</strong>: Predicates can be combined using AND, OR, NOT operations</li></ul><p><strong>Monoid Backing</strong>: Predicates are backed by monoid operations for composition</p><ul><li><strong>All monoid (AND-based)</strong>: Short-circuits on first false, requires all conditions to be true</li><li><strong>Any monoid (OR-based)</strong>: Short-circuits on first true, succeeds if any condition is true</li><li><strong>Identity elements</strong>: <code class="inline">always_true</code> for All, <code class="inline">always_false</code> for Any</li><li><strong>Associativity</strong>: Order of composition doesn't affect result</li></ul><p><strong>Logical Laws</strong>: Predicates follow Boolean algebra laws</p><ul><li><strong>Identity</strong>: <code class="inline">p AND true = p</code>, <code class="inline">p OR false = p</code></li><li><strong>Commutativity</strong>: <code class="inline">p AND q = q AND p</code>, <code class="inline">p OR q = q OR p</code></li><li><strong>Associativity</strong>: <code class="inline">(p AND q) AND r = p AND (q AND r)</code></li><li><strong>De Morgan's Laws</strong>: <code class="inline">NOT(p AND q) = NOT p OR NOT q</code></li></ul><p><strong>Short-Circuiting</strong>: Efficient evaluation stops at first definitive result</p><ul><li><strong>AND operations</strong>: Stop at first false predicate</li><li><strong>OR operations</strong>: Stop at first true predicate</li><li><strong>Performance benefit</strong>: Avoid expensive later computations</li></ul><p><strong>Composition Patterns</strong>: Build complex logic from simple predicates</p><ul><li><strong>Layered validation</strong>: Basic checks before expensive operations</li><li><strong>Business rules</strong>: Combine multiple conditions into domain logic</li><li><strong>Filtering pipelines</strong>: Chain predicates for data processing</li></ul><h2 id="llm-decision-guide-when-to-use-predicates" class="section-heading">
  <a href="#llm-decision-guide-when-to-use-predicates" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">LLM Decision Guide: When to Use Predicates</span>
</h2>
<p><strong>✅ Use Predicates when:</strong></p><ul><li>Need reusable validation logic</li><li>Building complex conditional logic from simple parts</li><li>Want to compose boolean conditions</li><li>Need to filter collections based on multiple criteria</li><li>User says: &quot;validate&quot;, &quot;filter&quot;, &quot;condition&quot;, &quot;check if&quot;, &quot;business rules&quot;</li></ul><p><strong>❌ Don't use Predicates when:</strong></p><ul><li>Simple one-off boolean expressions</li><li>Single validation that won't be reused</li><li>Performance is absolutely critical (function call overhead)</li><li>Logic is too complex for boolean composition</li></ul><p><strong>⚡ Predicate vs. Direct Boolean Decision:</strong></p><ul><li><strong>Predicates</strong>: Reusable, composable, testable validation logic</li><li><strong>Direct booleans</strong>: Simple, one-off conditional checks</li><li><strong>Rule</strong>: Use predicates when logic will be reused or composed</li></ul><p><strong>⚙️ Function Choice Guide:</strong></p><ul><li><strong><code class="inline">and_all/1</code></strong>: All conditions must be true (short-circuits on false)</li><li><strong><code class="inline">or_any/1</code></strong>: Any condition can be true (short-circuits on true)</li><li><strong><a href="https://hexdocs.pm/elixir/Kernel.html#not/1"><code class="inline">not/1</code></a></strong>: Invert a predicate (logical negation)</li><li><strong><code class="inline">test/2</code></strong>: Apply predicate to value with error handling</li></ul><h2 id="llm-context-clues" class="section-heading">
  <a href="#llm-context-clues" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">LLM Context Clues</span>
</h2>
<p><strong>User language → Predicate patterns:</strong></p><ul><li>&quot;validate multiple conditions&quot; → <code class="inline">and_all</code> composition</li><li>&quot;any of these conditions&quot; → <code class="inline">or_any</code> composition</li><li>&quot;opposite of&quot; or &quot;not&quot; → <a href="https://hexdocs.pm/elixir/Kernel.html#not/1"><code class="inline">not/1</code></a> negation</li><li>&quot;business rules&quot; → Complex predicate composition</li><li>&quot;filter by conditions&quot; → Predicate with Enum.filter</li><li>&quot;access control&quot; → Role-based predicate composition</li><li>&quot;data validation&quot; → Layered predicate pipelines</li><li>&quot;conditional logic&quot; → Predicate composition with Utils</li></ul><h2 id="quick-reference" class="section-heading">
  <a href="#quick-reference" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Quick Reference</span>
</h2>
<ul><li><strong>Core concepts</strong>: Functions returning boolean values for conditions</li><li><strong>Monoid backing</strong>: Uses All (AND) and Any (OR) monoids for composition</li><li><strong>Main operations</strong>: <code class="inline">and_all/1</code>, <code class="inline">or_any/1</code>, <a href="https://hexdocs.pm/elixir/Kernel.html#not/1"><code class="inline">not/1</code></a>, <code class="inline">test/2</code></li><li><strong>Performance</strong>: Short-circuiting evaluation for efficiency</li><li><strong>Composition</strong>: Build complex logic from simple predicate functions</li></ul><h2 id="overview" class="section-heading">
  <a href="#overview" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Overview</span>
</h2>
<p><a href="Funx.Predicate.html"><code class="inline">Funx.Predicate</code></a> provides utilities for building and composing predicate functions (functions that return boolean values). Predicates are essential for validation, filtering, and conditional logic in functional programming.</p><p>The module is backed by monoid operations, enabling composable boolean logic with proper short-circuiting behavior. This makes it efficient and mathematically sound for building complex conditional systems.</p><h2 id="composition-rules" class="section-heading">
  <a href="#composition-rules" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Composition Rules</span>
</h2>
<table><thead><tr><th style="text-align: left;">Function</th><th style="text-align: left;">Type Signature</th><th style="text-align: left;">Purpose</th></tr></thead><tbody><tr><td style="text-align: left;"><code class="inline">and_all/1</code></td><td style="text-align: left;"><code class="inline">[a -&gt; boolean] -&gt; a -&gt; boolean</code></td><td style="text-align: left;">All predicates must be true (AND)</td></tr><tr><td style="text-align: left;"><code class="inline">or_any/1</code></td><td style="text-align: left;"><code class="inline">[a -&gt; boolean] -&gt; a -&gt; boolean</code></td><td style="text-align: left;">Any predicate can be true (OR)</td></tr><tr><td style="text-align: left;"><a href="https://hexdocs.pm/elixir/Kernel.html#not/1"><code class="inline">not/1</code></a></td><td style="text-align: left;"><code class="inline">(a -&gt; boolean) -&gt; a -&gt; boolean</code></td><td style="text-align: left;">Logical negation of predicate</td></tr><tr><td style="text-align: left;"><code class="inline">test/2</code></td><td style="text-align: left;"><code class="inline">(a -&gt; boolean) -&gt; a -&gt; boolean</code></td><td style="text-align: left;">Apply predicate to value, ensuring boolean result</td></tr></tbody></table><p>These functions enable building complex boolean logic from simple predicate functions while maintaining performance through short-circuiting.</p><p><strong>Monoid Law Guarantees</strong>: Because predicate composition is built on monoids (All and Any), it inherits mathematical guarantees:</p><ul><li><strong>Associativity</strong>: Grouping doesn't matter - <code class="inline">(p1 AND p2) AND p3 = p1 AND (p2 AND p3)</code></li><li><strong>Identity</strong>: Neutral elements - <code class="inline">and_all([])</code> returns <code class="inline">fn _ -&gt; true end</code>, <code class="inline">or_any([])</code> returns <code class="inline">fn _ -&gt; false end</code></li><li><strong>Short-circuiting</strong>: Efficient evaluation - <code class="inline">and_all</code> stops at first false, <code class="inline">or_any</code> stops at first true</li></ul><p><strong>Predicate Arity</strong>: Predicates used in <code class="inline">and_all/1</code> and <code class="inline">or_any/1</code> must be unary (1-arity). If more context is needed, use partially applied closures or higher-order predicate factories.</p><h2 id="correct-usage-patterns" class="section-heading">
  <a href="#correct-usage-patterns" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Correct Usage Patterns</span>
</h2>
<h3 id="combining-predicates" class="section-heading">
  <a href="#combining-predicates" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Combining Predicates</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="c1"># Individual predicates</span><span class="w">
</span><span class="n">is_adult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="0595138774-1">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">age</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">18</span><span class="w"> </span><span class="k" data-group-id="0595138774-1">end</span><span class="w">
</span><span class="n">has_email</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="0595138774-2">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">String</span><span class="o">.</span><span class="n">contains?</span><span class="p" data-group-id="0595138774-3">(</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;@&quot;</span><span class="p" data-group-id="0595138774-3">)</span><span class="w"> </span><span class="k" data-group-id="0595138774-2">end</span><span class="w">  
</span><span class="n">is_active</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="0595138774-4">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">active</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">true</span><span class="w"> </span><span class="k" data-group-id="0595138774-4">end</span><span class="w">

</span><span class="c1"># Combine with AND (all must be true)</span><span class="w">
</span><span class="n">valid_user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="0595138774-5">(</span><span class="p" data-group-id="0595138774-6">[</span><span class="n">is_adult</span><span class="p">,</span><span class="w"> </span><span class="n">has_email</span><span class="p">,</span><span class="w"> </span><span class="n">is_active</span><span class="p" data-group-id="0595138774-6">]</span><span class="p" data-group-id="0595138774-5">)</span><span class="w">

</span><span class="c1"># Combine with OR (any can be true)  </span><span class="w">
</span><span class="n">admin_or_moderator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">or_any</span><span class="p" data-group-id="0595138774-7">(</span><span class="p" data-group-id="0595138774-8">[</span><span class="w">
  </span><span class="k" data-group-id="0595138774-9">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">role</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">:admin</span><span class="w"> </span><span class="k" data-group-id="0595138774-9">end</span><span class="p">,</span><span class="w">
  </span><span class="k" data-group-id="0595138774-10">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">role</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">:moderator</span><span class="w"> </span><span class="k" data-group-id="0595138774-10">end</span><span class="w">
</span><span class="p" data-group-id="0595138774-8">]</span><span class="p" data-group-id="0595138774-7">)</span><span class="w">

</span><span class="c1"># Test the composed predicates</span><span class="w">
</span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="0595138774-11">%{</span><span class="ss">age</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span><span class="w"> </span><span class="ss">email</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;user@example.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">active</span><span class="p">:</span><span class="w"> </span><span class="no">true</span><span class="p" data-group-id="0595138774-11">}</span><span class="w">
</span><span class="n">valid_user</span><span class="o">.</span><span class="p" data-group-id="0595138774-12">(</span><span class="n">user</span><span class="p" data-group-id="0595138774-12">)</span><span class="w">  </span><span class="c1"># =&gt; true</span></code></pre><h3 id="working-with-lists-and-filtering" class="section-heading">
  <a href="#working-with-lists-and-filtering" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Working with Lists and Filtering</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="n">users</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="8033286723-1">[</span><span class="w">
  </span><span class="p" data-group-id="8033286723-2">%{</span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">age</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="ss">active</span><span class="p">:</span><span class="w"> </span><span class="no">true</span><span class="p" data-group-id="8033286723-2">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="8033286723-3">%{</span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Bob&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">age</span><span class="p">:</span><span class="w"> </span><span class="mi">17</span><span class="p">,</span><span class="w"> </span><span class="ss">active</span><span class="p">:</span><span class="w"> </span><span class="no">true</span><span class="p" data-group-id="8033286723-3">}</span><span class="p">,</span><span class="w"> 
  </span><span class="p" data-group-id="8033286723-4">%{</span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Carol&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">age</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span><span class="w"> </span><span class="ss">active</span><span class="p">:</span><span class="w"> </span><span class="no">false</span><span class="p" data-group-id="8033286723-4">}</span><span class="w">
</span><span class="p" data-group-id="8033286723-1">]</span><span class="w">

</span><span class="c1"># Create filtering predicates</span><span class="w">
</span><span class="n">adult_filter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="8033286723-5">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">age</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">18</span><span class="w"> </span><span class="k" data-group-id="8033286723-5">end</span><span class="w">
</span><span class="n">active_filter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="8033286723-6">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">active</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">true</span><span class="w"> </span><span class="k" data-group-id="8033286723-6">end</span><span class="w">

</span><span class="c1"># Combine filters</span><span class="w">
</span><span class="n">valid_user_filter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="8033286723-7">(</span><span class="p" data-group-id="8033286723-8">[</span><span class="n">adult_filter</span><span class="p">,</span><span class="w"> </span><span class="n">active_filter</span><span class="p" data-group-id="8033286723-8">]</span><span class="p" data-group-id="8033286723-7">)</span><span class="w">

</span><span class="c1"># Apply to collection</span><span class="w">
</span><span class="n">valid_users</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">filter</span><span class="p" data-group-id="8033286723-9">(</span><span class="n">users</span><span class="p">,</span><span class="w"> </span><span class="n">valid_user_filter</span><span class="p" data-group-id="8033286723-9">)</span><span class="w">
</span><span class="c1"># =&gt; [%{name: &quot;Alice&quot;, age: 30, active: true}]</span></code></pre><h3 id="negation" class="section-heading">
  <a href="#negation" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Negation</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="c1"># Original predicate</span><span class="w">
</span><span class="n">is_admin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="3684031979-1">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">role</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">:admin</span><span class="w"> </span><span class="k" data-group-id="3684031979-1">end</span><span class="w">

</span><span class="c1"># Negated predicate</span><span class="w">
</span><span class="n">not_admin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="ow">not</span><span class="p" data-group-id="3684031979-2">(</span><span class="n">is_admin</span><span class="p" data-group-id="3684031979-2">)</span><span class="w">

</span><span class="c1"># Use for filtering</span><span class="w">
</span><span class="n">regular_users</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">filter</span><span class="p" data-group-id="3684031979-3">(</span><span class="n">all_users</span><span class="p">,</span><span class="w"> </span><span class="n">not_admin</span><span class="p" data-group-id="3684031979-3">)</span></code></pre><h2 id="compositional-guidelines" class="section-heading">
  <a href="#compositional-guidelines" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Compositional Guidelines</span>
</h2>
<p>Follow these patterns when generating or working with predicates:</p><ul><li><strong>Build from simple parts</strong>: Start with basic predicates and compose them</li><li><strong>Use descriptive names</strong>: Name intermediate predicates for clarity</li><li><strong>Layer validations</strong>: Put cheap checks before expensive ones</li><li><strong>Short-circuit efficiently</strong>: Use <code class="inline">and_all</code> and <code class="inline">or_any</code> for performance</li><li><strong>Avoid side effects</strong>: Keep predicates pure (no IO, mutations, etc.)</li><li><strong>Test compositions</strong>: Verify complex predicates work as expected</li></ul><h2 id="stability-contract" class="section-heading">
  <a href="#stability-contract" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Stability Contract</span>
</h2>
<p>Ensure that predicate functions maintain:</p><ul><li><strong>Purity</strong>: No side effects, same input produces same output</li><li><strong>Short-circuiting</strong>: <code class="inline">and_all</code> stops at first false, <code class="inline">or_any</code> stops at first true  </li><li><strong>Logical identity</strong>: Follow Boolean algebra laws and De Morgan's laws</li><li><strong>Type consistency</strong>: All predicates in a composition should accept same type</li><li><strong>Unary predicates</strong>: All predicates must be single-argument functions for composition</li></ul><h2 id="anti-patterns" class="section-heading">
  <a href="#anti-patterns" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Anti-Patterns</span>
</h2>
<p>Avoid generating or emitting:</p><ul><li><strong>Side effects in predicates</strong>: No IO, logging, or mutations</li><li><strong>Expensive operations early</strong>: Put cheap validations first</li><li><strong>Non-boolean returns</strong>: Predicates must return true/false</li><li><strong>Mixed input types</strong>: Keep predicates type-consistent within compositions</li><li><strong>Multi-arity predicates</strong>: Don't use predicates requiring multiple arguments in composition</li><li><strong>Deep nesting</strong>: Use intermediate named predicates instead</li></ul><h2 id="good-patterns" class="section-heading">
  <a href="#good-patterns" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Good Patterns</span>
</h2>
<p>Encourage completions like:</p><pre><code class="makeup elixir" translate="no"><span class="c1"># Named intermediate predicates for clarity</span><span class="w">
</span><span class="n">has_permission</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="7398810299-1">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">permissions</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">member?</span><span class="p" data-group-id="7398810299-2">(</span><span class="ss">:read</span><span class="p" data-group-id="7398810299-2">)</span><span class="w"> </span><span class="k" data-group-id="7398810299-1">end</span><span class="w">
</span><span class="n">within_rate_limit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="7398810299-3">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">requests_today</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="k" data-group-id="7398810299-3">end</span><span class="w">
</span><span class="n">account_active</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="7398810299-4">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">:active</span><span class="w"> </span><span class="k" data-group-id="7398810299-4">end</span><span class="w">

</span><span class="c1"># Composed authorization predicate</span><span class="w">
</span><span class="n">can_access</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="7398810299-5">(</span><span class="p" data-group-id="7398810299-6">[</span><span class="n">has_permission</span><span class="p">,</span><span class="w"> </span><span class="n">within_rate_limit</span><span class="p">,</span><span class="w"> </span><span class="n">account_active</span><span class="p" data-group-id="7398810299-6">]</span><span class="p" data-group-id="7398810299-5">)</span></code></pre><pre><code class="makeup elixir" translate="no"><span class="c1"># Proper arity handling for multi-context predicates</span><span class="w">
</span><span class="c1"># ❌ Wrong: multi-arity predicate</span><span class="w">
</span><span class="n">bad_access_check</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="1345705066-1">fn</span><span class="w"> </span><span class="n">resource</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">resource</span><span class="o">.</span><span class="n">owner_id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="w"> </span><span class="k" data-group-id="1345705066-1">end</span><span class="w">

</span><span class="c1"># ✅ Right: use closure or factory pattern</span><span class="w">
</span><span class="n">is_owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="1345705066-2">fn</span><span class="w"> </span><span class="n">resource</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
  </span><span class="k" data-group-id="1345705066-3">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">resource</span><span class="o">.</span><span class="n">owner_id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="w"> </span><span class="k" data-group-id="1345705066-3">end</span><span class="w">
</span><span class="k" data-group-id="1345705066-2">end</span><span class="w">

</span><span class="c1"># ✅ Right: partially applied closure</span><span class="w">
</span><span class="n">resource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="1345705066-4">%{</span><span class="ss">owner_id</span><span class="p">:</span><span class="w"> </span><span class="mi">123</span><span class="p" data-group-id="1345705066-4">}</span><span class="w">
</span><span class="n">owner_check</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">is_owner</span><span class="o">.</span><span class="p" data-group-id="1345705066-5">(</span><span class="n">resource</span><span class="p" data-group-id="1345705066-5">)</span><span class="w">  </span><span class="c1"># Returns unary predicate</span><span class="w">

</span><span class="c1"># Use in composition</span><span class="w">
</span><span class="n">access_predicates</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="1345705066-6">(</span><span class="p" data-group-id="1345705066-7">[</span><span class="w">
  </span><span class="n">owner_check</span><span class="p">,</span><span class="w">                    </span><span class="c1"># Unary predicate</span><span class="w">
  </span><span class="k" data-group-id="1345705066-8">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">active</span><span class="w"> </span><span class="k" data-group-id="1345705066-8">end</span><span class="p">,</span><span class="w">     </span><span class="c1"># Unary predicate</span><span class="w">
  </span><span class="k" data-group-id="1345705066-9">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">banned</span><span class="w"> </span><span class="k" data-group-id="1345705066-9">end</span><span class="w">  </span><span class="c1"># Unary predicate</span><span class="w">
</span><span class="p" data-group-id="1345705066-7">]</span><span class="p" data-group-id="1345705066-6">)</span></code></pre><pre><code class="makeup elixir" translate="no"><span class="c1"># Efficient layered validation (cheap checks first)</span><span class="w">
</span><span class="n">basic_validation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="5145554319-1">(</span><span class="p" data-group-id="5145554319-2">[</span><span class="w">
  </span><span class="k" data-group-id="5145554319-3">fn</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">is_nil</span><span class="p" data-group-id="5145554319-4">(</span><span class="n">data</span><span class="o">.</span><span class="n">id</span><span class="p" data-group-id="5145554319-4">)</span><span class="w"> </span><span class="k" data-group-id="5145554319-3">end</span><span class="p">,</span><span class="w">        </span><span class="c1"># Cheap null check</span><span class="w">
  </span><span class="k" data-group-id="5145554319-5">fn</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">String</span><span class="o">.</span><span class="n">length</span><span class="p" data-group-id="5145554319-6">(</span><span class="n">data</span><span class="o">.</span><span class="n">name</span><span class="p" data-group-id="5145554319-6">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k" data-group-id="5145554319-5">end</span><span class="w"> </span><span class="c1"># String length check</span><span class="w">
</span><span class="p" data-group-id="5145554319-2">]</span><span class="p" data-group-id="5145554319-1">)</span><span class="w">

</span><span class="n">expensive_validation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="5145554319-7">fn</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
  </span><span class="c1"># Expensive database check only after basic validation passes</span><span class="w">
  </span><span class="ow">not</span><span class="w"> </span><span class="nc">Database</span><span class="o">.</span><span class="n">user_exists?</span><span class="p" data-group-id="5145554319-8">(</span><span class="n">data</span><span class="o">.</span><span class="n">id</span><span class="p" data-group-id="5145554319-8">)</span><span class="w">
</span><span class="k" data-group-id="5145554319-7">end</span><span class="w">

</span><span class="n">full_validation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="5145554319-9">(</span><span class="p" data-group-id="5145554319-10">[</span><span class="n">basic_validation</span><span class="p">,</span><span class="w"> </span><span class="n">expensive_validation</span><span class="p" data-group-id="5145554319-10">]</span><span class="p" data-group-id="5145554319-9">)</span></code></pre><h2 id="llm-code-templates" class="section-heading">
  <a href="#llm-code-templates" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">LLM Code Templates</span>
</h2>
<h3 id="basic-validation-template" class="section-heading">
  <a href="#basic-validation-template" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Basic Validation Template</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="kd">def</span><span class="w"> </span><span class="nf">build_user_validator</span><span class="p" data-group-id="4830033533-1">(</span><span class="p" data-group-id="4830033533-1">)</span><span class="w"> </span><span class="k" data-group-id="4830033533-2">do</span><span class="w">
  </span><span class="c1"># Define individual validation predicates</span><span class="w">
  </span><span class="n">validations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="4830033533-3">%{</span><span class="w">
    </span><span class="ss">has_name</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="4830033533-4">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> 
      </span><span class="ow">not</span><span class="w"> </span><span class="n">is_nil</span><span class="p" data-group-id="4830033533-5">(</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="p" data-group-id="4830033533-5">)</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nc">String</span><span class="o">.</span><span class="n">length</span><span class="p" data-group-id="4830033533-6">(</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="p" data-group-id="4830033533-6">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> 
    </span><span class="k" data-group-id="4830033533-4">end</span><span class="p">,</span><span class="w">
    
    </span><span class="ss">valid_email</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="4830033533-7">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
      </span><span class="nc">String</span><span class="o">.</span><span class="n">contains?</span><span class="p" data-group-id="4830033533-8">(</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;@&quot;</span><span class="p" data-group-id="4830033533-8">)</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nc">String</span><span class="o">.</span><span class="n">contains?</span><span class="p" data-group-id="4830033533-9">(</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;.&quot;</span><span class="p" data-group-id="4830033533-9">)</span><span class="w">
    </span><span class="k" data-group-id="4830033533-7">end</span><span class="p">,</span><span class="w">
    
    </span><span class="ss">adult_age</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="4830033533-10">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
      </span><span class="n">is_integer</span><span class="p" data-group-id="4830033533-11">(</span><span class="n">user</span><span class="o">.</span><span class="n">age</span><span class="p" data-group-id="4830033533-11">)</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">age</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">18</span><span class="w">
    </span><span class="k" data-group-id="4830033533-10">end</span><span class="p">,</span><span class="w">
    
    </span><span class="ss">active_status</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="4830033533-12">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
      </span><span class="n">user</span><span class="o">.</span><span class="n">status</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="p" data-group-id="4830033533-13">[</span><span class="ss">:active</span><span class="p">,</span><span class="w"> </span><span class="ss">:verified</span><span class="p" data-group-id="4830033533-13">]</span><span class="w">
    </span><span class="k" data-group-id="4830033533-12">end</span><span class="w">
  </span><span class="p" data-group-id="4830033533-3">}</span><span class="w">
  
  </span><span class="c1"># Compose basic validation (cheap checks)</span><span class="w">
  </span><span class="n">basic_validation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="4830033533-14">(</span><span class="p" data-group-id="4830033533-15">[</span><span class="w">
    </span><span class="n">validations</span><span class="o">.</span><span class="n">has_name</span><span class="p">,</span><span class="w">
    </span><span class="n">validations</span><span class="o">.</span><span class="n">adult_age</span><span class="p">,</span><span class="w">
    </span><span class="n">validations</span><span class="o">.</span><span class="n">active_status</span><span class="w">
  </span><span class="p" data-group-id="4830033533-15">]</span><span class="p" data-group-id="4830033533-14">)</span><span class="w">
  
  </span><span class="c1"># Compose expensive validation</span><span class="w">
  </span><span class="n">expensive_validation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="4830033533-16">(</span><span class="p" data-group-id="4830033533-17">[</span><span class="w">
    </span><span class="n">validations</span><span class="o">.</span><span class="n">valid_email</span><span class="p">,</span><span class="w">
    </span><span class="k" data-group-id="4830033533-18">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nc">UserRepo</span><span class="o">.</span><span class="n">email_exists?</span><span class="p" data-group-id="4830033533-19">(</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p" data-group-id="4830033533-19">)</span><span class="w"> </span><span class="k" data-group-id="4830033533-18">end</span><span class="w">  </span><span class="c1"># Database check</span><span class="w">
  </span><span class="p" data-group-id="4830033533-17">]</span><span class="p" data-group-id="4830033533-16">)</span><span class="w">
  
  </span><span class="c1"># Final composed validator</span><span class="w">
  </span><span class="n">complete_validator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="4830033533-20">(</span><span class="p" data-group-id="4830033533-21">[</span><span class="n">basic_validation</span><span class="p">,</span><span class="w"> </span><span class="n">expensive_validation</span><span class="p" data-group-id="4830033533-21">]</span><span class="p" data-group-id="4830033533-20">)</span><span class="w">
  
  </span><span class="c1"># Usage function</span><span class="w">
  </span><span class="k" data-group-id="4830033533-22">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">complete_validator</span><span class="o">.</span><span class="p" data-group-id="4830033533-23">(</span><span class="n">user</span><span class="p" data-group-id="4830033533-23">)</span><span class="w"> </span><span class="k" data-group-id="4830033533-24">do</span><span class="w">
      </span><span class="no">true</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p" data-group-id="4830033533-25">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p" data-group-id="4830033533-25">}</span><span class="w">
      </span><span class="no">false</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p" data-group-id="4830033533-26">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;User validation failed&quot;</span><span class="p" data-group-id="4830033533-26">}</span><span class="w">
    </span><span class="k" data-group-id="4830033533-24">end</span><span class="w">
  </span><span class="k" data-group-id="4830033533-22">end</span><span class="w">
</span><span class="k" data-group-id="4830033533-2">end</span><span class="w">

</span><span class="c1"># Usage</span><span class="w">
</span><span class="n">validator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">build_user_validator</span><span class="p" data-group-id="4830033533-27">(</span><span class="p" data-group-id="4830033533-27">)</span><span class="w">
</span><span class="n">validator</span><span class="o">.</span><span class="p" data-group-id="4830033533-28">(</span><span class="p" data-group-id="4830033533-29">%{</span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">email</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;alice@example.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">age</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span><span class="w"> </span><span class="ss">status</span><span class="p">:</span><span class="w"> </span><span class="ss">:active</span><span class="p" data-group-id="4830033533-29">}</span><span class="p" data-group-id="4830033533-28">)</span></code></pre><h3 id="access-control-template" class="section-heading">
  <a href="#access-control-template" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Access Control Template</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="kd">def</span><span class="w"> </span><span class="nf">build_access_control_system</span><span class="p" data-group-id="1868601578-1">(</span><span class="p" data-group-id="1868601578-1">)</span><span class="w"> </span><span class="k" data-group-id="1868601578-2">do</span><span class="w">
  </span><span class="c1"># Role-based predicates</span><span class="w">
  </span><span class="n">roles</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="1868601578-3">%{</span><span class="w">
    </span><span class="ss">is_admin</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="1868601578-4">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">role</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">:admin</span><span class="w"> </span><span class="k" data-group-id="1868601578-4">end</span><span class="p">,</span><span class="w">
    </span><span class="ss">is_moderator</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="1868601578-5">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">role</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">:moderator</span><span class="w"> </span><span class="k" data-group-id="1868601578-5">end</span><span class="p">,</span><span class="w">
    </span><span class="ss">is_owner</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="1868601578-6">fn</span><span class="w"> </span><span class="n">resource</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">resource</span><span class="o">.</span><span class="n">owner_id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="w"> </span><span class="k" data-group-id="1868601578-6">end</span><span class="p">,</span><span class="w">
    </span><span class="ss">is_collaborator</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="1868601578-7">fn</span><span class="w"> </span><span class="n">resource</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> 
      </span><span class="nc">Enum</span><span class="o">.</span><span class="n">member?</span><span class="p" data-group-id="1868601578-8">(</span><span class="n">resource</span><span class="o">.</span><span class="n">collaborator_ids</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p" data-group-id="1868601578-8">)</span><span class="w">
    </span><span class="k" data-group-id="1868601578-7">end</span><span class="w">
  </span><span class="p" data-group-id="1868601578-3">}</span><span class="w">
  
  </span><span class="c1"># Permission predicates</span><span class="w">
  </span><span class="n">permissions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="1868601578-9">%{</span><span class="w">
    </span><span class="ss">can_read</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="1868601578-10">fn</span><span class="w"> </span><span class="n">resource</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
      </span><span class="n">resource</span><span class="o">.</span><span class="n">visibility</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">:public</span><span class="w"> </span><span class="ow">or</span><span class="w">
      </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">or_any</span><span class="p" data-group-id="1868601578-11">(</span><span class="p" data-group-id="1868601578-12">[</span><span class="w">
        </span><span class="n">roles</span><span class="o">.</span><span class="n">is_admin</span><span class="p">,</span><span class="w">
        </span><span class="n">roles</span><span class="o">.</span><span class="n">is_owner</span><span class="o">.</span><span class="p" data-group-id="1868601578-13">(</span><span class="n">resource</span><span class="p" data-group-id="1868601578-13">)</span><span class="p">,</span><span class="w">
        </span><span class="n">roles</span><span class="o">.</span><span class="n">is_collaborator</span><span class="o">.</span><span class="p" data-group-id="1868601578-14">(</span><span class="n">resource</span><span class="p" data-group-id="1868601578-14">)</span><span class="w">
      </span><span class="p" data-group-id="1868601578-12">]</span><span class="p" data-group-id="1868601578-11">)</span><span class="o">.</span><span class="p" data-group-id="1868601578-15">(</span><span class="n">user</span><span class="p" data-group-id="1868601578-15">)</span><span class="w">
    </span><span class="k" data-group-id="1868601578-10">end</span><span class="p">,</span><span class="w">
    
    </span><span class="ss">can_write</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="1868601578-16">fn</span><span class="w"> </span><span class="n">resource</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
      </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">or_any</span><span class="p" data-group-id="1868601578-17">(</span><span class="p" data-group-id="1868601578-18">[</span><span class="w">
        </span><span class="n">roles</span><span class="o">.</span><span class="n">is_admin</span><span class="p">,</span><span class="w">
        </span><span class="n">roles</span><span class="o">.</span><span class="n">is_moderator</span><span class="p">,</span><span class="w">
        </span><span class="n">roles</span><span class="o">.</span><span class="n">is_owner</span><span class="o">.</span><span class="p" data-group-id="1868601578-19">(</span><span class="n">resource</span><span class="p" data-group-id="1868601578-19">)</span><span class="w">
      </span><span class="p" data-group-id="1868601578-18">]</span><span class="p" data-group-id="1868601578-17">)</span><span class="o">.</span><span class="p" data-group-id="1868601578-20">(</span><span class="n">user</span><span class="p" data-group-id="1868601578-20">)</span><span class="w">
    </span><span class="k" data-group-id="1868601578-16">end</span><span class="p">,</span><span class="w">
    
    </span><span class="ss">can_delete</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="1868601578-21">fn</span><span class="w"> </span><span class="n">resource</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
      </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">or_any</span><span class="p" data-group-id="1868601578-22">(</span><span class="p" data-group-id="1868601578-23">[</span><span class="w">
        </span><span class="n">roles</span><span class="o">.</span><span class="n">is_admin</span><span class="p">,</span><span class="w">
        </span><span class="n">roles</span><span class="o">.</span><span class="n">is_owner</span><span class="o">.</span><span class="p" data-group-id="1868601578-24">(</span><span class="n">resource</span><span class="p" data-group-id="1868601578-24">)</span><span class="w">
      </span><span class="p" data-group-id="1868601578-23">]</span><span class="p" data-group-id="1868601578-22">)</span><span class="o">.</span><span class="p" data-group-id="1868601578-25">(</span><span class="n">user</span><span class="p" data-group-id="1868601578-25">)</span><span class="w">
    </span><span class="k" data-group-id="1868601578-21">end</span><span class="w">
  </span><span class="p" data-group-id="1868601578-9">}</span><span class="w">
  
  </span><span class="c1"># Context-aware validation</span><span class="w">
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">authorize_action</span><span class="p" data-group-id="1868601578-26">(</span><span class="n">action</span><span class="p">,</span><span class="w"> </span><span class="n">resource</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p" data-group-id="1868601578-26">)</span><span class="w"> </span><span class="k" data-group-id="1868601578-27">do</span><span class="w">
    </span><span class="n">action_predicate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="n">action</span><span class="w"> </span><span class="k" data-group-id="1868601578-28">do</span><span class="w">
      </span><span class="ss">:read</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">permissions</span><span class="o">.</span><span class="n">can_read</span><span class="o">.</span><span class="p" data-group-id="1868601578-29">(</span><span class="n">resource</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p" data-group-id="1868601578-29">)</span><span class="w">
      </span><span class="ss">:write</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">permissions</span><span class="o">.</span><span class="n">can_write</span><span class="o">.</span><span class="p" data-group-id="1868601578-30">(</span><span class="n">resource</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p" data-group-id="1868601578-30">)</span><span class="w">
      </span><span class="ss">:delete</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">permissions</span><span class="o">.</span><span class="n">can_delete</span><span class="o">.</span><span class="p" data-group-id="1868601578-31">(</span><span class="n">resource</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p" data-group-id="1868601578-31">)</span><span class="w">
    </span><span class="k" data-group-id="1868601578-28">end</span><span class="w">
    
    </span><span class="c1"># Additional context checks</span><span class="w">
    </span><span class="n">context_checks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="1868601578-32">(</span><span class="p" data-group-id="1868601578-33">[</span><span class="w">
      </span><span class="k" data-group-id="1868601578-34">fn</span><span class="w"> </span><span class="bp">_</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">:active</span><span class="w"> </span><span class="k" data-group-id="1868601578-34">end</span><span class="p">,</span><span class="w">
      </span><span class="k" data-group-id="1868601578-35">fn</span><span class="w"> </span><span class="bp">_</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">banned</span><span class="w"> </span><span class="k" data-group-id="1868601578-35">end</span><span class="p">,</span><span class="w">
      </span><span class="k" data-group-id="1868601578-36">fn</span><span class="w"> </span><span class="bp">_</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">resource</span><span class="o">.</span><span class="n">status</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="ss">:archived</span><span class="w"> </span><span class="k" data-group-id="1868601578-36">end</span><span class="w">
    </span><span class="p" data-group-id="1868601578-33">]</span><span class="p" data-group-id="1868601578-32">)</span><span class="w">
    
    </span><span class="n">final_check</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="1868601578-37">(</span><span class="p" data-group-id="1868601578-38">[</span><span class="w">
      </span><span class="k" data-group-id="1868601578-39">fn</span><span class="w"> </span><span class="bp">_</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">action_predicate</span><span class="w"> </span><span class="k" data-group-id="1868601578-39">end</span><span class="p">,</span><span class="w">
      </span><span class="n">context_checks</span><span class="w">
    </span><span class="p" data-group-id="1868601578-38">]</span><span class="p" data-group-id="1868601578-37">)</span><span class="w">
    
    </span><span class="n">final_check</span><span class="o">.</span><span class="p" data-group-id="1868601578-40">(</span><span class="n">user</span><span class="p" data-group-id="1868601578-40">)</span><span class="w">
  </span><span class="k" data-group-id="1868601578-27">end</span><span class="w">
  
  </span><span class="p" data-group-id="1868601578-41">%{</span><span class="ss">authorize</span><span class="p">:</span><span class="w"> </span><span class="o">&amp;</span><span class="n">authorize_action</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="ss">permissions</span><span class="p">:</span><span class="w"> </span><span class="n">permissions</span><span class="p">,</span><span class="w"> </span><span class="ss">roles</span><span class="p">:</span><span class="w"> </span><span class="n">roles</span><span class="p" data-group-id="1868601578-41">}</span><span class="w">
</span><span class="k" data-group-id="1868601578-2">end</span></code></pre><h3 id="filtering-pipeline-template" class="section-heading">
  <a href="#filtering-pipeline-template" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Filtering Pipeline Template</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="kd">def</span><span class="w"> </span><span class="nf">build_data_filtering_pipeline</span><span class="p" data-group-id="6000788367-1">(</span><span class="p" data-group-id="6000788367-1">)</span><span class="w"> </span><span class="k" data-group-id="6000788367-2">do</span><span class="w">
  </span><span class="c1"># Stage 1: Basic data quality filters</span><span class="w">
  </span><span class="n">quality_filters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="6000788367-3">%{</span><span class="w">
    </span><span class="ss">not_nil</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="6000788367-4">fn</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">is_nil</span><span class="p" data-group-id="6000788367-5">(</span><span class="n">item</span><span class="p" data-group-id="6000788367-5">)</span><span class="w"> </span><span class="k" data-group-id="6000788367-4">end</span><span class="p">,</span><span class="w">
    </span><span class="ss">has_required_fields</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="6000788367-6">fn</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> 
      </span><span class="p" data-group-id="6000788367-7">[</span><span class="ss">:id</span><span class="p">,</span><span class="w"> </span><span class="ss">:name</span><span class="p">,</span><span class="w"> </span><span class="ss">:created_at</span><span class="p" data-group-id="6000788367-7">]</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">all?</span><span class="p" data-group-id="6000788367-8">(</span><span class="k" data-group-id="6000788367-9">fn</span><span class="w"> </span><span class="n">field</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> 
        </span><span class="nc">Map</span><span class="o">.</span><span class="n">has_key?</span><span class="p" data-group-id="6000788367-10">(</span><span class="n">item</span><span class="p">,</span><span class="w"> </span><span class="n">field</span><span class="p" data-group-id="6000788367-10">)</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">is_nil</span><span class="p" data-group-id="6000788367-11">(</span><span class="n">item</span><span class="p" data-group-id="6000788367-12">[</span><span class="n">field</span><span class="p" data-group-id="6000788367-12">]</span><span class="p" data-group-id="6000788367-11">)</span><span class="w">
      </span><span class="k" data-group-id="6000788367-9">end</span><span class="p" data-group-id="6000788367-8">)</span><span class="w">
    </span><span class="k" data-group-id="6000788367-6">end</span><span class="p">,</span><span class="w">
    </span><span class="ss">valid_timestamps</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="6000788367-13">fn</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
      </span><span class="n">is_struct</span><span class="p" data-group-id="6000788367-14">(</span><span class="n">item</span><span class="o">.</span><span class="n">created_at</span><span class="p">,</span><span class="w"> </span><span class="nc">DateTime</span><span class="p" data-group-id="6000788367-14">)</span><span class="w"> </span><span class="ow">and</span><span class="w"> 
      </span><span class="nc">DateTime</span><span class="o">.</span><span class="n">compare</span><span class="p" data-group-id="6000788367-15">(</span><span class="n">item</span><span class="o">.</span><span class="n">created_at</span><span class="p">,</span><span class="w"> </span><span class="nc">DateTime</span><span class="o">.</span><span class="n">utc_now</span><span class="p" data-group-id="6000788367-16">(</span><span class="p" data-group-id="6000788367-16">)</span><span class="p" data-group-id="6000788367-15">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">:lt</span><span class="w">
    </span><span class="k" data-group-id="6000788367-13">end</span><span class="w">
  </span><span class="p" data-group-id="6000788367-3">}</span><span class="w">
  
  </span><span class="c1"># Stage 2: Business logic filters  </span><span class="w">
  </span><span class="n">business_filters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="6000788367-17">%{</span><span class="w">
    </span><span class="ss">active_status</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="6000788367-18">fn</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">item</span><span class="o">.</span><span class="n">status</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="p" data-group-id="6000788367-19">[</span><span class="ss">:active</span><span class="p">,</span><span class="w"> </span><span class="ss">:published</span><span class="p" data-group-id="6000788367-19">]</span><span class="w"> </span><span class="k" data-group-id="6000788367-18">end</span><span class="p">,</span><span class="w">
    </span><span class="ss">within_date_range</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="6000788367-20">fn</span><span class="w"> </span><span class="n">start_date</span><span class="p">,</span><span class="w"> </span><span class="n">end_date</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
      </span><span class="k" data-group-id="6000788367-21">fn</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
        </span><span class="nc">DateTime</span><span class="o">.</span><span class="n">compare</span><span class="p" data-group-id="6000788367-22">(</span><span class="n">item</span><span class="o">.</span><span class="n">created_at</span><span class="p">,</span><span class="w"> </span><span class="n">start_date</span><span class="p" data-group-id="6000788367-22">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="ss">:lt</span><span class="w"> </span><span class="ow">and</span><span class="w">
        </span><span class="nc">DateTime</span><span class="o">.</span><span class="n">compare</span><span class="p" data-group-id="6000788367-23">(</span><span class="n">item</span><span class="o">.</span><span class="n">created_at</span><span class="p">,</span><span class="w"> </span><span class="n">end_date</span><span class="p" data-group-id="6000788367-23">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="ss">:gt</span><span class="w">
      </span><span class="k" data-group-id="6000788367-21">end</span><span class="w">
    </span><span class="k" data-group-id="6000788367-20">end</span><span class="p">,</span><span class="w">
    </span><span class="ss">meets_threshold</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="6000788367-24">fn</span><span class="w"> </span><span class="n">threshold_field</span><span class="p">,</span><span class="w"> </span><span class="n">min_value</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
      </span><span class="k" data-group-id="6000788367-25">fn</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
        </span><span class="nc">Map</span><span class="o">.</span><span class="n">get</span><span class="p" data-group-id="6000788367-26">(</span><span class="n">item</span><span class="p">,</span><span class="w"> </span><span class="n">threshold_field</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="6000788367-26">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">min_value</span><span class="w">
      </span><span class="k" data-group-id="6000788367-25">end</span><span class="w">
    </span><span class="k" data-group-id="6000788367-24">end</span><span class="w">
  </span><span class="p" data-group-id="6000788367-17">}</span><span class="w">
  
  </span><span class="c1"># Stage 3: User-specific filters</span><span class="w">
  </span><span class="n">user_filters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="6000788367-27">%{</span><span class="w">
    </span><span class="ss">user_can_see</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="6000788367-28">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
      </span><span class="k" data-group-id="6000788367-29">fn</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
        </span><span class="n">item</span><span class="o">.</span><span class="n">visibility</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">:public</span><span class="w"> </span><span class="ow">or</span><span class="w"> 
        </span><span class="n">item</span><span class="o">.</span><span class="n">owner_id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="w"> </span><span class="ow">or</span><span class="w">
        </span><span class="n">user</span><span class="o">.</span><span class="n">role</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="p" data-group-id="6000788367-30">[</span><span class="ss">:admin</span><span class="p">,</span><span class="w"> </span><span class="ss">:moderator</span><span class="p" data-group-id="6000788367-30">]</span><span class="w">
      </span><span class="k" data-group-id="6000788367-29">end</span><span class="w">
    </span><span class="k" data-group-id="6000788367-28">end</span><span class="p">,</span><span class="w">
    </span><span class="ss">not_blocked_by_user</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="6000788367-31">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
      </span><span class="k" data-group-id="6000788367-32">fn</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
        </span><span class="ow">not</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">member?</span><span class="p" data-group-id="6000788367-33">(</span><span class="n">user</span><span class="o">.</span><span class="n">blocked_ids</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p" data-group-id="6000788367-34">[</span><span class="p" data-group-id="6000788367-34">]</span><span class="p">,</span><span class="w"> </span><span class="n">item</span><span class="o">.</span><span class="n">owner_id</span><span class="p" data-group-id="6000788367-33">)</span><span class="w">
      </span><span class="k" data-group-id="6000788367-32">end</span><span class="w">
    </span><span class="k" data-group-id="6000788367-31">end</span><span class="w">
  </span><span class="p" data-group-id="6000788367-27">}</span><span class="w">
  
  </span><span class="c1"># Compose filtering pipeline</span><span class="w">
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">create_filter_pipeline</span><span class="p" data-group-id="6000788367-35">(</span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="n">options</span><span class="w"> </span><span class="o">\\</span><span class="w"> </span><span class="p" data-group-id="6000788367-36">%{</span><span class="p" data-group-id="6000788367-36">}</span><span class="p" data-group-id="6000788367-35">)</span><span class="w"> </span><span class="k" data-group-id="6000788367-37">do</span><span class="w">
    </span><span class="c1"># Basic quality checks (always applied)</span><span class="w">
    </span><span class="n">basic_quality</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="6000788367-38">(</span><span class="p" data-group-id="6000788367-39">[</span><span class="w">
      </span><span class="n">quality_filters</span><span class="o">.</span><span class="n">not_nil</span><span class="p">,</span><span class="w">
      </span><span class="n">quality_filters</span><span class="o">.</span><span class="n">has_required_fields</span><span class="p">,</span><span class="w">
      </span><span class="n">quality_filters</span><span class="o">.</span><span class="n">valid_timestamps</span><span class="w">
    </span><span class="p" data-group-id="6000788367-39">]</span><span class="p" data-group-id="6000788367-38">)</span><span class="w">
    
    </span><span class="c1"># Business logic filters</span><span class="w">
    </span><span class="n">business_logic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="6000788367-40">[</span><span class="w">
      </span><span class="n">business_filters</span><span class="o">.</span><span class="n">active_status</span><span class="p">,</span><span class="w">
      </span><span class="n">business_filters</span><span class="o">.</span><span class="n">within_date_range</span><span class="o">.</span><span class="p" data-group-id="6000788367-41">(</span><span class="w">
        </span><span class="n">options</span><span class="p" data-group-id="6000788367-42">[</span><span class="ss">:start_date</span><span class="p" data-group-id="6000788367-42">]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nc">DateTime</span><span class="o">.</span><span class="n">add</span><span class="p" data-group-id="6000788367-43">(</span><span class="nc">DateTime</span><span class="o">.</span><span class="n">utc_now</span><span class="p" data-group-id="6000788367-44">(</span><span class="p" data-group-id="6000788367-44">)</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="ss">:day</span><span class="p" data-group-id="6000788367-43">)</span><span class="p">,</span><span class="w">
        </span><span class="n">options</span><span class="p" data-group-id="6000788367-45">[</span><span class="ss">:end_date</span><span class="p" data-group-id="6000788367-45">]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nc">DateTime</span><span class="o">.</span><span class="n">utc_now</span><span class="p" data-group-id="6000788367-46">(</span><span class="p" data-group-id="6000788367-46">)</span><span class="w">
      </span><span class="p" data-group-id="6000788367-41">)</span><span class="p">,</span><span class="w">
      </span><span class="n">business_filters</span><span class="o">.</span><span class="n">meets_threshold</span><span class="o">.</span><span class="p" data-group-id="6000788367-47">(</span><span class="ss">:score</span><span class="p">,</span><span class="w"> </span><span class="n">options</span><span class="p" data-group-id="6000788367-48">[</span><span class="ss">:min_score</span><span class="p" data-group-id="6000788367-48">]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="6000788367-47">)</span><span class="w">
    </span><span class="p" data-group-id="6000788367-40">]</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="6000788367-49">(</span><span class="p" data-group-id="6000788367-49">)</span><span class="w">
    
    </span><span class="c1"># User-specific filters</span><span class="w">
    </span><span class="n">user_specific</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="6000788367-50">(</span><span class="p" data-group-id="6000788367-51">[</span><span class="w">
      </span><span class="n">user_filters</span><span class="o">.</span><span class="n">user_can_see</span><span class="o">.</span><span class="p" data-group-id="6000788367-52">(</span><span class="n">user</span><span class="p" data-group-id="6000788367-52">)</span><span class="p">,</span><span class="w">
      </span><span class="n">user_filters</span><span class="o">.</span><span class="n">not_blocked_by_user</span><span class="o">.</span><span class="p" data-group-id="6000788367-53">(</span><span class="n">user</span><span class="p" data-group-id="6000788367-53">)</span><span class="w">
    </span><span class="p" data-group-id="6000788367-51">]</span><span class="p" data-group-id="6000788367-50">)</span><span class="w">
    
    </span><span class="c1"># Complete pipeline</span><span class="w">
    </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="6000788367-54">(</span><span class="p" data-group-id="6000788367-55">[</span><span class="n">basic_quality</span><span class="p">,</span><span class="w"> </span><span class="n">business_logic</span><span class="p">,</span><span class="w"> </span><span class="n">user_specific</span><span class="p" data-group-id="6000788367-55">]</span><span class="p" data-group-id="6000788367-54">)</span><span class="w">
  </span><span class="k" data-group-id="6000788367-37">end</span><span class="w">
  
  </span><span class="c1"># Usage helper</span><span class="w">
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">filter_data</span><span class="p" data-group-id="6000788367-56">(</span><span class="n">data_list</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="n">options</span><span class="w"> </span><span class="o">\\</span><span class="w"> </span><span class="p" data-group-id="6000788367-57">%{</span><span class="p" data-group-id="6000788367-57">}</span><span class="p" data-group-id="6000788367-56">)</span><span class="w"> </span><span class="k" data-group-id="6000788367-58">do</span><span class="w">
    </span><span class="n">pipeline</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">create_filter_pipeline</span><span class="p" data-group-id="6000788367-59">(</span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="n">options</span><span class="p" data-group-id="6000788367-59">)</span><span class="w">
    </span><span class="nc">Enum</span><span class="o">.</span><span class="n">filter</span><span class="p" data-group-id="6000788367-60">(</span><span class="n">data_list</span><span class="p">,</span><span class="w"> </span><span class="n">pipeline</span><span class="p" data-group-id="6000788367-60">)</span><span class="w">
  </span><span class="k" data-group-id="6000788367-58">end</span><span class="w">
  
  </span><span class="p" data-group-id="6000788367-61">%{</span><span class="w">
    </span><span class="ss">create_pipeline</span><span class="p">:</span><span class="w"> </span><span class="o">&amp;</span><span class="n">create_filter_pipeline</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="w">
    </span><span class="ss">filter_data</span><span class="p">:</span><span class="w"> </span><span class="o">&amp;</span><span class="n">filter_data</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span><span class="w">
    </span><span class="ss">individual_filters</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="6000788367-62">%{</span><span class="w">
      </span><span class="ss">quality</span><span class="p">:</span><span class="w"> </span><span class="n">quality_filters</span><span class="p">,</span><span class="w">
      </span><span class="ss">business</span><span class="p">:</span><span class="w"> </span><span class="n">business_filters</span><span class="p">,</span><span class="w">
      </span><span class="ss">user</span><span class="p">:</span><span class="w"> </span><span class="n">user_filters</span><span class="w">
    </span><span class="p" data-group-id="6000788367-62">}</span><span class="w">
  </span><span class="p" data-group-id="6000788367-61">}</span><span class="w">
</span><span class="k" data-group-id="6000788367-2">end</span></code></pre><h3 id="business-rules-template" class="section-heading">
  <a href="#business-rules-template" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Business Rules Template</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="kd">def</span><span class="w"> </span><span class="nf">build_business_rules_engine</span><span class="p" data-group-id="1969672862-1">(</span><span class="p" data-group-id="1969672862-1">)</span><span class="w"> </span><span class="k" data-group-id="1969672862-2">do</span><span class="w">
  </span><span class="c1"># Domain-specific predicates</span><span class="w">
  </span><span class="n">customer_rules</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="1969672862-3">%{</span><span class="w">
    </span><span class="ss">is_premium</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="1969672862-4">fn</span><span class="w"> </span><span class="n">customer</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">customer</span><span class="o">.</span><span class="n">tier</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">:premium</span><span class="w"> </span><span class="k" data-group-id="1969672862-4">end</span><span class="p">,</span><span class="w">
    </span><span class="ss">account_in_good_standing</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="1969672862-5">fn</span><span class="w"> </span><span class="n">customer</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> 
      </span><span class="n">customer</span><span class="o">.</span><span class="n">balance</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">customer</span><span class="o">.</span><span class="n">past_due_count</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">3</span><span class="w">
    </span><span class="k" data-group-id="1969672862-5">end</span><span class="p">,</span><span class="w">
    </span><span class="ss">region_eligible</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="1969672862-6">fn</span><span class="w"> </span><span class="n">allowed_regions</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
      </span><span class="k" data-group-id="1969672862-7">fn</span><span class="w"> </span><span class="n">customer</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">member?</span><span class="p" data-group-id="1969672862-8">(</span><span class="n">allowed_regions</span><span class="p">,</span><span class="w"> </span><span class="n">customer</span><span class="o">.</span><span class="n">region</span><span class="p" data-group-id="1969672862-8">)</span><span class="w"> </span><span class="k" data-group-id="1969672862-7">end</span><span class="w">
    </span><span class="k" data-group-id="1969672862-6">end</span><span class="p">,</span><span class="w">
    </span><span class="ss">loyalty_member</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="1969672862-9">fn</span><span class="w"> </span><span class="n">min_months</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
      </span><span class="k" data-group-id="1969672862-10">fn</span><span class="w"> </span><span class="n">customer</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
        </span><span class="n">months_active</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">DateTime</span><span class="o">.</span><span class="n">diff</span><span class="p" data-group-id="1969672862-11">(</span><span class="nc">DateTime</span><span class="o">.</span><span class="n">utc_now</span><span class="p" data-group-id="1969672862-12">(</span><span class="p" data-group-id="1969672862-12">)</span><span class="p">,</span><span class="w"> </span><span class="n">customer</span><span class="o">.</span><span class="n">signup_date</span><span class="p">,</span><span class="w"> </span><span class="ss">:day</span><span class="p" data-group-id="1969672862-11">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">30</span><span class="w">
        </span><span class="n">months_active</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">min_months</span><span class="w">
      </span><span class="k" data-group-id="1969672862-10">end</span><span class="w">
    </span><span class="k" data-group-id="1969672862-9">end</span><span class="w">
  </span><span class="p" data-group-id="1969672862-3">}</span><span class="w">
  
  </span><span class="n">order_rules</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="1969672862-13">%{</span><span class="w">
    </span><span class="ss">within_limits</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="1969672862-14">fn</span><span class="w"> </span><span class="n">customer</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
      </span><span class="k" data-group-id="1969672862-15">fn</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
        </span><span class="n">daily_total</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">CustomerService</span><span class="o">.</span><span class="n">daily_order_total</span><span class="p" data-group-id="1969672862-16">(</span><span class="n">customer</span><span class="o">.</span><span class="n">id</span><span class="p" data-group-id="1969672862-16">)</span><span class="w">
        </span><span class="p" data-group-id="1969672862-17">(</span><span class="n">daily_total</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">order</span><span class="o">.</span><span class="n">amount</span><span class="p" data-group-id="1969672862-17">)</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">customer</span><span class="o">.</span><span class="n">daily_limit</span><span class="w">
      </span><span class="k" data-group-id="1969672862-15">end</span><span class="w">
    </span><span class="k" data-group-id="1969672862-14">end</span><span class="p">,</span><span class="w">
    </span><span class="ss">valid_items</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="1969672862-18">fn</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
      </span><span class="nc">Enum</span><span class="o">.</span><span class="n">all?</span><span class="p" data-group-id="1969672862-19">(</span><span class="n">order</span><span class="o">.</span><span class="n">items</span><span class="p">,</span><span class="w"> </span><span class="k" data-group-id="1969672862-20">fn</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
        </span><span class="n">item</span><span class="o">.</span><span class="n">quantity</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">item</span><span class="o">.</span><span class="n">price</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">item</span><span class="o">.</span><span class="n">discontinued</span><span class="w">
      </span><span class="k" data-group-id="1969672862-20">end</span><span class="p" data-group-id="1969672862-19">)</span><span class="w">
    </span><span class="k" data-group-id="1969672862-18">end</span><span class="p">,</span><span class="w">
    </span><span class="ss">shipping_available</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="1969672862-21">fn</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
      </span><span class="nc">ShippingService</span><span class="o">.</span><span class="n">can_ship_to?</span><span class="p" data-group-id="1969672862-22">(</span><span class="n">order</span><span class="o">.</span><span class="n">shipping_address</span><span class="p" data-group-id="1969672862-22">)</span><span class="w">
    </span><span class="k" data-group-id="1969672862-21">end</span><span class="w">
  </span><span class="p" data-group-id="1969672862-13">}</span><span class="w">
  
  </span><span class="c1"># Compose complex business rules</span><span class="w">
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">create_order_validation_rules</span><span class="p" data-group-id="1969672862-23">(</span><span class="n">promotions</span><span class="w"> </span><span class="o">\\</span><span class="w"> </span><span class="p" data-group-id="1969672862-24">[</span><span class="p" data-group-id="1969672862-24">]</span><span class="p" data-group-id="1969672862-23">)</span><span class="w"> </span><span class="k" data-group-id="1969672862-25">do</span><span class="w">
    </span><span class="c1"># Base eligibility rules</span><span class="w">
    </span><span class="n">customer_eligible</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="1969672862-26">(</span><span class="p" data-group-id="1969672862-27">[</span><span class="w">
      </span><span class="n">customer_rules</span><span class="o">.</span><span class="n">account_in_good_standing</span><span class="p">,</span><span class="w">
      </span><span class="n">customer_rules</span><span class="o">.</span><span class="n">region_eligible</span><span class="o">.</span><span class="p" data-group-id="1969672862-28">(</span><span class="p" data-group-id="1969672862-29">[</span><span class="ss">:us</span><span class="p">,</span><span class="w"> </span><span class="ss">:ca</span><span class="p">,</span><span class="w"> </span><span class="ss">:uk</span><span class="p" data-group-id="1969672862-29">]</span><span class="p" data-group-id="1969672862-28">)</span><span class="w">
    </span><span class="p" data-group-id="1969672862-27">]</span><span class="p" data-group-id="1969672862-26">)</span><span class="w">
    
    </span><span class="c1"># Order validation rules</span><span class="w">
    </span><span class="n">order_valid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="1969672862-30">(</span><span class="p" data-group-id="1969672862-31">[</span><span class="w">
      </span><span class="n">order_rules</span><span class="o">.</span><span class="n">valid_items</span><span class="p">,</span><span class="w">
      </span><span class="n">order_rules</span><span class="o">.</span><span class="n">shipping_available</span><span class="w">
    </span><span class="p" data-group-id="1969672862-31">]</span><span class="p" data-group-id="1969672862-30">)</span><span class="w">
    
    </span><span class="c1"># Dynamic promotion rules</span><span class="w">
    </span><span class="n">promotion_rules</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">promotions</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">map</span><span class="p" data-group-id="1969672862-32">(</span><span class="k" data-group-id="1969672862-33">fn</span><span class="w"> </span><span class="n">promo</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
      </span><span class="k">case</span><span class="w"> </span><span class="n">promo</span><span class="o">.</span><span class="n">type</span><span class="w"> </span><span class="k" data-group-id="1969672862-34">do</span><span class="w">
        </span><span class="ss">:loyalty</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> 
          </span><span class="n">customer_rules</span><span class="o">.</span><span class="n">loyalty_member</span><span class="o">.</span><span class="p" data-group-id="1969672862-35">(</span><span class="n">promo</span><span class="o">.</span><span class="n">min_months</span><span class="p" data-group-id="1969672862-35">)</span><span class="w">
        </span><span class="ss">:premium</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> 
          </span><span class="n">customer_rules</span><span class="o">.</span><span class="n">is_premium</span><span class="w">
        </span><span class="ss">:volume</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
          </span><span class="k" data-group-id="1969672862-36">fn</span><span class="w"> </span><span class="n">customer</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> 
            </span><span class="k" data-group-id="1969672862-37">fn</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> 
              </span><span class="n">order</span><span class="o">.</span><span class="n">amount</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">promo</span><span class="o">.</span><span class="n">min_amount</span><span class="w">
            </span><span class="k" data-group-id="1969672862-37">end</span><span class="w">
          </span><span class="k" data-group-id="1969672862-36">end</span><span class="w">
      </span><span class="k" data-group-id="1969672862-34">end</span><span class="w">
    </span><span class="k" data-group-id="1969672862-33">end</span><span class="p" data-group-id="1969672862-32">)</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">or_any</span><span class="p" data-group-id="1969672862-38">(</span><span class="p" data-group-id="1969672862-38">)</span><span class="w">  </span><span class="c1"># Any promotion can apply</span><span class="w">
    
    </span><span class="c1"># Combine all rules</span><span class="w">
    </span><span class="p" data-group-id="1969672862-39">%{</span><span class="w">
      </span><span class="ss">can_place_order</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="1969672862-40">fn</span><span class="w"> </span><span class="n">customer</span><span class="p">,</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
        </span><span class="n">basic_rules</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="1969672862-41">(</span><span class="p" data-group-id="1969672862-42">[</span><span class="w">
          </span><span class="k" data-group-id="1969672862-43">fn</span><span class="w"> </span><span class="bp">_</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">customer_eligible</span><span class="o">.</span><span class="p" data-group-id="1969672862-44">(</span><span class="n">customer</span><span class="p" data-group-id="1969672862-44">)</span><span class="w"> </span><span class="k" data-group-id="1969672862-43">end</span><span class="p">,</span><span class="w">
          </span><span class="k" data-group-id="1969672862-45">fn</span><span class="w"> </span><span class="bp">_</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">order_valid</span><span class="o">.</span><span class="p" data-group-id="1969672862-46">(</span><span class="n">order</span><span class="p" data-group-id="1969672862-46">)</span><span class="w"> </span><span class="k" data-group-id="1969672862-45">end</span><span class="p">,</span><span class="w">
          </span><span class="n">order_rules</span><span class="o">.</span><span class="n">within_limits</span><span class="o">.</span><span class="p" data-group-id="1969672862-47">(</span><span class="n">customer</span><span class="p" data-group-id="1969672862-47">)</span><span class="w">
        </span><span class="p" data-group-id="1969672862-42">]</span><span class="p" data-group-id="1969672862-41">)</span><span class="w">
        </span><span class="n">basic_rules</span><span class="o">.</span><span class="p" data-group-id="1969672862-48">(</span><span class="n">order</span><span class="p" data-group-id="1969672862-48">)</span><span class="w">
      </span><span class="k" data-group-id="1969672862-40">end</span><span class="p">,</span><span class="w">
      
      </span><span class="ss">eligible_for_promotions</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="1969672862-49">fn</span><span class="w"> </span><span class="n">customer</span><span class="p">,</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
        </span><span class="n">promotion_check</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">promotion_rules</span><span class="o">.</span><span class="p" data-group-id="1969672862-50">(</span><span class="n">customer</span><span class="p" data-group-id="1969672862-50">)</span><span class="w">
        </span><span class="n">promotion_check</span><span class="o">.</span><span class="p" data-group-id="1969672862-51">(</span><span class="n">order</span><span class="p" data-group-id="1969672862-51">)</span><span class="w">
      </span><span class="k" data-group-id="1969672862-49">end</span><span class="p">,</span><span class="w">
      
      </span><span class="ss">complete_validation</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="1969672862-52">fn</span><span class="w"> </span><span class="n">customer</span><span class="p">,</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
        </span><span class="n">all_rules</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="1969672862-53">(</span><span class="p" data-group-id="1969672862-54">[</span><span class="w">
          </span><span class="k" data-group-id="1969672862-55">fn</span><span class="w"> </span><span class="bp">_</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">customer_eligible</span><span class="o">.</span><span class="p" data-group-id="1969672862-56">(</span><span class="n">customer</span><span class="p" data-group-id="1969672862-56">)</span><span class="w"> </span><span class="k" data-group-id="1969672862-55">end</span><span class="p">,</span><span class="w">
          </span><span class="k" data-group-id="1969672862-57">fn</span><span class="w"> </span><span class="bp">_</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">order_valid</span><span class="o">.</span><span class="p" data-group-id="1969672862-58">(</span><span class="n">order</span><span class="p" data-group-id="1969672862-58">)</span><span class="w"> </span><span class="k" data-group-id="1969672862-57">end</span><span class="p">,</span><span class="w">
          </span><span class="n">order_rules</span><span class="o">.</span><span class="n">within_limits</span><span class="o">.</span><span class="p" data-group-id="1969672862-59">(</span><span class="n">customer</span><span class="p" data-group-id="1969672862-59">)</span><span class="w">
        </span><span class="p" data-group-id="1969672862-54">]</span><span class="p" data-group-id="1969672862-53">)</span><span class="w">
        
        </span><span class="p" data-group-id="1969672862-60">{</span><span class="n">all_rules</span><span class="o">.</span><span class="p" data-group-id="1969672862-61">(</span><span class="n">order</span><span class="p" data-group-id="1969672862-61">)</span><span class="p">,</span><span class="w"> </span><span class="n">promotion_rules</span><span class="o">.</span><span class="p" data-group-id="1969672862-62">(</span><span class="n">customer</span><span class="p" data-group-id="1969672862-62">)</span><span class="o">.</span><span class="p" data-group-id="1969672862-63">(</span><span class="n">order</span><span class="p" data-group-id="1969672862-63">)</span><span class="p" data-group-id="1969672862-60">}</span><span class="w">
      </span><span class="k" data-group-id="1969672862-52">end</span><span class="w">
    </span><span class="p" data-group-id="1969672862-39">}</span><span class="w">
  </span><span class="k" data-group-id="1969672862-25">end</span><span class="w">
  
  </span><span class="p" data-group-id="1969672862-64">%{</span><span class="w">
    </span><span class="ss">customer_rules</span><span class="p">:</span><span class="w"> </span><span class="n">customer_rules</span><span class="p">,</span><span class="w">
    </span><span class="ss">order_rules</span><span class="p">:</span><span class="w"> </span><span class="n">order_rules</span><span class="p">,</span><span class="w">
    </span><span class="ss">create_validation</span><span class="p">:</span><span class="w"> </span><span class="o">&amp;</span><span class="n">create_order_validation_rules</span><span class="o">/</span><span class="mi">1</span><span class="w">
  </span><span class="p" data-group-id="1969672862-64">}</span><span class="w">
</span><span class="k" data-group-id="1969672862-2">end</span></code></pre><h2 id="llm-performance-considerations" class="section-heading">
  <a href="#llm-performance-considerations" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">LLM Performance Considerations</span>
</h2>
<h3 id="short-circuiting-behavior" class="section-heading">
  <a href="#short-circuiting-behavior" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Short-Circuiting Behavior</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="c1"># ✅ Good: Cheap predicates first</span><span class="w">
</span><span class="n">efficient_validation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="5122192562-1">(</span><span class="p" data-group-id="5122192562-2">[</span><span class="w">
  </span><span class="k" data-group-id="5122192562-3">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">is_nil</span><span class="p" data-group-id="5122192562-4">(</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p" data-group-id="5122192562-4">)</span><span class="w"> </span><span class="k" data-group-id="5122192562-3">end</span><span class="p">,</span><span class="w">           </span><span class="c1"># Very fast</span><span class="w">
  </span><span class="k" data-group-id="5122192562-5">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">String</span><span class="o">.</span><span class="n">length</span><span class="p" data-group-id="5122192562-6">(</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p" data-group-id="5122192562-6">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="k" data-group-id="5122192562-5">end</span><span class="p">,</span><span class="w"> </span><span class="c1"># Fast</span><span class="w">
  </span><span class="k" data-group-id="5122192562-7">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">Database</span><span class="o">.</span><span class="n">user_exists?</span><span class="p" data-group-id="5122192562-8">(</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p" data-group-id="5122192562-8">)</span><span class="w"> </span><span class="k" data-group-id="5122192562-7">end</span><span class="w">  </span><span class="c1"># Expensive - last</span><span class="w">
</span><span class="p" data-group-id="5122192562-2">]</span><span class="p" data-group-id="5122192562-1">)</span><span class="w">

</span><span class="c1"># ❌ Less efficient: Expensive predicate first</span><span class="w">
</span><span class="n">inefficient_validation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="5122192562-9">(</span><span class="p" data-group-id="5122192562-10">[</span><span class="w">
  </span><span class="k" data-group-id="5122192562-11">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">Database</span><span class="o">.</span><span class="n">user_exists?</span><span class="p" data-group-id="5122192562-12">(</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p" data-group-id="5122192562-12">)</span><span class="w"> </span><span class="k" data-group-id="5122192562-11">end</span><span class="p">,</span><span class="w"> </span><span class="c1"># Expensive - runs every time</span><span class="w">
  </span><span class="k" data-group-id="5122192562-13">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">is_nil</span><span class="p" data-group-id="5122192562-14">(</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p" data-group-id="5122192562-14">)</span><span class="w"> </span><span class="k" data-group-id="5122192562-13">end</span><span class="w">            </span><span class="c1"># Fast - but too late</span><span class="w">
</span><span class="p" data-group-id="5122192562-10">]</span><span class="p" data-group-id="5122192562-9">)</span></code></pre><h3 id="predicate-memoization" class="section-heading">
  <a href="#predicate-memoization" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Predicate Memoization</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="c1"># For expensive predicates that are reused</span><span class="w">
</span><span class="kd">def</span><span class="w"> </span><span class="nf">create_memoized_predicate</span><span class="p" data-group-id="1835545535-1">(</span><span class="n">expensive_fn</span><span class="p" data-group-id="1835545535-1">)</span><span class="w"> </span><span class="k" data-group-id="1835545535-2">do</span><span class="w">
  </span><span class="n">cache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Agent</span><span class="o">.</span><span class="n">start_link</span><span class="p" data-group-id="1835545535-3">(</span><span class="k" data-group-id="1835545535-4">fn</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p" data-group-id="1835545535-5">%{</span><span class="p" data-group-id="1835545535-5">}</span><span class="w"> </span><span class="k" data-group-id="1835545535-4">end</span><span class="p" data-group-id="1835545535-3">)</span><span class="w">
  
  </span><span class="k" data-group-id="1835545535-6">fn</span><span class="w"> </span><span class="n">input</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
    </span><span class="nc">Agent</span><span class="o">.</span><span class="n">get_and_update</span><span class="p" data-group-id="1835545535-7">(</span><span class="n">cache</span><span class="p">,</span><span class="w"> </span><span class="k" data-group-id="1835545535-8">fn</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
      </span><span class="k">case</span><span class="w"> </span><span class="nc">Map</span><span class="o">.</span><span class="n">get</span><span class="p" data-group-id="1835545535-9">(</span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="n">input</span><span class="p" data-group-id="1835545535-9">)</span><span class="w"> </span><span class="k" data-group-id="1835545535-10">do</span><span class="w">
        </span><span class="no">nil</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> 
          </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">expensive_fn</span><span class="o">.</span><span class="p" data-group-id="1835545535-11">(</span><span class="n">input</span><span class="p" data-group-id="1835545535-11">)</span><span class="w">
          </span><span class="p" data-group-id="1835545535-12">{</span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="nc">Map</span><span class="o">.</span><span class="n">put</span><span class="p" data-group-id="1835545535-13">(</span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="n">input</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p" data-group-id="1835545535-13">)</span><span class="p" data-group-id="1835545535-12">}</span><span class="w">
        </span><span class="n">cached_result</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> 
          </span><span class="p" data-group-id="1835545535-14">{</span><span class="n">cached_result</span><span class="p">,</span><span class="w"> </span><span class="n">state</span><span class="p" data-group-id="1835545535-14">}</span><span class="w">
      </span><span class="k" data-group-id="1835545535-10">end</span><span class="w">
    </span><span class="k" data-group-id="1835545535-8">end</span><span class="p" data-group-id="1835545535-7">)</span><span class="w">
  </span><span class="k" data-group-id="1835545535-6">end</span><span class="w">
</span><span class="k" data-group-id="1835545535-2">end</span><span class="w">

</span><span class="c1"># Usage</span><span class="w">
</span><span class="n">expensive_check</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">create_memoized_predicate</span><span class="p" data-group-id="1835545535-15">(</span><span class="k" data-group-id="1835545535-16">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> 
  </span><span class="c1"># Expensive operation here</span><span class="w">
  </span><span class="nc">ExternalAPI</span><span class="o">.</span><span class="n">validate_user</span><span class="p" data-group-id="1835545535-17">(</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p" data-group-id="1835545535-17">)</span><span class="w">
</span><span class="k" data-group-id="1835545535-16">end</span><span class="p" data-group-id="1835545535-15">)</span><span class="w">

</span><span class="n">validation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="1835545535-18">(</span><span class="p" data-group-id="1835545535-19">[</span><span class="n">basic_checks</span><span class="p">,</span><span class="w"> </span><span class="n">expensive_check</span><span class="p" data-group-id="1835545535-19">]</span><span class="p" data-group-id="1835545535-18">)</span></code></pre><h2 id="llm-interop-patterns" class="section-heading">
  <a href="#llm-interop-patterns" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">LLM Interop Patterns</span>
</h2>
<h3 id="with-funx-utils" class="section-heading">
  <a href="#with-funx-utils" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">With Funx.Utils</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="kd">def</span><span class="w"> </span><span class="nf">build_utils_integration</span><span class="p" data-group-id="2760659865-1">(</span><span class="p" data-group-id="2760659865-1">)</span><span class="w"> </span><span class="k" data-group-id="2760659865-2">do</span><span class="w">
  </span><span class="c1"># Create predicate functions for pipeline use</span><span class="w">
  </span><span class="c1"># Note: Predicates are functions that can be called directly</span><span class="w">
  
  </span><span class="c1"># Create reusable predicates</span><span class="w">
  </span><span class="n">test_adult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="2760659865-3">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">age</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">18</span><span class="w"> </span><span class="k" data-group-id="2760659865-3">end</span><span class="w">
  </span><span class="n">test_active</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="2760659865-4">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">:active</span><span class="w"> </span><span class="k" data-group-id="2760659865-4">end</span><span class="w">
  </span><span class="n">test_verified</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="2760659865-5">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">verified</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">true</span><span class="w"> </span><span class="k" data-group-id="2760659865-5">end</span><span class="w">
  
  </span><span class="c1"># Use in pipelines</span><span class="w">
  </span><span class="n">users</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="2760659865-6">[</span><span class="p" data-group-id="2760659865-7">%{</span><span class="ss">age</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span><span class="w"> </span><span class="ss">status</span><span class="p">:</span><span class="w"> </span><span class="ss">:active</span><span class="p">,</span><span class="w"> </span><span class="ss">verified</span><span class="p">:</span><span class="w"> </span><span class="no">true</span><span class="p" data-group-id="2760659865-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="2760659865-8">%{</span><span class="ss">age</span><span class="p">:</span><span class="w"> </span><span class="mi">17</span><span class="p">,</span><span class="w"> </span><span class="ss">status</span><span class="p">:</span><span class="w"> </span><span class="ss">:inactive</span><span class="p">,</span><span class="w"> </span><span class="ss">verified</span><span class="p">:</span><span class="w"> </span><span class="no">false</span><span class="p" data-group-id="2760659865-8">}</span><span class="p" data-group-id="2760659865-6">]</span><span class="w">
  
  </span><span class="n">adults</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">filter</span><span class="p" data-group-id="2760659865-9">(</span><span class="n">test_adult</span><span class="p" data-group-id="2760659865-9">)</span><span class="w">
  </span><span class="n">active_users</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">filter</span><span class="p" data-group-id="2760659865-10">(</span><span class="n">test_active</span><span class="p" data-group-id="2760659865-10">)</span><span class="w">
  
  </span><span class="c1"># Compose with other Utils functions</span><span class="w">
  </span><span class="n">filter_by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Funx.Utils</span><span class="o">.</span><span class="n">flip</span><span class="p" data-group-id="2760659865-11">(</span><span class="o">&amp;</span><span class="nc">Enum</span><span class="o">.</span><span class="n">filter</span><span class="o">/</span><span class="mi">2</span><span class="p" data-group-id="2760659865-11">)</span><span class="w">
  
  </span><span class="c1"># Create specialized filters</span><span class="w">
  </span><span class="n">filter_adults</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">filter_by</span><span class="o">.</span><span class="p" data-group-id="2760659865-12">(</span><span class="n">test_adult</span><span class="p" data-group-id="2760659865-12">)</span><span class="w">
  </span><span class="n">filter_active</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">filter_by</span><span class="o">.</span><span class="p" data-group-id="2760659865-13">(</span><span class="n">test_active</span><span class="p" data-group-id="2760659865-13">)</span><span class="w">
  
  </span><span class="n">users</span><span class="w"> 
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">filter_adults</span><span class="o">.</span><span class="p" data-group-id="2760659865-14">(</span><span class="p" data-group-id="2760659865-14">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">filter_active</span><span class="o">.</span><span class="p" data-group-id="2760659865-15">(</span><span class="p" data-group-id="2760659865-15">)</span><span class="w">
</span><span class="k" data-group-id="2760659865-2">end</span></code></pre><h3 id="with-maybe-either-bind" class="section-heading">
  <a href="#with-maybe-either-bind" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">With Maybe/Either Bind</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="kd">def</span><span class="w"> </span><span class="nf">build_monadic_validation</span><span class="p" data-group-id="7746481913-1">(</span><span class="p" data-group-id="7746481913-1">)</span><span class="w"> </span><span class="k" data-group-id="7746481913-2">do</span><span class="w">
  </span><span class="c1"># Convert predicates to Maybe-returning validators</span><span class="w">
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">predicate_to_maybe</span><span class="p" data-group-id="7746481913-3">(</span><span class="n">predicate</span><span class="p">,</span><span class="w"> </span><span class="n">error_msg</span><span class="p" data-group-id="7746481913-3">)</span><span class="w"> </span><span class="k" data-group-id="7746481913-4">do</span><span class="w">
    </span><span class="k" data-group-id="7746481913-5">fn</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
      </span><span class="k">if</span><span class="w"> </span><span class="n">predicate</span><span class="o">.</span><span class="p" data-group-id="7746481913-6">(</span><span class="n">value</span><span class="p" data-group-id="7746481913-6">)</span><span class="w"> </span><span class="k" data-group-id="7746481913-7">do</span><span class="w">
        </span><span class="nc">Maybe</span><span class="o">.</span><span class="n">just</span><span class="p" data-group-id="7746481913-8">(</span><span class="n">value</span><span class="p" data-group-id="7746481913-8">)</span><span class="w">
      </span><span class="k" data-group-id="7746481913-7">else</span><span class="w">
        </span><span class="nc">Maybe</span><span class="o">.</span><span class="n">nothing</span><span class="p" data-group-id="7746481913-9">(</span><span class="p" data-group-id="7746481913-9">)</span><span class="w">
      </span><span class="k" data-group-id="7746481913-7">end</span><span class="w">
    </span><span class="k" data-group-id="7746481913-5">end</span><span class="w">
  </span><span class="k" data-group-id="7746481913-4">end</span><span class="w">
  
  </span><span class="c1"># Convert predicates to Either-returning validators</span><span class="w">
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">predicate_to_either</span><span class="p" data-group-id="7746481913-10">(</span><span class="n">predicate</span><span class="p">,</span><span class="w"> </span><span class="n">error_msg</span><span class="p" data-group-id="7746481913-10">)</span><span class="w"> </span><span class="k" data-group-id="7746481913-11">do</span><span class="w">
    </span><span class="k" data-group-id="7746481913-12">fn</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
      </span><span class="k">if</span><span class="w"> </span><span class="n">predicate</span><span class="o">.</span><span class="p" data-group-id="7746481913-13">(</span><span class="n">value</span><span class="p" data-group-id="7746481913-13">)</span><span class="w"> </span><span class="k" data-group-id="7746481913-14">do</span><span class="w">
        </span><span class="nc">Either</span><span class="o">.</span><span class="n">right</span><span class="p" data-group-id="7746481913-15">(</span><span class="n">value</span><span class="p" data-group-id="7746481913-15">)</span><span class="w">
      </span><span class="k" data-group-id="7746481913-14">else</span><span class="w">
        </span><span class="nc">Either</span><span class="o">.</span><span class="n">left</span><span class="p" data-group-id="7746481913-16">(</span><span class="n">error_msg</span><span class="p" data-group-id="7746481913-16">)</span><span class="w">
      </span><span class="k" data-group-id="7746481913-14">end</span><span class="w">
    </span><span class="k" data-group-id="7746481913-12">end</span><span class="w">
  </span><span class="k" data-group-id="7746481913-11">end</span><span class="w">
  
  </span><span class="c1"># Create validators</span><span class="w">
  </span><span class="n">age_predicate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="7746481913-17">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">age</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">18</span><span class="w"> </span><span class="k" data-group-id="7746481913-17">end</span><span class="w">
  </span><span class="n">email_predicate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="7746481913-18">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">String</span><span class="o">.</span><span class="n">contains?</span><span class="p" data-group-id="7746481913-19">(</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;@&quot;</span><span class="p" data-group-id="7746481913-19">)</span><span class="w"> </span><span class="k" data-group-id="7746481913-18">end</span><span class="w">
  
  </span><span class="n">age_validator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">predicate_to_either</span><span class="p" data-group-id="7746481913-20">(</span><span class="n">age_predicate</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Must be adult&quot;</span><span class="p" data-group-id="7746481913-20">)</span><span class="w">
  </span><span class="n">email_validator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">predicate_to_either</span><span class="p" data-group-id="7746481913-21">(</span><span class="n">email_predicate</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Invalid email&quot;</span><span class="p" data-group-id="7746481913-21">)</span><span class="w">
  
  </span><span class="c1"># Use in monadic pipeline</span><span class="w">
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">validate_user</span><span class="p" data-group-id="7746481913-22">(</span><span class="n">user</span><span class="p" data-group-id="7746481913-22">)</span><span class="w"> </span><span class="k" data-group-id="7746481913-23">do</span><span class="w">
    </span><span class="nc">Either</span><span class="o">.</span><span class="n">right</span><span class="p" data-group-id="7746481913-24">(</span><span class="n">user</span><span class="p" data-group-id="7746481913-24">)</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Either</span><span class="o">.</span><span class="n">bind</span><span class="p" data-group-id="7746481913-25">(</span><span class="n">age_validator</span><span class="p" data-group-id="7746481913-25">)</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Either</span><span class="o">.</span><span class="n">bind</span><span class="p" data-group-id="7746481913-26">(</span><span class="n">email_validator</span><span class="p" data-group-id="7746481913-26">)</span><span class="w">
  </span><span class="k" data-group-id="7746481913-23">end</span><span class="w">
  
  </span><span class="n">validate_user</span><span class="p" data-group-id="7746481913-27">(</span><span class="p" data-group-id="7746481913-28">%{</span><span class="ss">age</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span><span class="w"> </span><span class="ss">email</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;user@example.com&quot;</span><span class="p" data-group-id="7746481913-28">}</span><span class="p" data-group-id="7746481913-27">)</span><span class="w">  </span><span class="c1"># Right(user)</span><span class="w">
  </span><span class="n">validate_user</span><span class="p" data-group-id="7746481913-29">(</span><span class="p" data-group-id="7746481913-30">%{</span><span class="ss">age</span><span class="p">:</span><span class="w"> </span><span class="mi">16</span><span class="p">,</span><span class="w"> </span><span class="ss">email</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;invalid&quot;</span><span class="p" data-group-id="7746481913-30">}</span><span class="p" data-group-id="7746481913-29">)</span><span class="w">          </span><span class="c1"># Left(&quot;Must be adult&quot;)</span><span class="w">
</span><span class="k" data-group-id="7746481913-2">end</span></code></pre><h3 id="with-enum-functions" class="section-heading">
  <a href="#with-enum-functions" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">With Enum Functions</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="kd">def</span><span class="w"> </span><span class="nf">build_enum_integration</span><span class="p" data-group-id="5623183028-1">(</span><span class="p" data-group-id="5623183028-1">)</span><span class="w"> </span><span class="k" data-group-id="5623183028-2">do</span><span class="w">
  </span><span class="c1"># Predicate-based collection operations</span><span class="w">
  
  </span><span class="n">users</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="5623183028-3">[</span><span class="w">
    </span><span class="p" data-group-id="5623183028-4">%{</span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">role</span><span class="p">:</span><span class="w"> </span><span class="ss">:admin</span><span class="p">,</span><span class="w"> </span><span class="ss">active</span><span class="p">:</span><span class="w"> </span><span class="no">true</span><span class="p" data-group-id="5623183028-4">}</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="5623183028-5">%{</span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Bob&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">role</span><span class="p">:</span><span class="w"> </span><span class="ss">:user</span><span class="p">,</span><span class="w"> </span><span class="ss">active</span><span class="p">:</span><span class="w"> </span><span class="no">false</span><span class="p" data-group-id="5623183028-5">}</span><span class="p">,</span><span class="w"> 
    </span><span class="p" data-group-id="5623183028-6">%{</span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Carol&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">role</span><span class="p">:</span><span class="w"> </span><span class="ss">:moderator</span><span class="p">,</span><span class="w"> </span><span class="ss">active</span><span class="p">:</span><span class="w"> </span><span class="no">true</span><span class="p" data-group-id="5623183028-6">}</span><span class="w">
  </span><span class="p" data-group-id="5623183028-3">]</span><span class="w">
  
  </span><span class="c1"># Create predicates</span><span class="w">
  </span><span class="n">is_admin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="5623183028-7">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">role</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">:admin</span><span class="w"> </span><span class="k" data-group-id="5623183028-7">end</span><span class="w">
  </span><span class="n">is_active</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="5623183028-8">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">active</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">true</span><span class="w"> </span><span class="k" data-group-id="5623183028-8">end</span><span class="w">
  </span><span class="n">is_staff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">or_any</span><span class="p" data-group-id="5623183028-9">(</span><span class="p" data-group-id="5623183028-10">[</span><span class="w">
    </span><span class="k" data-group-id="5623183028-11">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">role</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">:admin</span><span class="w"> </span><span class="k" data-group-id="5623183028-11">end</span><span class="p">,</span><span class="w">
    </span><span class="k" data-group-id="5623183028-12">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">role</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">:moderator</span><span class="w"> </span><span class="k" data-group-id="5623183028-12">end</span><span class="w">
  </span><span class="p" data-group-id="5623183028-10">]</span><span class="p" data-group-id="5623183028-9">)</span><span class="w">
  
  </span><span class="c1"># Use with Enum functions</span><span class="w">
  </span><span class="n">active_users</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">filter</span><span class="p" data-group-id="5623183028-13">(</span><span class="n">users</span><span class="p">,</span><span class="w"> </span><span class="n">is_active</span><span class="p" data-group-id="5623183028-13">)</span><span class="w">
  </span><span class="n">staff_members</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">filter</span><span class="p" data-group-id="5623183028-14">(</span><span class="n">users</span><span class="p">,</span><span class="w"> </span><span class="n">is_staff</span><span class="p" data-group-id="5623183028-14">)</span><span class="w">
  
  </span><span class="c1"># Combine predicates for complex filtering</span><span class="w">
  </span><span class="n">active_staff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">filter</span><span class="p" data-group-id="5623183028-15">(</span><span class="n">users</span><span class="p">,</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="5623183028-16">(</span><span class="p" data-group-id="5623183028-17">[</span><span class="n">is_staff</span><span class="p">,</span><span class="w"> </span><span class="n">is_active</span><span class="p" data-group-id="5623183028-17">]</span><span class="p" data-group-id="5623183028-16">)</span><span class="p" data-group-id="5623183028-15">)</span><span class="w">
  
  </span><span class="c1"># Partition based on predicates</span><span class="w">
  </span><span class="p" data-group-id="5623183028-18">{</span><span class="n">staff</span><span class="p">,</span><span class="w"> </span><span class="n">regular_users</span><span class="p" data-group-id="5623183028-18">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">split_with</span><span class="p" data-group-id="5623183028-19">(</span><span class="n">users</span><span class="p">,</span><span class="w"> </span><span class="n">is_staff</span><span class="p" data-group-id="5623183028-19">)</span><span class="w">
  
  </span><span class="c1"># Count matching items</span><span class="w">
  </span><span class="n">staff_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">count</span><span class="p" data-group-id="5623183028-20">(</span><span class="n">users</span><span class="p">,</span><span class="w"> </span><span class="n">is_staff</span><span class="p" data-group-id="5623183028-20">)</span><span class="w">
  
  </span><span class="c1"># Find items</span><span class="w">
  </span><span class="n">first_admin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">find</span><span class="p" data-group-id="5623183028-21">(</span><span class="n">users</span><span class="p">,</span><span class="w"> </span><span class="n">is_admin</span><span class="p" data-group-id="5623183028-21">)</span><span class="w">
  </span><span class="n">all_active</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">all?</span><span class="p" data-group-id="5623183028-22">(</span><span class="n">users</span><span class="p">,</span><span class="w"> </span><span class="n">is_active</span><span class="p" data-group-id="5623183028-22">)</span><span class="w">
  </span><span class="n">any_admins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">any?</span><span class="p" data-group-id="5623183028-23">(</span><span class="n">users</span><span class="p">,</span><span class="w"> </span><span class="n">is_admin</span><span class="p" data-group-id="5623183028-23">)</span><span class="w">
  
  </span><span class="p" data-group-id="5623183028-24">%{</span><span class="w">
    </span><span class="ss">active_users</span><span class="p">:</span><span class="w"> </span><span class="n">active_users</span><span class="p">,</span><span class="w">
    </span><span class="ss">staff_members</span><span class="p">:</span><span class="w"> </span><span class="n">staff_members</span><span class="p">,</span><span class="w">
    </span><span class="ss">active_staff</span><span class="p">:</span><span class="w"> </span><span class="n">active_staff</span><span class="p">,</span><span class="w">
    </span><span class="ss">counts</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="5623183028-25">%{</span><span class="ss">staff</span><span class="p">:</span><span class="w"> </span><span class="n">staff_count</span><span class="p" data-group-id="5623183028-25">}</span><span class="p">,</span><span class="w">
    </span><span class="ss">checks</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="5623183028-26">%{</span><span class="ss">all_active</span><span class="p">:</span><span class="w"> </span><span class="n">all_active</span><span class="p">,</span><span class="w"> </span><span class="ss">any_admins</span><span class="p">:</span><span class="w"> </span><span class="n">any_admins</span><span class="p" data-group-id="5623183028-26">}</span><span class="w">
  </span><span class="p" data-group-id="5623183028-24">}</span><span class="w">
</span><span class="k" data-group-id="5623183028-2">end</span></code></pre><h3 id="with-case-statements" class="section-heading">
  <a href="#with-case-statements" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">With Case Statements</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="kd">def</span><span class="w"> </span><span class="nf">build_case_integration</span><span class="p" data-group-id="5073282525-1">(</span><span class="p" data-group-id="5073282525-1">)</span><span class="w"> </span><span class="k" data-group-id="5073282525-2">do</span><span class="w">
  </span><span class="c1"># Use predicates in case statement guards</span><span class="w">
  
  </span><span class="n">is_admin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="5073282525-3">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">role</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">:admin</span><span class="w"> </span><span class="k" data-group-id="5073282525-3">end</span><span class="w">
  </span><span class="n">is_owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="5073282525-4">fn</span><span class="w"> </span><span class="n">resource</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">resource</span><span class="o">.</span><span class="n">owner_id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="w"> </span><span class="k" data-group-id="5073282525-4">end</span><span class="w">
  </span><span class="n">is_collaborator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="5073282525-5">fn</span><span class="w"> </span><span class="n">resource</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> 
    </span><span class="nc">Enum</span><span class="o">.</span><span class="n">member?</span><span class="p" data-group-id="5073282525-6">(</span><span class="n">resource</span><span class="o">.</span><span class="n">collaborators</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p" data-group-id="5073282525-6">)</span><span class="w">
  </span><span class="k" data-group-id="5073282525-5">end</span><span class="w">
  
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">authorize_action</span><span class="p" data-group-id="5073282525-7">(</span><span class="n">action</span><span class="p">,</span><span class="w"> </span><span class="n">resource</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p" data-group-id="5073282525-7">)</span><span class="w"> </span><span class="k" data-group-id="5073282525-8">do</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="p" data-group-id="5073282525-9">{</span><span class="n">action</span><span class="p">,</span><span class="w"> </span><span class="n">is_admin</span><span class="o">.</span><span class="p" data-group-id="5073282525-10">(</span><span class="n">user</span><span class="p" data-group-id="5073282525-10">)</span><span class="p" data-group-id="5073282525-9">}</span><span class="w"> </span><span class="k" data-group-id="5073282525-11">do</span><span class="w">
      </span><span class="p" data-group-id="5073282525-12">{</span><span class="bp">_</span><span class="p">,</span><span class="w"> </span><span class="no">true</span><span class="p" data-group-id="5073282525-12">}</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> 
        </span><span class="c1"># Admins can do anything</span><span class="w">
        </span><span class="ss">:authorized</span><span class="w">
        
      </span><span class="p" data-group-id="5073282525-13">{</span><span class="ss">:read</span><span class="p">,</span><span class="w"> </span><span class="no">false</span><span class="p" data-group-id="5073282525-13">}</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
        </span><span class="c1"># Non-admins need specific read permissions</span><span class="w">
        </span><span class="k">case</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">or_any</span><span class="p" data-group-id="5073282525-14">(</span><span class="p" data-group-id="5073282525-15">[</span><span class="n">is_owner</span><span class="o">.</span><span class="p" data-group-id="5073282525-16">(</span><span class="n">resource</span><span class="p" data-group-id="5073282525-16">)</span><span class="p">,</span><span class="w"> </span><span class="n">is_collaborator</span><span class="o">.</span><span class="p" data-group-id="5073282525-17">(</span><span class="n">resource</span><span class="p" data-group-id="5073282525-17">)</span><span class="p" data-group-id="5073282525-15">]</span><span class="p" data-group-id="5073282525-14">)</span><span class="o">.</span><span class="p" data-group-id="5073282525-18">(</span><span class="n">user</span><span class="p" data-group-id="5073282525-18">)</span><span class="w"> </span><span class="k" data-group-id="5073282525-19">do</span><span class="w">
          </span><span class="no">true</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="ss">:authorized</span><span class="w">
          </span><span class="no">false</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p" data-group-id="5073282525-20">{</span><span class="ss">:unauthorized</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;No read access&quot;</span><span class="p" data-group-id="5073282525-20">}</span><span class="w">
        </span><span class="k" data-group-id="5073282525-19">end</span><span class="w">
        
      </span><span class="p" data-group-id="5073282525-21">{</span><span class="ss">:write</span><span class="p">,</span><span class="w"> </span><span class="no">false</span><span class="p" data-group-id="5073282525-21">}</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
        </span><span class="c1"># Non-admins need ownership for writes</span><span class="w">
        </span><span class="k">case</span><span class="w"> </span><span class="n">is_owner</span><span class="o">.</span><span class="p" data-group-id="5073282525-22">(</span><span class="n">resource</span><span class="p" data-group-id="5073282525-22">)</span><span class="o">.</span><span class="p" data-group-id="5073282525-23">(</span><span class="n">user</span><span class="p" data-group-id="5073282525-23">)</span><span class="w"> </span><span class="k" data-group-id="5073282525-24">do</span><span class="w">
          </span><span class="no">true</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="ss">:authorized</span><span class="w">
          </span><span class="no">false</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p" data-group-id="5073282525-25">{</span><span class="ss">:unauthorized</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Must be owner to modify&quot;</span><span class="p" data-group-id="5073282525-25">}</span><span class="w">
        </span><span class="k" data-group-id="5073282525-24">end</span><span class="w">
        
      </span><span class="p" data-group-id="5073282525-26">{</span><span class="ss">:delete</span><span class="p">,</span><span class="w"> </span><span class="no">false</span><span class="p" data-group-id="5073282525-26">}</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
        </span><span class="c1"># Only owners and admins can delete</span><span class="w">
        </span><span class="p" data-group-id="5073282525-27">{</span><span class="ss">:unauthorized</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Insufficient permissions for delete&quot;</span><span class="p" data-group-id="5073282525-27">}</span><span class="w">
    </span><span class="k" data-group-id="5073282525-11">end</span><span class="w">
  </span><span class="k" data-group-id="5073282525-8">end</span><span class="w">
  
  </span><span class="p" data-group-id="5073282525-28">%{</span><span class="ss">authorize</span><span class="p">:</span><span class="w"> </span><span class="o">&amp;</span><span class="n">authorize_action</span><span class="o">/</span><span class="mi">3</span><span class="p" data-group-id="5073282525-28">}</span><span class="w">
</span><span class="k" data-group-id="5073282525-2">end</span></code></pre><h3 id="with-guard-clauses" class="section-heading">
  <a href="#with-guard-clauses" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">With Guard Clauses</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="kd">def</span><span class="w"> </span><span class="nf">build_guard_integration</span><span class="p" data-group-id="1925113955-1">(</span><span class="p" data-group-id="1925113955-1">)</span><span class="w"> </span><span class="k" data-group-id="1925113955-2">do</span><span class="w">
  </span><span class="c1"># Convert predicates to guard-compatible expressions</span><span class="w">
  
  </span><span class="c1"># Note: These need to be guard-safe functions</span><span class="w">
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">process_user</span><span class="p" data-group-id="1925113955-3">(</span><span class="n">user</span><span class="p" data-group-id="1925113955-3">)</span><span class="w"> </span><span class="ow">when</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">age</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">18</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">active</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">true</span><span class="w"> </span><span class="k" data-group-id="1925113955-4">do</span><span class="w">
    </span><span class="p" data-group-id="1925113955-5">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Processing adult active user: </span><span class="si" data-group-id="1925113955-6">#{</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="si" data-group-id="1925113955-6">}</span><span class="s">&quot;</span><span class="p" data-group-id="1925113955-5">}</span><span class="w">
  </span><span class="k" data-group-id="1925113955-4">end</span><span class="w">
  
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">process_user</span><span class="p" data-group-id="1925113955-7">(</span><span class="n">user</span><span class="p" data-group-id="1925113955-7">)</span><span class="w"> </span><span class="ow">when</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">role</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">:admin</span><span class="w"> </span><span class="k" data-group-id="1925113955-8">do</span><span class="w">
    </span><span class="p" data-group-id="1925113955-9">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Processing admin user: </span><span class="si" data-group-id="1925113955-10">#{</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="si" data-group-id="1925113955-10">}</span><span class="s">&quot;</span><span class="p" data-group-id="1925113955-9">}</span><span class="w">
  </span><span class="k" data-group-id="1925113955-8">end</span><span class="w">
  
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">process_user</span><span class="p" data-group-id="1925113955-11">(</span><span class="c">_user</span><span class="p" data-group-id="1925113955-11">)</span><span class="w"> </span><span class="k" data-group-id="1925113955-12">do</span><span class="w">
    </span><span class="p" data-group-id="1925113955-13">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;User does not meet processing criteria&quot;</span><span class="p" data-group-id="1925113955-13">}</span><span class="w">
  </span><span class="k" data-group-id="1925113955-12">end</span><span class="w">
  
  </span><span class="c1"># For more complex predicates, use function heads</span><span class="w">
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">handle_request</span><span class="p" data-group-id="1925113955-14">(</span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p" data-group-id="1925113955-14">)</span><span class="w"> </span><span class="k" data-group-id="1925113955-15">do</span><span class="w">
    </span><span class="k">cond</span><span class="w"> </span><span class="k" data-group-id="1925113955-16">do</span><span class="w">
      </span><span class="n">is_admin_user</span><span class="p" data-group-id="1925113955-17">(</span><span class="p" data-group-id="1925113955-17">)</span><span class="o">.</span><span class="p" data-group-id="1925113955-18">(</span><span class="n">user</span><span class="p" data-group-id="1925113955-18">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
        </span><span class="n">handle_admin_request</span><span class="p" data-group-id="1925113955-19">(</span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p" data-group-id="1925113955-19">)</span><span class="w">
        
      </span><span class="n">is_premium_user</span><span class="p" data-group-id="1925113955-20">(</span><span class="p" data-group-id="1925113955-20">)</span><span class="o">.</span><span class="p" data-group-id="1925113955-21">(</span><span class="n">user</span><span class="p" data-group-id="1925113955-21">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
        </span><span class="n">handle_premium_request</span><span class="p" data-group-id="1925113955-22">(</span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p" data-group-id="1925113955-22">)</span><span class="w">
        
      </span><span class="n">basic_user_requirements</span><span class="p" data-group-id="1925113955-23">(</span><span class="p" data-group-id="1925113955-23">)</span><span class="o">.</span><span class="p" data-group-id="1925113955-24">(</span><span class="n">user</span><span class="p" data-group-id="1925113955-24">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
        </span><span class="n">handle_basic_request</span><span class="p" data-group-id="1925113955-25">(</span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p" data-group-id="1925113955-25">)</span><span class="w">
        
      </span><span class="no">true</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
        </span><span class="p" data-group-id="1925113955-26">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;User not authorized for any request type&quot;</span><span class="p" data-group-id="1925113955-26">}</span><span class="w">
    </span><span class="k" data-group-id="1925113955-16">end</span><span class="w">
  </span><span class="k" data-group-id="1925113955-15">end</span><span class="w">
  
  </span><span class="kd">defp</span><span class="w"> </span><span class="nf">is_admin_user</span><span class="p" data-group-id="1925113955-27">(</span><span class="p" data-group-id="1925113955-27">)</span><span class="p">,</span><span class="w"> </span><span class="ss">do</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="1925113955-28">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">role</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">:admin</span><span class="w"> </span><span class="k" data-group-id="1925113955-28">end</span><span class="w">
  </span><span class="kd">defp</span><span class="w"> </span><span class="nf">is_premium_user</span><span class="p" data-group-id="1925113955-29">(</span><span class="p" data-group-id="1925113955-29">)</span><span class="p">,</span><span class="w"> </span><span class="ss">do</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="1925113955-30">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">subscription</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">:premium</span><span class="w"> </span><span class="k" data-group-id="1925113955-30">end</span><span class="w">
  </span><span class="kd">defp</span><span class="w"> </span><span class="nf">basic_user_requirements</span><span class="p" data-group-id="1925113955-31">(</span><span class="p" data-group-id="1925113955-31">)</span><span class="w"> </span><span class="k" data-group-id="1925113955-32">do</span><span class="w">
    </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="1925113955-33">(</span><span class="p" data-group-id="1925113955-34">[</span><span class="w">
      </span><span class="k" data-group-id="1925113955-35">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">verified</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">true</span><span class="w"> </span><span class="k" data-group-id="1925113955-35">end</span><span class="p">,</span><span class="w">
      </span><span class="k" data-group-id="1925113955-36">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">:active</span><span class="w"> </span><span class="k" data-group-id="1925113955-36">end</span><span class="w">
    </span><span class="p" data-group-id="1925113955-34">]</span><span class="p" data-group-id="1925113955-33">)</span><span class="w">
  </span><span class="k" data-group-id="1925113955-32">end</span><span class="w">
  
  </span><span class="p" data-group-id="1925113955-37">%{</span><span class="ss">process_user</span><span class="p">:</span><span class="w"> </span><span class="o">&amp;</span><span class="n">process_user</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">handle_request</span><span class="p">:</span><span class="w"> </span><span class="o">&amp;</span><span class="n">handle_request</span><span class="o">/</span><span class="mi">2</span><span class="p" data-group-id="1925113955-37">}</span><span class="w">
</span><span class="k" data-group-id="1925113955-2">end</span></code></pre><h2 id="llm-testing-guidance" class="section-heading">
  <a href="#llm-testing-guidance" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">LLM Testing Guidance</span>
</h2>
<h3 id="test-individual-predicates" class="section-heading">
  <a href="#test-individual-predicates" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Test Individual Predicates</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="kd">defmodule</span><span class="w"> </span><span class="nc">PredicateTest</span><span class="w"> </span><span class="k" data-group-id="3455406735-1">do</span><span class="w">
  </span><span class="kn">use</span><span class="w"> </span><span class="nc">ExUnit.Case</span><span class="w">
  
  </span><span class="n">test</span><span class="w"> </span><span class="s">&quot;individual predicates work correctly&quot;</span><span class="w"> </span><span class="k" data-group-id="3455406735-2">do</span><span class="w">
    </span><span class="n">is_adult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="3455406735-3">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">age</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">18</span><span class="w"> </span><span class="k" data-group-id="3455406735-3">end</span><span class="w">
    </span><span class="n">has_email</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="3455406735-4">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">String</span><span class="o">.</span><span class="n">contains?</span><span class="p" data-group-id="3455406735-5">(</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;@&quot;</span><span class="p" data-group-id="3455406735-5">)</span><span class="w"> </span><span class="k" data-group-id="3455406735-4">end</span><span class="w">
    
    </span><span class="n">adult_user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="3455406735-6">%{</span><span class="ss">age</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span><span class="w"> </span><span class="ss">email</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;user@example.com&quot;</span><span class="p" data-group-id="3455406735-6">}</span><span class="w">
    </span><span class="n">minor_user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="3455406735-7">%{</span><span class="ss">age</span><span class="p">:</span><span class="w"> </span><span class="mi">16</span><span class="p">,</span><span class="w"> </span><span class="ss">email</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;teen@example.com&quot;</span><span class="p" data-group-id="3455406735-7">}</span><span class="w">
    
    </span><span class="n">assert</span><span class="w"> </span><span class="n">is_adult</span><span class="o">.</span><span class="p" data-group-id="3455406735-8">(</span><span class="n">adult_user</span><span class="p" data-group-id="3455406735-8">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">true</span><span class="w">
    </span><span class="n">assert</span><span class="w"> </span><span class="n">is_adult</span><span class="o">.</span><span class="p" data-group-id="3455406735-9">(</span><span class="n">minor_user</span><span class="p" data-group-id="3455406735-9">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">false</span><span class="w">
    
    </span><span class="n">assert</span><span class="w"> </span><span class="n">has_email</span><span class="o">.</span><span class="p" data-group-id="3455406735-10">(</span><span class="n">adult_user</span><span class="p" data-group-id="3455406735-10">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">true</span><span class="w">
    </span><span class="n">assert</span><span class="w"> </span><span class="n">has_email</span><span class="o">.</span><span class="p" data-group-id="3455406735-11">(</span><span class="p" data-group-id="3455406735-12">%{</span><span class="ss">age</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span><span class="w"> </span><span class="ss">email</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;invalid&quot;</span><span class="p" data-group-id="3455406735-12">}</span><span class="p" data-group-id="3455406735-11">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">false</span><span class="w">
  </span><span class="k" data-group-id="3455406735-2">end</span><span class="w">
  
  </span><span class="n">test</span><span class="w"> </span><span class="s">&quot;predicate composition works&quot;</span><span class="w"> </span><span class="k" data-group-id="3455406735-13">do</span><span class="w">
    </span><span class="n">is_adult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="3455406735-14">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">age</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">18</span><span class="w"> </span><span class="k" data-group-id="3455406735-14">end</span><span class="w">
    </span><span class="n">has_email</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="3455406735-15">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">String</span><span class="o">.</span><span class="n">contains?</span><span class="p" data-group-id="3455406735-16">(</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;@&quot;</span><span class="p" data-group-id="3455406735-16">)</span><span class="w"> </span><span class="k" data-group-id="3455406735-15">end</span><span class="w">
    </span><span class="n">is_active</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="3455406735-17">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">active</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">true</span><span class="w"> </span><span class="k" data-group-id="3455406735-17">end</span><span class="w">
    
    </span><span class="c1"># Test AND composition</span><span class="w">
    </span><span class="n">valid_user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="3455406735-18">(</span><span class="p" data-group-id="3455406735-19">[</span><span class="n">is_adult</span><span class="p">,</span><span class="w"> </span><span class="n">has_email</span><span class="p">,</span><span class="w"> </span><span class="n">is_active</span><span class="p" data-group-id="3455406735-19">]</span><span class="p" data-group-id="3455406735-18">)</span><span class="w">
    
    </span><span class="n">fully_valid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="3455406735-20">%{</span><span class="ss">age</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span><span class="w"> </span><span class="ss">email</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;user@example.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">active</span><span class="p">:</span><span class="w"> </span><span class="no">true</span><span class="p" data-group-id="3455406735-20">}</span><span class="w">
    </span><span class="n">invalid_email</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="3455406735-21">%{</span><span class="ss">age</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span><span class="w"> </span><span class="ss">email</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;invalid&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">active</span><span class="p">:</span><span class="w"> </span><span class="no">true</span><span class="p" data-group-id="3455406735-21">}</span><span class="w">
    </span><span class="n">inactive_user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="3455406735-22">%{</span><span class="ss">age</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span><span class="w"> </span><span class="ss">email</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;user@example.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">active</span><span class="p">:</span><span class="w"> </span><span class="no">false</span><span class="p" data-group-id="3455406735-22">}</span><span class="w">
    
    </span><span class="n">assert</span><span class="w"> </span><span class="n">valid_user</span><span class="o">.</span><span class="p" data-group-id="3455406735-23">(</span><span class="n">fully_valid</span><span class="p" data-group-id="3455406735-23">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">true</span><span class="w">
    </span><span class="n">assert</span><span class="w"> </span><span class="n">valid_user</span><span class="o">.</span><span class="p" data-group-id="3455406735-24">(</span><span class="n">invalid_email</span><span class="p" data-group-id="3455406735-24">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">false</span><span class="w">
    </span><span class="n">assert</span><span class="w"> </span><span class="n">valid_user</span><span class="o">.</span><span class="p" data-group-id="3455406735-25">(</span><span class="n">inactive_user</span><span class="p" data-group-id="3455406735-25">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">false</span><span class="w">
    
    </span><span class="c1"># Test OR composition  </span><span class="w">
    </span><span class="n">admin_or_owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">or_any</span><span class="p" data-group-id="3455406735-26">(</span><span class="p" data-group-id="3455406735-27">[</span><span class="w">
      </span><span class="k" data-group-id="3455406735-28">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">role</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">:admin</span><span class="w"> </span><span class="k" data-group-id="3455406735-28">end</span><span class="p">,</span><span class="w">
      </span><span class="k" data-group-id="3455406735-29">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">owner</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">true</span><span class="w"> </span><span class="k" data-group-id="3455406735-29">end</span><span class="w">
    </span><span class="p" data-group-id="3455406735-27">]</span><span class="p" data-group-id="3455406735-26">)</span><span class="w">
    
    </span><span class="n">admin_user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="3455406735-30">%{</span><span class="ss">role</span><span class="p">:</span><span class="w"> </span><span class="ss">:admin</span><span class="p">,</span><span class="w"> </span><span class="ss">owner</span><span class="p">:</span><span class="w"> </span><span class="no">false</span><span class="p" data-group-id="3455406735-30">}</span><span class="w">
    </span><span class="n">owner_user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="3455406735-31">%{</span><span class="ss">role</span><span class="p">:</span><span class="w"> </span><span class="ss">:user</span><span class="p">,</span><span class="w"> </span><span class="ss">owner</span><span class="p">:</span><span class="w"> </span><span class="no">true</span><span class="p" data-group-id="3455406735-31">}</span><span class="w">
    </span><span class="n">regular_user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="3455406735-32">%{</span><span class="ss">role</span><span class="p">:</span><span class="w"> </span><span class="ss">:user</span><span class="p">,</span><span class="w"> </span><span class="ss">owner</span><span class="p">:</span><span class="w"> </span><span class="no">false</span><span class="p" data-group-id="3455406735-32">}</span><span class="w">
    
    </span><span class="n">assert</span><span class="w"> </span><span class="n">admin_or_owner</span><span class="o">.</span><span class="p" data-group-id="3455406735-33">(</span><span class="n">admin_user</span><span class="p" data-group-id="3455406735-33">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">true</span><span class="w">
    </span><span class="n">assert</span><span class="w"> </span><span class="n">admin_or_owner</span><span class="o">.</span><span class="p" data-group-id="3455406735-34">(</span><span class="n">owner_user</span><span class="p" data-group-id="3455406735-34">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">true</span><span class="w">
    </span><span class="n">assert</span><span class="w"> </span><span class="n">admin_or_owner</span><span class="o">.</span><span class="p" data-group-id="3455406735-35">(</span><span class="n">regular_user</span><span class="p" data-group-id="3455406735-35">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">false</span><span class="w">
  </span><span class="k" data-group-id="3455406735-13">end</span><span class="w">
  
  </span><span class="n">test</span><span class="w"> </span><span class="s">&quot;predicate negation works&quot;</span><span class="w"> </span><span class="k" data-group-id="3455406735-36">do</span><span class="w">
    </span><span class="n">is_admin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="3455406735-37">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">role</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">:admin</span><span class="w"> </span><span class="k" data-group-id="3455406735-37">end</span><span class="w">
    </span><span class="n">is_not_admin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="ow">not</span><span class="p" data-group-id="3455406735-38">(</span><span class="n">is_admin</span><span class="p" data-group-id="3455406735-38">)</span><span class="w">
    
    </span><span class="n">admin_user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="3455406735-39">%{</span><span class="ss">role</span><span class="p">:</span><span class="w"> </span><span class="ss">:admin</span><span class="p" data-group-id="3455406735-39">}</span><span class="w">
    </span><span class="n">regular_user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="3455406735-40">%{</span><span class="ss">role</span><span class="p">:</span><span class="w"> </span><span class="ss">:user</span><span class="p" data-group-id="3455406735-40">}</span><span class="w">
    
    </span><span class="n">assert</span><span class="w"> </span><span class="n">is_admin</span><span class="o">.</span><span class="p" data-group-id="3455406735-41">(</span><span class="n">admin_user</span><span class="p" data-group-id="3455406735-41">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">true</span><span class="w">
    </span><span class="n">assert</span><span class="w"> </span><span class="n">is_not_admin</span><span class="o">.</span><span class="p" data-group-id="3455406735-42">(</span><span class="n">admin_user</span><span class="p" data-group-id="3455406735-42">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">false</span><span class="w">
    
    </span><span class="n">assert</span><span class="w"> </span><span class="n">is_admin</span><span class="o">.</span><span class="p" data-group-id="3455406735-43">(</span><span class="n">regular_user</span><span class="p" data-group-id="3455406735-43">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">false</span><span class="w">
    </span><span class="n">assert</span><span class="w"> </span><span class="n">is_not_admin</span><span class="o">.</span><span class="p" data-group-id="3455406735-44">(</span><span class="n">regular_user</span><span class="p" data-group-id="3455406735-44">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">true</span><span class="w">
  </span><span class="k" data-group-id="3455406735-36">end</span><span class="w">
</span><span class="k" data-group-id="3455406735-1">end</span></code></pre><h3 id="test-composed-predicates" class="section-heading">
  <a href="#test-composed-predicates" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Test Composed Predicates</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="kd">defmodule</span><span class="w"> </span><span class="nc">ComposedPredicateTest</span><span class="w"> </span><span class="k" data-group-id="6307004009-1">do</span><span class="w">
  </span><span class="kn">use</span><span class="w"> </span><span class="nc">ExUnit.Case</span><span class="w">
  
  </span><span class="n">setup</span><span class="w"> </span><span class="k" data-group-id="6307004009-2">do</span><span class="w">
    </span><span class="n">users</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="6307004009-3">[</span><span class="w">
      </span><span class="p" data-group-id="6307004009-4">%{</span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">age</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="ss">role</span><span class="p">:</span><span class="w"> </span><span class="ss">:admin</span><span class="p">,</span><span class="w"> </span><span class="ss">active</span><span class="p">:</span><span class="w"> </span><span class="no">true</span><span class="p">,</span><span class="w"> </span><span class="ss">verified</span><span class="p">:</span><span class="w"> </span><span class="no">true</span><span class="p" data-group-id="6307004009-4">}</span><span class="p">,</span><span class="w">
      </span><span class="p" data-group-id="6307004009-5">%{</span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Bob&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">age</span><span class="p">:</span><span class="w"> </span><span class="mi">17</span><span class="p">,</span><span class="w"> </span><span class="ss">role</span><span class="p">:</span><span class="w"> </span><span class="ss">:user</span><span class="p">,</span><span class="w"> </span><span class="ss">active</span><span class="p">:</span><span class="w"> </span><span class="no">true</span><span class="p">,</span><span class="w"> </span><span class="ss">verified</span><span class="p">:</span><span class="w"> </span><span class="no">false</span><span class="p" data-group-id="6307004009-5">}</span><span class="p">,</span><span class="w">
      </span><span class="p" data-group-id="6307004009-6">%{</span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Carol&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">age</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span><span class="w"> </span><span class="ss">role</span><span class="p">:</span><span class="w"> </span><span class="ss">:moderator</span><span class="p">,</span><span class="w"> </span><span class="ss">active</span><span class="p">:</span><span class="w"> </span><span class="no">false</span><span class="p">,</span><span class="w"> </span><span class="ss">verified</span><span class="p">:</span><span class="w"> </span><span class="no">true</span><span class="p" data-group-id="6307004009-6">}</span><span class="p">,</span><span class="w">
      </span><span class="p" data-group-id="6307004009-7">%{</span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Dave&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">age</span><span class="p">:</span><span class="w"> </span><span class="mi">35</span><span class="p">,</span><span class="w"> </span><span class="ss">role</span><span class="p">:</span><span class="w"> </span><span class="ss">:user</span><span class="p">,</span><span class="w"> </span><span class="ss">active</span><span class="p">:</span><span class="w"> </span><span class="no">true</span><span class="p">,</span><span class="w"> </span><span class="ss">verified</span><span class="p">:</span><span class="w"> </span><span class="no">true</span><span class="p" data-group-id="6307004009-7">}</span><span class="w">
    </span><span class="p" data-group-id="6307004009-3">]</span><span class="w">
    
    </span><span class="p" data-group-id="6307004009-8">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="ss">users</span><span class="p">:</span><span class="w"> </span><span class="n">users</span><span class="p" data-group-id="6307004009-8">}</span><span class="w">
  </span><span class="k" data-group-id="6307004009-2">end</span><span class="w">
  
  </span><span class="n">test</span><span class="w"> </span><span class="s">&quot;complex business rule validation&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6307004009-9">%{</span><span class="ss">users</span><span class="p">:</span><span class="w"> </span><span class="n">users</span><span class="p" data-group-id="6307004009-9">}</span><span class="w"> </span><span class="k" data-group-id="6307004009-10">do</span><span class="w">
    </span><span class="c1"># Build complex business rules</span><span class="w">
    </span><span class="n">basic_requirements</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="6307004009-11">(</span><span class="p" data-group-id="6307004009-12">[</span><span class="w">
      </span><span class="k" data-group-id="6307004009-13">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">age</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">18</span><span class="w"> </span><span class="k" data-group-id="6307004009-13">end</span><span class="p">,</span><span class="w">
      </span><span class="k" data-group-id="6307004009-14">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">active</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">true</span><span class="w"> </span><span class="k" data-group-id="6307004009-14">end</span><span class="p">,</span><span class="w">
      </span><span class="k" data-group-id="6307004009-15">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">verified</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">true</span><span class="w"> </span><span class="k" data-group-id="6307004009-15">end</span><span class="w">
    </span><span class="p" data-group-id="6307004009-12">]</span><span class="p" data-group-id="6307004009-11">)</span><span class="w">
    
    </span><span class="n">elevated_access</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">or_any</span><span class="p" data-group-id="6307004009-16">(</span><span class="p" data-group-id="6307004009-17">[</span><span class="w">
      </span><span class="k" data-group-id="6307004009-18">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">role</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">:admin</span><span class="w"> </span><span class="k" data-group-id="6307004009-18">end</span><span class="p">,</span><span class="w">
      </span><span class="k" data-group-id="6307004009-19">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">role</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">:moderator</span><span class="w"> </span><span class="k" data-group-id="6307004009-19">end</span><span class="w">
    </span><span class="p" data-group-id="6307004009-17">]</span><span class="p" data-group-id="6307004009-16">)</span><span class="w">
    
    </span><span class="n">can_moderate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="6307004009-20">(</span><span class="p" data-group-id="6307004009-21">[</span><span class="n">basic_requirements</span><span class="p">,</span><span class="w"> </span><span class="n">elevated_access</span><span class="p" data-group-id="6307004009-21">]</span><span class="p" data-group-id="6307004009-20">)</span><span class="w">
    
    </span><span class="c1"># Test against known data</span><span class="w">
    </span><span class="p" data-group-id="6307004009-22">[</span><span class="n">alice</span><span class="p">,</span><span class="w"> </span><span class="n">bob</span><span class="p">,</span><span class="w"> </span><span class="n">carol</span><span class="p">,</span><span class="w"> </span><span class="n">dave</span><span class="p" data-group-id="6307004009-22">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">users</span><span class="w">
    
    </span><span class="n">assert</span><span class="w"> </span><span class="n">can_moderate</span><span class="o">.</span><span class="p" data-group-id="6307004009-23">(</span><span class="n">alice</span><span class="p" data-group-id="6307004009-23">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">true</span><span class="w">   </span><span class="c1"># Admin, meets requirements</span><span class="w">
    </span><span class="n">assert</span><span class="w"> </span><span class="n">can_moderate</span><span class="o">.</span><span class="p" data-group-id="6307004009-24">(</span><span class="n">bob</span><span class="p" data-group-id="6307004009-24">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">false</span><span class="w">    </span><span class="c1"># Minor, unverified</span><span class="w">
    </span><span class="n">assert</span><span class="w"> </span><span class="n">can_moderate</span><span class="o">.</span><span class="p" data-group-id="6307004009-25">(</span><span class="n">carol</span><span class="p" data-group-id="6307004009-25">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">false</span><span class="w">  </span><span class="c1"># Inactive</span><span class="w">
    </span><span class="n">assert</span><span class="w"> </span><span class="n">can_moderate</span><span class="o">.</span><span class="p" data-group-id="6307004009-26">(</span><span class="n">dave</span><span class="p" data-group-id="6307004009-26">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">false</span><span class="w">   </span><span class="c1"># No elevated role</span><span class="w">
  </span><span class="k" data-group-id="6307004009-10">end</span><span class="w">
  
  </span><span class="n">test</span><span class="w"> </span><span class="s">&quot;filtering with composed predicates&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6307004009-27">%{</span><span class="ss">users</span><span class="p">:</span><span class="w"> </span><span class="n">users</span><span class="p" data-group-id="6307004009-27">}</span><span class="w"> </span><span class="k" data-group-id="6307004009-28">do</span><span class="w">
    </span><span class="c1"># Create filtering predicates</span><span class="w">
    </span><span class="n">is_adult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="6307004009-29">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">age</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">18</span><span class="w"> </span><span class="k" data-group-id="6307004009-29">end</span><span class="w">
    </span><span class="n">is_staff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">or_any</span><span class="p" data-group-id="6307004009-30">(</span><span class="p" data-group-id="6307004009-31">[</span><span class="w">
      </span><span class="k" data-group-id="6307004009-32">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">role</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">:admin</span><span class="w"> </span><span class="k" data-group-id="6307004009-32">end</span><span class="p">,</span><span class="w">
      </span><span class="k" data-group-id="6307004009-33">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">role</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">:moderator</span><span class="w"> </span><span class="k" data-group-id="6307004009-33">end</span><span class="w">
    </span><span class="p" data-group-id="6307004009-31">]</span><span class="p" data-group-id="6307004009-30">)</span><span class="w">
    
    </span><span class="n">active_staff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="6307004009-34">(</span><span class="p" data-group-id="6307004009-35">[</span><span class="w">
      </span><span class="n">is_adult</span><span class="p">,</span><span class="w">
      </span><span class="n">is_staff</span><span class="p">,</span><span class="w">
      </span><span class="k" data-group-id="6307004009-36">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">active</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">true</span><span class="w"> </span><span class="k" data-group-id="6307004009-36">end</span><span class="w">
    </span><span class="p" data-group-id="6307004009-35">]</span><span class="p" data-group-id="6307004009-34">)</span><span class="w">
    
    </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">filter</span><span class="p" data-group-id="6307004009-37">(</span><span class="n">users</span><span class="p">,</span><span class="w"> </span><span class="n">active_staff</span><span class="p" data-group-id="6307004009-37">)</span><span class="w">
    
    </span><span class="c1"># Only Alice should match (adult, admin, active)</span><span class="w">
    </span><span class="n">assert</span><span class="w"> </span><span class="n">length</span><span class="p" data-group-id="6307004009-38">(</span><span class="n">result</span><span class="p" data-group-id="6307004009-38">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w">
    </span><span class="n">assert</span><span class="w"> </span><span class="n">hd</span><span class="p" data-group-id="6307004009-39">(</span><span class="n">result</span><span class="p" data-group-id="6307004009-39">)</span><span class="o">.</span><span class="n">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span><span class="w">
  </span><span class="k" data-group-id="6307004009-28">end</span><span class="w">
  
  </span><span class="n">test</span><span class="w"> </span><span class="s">&quot;short-circuiting behavior&quot;</span><span class="w"> </span><span class="k" data-group-id="6307004009-40">do</span><span class="w">
    </span><span class="n">call_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Agent</span><span class="o">.</span><span class="n">start_link</span><span class="p" data-group-id="6307004009-41">(</span><span class="k" data-group-id="6307004009-42">fn</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k" data-group-id="6307004009-42">end</span><span class="p">,</span><span class="w"> </span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="ss">:test_counter</span><span class="p" data-group-id="6307004009-41">)</span><span class="w">
    
    </span><span class="n">expensive_predicate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="6307004009-43">fn</span><span class="w"> </span><span class="c">_user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
      </span><span class="nc">Agent</span><span class="o">.</span><span class="n">update</span><span class="p" data-group-id="6307004009-44">(</span><span class="ss">:test_counter</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="p" data-group-id="6307004009-45">(</span><span class="ni">&amp;1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="6307004009-45">)</span><span class="p" data-group-id="6307004009-44">)</span><span class="w">
      </span><span class="no">true</span><span class="w">
    </span><span class="k" data-group-id="6307004009-43">end</span><span class="w">
    
    </span><span class="c1"># This should short-circuit after the first false</span><span class="w">
    </span><span class="n">short_circuit_predicate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="6307004009-46">(</span><span class="p" data-group-id="6307004009-47">[</span><span class="w">
      </span><span class="k" data-group-id="6307004009-48">fn</span><span class="w"> </span><span class="c">_user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">false</span><span class="w"> </span><span class="k" data-group-id="6307004009-48">end</span><span class="p">,</span><span class="w">  </span><span class="c1"># Always false - should short-circuit here</span><span class="w">
      </span><span class="n">expensive_predicate</span><span class="w">    </span><span class="c1"># Should not be called</span><span class="w">
    </span><span class="p" data-group-id="6307004009-47">]</span><span class="p" data-group-id="6307004009-46">)</span><span class="w">
    
    </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="6307004009-49">%{</span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Test&quot;</span><span class="p" data-group-id="6307004009-49">}</span><span class="w">
    </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">short_circuit_predicate</span><span class="o">.</span><span class="p" data-group-id="6307004009-50">(</span><span class="n">user</span><span class="p" data-group-id="6307004009-50">)</span><span class="w">
    </span><span class="n">call_count_after</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Agent</span><span class="o">.</span><span class="n">get</span><span class="p" data-group-id="6307004009-51">(</span><span class="ss">:test_counter</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="ni">&amp;1</span><span class="p" data-group-id="6307004009-51">)</span><span class="w">
    
    </span><span class="n">assert</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">false</span><span class="w">
    </span><span class="n">assert</span><span class="w"> </span><span class="n">call_count_after</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w">  </span><span class="c1"># Expensive predicate was not called</span><span class="w">
  </span><span class="k" data-group-id="6307004009-40">end</span><span class="w">
</span><span class="k" data-group-id="6307004009-1">end</span></code></pre><h3 id="test-edge-cases" class="section-heading">
  <a href="#test-edge-cases" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Test Edge Cases</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="kd">defmodule</span><span class="w"> </span><span class="nc">PredicateEdgeCaseTest</span><span class="w"> </span><span class="k" data-group-id="2721958846-1">do</span><span class="w">
  </span><span class="kn">use</span><span class="w"> </span><span class="nc">ExUnit.Case</span><span class="w">
  
  </span><span class="n">test</span><span class="w"> </span><span class="s">&quot;empty predicate lists&quot;</span><span class="w"> </span><span class="k" data-group-id="2721958846-2">do</span><span class="w">
    </span><span class="c1"># Empty and_all should return true (identity element)</span><span class="w">
    </span><span class="n">always_true</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="2721958846-3">(</span><span class="p" data-group-id="2721958846-4">[</span><span class="p" data-group-id="2721958846-4">]</span><span class="p" data-group-id="2721958846-3">)</span><span class="w">
    </span><span class="n">assert</span><span class="w"> </span><span class="n">always_true</span><span class="o">.</span><span class="p" data-group-id="2721958846-5">(</span><span class="ss">:anything</span><span class="p" data-group-id="2721958846-5">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">true</span><span class="w">
    
    </span><span class="c1"># Empty or_any should return false (identity element)</span><span class="w">
    </span><span class="n">always_false</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">or_any</span><span class="p" data-group-id="2721958846-6">(</span><span class="p" data-group-id="2721958846-7">[</span><span class="p" data-group-id="2721958846-7">]</span><span class="p" data-group-id="2721958846-6">)</span><span class="w">
    </span><span class="n">assert</span><span class="w"> </span><span class="n">always_false</span><span class="o">.</span><span class="p" data-group-id="2721958846-8">(</span><span class="ss">:anything</span><span class="p" data-group-id="2721958846-8">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">false</span><span class="w">
  </span><span class="k" data-group-id="2721958846-2">end</span><span class="w">
  
  </span><span class="n">test</span><span class="w"> </span><span class="s">&quot;single predicate in composition&quot;</span><span class="w"> </span><span class="k" data-group-id="2721958846-9">do</span><span class="w">
    </span><span class="n">single_pred</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="2721958846-10">fn</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="k" data-group-id="2721958846-10">end</span><span class="w">
    
    </span><span class="n">and_single</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="2721958846-11">(</span><span class="p" data-group-id="2721958846-12">[</span><span class="n">single_pred</span><span class="p" data-group-id="2721958846-12">]</span><span class="p" data-group-id="2721958846-11">)</span><span class="w">
    </span><span class="n">or_single</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">or_any</span><span class="p" data-group-id="2721958846-13">(</span><span class="p" data-group-id="2721958846-14">[</span><span class="n">single_pred</span><span class="p" data-group-id="2721958846-14">]</span><span class="p" data-group-id="2721958846-13">)</span><span class="w">
    
    </span><span class="n">assert</span><span class="w"> </span><span class="n">and_single</span><span class="o">.</span><span class="p" data-group-id="2721958846-15">(</span><span class="mi">10</span><span class="p" data-group-id="2721958846-15">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">true</span><span class="w">
    </span><span class="n">assert</span><span class="w"> </span><span class="n">or_single</span><span class="o">.</span><span class="p" data-group-id="2721958846-16">(</span><span class="mi">10</span><span class="p" data-group-id="2721958846-16">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">true</span><span class="w">
    </span><span class="n">assert</span><span class="w"> </span><span class="n">and_single</span><span class="o">.</span><span class="p" data-group-id="2721958846-17">(</span><span class="mi">3</span><span class="p" data-group-id="2721958846-17">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">false</span><span class="w">
    </span><span class="n">assert</span><span class="w"> </span><span class="n">or_single</span><span class="o">.</span><span class="p" data-group-id="2721958846-18">(</span><span class="mi">3</span><span class="p" data-group-id="2721958846-18">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">false</span><span class="w">
  </span><span class="k" data-group-id="2721958846-9">end</span><span class="w">
  
  </span><span class="n">test</span><span class="w"> </span><span class="s">&quot;nested composition&quot;</span><span class="w"> </span><span class="k" data-group-id="2721958846-19">do</span><span class="w">
    </span><span class="c1"># Build nested predicate structure</span><span class="w">
    </span><span class="n">inner_and</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="2721958846-20">(</span><span class="p" data-group-id="2721958846-21">[</span><span class="w">
      </span><span class="k" data-group-id="2721958846-22">fn</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k" data-group-id="2721958846-22">end</span><span class="p">,</span><span class="w">
      </span><span class="k" data-group-id="2721958846-23">fn</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="k" data-group-id="2721958846-23">end</span><span class="w">
    </span><span class="p" data-group-id="2721958846-21">]</span><span class="p" data-group-id="2721958846-20">)</span><span class="w">
    
    </span><span class="n">inner_or</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">or_any</span><span class="p" data-group-id="2721958846-24">(</span><span class="p" data-group-id="2721958846-25">[</span><span class="w">
      </span><span class="k" data-group-id="2721958846-26">fn</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="k" data-group-id="2721958846-26">end</span><span class="p">,</span><span class="w">  </span><span class="c1"># Special case</span><span class="w">
      </span><span class="n">inner_and</span><span class="w">             </span><span class="c1"># Or within normal range</span><span class="w">
    </span><span class="p" data-group-id="2721958846-25">]</span><span class="p" data-group-id="2721958846-24">)</span><span class="w">
    
    </span><span class="n">outer_predicate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="2721958846-27">(</span><span class="p" data-group-id="2721958846-28">[</span><span class="w">
      </span><span class="k" data-group-id="2721958846-29">fn</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">is_integer</span><span class="p" data-group-id="2721958846-30">(</span><span class="n">x</span><span class="p" data-group-id="2721958846-30">)</span><span class="w"> </span><span class="k" data-group-id="2721958846-29">end</span><span class="p">,</span><span class="w">
      </span><span class="n">inner_or</span><span class="w">
    </span><span class="p" data-group-id="2721958846-28">]</span><span class="p" data-group-id="2721958846-27">)</span><span class="w">
    
    </span><span class="n">assert</span><span class="w"> </span><span class="n">outer_predicate</span><span class="o">.</span><span class="p" data-group-id="2721958846-31">(</span><span class="mi">50</span><span class="p" data-group-id="2721958846-31">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">true</span><span class="w">    </span><span class="c1"># Integer in range</span><span class="w">
    </span><span class="n">assert</span><span class="w"> </span><span class="n">outer_predicate</span><span class="o">.</span><span class="p" data-group-id="2721958846-32">(</span><span class="o">-</span><span class="mi">1</span><span class="p" data-group-id="2721958846-32">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">true</span><span class="w">    </span><span class="c1"># Special case</span><span class="w">
    </span><span class="n">assert</span><span class="w"> </span><span class="n">outer_predicate</span><span class="o">.</span><span class="p" data-group-id="2721958846-33">(</span><span class="mi">150</span><span class="p" data-group-id="2721958846-33">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">false</span><span class="w">  </span><span class="c1"># Out of range</span><span class="w">
    </span><span class="n">assert</span><span class="w"> </span><span class="n">outer_predicate</span><span class="o">.</span><span class="p" data-group-id="2721958846-34">(</span><span class="mf">5.5</span><span class="p" data-group-id="2721958846-34">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">false</span><span class="w">  </span><span class="c1"># Not integer</span><span class="w">
  </span><span class="k" data-group-id="2721958846-19">end</span><span class="w">
  
  </span><span class="n">test</span><span class="w"> </span><span class="s">&quot;nil and error handling&quot;</span><span class="w"> </span><span class="k" data-group-id="2721958846-35">do</span><span class="w">
    </span><span class="n">safe_predicate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="2721958846-36">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
      </span><span class="c1"># Safely handle potential nil values</span><span class="w">
      </span><span class="ow">not</span><span class="w"> </span><span class="n">is_nil</span><span class="p" data-group-id="2721958846-37">(</span><span class="n">user</span><span class="p" data-group-id="2721958846-37">)</span><span class="w"> </span><span class="ow">and</span><span class="w"> 
      </span><span class="nc">Map</span><span class="o">.</span><span class="n">has_key?</span><span class="p" data-group-id="2721958846-38">(</span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="ss">:age</span><span class="p" data-group-id="2721958846-38">)</span><span class="w"> </span><span class="ow">and</span><span class="w"> 
      </span><span class="ow">not</span><span class="w"> </span><span class="n">is_nil</span><span class="p" data-group-id="2721958846-39">(</span><span class="n">user</span><span class="o">.</span><span class="n">age</span><span class="p" data-group-id="2721958846-39">)</span><span class="w"> </span><span class="ow">and</span><span class="w">
      </span><span class="n">user</span><span class="o">.</span><span class="n">age</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">18</span><span class="w">
    </span><span class="k" data-group-id="2721958846-36">end</span><span class="w">
    
    </span><span class="n">assert</span><span class="w"> </span><span class="n">safe_predicate</span><span class="o">.</span><span class="p" data-group-id="2721958846-40">(</span><span class="p" data-group-id="2721958846-41">%{</span><span class="ss">age</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="p" data-group-id="2721958846-41">}</span><span class="p" data-group-id="2721958846-40">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">true</span><span class="w">
    </span><span class="n">assert</span><span class="w"> </span><span class="n">safe_predicate</span><span class="o">.</span><span class="p" data-group-id="2721958846-42">(</span><span class="p" data-group-id="2721958846-43">%{</span><span class="p" data-group-id="2721958846-43">}</span><span class="p" data-group-id="2721958846-42">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">false</span><span class="w">
    </span><span class="n">assert</span><span class="w"> </span><span class="n">safe_predicate</span><span class="o">.</span><span class="p" data-group-id="2721958846-44">(</span><span class="no">nil</span><span class="p" data-group-id="2721958846-44">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">false</span><span class="w">
  </span><span class="k" data-group-id="2721958846-35">end</span><span class="w">
</span><span class="k" data-group-id="2721958846-1">end</span></code></pre><h2 id="llm-debugging-tips" class="section-heading">
  <a href="#llm-debugging-tips" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">LLM Debugging Tips</span>
</h2>
<h3 id="named-predicates-for-clarity" class="section-heading">
  <a href="#named-predicates-for-clarity" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Named Predicates for Clarity</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="kd">def</span><span class="w"> </span><span class="nf">build_debuggable_predicates</span><span class="p" data-group-id="9401138633-1">(</span><span class="p" data-group-id="9401138633-1">)</span><span class="w"> </span><span class="k" data-group-id="9401138633-2">do</span><span class="w">
  </span><span class="c1"># Create named predicates for easier debugging</span><span class="w">
  </span><span class="n">predicates</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="9401138633-3">%{</span><span class="w">
    </span><span class="ss">is_adult</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="9401138633-4">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> 
      </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">age</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">18</span><span class="w">
      </span><span class="nc">IO</span><span class="o">.</span><span class="n">puts</span><span class="p" data-group-id="9401138633-5">(</span><span class="s">&quot;is_adult(</span><span class="si" data-group-id="9401138633-6">#{</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="si" data-group-id="9401138633-6">}</span><span class="s">): </span><span class="si" data-group-id="9401138633-7">#{</span><span class="n">result</span><span class="si" data-group-id="9401138633-7">}</span><span class="s">&quot;</span><span class="p" data-group-id="9401138633-5">)</span><span class="w">
      </span><span class="n">result</span><span class="w">
    </span><span class="k" data-group-id="9401138633-4">end</span><span class="p">,</span><span class="w">
    
    </span><span class="ss">has_valid_email</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="9401138633-8">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
      </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">String</span><span class="o">.</span><span class="n">contains?</span><span class="p" data-group-id="9401138633-9">(</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;@&quot;</span><span class="p" data-group-id="9401138633-9">)</span><span class="w">
      </span><span class="nc">IO</span><span class="o">.</span><span class="n">puts</span><span class="p" data-group-id="9401138633-10">(</span><span class="s">&quot;has_valid_email(</span><span class="si" data-group-id="9401138633-11">#{</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="si" data-group-id="9401138633-11">}</span><span class="s">): </span><span class="si" data-group-id="9401138633-12">#{</span><span class="n">result</span><span class="si" data-group-id="9401138633-12">}</span><span class="s">&quot;</span><span class="p" data-group-id="9401138633-10">)</span><span class="w">
      </span><span class="n">result</span><span class="w">
    </span><span class="k" data-group-id="9401138633-8">end</span><span class="p">,</span><span class="w">
    
    </span><span class="ss">is_active</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="9401138633-13">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
      </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">active</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">true</span><span class="w">
      </span><span class="nc">IO</span><span class="o">.</span><span class="n">puts</span><span class="p" data-group-id="9401138633-14">(</span><span class="s">&quot;is_active(</span><span class="si" data-group-id="9401138633-15">#{</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="si" data-group-id="9401138633-15">}</span><span class="s">): </span><span class="si" data-group-id="9401138633-16">#{</span><span class="n">result</span><span class="si" data-group-id="9401138633-16">}</span><span class="s">&quot;</span><span class="p" data-group-id="9401138633-14">)</span><span class="w">  
      </span><span class="n">result</span><span class="w">
    </span><span class="k" data-group-id="9401138633-13">end</span><span class="w">
  </span><span class="p" data-group-id="9401138633-3">}</span><span class="w">
  
  </span><span class="c1"># Compose with logging</span><span class="w">
  </span><span class="n">user_validator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="9401138633-17">(</span><span class="p" data-group-id="9401138633-18">[</span><span class="w">
    </span><span class="n">predicates</span><span class="o">.</span><span class="n">is_adult</span><span class="p">,</span><span class="w">
    </span><span class="n">predicates</span><span class="o">.</span><span class="n">has_valid_email</span><span class="p">,</span><span class="w">
    </span><span class="n">predicates</span><span class="o">.</span><span class="n">is_active</span><span class="w">
  </span><span class="p" data-group-id="9401138633-18">]</span><span class="p" data-group-id="9401138633-17">)</span><span class="w">
  
  </span><span class="c1"># Test user</span><span class="w">
  </span><span class="n">test_user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="9401138633-19">%{</span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">age</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span><span class="w"> </span><span class="ss">email</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;alice@test.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">active</span><span class="p">:</span><span class="w"> </span><span class="no">true</span><span class="p" data-group-id="9401138633-19">}</span><span class="w">
  
  </span><span class="nc">IO</span><span class="o">.</span><span class="n">puts</span><span class="p" data-group-id="9401138633-20">(</span><span class="s">&quot;Testing user validation:&quot;</span><span class="p" data-group-id="9401138633-20">)</span><span class="w">
  </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">user_validator</span><span class="o">.</span><span class="p" data-group-id="9401138633-21">(</span><span class="n">test_user</span><span class="p" data-group-id="9401138633-21">)</span><span class="w">
  </span><span class="nc">IO</span><span class="o">.</span><span class="n">puts</span><span class="p" data-group-id="9401138633-22">(</span><span class="s">&quot;Final result: </span><span class="si" data-group-id="9401138633-23">#{</span><span class="n">result</span><span class="si" data-group-id="9401138633-23">}</span><span class="s">&quot;</span><span class="p" data-group-id="9401138633-22">)</span><span class="w">
  
  </span><span class="n">result</span><span class="w">
</span><span class="k" data-group-id="9401138633-2">end</span></code></pre><h3 id="component-testing" class="section-heading">
  <a href="#component-testing" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Component Testing</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="kd">def</span><span class="w"> </span><span class="nf">debug_predicate_composition</span><span class="p" data-group-id="2072636030-1">(</span><span class="p" data-group-id="2072636030-1">)</span><span class="w"> </span><span class="k" data-group-id="2072636030-2">do</span><span class="w">
  </span><span class="c1"># Test individual components first</span><span class="w">
  </span><span class="n">predicates</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="2072636030-3">[</span><span class="w">
    </span><span class="p" data-group-id="2072636030-4">{</span><span class="s">&quot;age_check&quot;</span><span class="p">,</span><span class="w"> </span><span class="k" data-group-id="2072636030-5">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">age</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">18</span><span class="w"> </span><span class="k" data-group-id="2072636030-5">end</span><span class="p" data-group-id="2072636030-4">}</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="2072636030-6">{</span><span class="s">&quot;email_check&quot;</span><span class="p">,</span><span class="w"> </span><span class="k" data-group-id="2072636030-7">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">String</span><span class="o">.</span><span class="n">contains?</span><span class="p" data-group-id="2072636030-8">(</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;@&quot;</span><span class="p" data-group-id="2072636030-8">)</span><span class="w"> </span><span class="k" data-group-id="2072636030-7">end</span><span class="p" data-group-id="2072636030-6">}</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="2072636030-9">{</span><span class="s">&quot;active_check&quot;</span><span class="p">,</span><span class="w"> </span><span class="k" data-group-id="2072636030-10">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">active</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">true</span><span class="w"> </span><span class="k" data-group-id="2072636030-10">end</span><span class="p" data-group-id="2072636030-9">}</span><span class="w">
  </span><span class="p" data-group-id="2072636030-3">]</span><span class="w">
  
  </span><span class="n">test_user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="2072636030-11">%{</span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Bob&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">age</span><span class="p">:</span><span class="w"> </span><span class="mi">17</span><span class="p">,</span><span class="w"> </span><span class="ss">email</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bob@test.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">active</span><span class="p">:</span><span class="w"> </span><span class="no">false</span><span class="p" data-group-id="2072636030-11">}</span><span class="w">
  
  </span><span class="nc">IO</span><span class="o">.</span><span class="n">puts</span><span class="p" data-group-id="2072636030-12">(</span><span class="s">&quot;Individual predicate results:&quot;</span><span class="p" data-group-id="2072636030-12">)</span><span class="w">
  </span><span class="n">individual_results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">predicates</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">map</span><span class="p" data-group-id="2072636030-13">(</span><span class="k" data-group-id="2072636030-14">fn</span><span class="w"> </span><span class="p" data-group-id="2072636030-15">{</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">pred</span><span class="p" data-group-id="2072636030-15">}</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
    </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pred</span><span class="o">.</span><span class="p" data-group-id="2072636030-16">(</span><span class="n">test_user</span><span class="p" data-group-id="2072636030-16">)</span><span class="w">
    </span><span class="nc">IO</span><span class="o">.</span><span class="n">puts</span><span class="p" data-group-id="2072636030-17">(</span><span class="s">&quot;</span><span class="si" data-group-id="2072636030-18">#{</span><span class="n">name</span><span class="si" data-group-id="2072636030-18">}</span><span class="s">: </span><span class="si" data-group-id="2072636030-19">#{</span><span class="n">result</span><span class="si" data-group-id="2072636030-19">}</span><span class="s">&quot;</span><span class="p" data-group-id="2072636030-17">)</span><span class="w">
    </span><span class="p" data-group-id="2072636030-20">{</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p" data-group-id="2072636030-20">}</span><span class="w">
  </span><span class="k" data-group-id="2072636030-14">end</span><span class="p" data-group-id="2072636030-13">)</span><span class="w">
  
  </span><span class="c1"># Test composition</span><span class="w">
  </span><span class="n">composed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">predicates</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">map</span><span class="p" data-group-id="2072636030-21">(</span><span class="k" data-group-id="2072636030-22">fn</span><span class="w"> </span><span class="p" data-group-id="2072636030-23">{</span><span class="bp">_</span><span class="p">,</span><span class="w"> </span><span class="n">pred</span><span class="p" data-group-id="2072636030-23">}</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">pred</span><span class="w"> </span><span class="k" data-group-id="2072636030-22">end</span><span class="p" data-group-id="2072636030-21">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">p_all</span><span class="p" data-group-id="2072636030-24">(</span><span class="p" data-group-id="2072636030-24">)</span><span class="w">
  </span><span class="n">composed_result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">composed</span><span class="o">.</span><span class="p" data-group-id="2072636030-25">(</span><span class="n">test_user</span><span class="p" data-group-id="2072636030-25">)</span><span class="w">
  
  </span><span class="nc">IO</span><span class="o">.</span><span class="n">puts</span><span class="p" data-group-id="2072636030-26">(</span><span class="s">&quot;Composed result: </span><span class="si" data-group-id="2072636030-27">#{</span><span class="n">composed_result</span><span class="si" data-group-id="2072636030-27">}</span><span class="s">&quot;</span><span class="p" data-group-id="2072636030-26">)</span><span class="w">
  
  </span><span class="c1"># Analyze results</span><span class="w">
  </span><span class="n">failing_predicates</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">individual_results</span><span class="w"> 
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">filter</span><span class="p" data-group-id="2072636030-28">(</span><span class="k" data-group-id="2072636030-29">fn</span><span class="w"> </span><span class="p" data-group-id="2072636030-30">{</span><span class="bp">_</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p" data-group-id="2072636030-30">}</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="k" data-group-id="2072636030-29">end</span><span class="p" data-group-id="2072636030-28">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">map</span><span class="p" data-group-id="2072636030-31">(</span><span class="k" data-group-id="2072636030-32">fn</span><span class="w"> </span><span class="p" data-group-id="2072636030-33">{</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="bp">_</span><span class="p" data-group-id="2072636030-33">}</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k" data-group-id="2072636030-32">end</span><span class="p" data-group-id="2072636030-31">)</span><span class="w">
  
  </span><span class="nc">IO</span><span class="o">.</span><span class="n">puts</span><span class="p" data-group-id="2072636030-34">(</span><span class="s">&quot;Failing predicates: </span><span class="si" data-group-id="2072636030-35">#{</span><span class="n">inspect</span><span class="p" data-group-id="2072636030-36">(</span><span class="n">failing_predicates</span><span class="p" data-group-id="2072636030-36">)</span><span class="si" data-group-id="2072636030-35">}</span><span class="s">&quot;</span><span class="p" data-group-id="2072636030-34">)</span><span class="w">
  
  </span><span class="p" data-group-id="2072636030-37">%{</span><span class="ss">individual</span><span class="p">:</span><span class="w"> </span><span class="n">individual_results</span><span class="p">,</span><span class="w"> </span><span class="ss">composed</span><span class="p">:</span><span class="w"> </span><span class="n">composed_result</span><span class="p">,</span><span class="w"> </span><span class="ss">failing</span><span class="p">:</span><span class="w"> </span><span class="n">failing_predicates</span><span class="p" data-group-id="2072636030-37">}</span><span class="w">
</span><span class="k" data-group-id="2072636030-2">end</span></code></pre><h2 id="llm-error-message-design" class="section-heading">
  <a href="#llm-error-message-design" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">LLM Error Message Design</span>
</h2>
<h3 id="providing-context-for-failures" class="section-heading">
  <a href="#providing-context-for-failures" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Providing Context for Failures</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="kd">def</span><span class="w"> </span><span class="nf">build_descriptive_validation</span><span class="p" data-group-id="7169592728-1">(</span><span class="p" data-group-id="7169592728-1">)</span><span class="w"> </span><span class="k" data-group-id="7169592728-2">do</span><span class="w">
  </span><span class="c1"># Create predicates with error context</span><span class="w">
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">create_validating_predicate</span><span class="p" data-group-id="7169592728-3">(</span><span class="n">predicate_fn</span><span class="p">,</span><span class="w"> </span><span class="n">description</span><span class="p" data-group-id="7169592728-3">)</span><span class="w"> </span><span class="k" data-group-id="7169592728-4">do</span><span class="w">
    </span><span class="k" data-group-id="7169592728-5">fn</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
      </span><span class="k">case</span><span class="w"> </span><span class="n">predicate_fn</span><span class="o">.</span><span class="p" data-group-id="7169592728-6">(</span><span class="n">value</span><span class="p" data-group-id="7169592728-6">)</span><span class="w"> </span><span class="k" data-group-id="7169592728-7">do</span><span class="w">
        </span><span class="no">true</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p" data-group-id="7169592728-8">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p" data-group-id="7169592728-8">}</span><span class="w">
        </span><span class="no">false</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p" data-group-id="7169592728-9">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;</span><span class="si" data-group-id="7169592728-10">#{</span><span class="n">description</span><span class="si" data-group-id="7169592728-10">}</span><span class="s"> failed for </span><span class="si" data-group-id="7169592728-11">#{</span><span class="n">inspect</span><span class="p" data-group-id="7169592728-12">(</span><span class="n">value</span><span class="p" data-group-id="7169592728-12">)</span><span class="si" data-group-id="7169592728-11">}</span><span class="s">&quot;</span><span class="p" data-group-id="7169592728-9">}</span><span class="w">
      </span><span class="k" data-group-id="7169592728-7">end</span><span class="w">
    </span><span class="k" data-group-id="7169592728-5">end</span><span class="w">
  </span><span class="k" data-group-id="7169592728-4">end</span><span class="w">
  
  </span><span class="c1"># Build contextual validators</span><span class="w">
  </span><span class="n">validators</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="7169592728-13">%{</span><span class="w">
    </span><span class="ss">age_validator</span><span class="p">:</span><span class="w"> </span><span class="n">create_validating_predicate</span><span class="p" data-group-id="7169592728-14">(</span><span class="w">
      </span><span class="k" data-group-id="7169592728-15">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">age</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">18</span><span class="w"> </span><span class="k" data-group-id="7169592728-15">end</span><span class="p">,</span><span class="w">
      </span><span class="s">&quot;Age requirement (&gt;=18)&quot;</span><span class="w">
    </span><span class="p" data-group-id="7169592728-14">)</span><span class="p">,</span><span class="w">
    
    </span><span class="ss">email_validator</span><span class="p">:</span><span class="w"> </span><span class="n">create_validating_predicate</span><span class="p" data-group-id="7169592728-16">(</span><span class="w">
      </span><span class="k" data-group-id="7169592728-17">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">String</span><span class="o">.</span><span class="n">contains?</span><span class="p" data-group-id="7169592728-18">(</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;@&quot;</span><span class="p" data-group-id="7169592728-18">)</span><span class="w"> </span><span class="k" data-group-id="7169592728-17">end</span><span class="p">,</span><span class="w">
      </span><span class="s">&quot;Email format validation&quot;</span><span class="w">
    </span><span class="p" data-group-id="7169592728-16">)</span><span class="p">,</span><span class="w">
    
    </span><span class="ss">status_validator</span><span class="p">:</span><span class="w"> </span><span class="n">create_validating_predicate</span><span class="p" data-group-id="7169592728-19">(</span><span class="w">
      </span><span class="k" data-group-id="7169592728-20">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">:active</span><span class="w"> </span><span class="k" data-group-id="7169592728-20">end</span><span class="p">,</span><span class="w">
      </span><span class="s">&quot;Active status requirement&quot;</span><span class="w">
    </span><span class="p" data-group-id="7169592728-19">)</span><span class="w">
  </span><span class="p" data-group-id="7169592728-13">}</span><span class="w">
  
  </span><span class="c1"># Compose with error accumulation</span><span class="w">
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">validate_user_with_errors</span><span class="p" data-group-id="7169592728-21">(</span><span class="n">user</span><span class="p" data-group-id="7169592728-21">)</span><span class="w"> </span><span class="k" data-group-id="7169592728-22">do</span><span class="w">
    </span><span class="n">results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="7169592728-23">[</span><span class="w">
      </span><span class="n">validators</span><span class="o">.</span><span class="n">age_validator</span><span class="o">.</span><span class="p" data-group-id="7169592728-24">(</span><span class="n">user</span><span class="p" data-group-id="7169592728-24">)</span><span class="p">,</span><span class="w">
      </span><span class="n">validators</span><span class="o">.</span><span class="n">email_validator</span><span class="o">.</span><span class="p" data-group-id="7169592728-25">(</span><span class="n">user</span><span class="p" data-group-id="7169592728-25">)</span><span class="p">,</span><span class="w">
      </span><span class="n">validators</span><span class="o">.</span><span class="n">status_validator</span><span class="o">.</span><span class="p" data-group-id="7169592728-26">(</span><span class="n">user</span><span class="p" data-group-id="7169592728-26">)</span><span class="w">
    </span><span class="p" data-group-id="7169592728-23">]</span><span class="w">
    
    </span><span class="n">errors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">results</span><span class="w"> 
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">filter</span><span class="p" data-group-id="7169592728-27">(</span><span class="k" data-group-id="7169592728-28">fn</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">elem</span><span class="p" data-group-id="7169592728-29">(</span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="7169592728-29">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">:error</span><span class="w"> </span><span class="k" data-group-id="7169592728-28">end</span><span class="p" data-group-id="7169592728-27">)</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">map</span><span class="p" data-group-id="7169592728-30">(</span><span class="k" data-group-id="7169592728-31">fn</span><span class="w"> </span><span class="p" data-group-id="7169592728-32">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="n">msg</span><span class="p" data-group-id="7169592728-32">}</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">msg</span><span class="w"> </span><span class="k" data-group-id="7169592728-31">end</span><span class="p" data-group-id="7169592728-30">)</span><span class="w">
    
    </span><span class="k">case</span><span class="w"> </span><span class="n">errors</span><span class="w"> </span><span class="k" data-group-id="7169592728-33">do</span><span class="w">
      </span><span class="p" data-group-id="7169592728-34">[</span><span class="p" data-group-id="7169592728-34">]</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p" data-group-id="7169592728-35">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p" data-group-id="7169592728-35">}</span><span class="w">
      </span><span class="n">error_list</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p" data-group-id="7169592728-36">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Validation failed: &quot;</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">join</span><span class="p" data-group-id="7169592728-37">(</span><span class="n">error_list</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;, &quot;</span><span class="p" data-group-id="7169592728-37">)</span><span class="p" data-group-id="7169592728-36">}</span><span class="w">
    </span><span class="k" data-group-id="7169592728-33">end</span><span class="w">
  </span><span class="k" data-group-id="7169592728-22">end</span><span class="w">
  
  </span><span class="p" data-group-id="7169592728-38">%{</span><span class="ss">validate</span><span class="p">:</span><span class="w"> </span><span class="o">&amp;</span><span class="n">validate_user_with_errors</span><span class="o">/</span><span class="mi">1</span><span class="p" data-group-id="7169592728-38">}</span><span class="w">
</span><span class="k" data-group-id="7169592728-2">end</span></code></pre><h2 id="llm-common-mistakes-to-avoid" class="section-heading">
  <a href="#llm-common-mistakes-to-avoid" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">LLM Common Mistakes to Avoid</span>
</h2>
<h3 id="don-t-use-side-effects-in-predicates" class="section-heading">
  <a href="#don-t-use-side-effects-in-predicates" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">❌ Don't Use Side Effects in Predicates</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="c1"># ❌ Wrong: predicates with side effects</span><span class="w">
</span><span class="n">bad_predicate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="5666862838-1">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
  </span><span class="nc">Logger</span><span class="o">.</span><span class="n">info</span><span class="p" data-group-id="5666862838-2">(</span><span class="s">&quot;Checking user </span><span class="si" data-group-id="5666862838-3">#{</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="si" data-group-id="5666862838-3">}</span><span class="s">&quot;</span><span class="p" data-group-id="5666862838-2">)</span><span class="w">  </span><span class="c1"># Side effect!</span><span class="w">
  </span><span class="nc">Database</span><span class="o">.</span><span class="n">log_access</span><span class="p" data-group-id="5666862838-4">(</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p" data-group-id="5666862838-4">)</span><span class="w">             </span><span class="c1"># Side effect!</span><span class="w">
  </span><span class="n">user</span><span class="o">.</span><span class="n">age</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">18</span><span class="w">
</span><span class="k" data-group-id="5666862838-1">end</span><span class="w">

</span><span class="c1"># ✅ Correct: pure predicates, side effects elsewhere</span><span class="w">
</span><span class="n">good_predicate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="5666862838-5">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">age</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">18</span><span class="w"> </span><span class="k" data-group-id="5666862838-5">end</span><span class="w">

</span><span class="kd">def</span><span class="w"> </span><span class="nf">validate_and_log</span><span class="p" data-group-id="5666862838-6">(</span><span class="n">user</span><span class="p" data-group-id="5666862838-6">)</span><span class="w"> </span><span class="k" data-group-id="5666862838-7">do</span><span class="w">
  </span><span class="nc">Logger</span><span class="o">.</span><span class="n">info</span><span class="p" data-group-id="5666862838-8">(</span><span class="s">&quot;Checking user </span><span class="si" data-group-id="5666862838-9">#{</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="si" data-group-id="5666862838-9">}</span><span class="s">&quot;</span><span class="p" data-group-id="5666862838-8">)</span><span class="w">    </span><span class="c1"># Side effects separate</span><span class="w">
  </span><span class="n">is_valid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">good_predicate</span><span class="o">.</span><span class="p" data-group-id="5666862838-10">(</span><span class="n">user</span><span class="p" data-group-id="5666862838-10">)</span><span class="w">
  </span><span class="k">if</span><span class="w"> </span><span class="n">is_valid</span><span class="p">,</span><span class="w"> </span><span class="ss">do</span><span class="p">:</span><span class="w"> </span><span class="nc">Database</span><span class="o">.</span><span class="n">log_access</span><span class="p" data-group-id="5666862838-11">(</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p" data-group-id="5666862838-11">)</span><span class="w">
  </span><span class="n">is_valid</span><span class="w">
</span><span class="k" data-group-id="5666862838-7">end</span></code></pre><h3 id="don-t-put-expensive-operations-first" class="section-heading">
  <a href="#don-t-put-expensive-operations-first" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">❌ Don't Put Expensive Operations First</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="c1"># ❌ Wrong: expensive check first</span><span class="w">
</span><span class="n">inefficient_validation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="1498798283-1">(</span><span class="p" data-group-id="1498798283-2">[</span><span class="w">
  </span><span class="k" data-group-id="1498798283-3">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">ExternalAPI</span><span class="o">.</span><span class="n">verify_identity</span><span class="p" data-group-id="1498798283-4">(</span><span class="n">user</span><span class="o">.</span><span class="n">ssn</span><span class="p" data-group-id="1498798283-4">)</span><span class="w"> </span><span class="k" data-group-id="1498798283-3">end</span><span class="p">,</span><span class="w">  </span><span class="c1"># Expensive!</span><span class="w">
  </span><span class="k" data-group-id="1498798283-5">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">is_nil</span><span class="p" data-group-id="1498798283-6">(</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="p" data-group-id="1498798283-6">)</span><span class="w"> </span><span class="k" data-group-id="1498798283-5">end</span><span class="p">,</span><span class="w">                  </span><span class="c1"># Cheap</span><span class="w">
  </span><span class="k" data-group-id="1498798283-7">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">String</span><span class="o">.</span><span class="n">length</span><span class="p" data-group-id="1498798283-8">(</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p" data-group-id="1498798283-8">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k" data-group-id="1498798283-7">end</span><span class="w">          </span><span class="c1"># Cheap  </span><span class="w">
</span><span class="p" data-group-id="1498798283-2">]</span><span class="p" data-group-id="1498798283-1">)</span><span class="w">

</span><span class="c1"># ✅ Correct: cheap checks first, expensive last</span><span class="w">
</span><span class="n">efficient_validation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="1498798283-9">(</span><span class="p" data-group-id="1498798283-10">[</span><span class="w">
  </span><span class="k" data-group-id="1498798283-11">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">is_nil</span><span class="p" data-group-id="1498798283-12">(</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="p" data-group-id="1498798283-12">)</span><span class="w"> </span><span class="k" data-group-id="1498798283-11">end</span><span class="p">,</span><span class="w">                  </span><span class="c1"># Cheap first</span><span class="w">
  </span><span class="k" data-group-id="1498798283-13">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">String</span><span class="o">.</span><span class="n">length</span><span class="p" data-group-id="1498798283-14">(</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p" data-group-id="1498798283-14">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k" data-group-id="1498798283-13">end</span><span class="p">,</span><span class="w">         </span><span class="c1"># Still cheap</span><span class="w">
  </span><span class="k" data-group-id="1498798283-15">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">ExternalAPI</span><span class="o">.</span><span class="n">verify_identity</span><span class="p" data-group-id="1498798283-16">(</span><span class="n">user</span><span class="o">.</span><span class="n">ssn</span><span class="p" data-group-id="1498798283-16">)</span><span class="w"> </span><span class="k" data-group-id="1498798283-15">end</span><span class="w">  </span><span class="c1"># Expensive last</span><span class="w">
</span><span class="p" data-group-id="1498798283-10">]</span><span class="p" data-group-id="1498798283-9">)</span></code></pre><h3 id="don-t-return-non-boolean-values" class="section-heading">
  <a href="#don-t-return-non-boolean-values" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">❌ Don't Return Non-Boolean Values</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="c1"># ❌ Wrong: returning non-boolean</span><span class="w">
</span><span class="n">bad_predicate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="4237520437-1">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
  </span><span class="k">case</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">age</span><span class="w"> </span><span class="k" data-group-id="4237520437-2">do</span><span class="w">
    </span><span class="n">age</span><span class="w"> </span><span class="ow">when</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">18</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="ss">:adult</span><span class="w">
    </span><span class="n">age</span><span class="w"> </span><span class="ow">when</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">13</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="ss">:teen</span><span class="w">  
    </span><span class="bp">_</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="ss">:child</span><span class="w">
  </span><span class="k" data-group-id="4237520437-2">end</span><span class="w">
</span><span class="k" data-group-id="4237520437-1">end</span><span class="w">

</span><span class="c1"># ✅ Correct: always return boolean</span><span class="w">
</span><span class="n">good_adult_predicate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="4237520437-3">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">age</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">18</span><span class="w"> </span><span class="k" data-group-id="4237520437-3">end</span><span class="w">
</span><span class="n">good_teen_predicate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="4237520437-4">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">age</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">13</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">age</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">18</span><span class="w"> </span><span class="k" data-group-id="4237520437-4">end</span><span class="w">

</span><span class="c1"># If you need the classification, use a separate function</span><span class="w">
</span><span class="kd">def</span><span class="w"> </span><span class="nf">classify_user</span><span class="p" data-group-id="4237520437-5">(</span><span class="n">user</span><span class="p" data-group-id="4237520437-5">)</span><span class="w"> </span><span class="k" data-group-id="4237520437-6">do</span><span class="w">
  </span><span class="k">cond</span><span class="w"> </span><span class="k" data-group-id="4237520437-7">do</span><span class="w">
    </span><span class="n">good_adult_predicate</span><span class="o">.</span><span class="p" data-group-id="4237520437-8">(</span><span class="n">user</span><span class="p" data-group-id="4237520437-8">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="ss">:adult</span><span class="w">
    </span><span class="n">good_teen_predicate</span><span class="o">.</span><span class="p" data-group-id="4237520437-9">(</span><span class="n">user</span><span class="p" data-group-id="4237520437-9">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="ss">:teen</span><span class="w">
    </span><span class="no">true</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="ss">:child</span><span class="w">
  </span><span class="k" data-group-id="4237520437-7">end</span><span class="w">
</span><span class="k" data-group-id="4237520437-6">end</span></code></pre><h3 id="don-t-mix-types-in-composition" class="section-heading">
  <a href="#don-t-mix-types-in-composition" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">❌ Don't Mix Types in Composition</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="c1"># ❌ Wrong: predicates expecting different types  </span><span class="w">
</span><span class="n">mixed_predicates</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="4166842661-1">(</span><span class="p" data-group-id="4166842661-2">[</span><span class="w">
  </span><span class="k" data-group-id="4166842661-3">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">age</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">18</span><span class="w"> </span><span class="k" data-group-id="4166842661-3">end</span><span class="p">,</span><span class="w">           </span><span class="c1"># Expects user struct</span><span class="w">
  </span><span class="k" data-group-id="4166842661-4">fn</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">String</span><span class="o">.</span><span class="n">length</span><span class="p" data-group-id="4166842661-5">(</span><span class="n">name</span><span class="p" data-group-id="4166842661-5">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k" data-group-id="4166842661-4">end</span><span class="w">   </span><span class="c1"># Expects string</span><span class="w">
</span><span class="p" data-group-id="4166842661-2">]</span><span class="p" data-group-id="4166842661-1">)</span><span class="w">

</span><span class="c1"># ✅ Correct: consistent input types</span><span class="w">
</span><span class="n">user_predicates</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="4166842661-6">(</span><span class="p" data-group-id="4166842661-7">[</span><span class="w">
  </span><span class="k" data-group-id="4166842661-8">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">age</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">18</span><span class="w"> </span><span class="k" data-group-id="4166842661-8">end</span><span class="p">,</span><span class="w">
  </span><span class="k" data-group-id="4166842661-9">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">String</span><span class="o">.</span><span class="n">length</span><span class="p" data-group-id="4166842661-10">(</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="p" data-group-id="4166842661-10">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k" data-group-id="4166842661-9">end</span><span class="p">,</span><span class="w">  </span><span class="c1"># Extract field first</span><span class="w">
  </span><span class="k" data-group-id="4166842661-11">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">is_nil</span><span class="p" data-group-id="4166842661-12">(</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p" data-group-id="4166842661-12">)</span><span class="w"> </span><span class="k" data-group-id="4166842661-11">end</span><span class="w">
</span><span class="p" data-group-id="4166842661-7">]</span><span class="p" data-group-id="4166842661-6">)</span></code></pre><h3 id="don-t-ignore-error-cases" class="section-heading">
  <a href="#don-t-ignore-error-cases" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">❌ Don't Ignore Error Cases</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="c1"># ❌ Wrong: not handling potential errors</span><span class="w">
</span><span class="n">unsafe_predicate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="7345411232-1">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
  </span><span class="n">user</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">notifications</span><span class="o">.</span><span class="n">email</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">true</span><span class="w">  </span><span class="c1"># Could crash!</span><span class="w">
</span><span class="k" data-group-id="7345411232-1">end</span><span class="w">

</span><span class="c1"># ✅ Correct: safe field access</span><span class="w">
</span><span class="n">safe_predicate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="7345411232-2">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
  </span><span class="n">get_in</span><span class="p" data-group-id="7345411232-3">(</span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7345411232-4">[</span><span class="ss">:profile</span><span class="p">,</span><span class="w"> </span><span class="ss">:preferences</span><span class="p">,</span><span class="w"> </span><span class="ss">:notifications</span><span class="p">,</span><span class="w"> </span><span class="ss">:email</span><span class="p" data-group-id="7345411232-4">]</span><span class="p" data-group-id="7345411232-3">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">true</span><span class="w">
</span><span class="k" data-group-id="7345411232-2">end</span><span class="w">

</span><span class="c1"># ✅ Even better: with nil checks</span><span class="w">
</span><span class="n">better_predicate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="7345411232-5">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
  </span><span class="k">case</span><span class="w"> </span><span class="n">get_in</span><span class="p" data-group-id="7345411232-6">(</span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7345411232-7">[</span><span class="ss">:profile</span><span class="p">,</span><span class="w"> </span><span class="ss">:preferences</span><span class="p">,</span><span class="w"> </span><span class="ss">:notifications</span><span class="p">,</span><span class="w"> </span><span class="ss">:email</span><span class="p" data-group-id="7345411232-7">]</span><span class="p" data-group-id="7345411232-6">)</span><span class="w"> </span><span class="k" data-group-id="7345411232-8">do</span><span class="w">
    </span><span class="no">true</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">true</span><span class="w">
    </span><span class="bp">_</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">false</span><span class="w">
  </span><span class="k" data-group-id="7345411232-8">end</span><span class="w">
</span><span class="k" data-group-id="7345411232-5">end</span></code></pre><h3 id="don-t-create-overly-complex-single-predicates" class="section-heading">
  <a href="#don-t-create-overly-complex-single-predicates" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">❌ Don't Create Overly Complex Single Predicates</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="c1"># ❌ Wrong: overly complex single predicate</span><span class="w">
</span><span class="n">complex_predicate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="1373408798-1">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
  </span><span class="n">user</span><span class="o">.</span><span class="n">age</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">18</span><span class="w"> </span><span class="ow">and</span><span class="w"> 
  </span><span class="n">user</span><span class="o">.</span><span class="n">active</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">true</span><span class="w"> </span><span class="ow">and</span><span class="w">
  </span><span class="n">user</span><span class="o">.</span><span class="n">verified</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">true</span><span class="w"> </span><span class="ow">and</span><span class="w">
  </span><span class="nc">String</span><span class="o">.</span><span class="n">contains?</span><span class="p" data-group-id="1373408798-2">(</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;@&quot;</span><span class="p" data-group-id="1373408798-2">)</span><span class="w"> </span><span class="ow">and</span><span class="w">
  </span><span class="n">user</span><span class="o">.</span><span class="n">role</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="p" data-group-id="1373408798-3">[</span><span class="ss">:admin</span><span class="p">,</span><span class="w"> </span><span class="ss">:moderator</span><span class="p">,</span><span class="w"> </span><span class="ss">:user</span><span class="p" data-group-id="1373408798-3">]</span><span class="w"> </span><span class="ow">and</span><span class="w">
  </span><span class="n">length</span><span class="p" data-group-id="1373408798-4">(</span><span class="n">user</span><span class="o">.</span><span class="n">permissions</span><span class="p" data-group-id="1373408798-4">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="ow">and</span><span class="w">
  </span><span class="ow">not</span><span class="w"> </span><span class="n">is_nil</span><span class="p" data-group-id="1373408798-5">(</span><span class="n">user</span><span class="o">.</span><span class="n">last_login</span><span class="p" data-group-id="1373408798-5">)</span><span class="w"> </span><span class="ow">and</span><span class="w">
  </span><span class="nc">DateTime</span><span class="o">.</span><span class="n">diff</span><span class="p" data-group-id="1373408798-6">(</span><span class="nc">DateTime</span><span class="o">.</span><span class="n">utc_now</span><span class="p" data-group-id="1373408798-7">(</span><span class="p" data-group-id="1373408798-7">)</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">last_login</span><span class="p">,</span><span class="w"> </span><span class="ss">:day</span><span class="p" data-group-id="1373408798-6">)</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">30</span><span class="w">
</span><span class="k" data-group-id="1373408798-1">end</span><span class="w">

</span><span class="c1"># ✅ Correct: break down into composable parts</span><span class="w">
</span><span class="n">basic_checks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="1373408798-8">(</span><span class="p" data-group-id="1373408798-9">[</span><span class="w">
  </span><span class="k" data-group-id="1373408798-10">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">age</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">18</span><span class="w"> </span><span class="k" data-group-id="1373408798-10">end</span><span class="p">,</span><span class="w">
  </span><span class="k" data-group-id="1373408798-11">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">active</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">true</span><span class="w"> </span><span class="k" data-group-id="1373408798-11">end</span><span class="p">,</span><span class="w">
  </span><span class="k" data-group-id="1373408798-12">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">verified</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">true</span><span class="w"> </span><span class="k" data-group-id="1373408798-12">end</span><span class="w">
</span><span class="p" data-group-id="1373408798-9">]</span><span class="p" data-group-id="1373408798-8">)</span><span class="w">

</span><span class="n">account_checks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="1373408798-13">(</span><span class="p" data-group-id="1373408798-14">[</span><span class="w">
  </span><span class="k" data-group-id="1373408798-15">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">String</span><span class="o">.</span><span class="n">contains?</span><span class="p" data-group-id="1373408798-16">(</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;@&quot;</span><span class="p" data-group-id="1373408798-16">)</span><span class="w"> </span><span class="k" data-group-id="1373408798-15">end</span><span class="p">,</span><span class="w">
  </span><span class="k" data-group-id="1373408798-17">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">role</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="p" data-group-id="1373408798-18">[</span><span class="ss">:admin</span><span class="p">,</span><span class="w"> </span><span class="ss">:moderator</span><span class="p">,</span><span class="w"> </span><span class="ss">:user</span><span class="p" data-group-id="1373408798-18">]</span><span class="w"> </span><span class="k" data-group-id="1373408798-17">end</span><span class="p">,</span><span class="w">
  </span><span class="k" data-group-id="1373408798-19">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">length</span><span class="p" data-group-id="1373408798-20">(</span><span class="n">user</span><span class="o">.</span><span class="n">permissions</span><span class="p" data-group-id="1373408798-20">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k" data-group-id="1373408798-19">end</span><span class="w">
</span><span class="p" data-group-id="1373408798-14">]</span><span class="p" data-group-id="1373408798-13">)</span><span class="w">

</span><span class="n">activity_checks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="1373408798-21">(</span><span class="p" data-group-id="1373408798-22">[</span><span class="w">
  </span><span class="k" data-group-id="1373408798-23">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">is_nil</span><span class="p" data-group-id="1373408798-24">(</span><span class="n">user</span><span class="o">.</span><span class="n">last_login</span><span class="p" data-group-id="1373408798-24">)</span><span class="w"> </span><span class="k" data-group-id="1373408798-23">end</span><span class="p">,</span><span class="w">
  </span><span class="k" data-group-id="1373408798-25">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">DateTime</span><span class="o">.</span><span class="n">diff</span><span class="p" data-group-id="1373408798-26">(</span><span class="nc">DateTime</span><span class="o">.</span><span class="n">utc_now</span><span class="p" data-group-id="1373408798-27">(</span><span class="p" data-group-id="1373408798-27">)</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">last_login</span><span class="p">,</span><span class="w"> </span><span class="ss">:day</span><span class="p" data-group-id="1373408798-26">)</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="k" data-group-id="1373408798-25">end</span><span class="w">
</span><span class="p" data-group-id="1373408798-22">]</span><span class="p" data-group-id="1373408798-21">)</span><span class="w">

</span><span class="n">complete_validation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="1373408798-28">(</span><span class="p" data-group-id="1373408798-29">[</span><span class="n">basic_checks</span><span class="p">,</span><span class="w"> </span><span class="n">account_checks</span><span class="p">,</span><span class="w"> </span><span class="n">activity_checks</span><span class="p" data-group-id="1373408798-29">]</span><span class="p" data-group-id="1373408798-28">)</span></code></pre><h2 id="llm-integration-with-monoids" class="section-heading">
  <a href="#llm-integration-with-monoids" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">LLM Integration with Monoids</span>
</h2>
<p>Understanding the monoid connection helps with advanced predicate composition:</p><pre><code class="makeup elixir" translate="no"><span class="c1"># Predicates use All and Any monoids internally</span><span class="w">
</span><span class="kd">def</span><span class="w"> </span><span class="nf">demonstrate_monoid_connection</span><span class="p" data-group-id="6705075684-1">(</span><span class="p" data-group-id="6705075684-1">)</span><span class="w"> </span><span class="k" data-group-id="6705075684-2">do</span><span class="w">
  </span><span class="c1"># All monoid (AND behavior) - identity is true</span><span class="w">
  </span><span class="n">all_monoid_example</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="6705075684-3">(</span><span class="p" data-group-id="6705075684-4">[</span><span class="w">
    </span><span class="k" data-group-id="6705075684-5">fn</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k" data-group-id="6705075684-5">end</span><span class="p">,</span><span class="w">    </span><span class="c1"># First check</span><span class="w">
    </span><span class="k" data-group-id="6705075684-6">fn</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="k" data-group-id="6705075684-6">end</span><span class="w">   </span><span class="c1"># Second check  </span><span class="w">
  </span><span class="p" data-group-id="6705075684-4">]</span><span class="p" data-group-id="6705075684-3">)</span><span class="w">
  </span><span class="c1"># Equivalent to: All.concat([predicate1, predicate2])</span><span class="w">
  
  </span><span class="c1"># Any monoid (OR behavior) - identity is false  </span><span class="w">
  </span><span class="n">any_monoid_example</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">or_any</span><span class="p" data-group-id="6705075684-7">(</span><span class="p" data-group-id="6705075684-8">[</span><span class="w">
    </span><span class="k" data-group-id="6705075684-9">fn</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">:admin</span><span class="w"> </span><span class="k" data-group-id="6705075684-9">end</span><span class="p">,</span><span class="w">     </span><span class="c1"># First check</span><span class="w">
    </span><span class="k" data-group-id="6705075684-10">fn</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">:moderator</span><span class="w"> </span><span class="k" data-group-id="6705075684-10">end</span><span class="w">  </span><span class="c1"># Second check</span><span class="w">
  </span><span class="p" data-group-id="6705075684-8">]</span><span class="p" data-group-id="6705075684-7">)</span><span class="w">
  </span><span class="c1"># Equivalent to: Any.concat([predicate1, predicate2])</span><span class="w">
  
  </span><span class="c1"># Direct monoid usage (advanced)</span><span class="w">
  </span><span class="kn">alias</span><span class="w"> </span><span class="nc">Funx.Monoid.All</span><span class="w">
  </span><span class="kn">alias</span><span class="w"> </span><span class="nc">Funx.Monoid.Any</span><span class="w">
  
  </span><span class="c1"># Build using monoids directly</span><span class="w">
  </span><span class="n">manual_all</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">All</span><span class="o">.</span><span class="n">concat</span><span class="p" data-group-id="6705075684-11">(</span><span class="p" data-group-id="6705075684-12">[</span><span class="w">
    </span><span class="nc">All</span><span class="o">.</span><span class="n">new</span><span class="p" data-group-id="6705075684-13">(</span><span class="k" data-group-id="6705075684-14">fn</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k" data-group-id="6705075684-14">end</span><span class="p" data-group-id="6705075684-13">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">All</span><span class="o">.</span><span class="n">new</span><span class="p" data-group-id="6705075684-15">(</span><span class="k" data-group-id="6705075684-16">fn</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="k" data-group-id="6705075684-16">end</span><span class="p" data-group-id="6705075684-15">)</span><span class="w">
  </span><span class="p" data-group-id="6705075684-12">]</span><span class="p" data-group-id="6705075684-11">)</span><span class="w">
  
  </span><span class="n">manual_any</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Any</span><span class="o">.</span><span class="n">concat</span><span class="p" data-group-id="6705075684-17">(</span><span class="p" data-group-id="6705075684-18">[</span><span class="w">
    </span><span class="nc">Any</span><span class="o">.</span><span class="n">new</span><span class="p" data-group-id="6705075684-19">(</span><span class="k" data-group-id="6705075684-20">fn</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">:admin</span><span class="w"> </span><span class="k" data-group-id="6705075684-20">end</span><span class="p" data-group-id="6705075684-19">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">Any</span><span class="o">.</span><span class="n">new</span><span class="p" data-group-id="6705075684-21">(</span><span class="k" data-group-id="6705075684-22">fn</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">:moderator</span><span class="w"> </span><span class="k" data-group-id="6705075684-22">end</span><span class="p" data-group-id="6705075684-21">)</span><span class="w">
  </span><span class="p" data-group-id="6705075684-18">]</span><span class="p" data-group-id="6705075684-17">)</span><span class="w">
  
  </span><span class="c1"># Extract predicates from monoids</span><span class="w">
  </span><span class="n">all_pred</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">All</span><span class="o">.</span><span class="n">get_value</span><span class="p" data-group-id="6705075684-23">(</span><span class="n">manual_all</span><span class="p" data-group-id="6705075684-23">)</span><span class="w">
  </span><span class="n">any_pred</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Any</span><span class="o">.</span><span class="n">get_value</span><span class="p" data-group-id="6705075684-24">(</span><span class="n">manual_any</span><span class="p" data-group-id="6705075684-24">)</span><span class="w">
  
  </span><span class="p" data-group-id="6705075684-25">%{</span><span class="w">
    </span><span class="ss">standard_and</span><span class="p">:</span><span class="w"> </span><span class="n">all_monoid_example</span><span class="p">,</span><span class="w">
    </span><span class="ss">standard_or</span><span class="p">:</span><span class="w"> </span><span class="n">any_monoid_example</span><span class="p">,</span><span class="w">
    </span><span class="ss">manual_all</span><span class="p">:</span><span class="w"> </span><span class="n">all_pred</span><span class="p">,</span><span class="w">
    </span><span class="ss">manual_any</span><span class="p">:</span><span class="w"> </span><span class="n">any_pred</span><span class="w">
  </span><span class="p" data-group-id="6705075684-25">}</span><span class="w">
</span><span class="k" data-group-id="6705075684-2">end</span></code></pre><h2 id="summary" class="section-heading">
  <a href="#summary" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Summary</span>
</h2>
<p><a href="Funx.Predicate.html"><code class="inline">Funx.Predicate</code></a> provides composable boolean logic for validation, filtering, and conditional operations. It's built on solid mathematical foundations with monoid backing for efficient composition.</p><p><strong>Key capabilities:</strong></p><ul><li><strong>Composable validation</strong>: Build complex logic from simple predicates</li><li><strong>Monoid-backed operations</strong>: Mathematically sound with proper identity elements</li><li><strong>Short-circuiting evaluation</strong>: Efficient <code class="inline">and_all</code> and <code class="inline">or_any</code> operations</li><li><strong>Cross-module integration</strong>: Works seamlessly with Utils, Maybe, Either, and Enum</li><li><strong>Performance optimization</strong>: Put cheap predicates first for efficiency</li></ul><p><strong>Core patterns:</strong></p><ul><li>Use <code class="inline">and_all/1</code> when all conditions must be true</li><li>Use <code class="inline">or_any/1</code> when any condition can be true  </li><li>Use <a href="https://hexdocs.pm/elixir/Kernel.html#not/1"><code class="inline">not/1</code></a> for logical negation</li><li>Compose predicates rather than building complex single functions</li><li>Order predicates from cheapest to most expensive</li></ul><p><strong>Integration points:</strong></p><ul><li><strong>Utils</strong>: Curry predicates for pipeline use</li><li><strong>Monads</strong>: Convert predicates to Maybe/Either validators</li><li><strong>Collections</strong>: Use with Enum filtering and testing functions</li><li><strong>Monoids</strong>: Direct monoid usage for advanced composition patterns</li></ul><p><strong>Canon</strong>: Build from simple predicates, compose with monoid operations, optimize with short-circuiting, integrate across functional abstractions.</p>
</div>

<div class="bottom-actions" id="bottom-actions">
  <div class="bottom-actions-item">

      <a href="monoid-usage-rules.html" class="bottom-actions-button" rel="prev">
        <span class="subheader">
          ← Previous Page
        </span>
        <span class="title">
Funx.Monoid Usage Rules
        </span>
      </a>

  </div>
  <div class="bottom-actions-item">

      <a href="monad-usage-rules.html" class="bottom-actions-button" rel="next">
        <span class="subheader">
          Next Page →
        </span>
        <span class="title">
Funx.Monad Usage Rules
        </span>
      </a>

  </div>
</div>
    <footer class="footer">
      <p>

          <span class="line">
            <a href="https://hex.pm/packages/funx/0.1.4" class="footer-hex-package">Hex Package</a>

            <a href="https://preview.hex.pm/preview/funx/0.1.4">Hex Preview</a>

              (<a href="https://preview.hex.pm/preview/funx/0.1.4/show/lib/predicate/usage-rules.md">current file</a>)

          </span>

        <span class="line">
          <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
            Search HexDocs
          </button>

            <a href="funx.epub" title="ePub version">
              Download ePub version
            </a>

        </span>
      </p>

      <p class="built-using">
        Built using
        <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.34.2) for the

          <a href="https://elixir-lang.org" title="Elixir" target="_blank" translate="no">Elixir programming language</a>

      </p>

    </footer>
  </div>
</main>
</div>

  </body>
</html>
