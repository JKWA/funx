<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.34.2">
    <meta name="project" content="funx v0.1.5">


    <title>Funx.Predicate Usage Rules — funx v0.1.5</title>
    <link rel="stylesheet" href="dist/html-elixir-F2VRIOKR.css" />


      <link rel="canonical" href="https://hexdocs.pm/funx/predicate-usage-rules.html" />

    <script src="dist/handlebars.runtime-NWIB6V2M.js"></script>
    <script src="dist/handlebars.templates-K7URE6B4.js"></script>
    <script src="dist/sidebar_items-FD9C8F72.js"></script>
    <script src="docs_config.js"></script>
    <script async src="dist/html-YIPIRHGU.js"></script>

  </head>
  <body data-type="extras" class="page-extra">
    <script>

      try {
        var settings = JSON.parse(localStorage.getItem('ex_doc:settings') || '{}');

        if (settings.theme === 'dark' ||
           ((settings.theme === 'system' || settings.theme == null) &&
             window.matchMedia('(prefers-color-scheme: dark)').matches)
           ) {
          document.body.classList.add('dark')
        }
      } catch (error) { }
    </script>

<div class="body-wrapper">

<button id="sidebar-menu" class="sidebar-button sidebar-toggle" aria-label="toggle sidebar" aria-controls="sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<nav id="sidebar" class="sidebar">

  <div class="sidebar-header">
    <div class="sidebar-projectInfo">

      <div>
        <a href="readme.html" class="sidebar-projectName" translate="no">
funx
        </a>
        <div class="sidebar-projectVersion" translate="no">
          v0.1.5
        </div>
      </div>
    </div>
    <ul id="sidebar-listNav" class="sidebar-listNav" role="tablist">
      <li>
        <button id="extras-list-tab-button" role="tab" data-type="extras" aria-controls="extras-tab-panel" aria-selected="true" tabindex="0">
Pages
        </button>
      </li>

        <li>
          <button id="modules-list-tab-button" role="tab" data-type="modules" aria-controls="modules-tab-panel" aria-selected="false" tabindex="-1">
            Modules
          </button>
        </li>


    </ul>
  </div>

  <div id="extras-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="extras-list-tab-button">
    <ul id="extras-full-list" class="full-list"></ul>
  </div>

    <div id="modules-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="modules-list-tab-button" hidden>
      <ul id="modules-full-list" class="full-list"></ul>
    </div>


</nav>

<main class="content">
  <output role="status" id="toast"></output>

  <div id="content" class="content-inner">
    <div class="top-search">
      <div class="search-settings">
        <form class="search-bar" action="search.html">
          <label class="search-label">
            <span class="sr-only">Search documentation of funx</span>
            <input name="q" type="text" class="search-input" placeholder="Press / to search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
          </label>
          <button type="submit" class="search-button" aria-label="Submit Search">
            <i class="ri-search-2-line ri-lg" aria-hidden="true" title="Submit search"></i>
          </button>
          <button type="button" tabindex="-1" class="search-close-button" aria-hidden="true">
            <i class="ri-close-line ri-lg" title="Cancel search"></i>
          </button>
        </form>
        <div class="autocomplete">
        </div>
        <button class="icon-settings display-settings">
          <i class="ri-settings-3-line"></i>
          <span class="sr-only">Settings</span>
        </button>
      </div>
    </div>

<div id="top-content">
  <h1>

      <a href="https://github.com/JKWA/funx/blob/v0.1.5/lib/predicate/usage-rules.md#L1" title="View Source" class="icon-action" rel="help">
        <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        <span class="sr-only">View Source</span>
      </a>


    <span><code class="inline">Funx.Predicate</code> Usage Rules</span>
  </h1>

<h2 id="llm-functional-programming-foundation" class="section-heading">
  <a href="#llm-functional-programming-foundation" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">LLM Functional Programming Foundation</span>
</h2>
<p><strong>Key Concepts for LLMs:</strong></p><p><strong>Predicate</strong>: A function that tests conditions and returns boolean values</p><ul><li><strong>Type signature</strong>: <code class="inline">a -&gt; boolean</code> (takes a value, returns true/false)</li><li><strong>Purpose</strong>: Enable composable, reusable validation and filtering logic</li><li><strong>Mathematical foundation</strong>: Based on Boolean algebra with logical operations</li><li><strong>Composition</strong>: Predicates can be combined using AND, OR, NOT operations</li></ul><p><strong>Monoid Backing</strong>: Predicates are backed by monoid operations for composition</p><ul><li><strong>All monoid (AND-based)</strong>: Short-circuits on first false, requires all conditions to be true</li><li><strong>Any monoid (OR-based)</strong>: Short-circuits on first true, succeeds if any condition is true</li><li><strong>Identity elements</strong>: <code class="inline">always_true</code> for All, <code class="inline">always_false</code> for Any</li><li><strong>Associativity</strong>: Order of composition doesn't affect result</li></ul><p><strong>Logical Laws</strong>: Predicates follow Boolean algebra laws</p><ul><li><strong>Identity</strong>: <code class="inline">p AND true = p</code>, <code class="inline">p OR false = p</code></li><li><strong>Commutativity</strong>: <code class="inline">p AND q = q AND p</code>, <code class="inline">p OR q = q OR p</code></li><li><strong>Associativity</strong>: <code class="inline">(p AND q) AND r = p AND (q AND r)</code></li><li><strong>De Morgan's Laws</strong>: <code class="inline">NOT(p AND q) = NOT p OR NOT q</code></li></ul><p><strong>Short-Circuiting</strong>: Efficient evaluation stops at first definitive result</p><ul><li><strong>AND operations</strong>: Stop at first false predicate</li><li><strong>OR operations</strong>: Stop at first true predicate</li><li><strong>Performance benefit</strong>: Avoid expensive later computations</li></ul><p><strong>Composition Patterns</strong>: Build complex logic from simple predicates</p><ul><li><strong>Layered validation</strong>: Basic checks before expensive operations</li><li><strong>Business rules</strong>: Combine multiple conditions into domain logic</li><li><strong>Filtering pipelines</strong>: Chain predicates for data processing</li></ul><h2 id="llm-decision-guide-when-to-use-predicates" class="section-heading">
  <a href="#llm-decision-guide-when-to-use-predicates" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">LLM Decision Guide: When to Use Predicates</span>
</h2>
<p><strong>✅ Use Predicates when:</strong></p><ul><li>Need reusable validation logic</li><li>Building complex conditional logic from simple parts</li><li>Want to compose boolean conditions</li><li>Need to filter collections based on multiple criteria</li><li>User says: &quot;validate&quot;, &quot;filter&quot;, &quot;condition&quot;, &quot;check if&quot;, &quot;business rules&quot;</li></ul><p><strong>❌ Don't use Predicates when:</strong></p><ul><li>Simple one-off boolean expressions</li><li>Single validation that won't be reused</li><li>Performance is absolutely critical (function call overhead)</li><li>Logic is too complex for boolean composition</li></ul><p><strong>⚡ Predicate vs. Direct Boolean Decision:</strong></p><ul><li><strong>Predicates</strong>: Reusable, composable, testable validation logic</li><li><strong>Direct booleans</strong>: Simple, one-off conditional checks</li><li><strong>Rule</strong>: Use predicates when logic will be reused or composed</li></ul><p><strong>⚙️ Function Choice Guide:</strong></p><ul><li><strong><code class="inline">and_all/1</code></strong>: All conditions must be true (short-circuits on false)</li><li><strong><code class="inline">or_any/1</code></strong>: Any condition can be true (short-circuits on true)</li><li><strong><a href="https://hexdocs.pm/elixir/Kernel.html#not/1"><code class="inline">not/1</code></a></strong>: Invert a predicate (logical negation)</li><li><strong><code class="inline">test/2</code></strong>: Apply predicate to value with error handling</li></ul><h2 id="llm-context-clues" class="section-heading">
  <a href="#llm-context-clues" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">LLM Context Clues</span>
</h2>
<p><strong>User language → Predicate patterns:</strong></p><ul><li>&quot;validate multiple conditions&quot; → <code class="inline">and_all</code> composition</li><li>&quot;any of these conditions&quot; → <code class="inline">or_any</code> composition</li><li>&quot;opposite of&quot; or &quot;not&quot; → <a href="https://hexdocs.pm/elixir/Kernel.html#not/1"><code class="inline">not/1</code></a> negation</li><li>&quot;business rules&quot; → Complex predicate composition</li><li>&quot;filter by conditions&quot; → Predicate with Enum.filter</li><li>&quot;access control&quot; → Role-based predicate composition</li><li>&quot;data validation&quot; → Layered predicate pipelines</li><li>&quot;conditional logic&quot; → Predicate composition with Utils</li></ul><h2 id="quick-reference" class="section-heading">
  <a href="#quick-reference" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Quick Reference</span>
</h2>
<ul><li><strong>Core concepts</strong>: Functions returning boolean values for conditions</li><li><strong>Monoid backing</strong>: Uses All (AND) and Any (OR) monoids for composition</li><li><strong>Main operations</strong>: <code class="inline">and_all/1</code>, <code class="inline">or_any/1</code>, <a href="https://hexdocs.pm/elixir/Kernel.html#not/1"><code class="inline">not/1</code></a>, <code class="inline">test/2</code></li><li><strong>Performance</strong>: Short-circuiting evaluation for efficiency</li><li><strong>Composition</strong>: Build complex logic from simple predicate functions</li></ul><h2 id="overview" class="section-heading">
  <a href="#overview" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Overview</span>
</h2>
<p><a href="Funx.Predicate.html"><code class="inline">Funx.Predicate</code></a> provides utilities for building and composing predicate functions (functions that return boolean values). Predicates are essential for validation, filtering, and conditional logic in functional programming.</p><p>The module is backed by monoid operations, enabling composable boolean logic with proper short-circuiting behavior. This makes it efficient and mathematically sound for building complex conditional systems.</p><h2 id="composition-rules" class="section-heading">
  <a href="#composition-rules" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Composition Rules</span>
</h2>
<table><thead><tr><th style="text-align: left;">Function</th><th style="text-align: left;">Type Signature</th><th style="text-align: left;">Purpose</th></tr></thead><tbody><tr><td style="text-align: left;"><code class="inline">and_all/1</code></td><td style="text-align: left;"><code class="inline">[a -&gt; boolean] -&gt; a -&gt; boolean</code></td><td style="text-align: left;">All predicates must be true (AND)</td></tr><tr><td style="text-align: left;"><code class="inline">or_any/1</code></td><td style="text-align: left;"><code class="inline">[a -&gt; boolean] -&gt; a -&gt; boolean</code></td><td style="text-align: left;">Any predicate can be true (OR)</td></tr><tr><td style="text-align: left;"><a href="https://hexdocs.pm/elixir/Kernel.html#not/1"><code class="inline">not/1</code></a></td><td style="text-align: left;"><code class="inline">(a -&gt; boolean) -&gt; a -&gt; boolean</code></td><td style="text-align: left;">Logical negation of predicate</td></tr><tr><td style="text-align: left;"><code class="inline">test/2</code></td><td style="text-align: left;"><code class="inline">(a -&gt; boolean) -&gt; a -&gt; boolean</code></td><td style="text-align: left;">Apply predicate to value, ensuring boolean result</td></tr></tbody></table><p>These functions enable building complex boolean logic from simple predicate functions while maintaining performance through short-circuiting.</p><p><strong>Monoid Law Guarantees</strong>: Because predicate composition is built on monoids (All and Any), it inherits mathematical guarantees:</p><ul><li><strong>Associativity</strong>: Grouping doesn't matter - <code class="inline">(p1 AND p2) AND p3 = p1 AND (p2 AND p3)</code></li><li><strong>Identity</strong>: Neutral elements - <code class="inline">and_all([])</code> returns <code class="inline">fn _ -&gt; true end</code>, <code class="inline">or_any([])</code> returns <code class="inline">fn _ -&gt; false end</code></li><li><strong>Short-circuiting</strong>: Efficient evaluation - <code class="inline">and_all</code> stops at first false, <code class="inline">or_any</code> stops at first true</li></ul><p><strong>Predicate Arity</strong>: Predicates used in <code class="inline">and_all/1</code> and <code class="inline">or_any/1</code> must be unary (1-arity). If more context is needed, use partially applied closures or higher-order predicate factories.</p><h2 id="correct-usage-patterns" class="section-heading">
  <a href="#correct-usage-patterns" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Correct Usage Patterns</span>
</h2>
<h3 id="combining-predicates" class="section-heading">
  <a href="#combining-predicates" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Combining Predicates</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="c1"># Individual predicates</span><span class="w">
</span><span class="n">is_adult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="0776596787-1">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">age</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">18</span><span class="w"> </span><span class="k" data-group-id="0776596787-1">end</span><span class="w">
</span><span class="n">has_email</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="0776596787-2">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">String</span><span class="o">.</span><span class="n">contains?</span><span class="p" data-group-id="0776596787-3">(</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;@&quot;</span><span class="p" data-group-id="0776596787-3">)</span><span class="w"> </span><span class="k" data-group-id="0776596787-2">end</span><span class="w">  
</span><span class="n">is_active</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="0776596787-4">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">active</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">true</span><span class="w"> </span><span class="k" data-group-id="0776596787-4">end</span><span class="w">

</span><span class="c1"># Combine with AND (all must be true)</span><span class="w">
</span><span class="n">valid_user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="0776596787-5">(</span><span class="p" data-group-id="0776596787-6">[</span><span class="n">is_adult</span><span class="p">,</span><span class="w"> </span><span class="n">has_email</span><span class="p">,</span><span class="w"> </span><span class="n">is_active</span><span class="p" data-group-id="0776596787-6">]</span><span class="p" data-group-id="0776596787-5">)</span><span class="w">

</span><span class="c1"># Combine with OR (any can be true)  </span><span class="w">
</span><span class="n">admin_or_moderator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">or_any</span><span class="p" data-group-id="0776596787-7">(</span><span class="p" data-group-id="0776596787-8">[</span><span class="w">
  </span><span class="k" data-group-id="0776596787-9">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">role</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">:admin</span><span class="w"> </span><span class="k" data-group-id="0776596787-9">end</span><span class="p">,</span><span class="w">
  </span><span class="k" data-group-id="0776596787-10">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">role</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">:moderator</span><span class="w"> </span><span class="k" data-group-id="0776596787-10">end</span><span class="w">
</span><span class="p" data-group-id="0776596787-8">]</span><span class="p" data-group-id="0776596787-7">)</span><span class="w">

</span><span class="c1"># Test the composed predicates</span><span class="w">
</span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="0776596787-11">%{</span><span class="ss">age</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span><span class="w"> </span><span class="ss">email</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;user@example.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">active</span><span class="p">:</span><span class="w"> </span><span class="no">true</span><span class="p" data-group-id="0776596787-11">}</span><span class="w">
</span><span class="n">valid_user</span><span class="o">.</span><span class="p" data-group-id="0776596787-12">(</span><span class="n">user</span><span class="p" data-group-id="0776596787-12">)</span><span class="w">  </span><span class="c1"># =&gt; true</span></code></pre><h3 id="working-with-lists-and-filtering" class="section-heading">
  <a href="#working-with-lists-and-filtering" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Working with Lists and Filtering</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="n">users</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="6795371722-1">[</span><span class="w">
  </span><span class="p" data-group-id="6795371722-2">%{</span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">age</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="ss">active</span><span class="p">:</span><span class="w"> </span><span class="no">true</span><span class="p" data-group-id="6795371722-2">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="6795371722-3">%{</span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Bob&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">age</span><span class="p">:</span><span class="w"> </span><span class="mi">17</span><span class="p">,</span><span class="w"> </span><span class="ss">active</span><span class="p">:</span><span class="w"> </span><span class="no">true</span><span class="p" data-group-id="6795371722-3">}</span><span class="p">,</span><span class="w"> 
  </span><span class="p" data-group-id="6795371722-4">%{</span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Carol&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">age</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span><span class="w"> </span><span class="ss">active</span><span class="p">:</span><span class="w"> </span><span class="no">false</span><span class="p" data-group-id="6795371722-4">}</span><span class="w">
</span><span class="p" data-group-id="6795371722-1">]</span><span class="w">

</span><span class="c1"># Create filtering predicates</span><span class="w">
</span><span class="n">adult_filter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="6795371722-5">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">age</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">18</span><span class="w"> </span><span class="k" data-group-id="6795371722-5">end</span><span class="w">
</span><span class="n">active_filter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="6795371722-6">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">active</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">true</span><span class="w"> </span><span class="k" data-group-id="6795371722-6">end</span><span class="w">

</span><span class="c1"># Combine filters</span><span class="w">
</span><span class="n">valid_user_filter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="6795371722-7">(</span><span class="p" data-group-id="6795371722-8">[</span><span class="n">adult_filter</span><span class="p">,</span><span class="w"> </span><span class="n">active_filter</span><span class="p" data-group-id="6795371722-8">]</span><span class="p" data-group-id="6795371722-7">)</span><span class="w">

</span><span class="c1"># Apply to collection</span><span class="w">
</span><span class="n">valid_users</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">filter</span><span class="p" data-group-id="6795371722-9">(</span><span class="n">users</span><span class="p">,</span><span class="w"> </span><span class="n">valid_user_filter</span><span class="p" data-group-id="6795371722-9">)</span><span class="w">
</span><span class="c1"># =&gt; [%{name: &quot;Alice&quot;, age: 30, active: true}]</span></code></pre><h3 id="negation" class="section-heading">
  <a href="#negation" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Negation</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="c1"># Original predicate</span><span class="w">
</span><span class="n">is_admin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="2646831905-1">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">role</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">:admin</span><span class="w"> </span><span class="k" data-group-id="2646831905-1">end</span><span class="w">

</span><span class="c1"># Negated predicate</span><span class="w">
</span><span class="n">not_admin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="ow">not</span><span class="p" data-group-id="2646831905-2">(</span><span class="n">is_admin</span><span class="p" data-group-id="2646831905-2">)</span><span class="w">

</span><span class="c1"># Use for filtering</span><span class="w">
</span><span class="n">regular_users</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">filter</span><span class="p" data-group-id="2646831905-3">(</span><span class="n">all_users</span><span class="p">,</span><span class="w"> </span><span class="n">not_admin</span><span class="p" data-group-id="2646831905-3">)</span></code></pre><h2 id="compositional-guidelines" class="section-heading">
  <a href="#compositional-guidelines" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Compositional Guidelines</span>
</h2>
<p>Follow these patterns when generating or working with predicates:</p><ul><li><strong>Build from simple parts</strong>: Start with basic predicates and compose them</li><li><strong>Use descriptive names</strong>: Name intermediate predicates for clarity</li><li><strong>Layer validations</strong>: Put cheap checks before expensive ones</li><li><strong>Short-circuit efficiently</strong>: Use <code class="inline">and_all</code> and <code class="inline">or_any</code> for performance</li><li><strong>Avoid side effects</strong>: Keep predicates pure (no IO, mutations, etc.)</li><li><strong>Test compositions</strong>: Verify complex predicates work as expected</li></ul><h2 id="stability-contract" class="section-heading">
  <a href="#stability-contract" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Stability Contract</span>
</h2>
<p>Ensure that predicate functions maintain:</p><ul><li><strong>Purity</strong>: No side effects, same input produces same output</li><li><strong>Short-circuiting</strong>: <code class="inline">and_all</code> stops at first false, <code class="inline">or_any</code> stops at first true  </li><li><strong>Logical identity</strong>: Follow Boolean algebra laws and De Morgan's laws</li><li><strong>Type consistency</strong>: All predicates in a composition should accept same type</li><li><strong>Unary predicates</strong>: All predicates must be single-argument functions for composition</li></ul><h2 id="anti-patterns" class="section-heading">
  <a href="#anti-patterns" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Anti-Patterns</span>
</h2>
<p>Avoid generating or emitting:</p><ul><li><strong>Side effects in predicates</strong>: No IO, logging, or mutations</li><li><strong>Expensive operations early</strong>: Put cheap validations first</li><li><strong>Non-boolean returns</strong>: Predicates must return true/false</li><li><strong>Mixed input types</strong>: Keep predicates type-consistent within compositions</li><li><strong>Multi-arity predicates</strong>: Don't use predicates requiring multiple arguments in composition</li><li><strong>Deep nesting</strong>: Use intermediate named predicates instead</li></ul><h2 id="good-patterns" class="section-heading">
  <a href="#good-patterns" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Good Patterns</span>
</h2>
<p>Encourage completions like:</p><pre><code class="makeup elixir" translate="no"><span class="c1"># Named intermediate predicates for clarity</span><span class="w">
</span><span class="n">has_permission</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="9857986886-1">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">permissions</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">member?</span><span class="p" data-group-id="9857986886-2">(</span><span class="ss">:read</span><span class="p" data-group-id="9857986886-2">)</span><span class="w"> </span><span class="k" data-group-id="9857986886-1">end</span><span class="w">
</span><span class="n">within_rate_limit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="9857986886-3">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">requests_today</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="k" data-group-id="9857986886-3">end</span><span class="w">
</span><span class="n">account_active</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="9857986886-4">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">:active</span><span class="w"> </span><span class="k" data-group-id="9857986886-4">end</span><span class="w">

</span><span class="c1"># Composed authorization predicate</span><span class="w">
</span><span class="n">can_access</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="9857986886-5">(</span><span class="p" data-group-id="9857986886-6">[</span><span class="n">has_permission</span><span class="p">,</span><span class="w"> </span><span class="n">within_rate_limit</span><span class="p">,</span><span class="w"> </span><span class="n">account_active</span><span class="p" data-group-id="9857986886-6">]</span><span class="p" data-group-id="9857986886-5">)</span></code></pre><pre><code class="makeup elixir" translate="no"><span class="c1"># Proper arity handling for multi-context predicates</span><span class="w">
</span><span class="c1"># ❌ Wrong: multi-arity predicate</span><span class="w">
</span><span class="n">bad_access_check</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="8349423715-1">fn</span><span class="w"> </span><span class="n">resource</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">resource</span><span class="o">.</span><span class="n">owner_id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="w"> </span><span class="k" data-group-id="8349423715-1">end</span><span class="w">

</span><span class="c1"># ✅ Right: use closure or factory pattern</span><span class="w">
</span><span class="n">is_owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="8349423715-2">fn</span><span class="w"> </span><span class="n">resource</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
  </span><span class="k" data-group-id="8349423715-3">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">resource</span><span class="o">.</span><span class="n">owner_id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="w"> </span><span class="k" data-group-id="8349423715-3">end</span><span class="w">
</span><span class="k" data-group-id="8349423715-2">end</span><span class="w">

</span><span class="c1"># ✅ Right: partially applied closure</span><span class="w">
</span><span class="n">resource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="8349423715-4">%{</span><span class="ss">owner_id</span><span class="p">:</span><span class="w"> </span><span class="mi">123</span><span class="p" data-group-id="8349423715-4">}</span><span class="w">
</span><span class="n">owner_check</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">is_owner</span><span class="o">.</span><span class="p" data-group-id="8349423715-5">(</span><span class="n">resource</span><span class="p" data-group-id="8349423715-5">)</span><span class="w">  </span><span class="c1"># Returns unary predicate</span><span class="w">

</span><span class="c1"># Use in composition</span><span class="w">
</span><span class="n">access_predicates</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="8349423715-6">(</span><span class="p" data-group-id="8349423715-7">[</span><span class="w">
  </span><span class="n">owner_check</span><span class="p">,</span><span class="w">                    </span><span class="c1"># Unary predicate</span><span class="w">
  </span><span class="k" data-group-id="8349423715-8">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">active</span><span class="w"> </span><span class="k" data-group-id="8349423715-8">end</span><span class="p">,</span><span class="w">     </span><span class="c1"># Unary predicate</span><span class="w">
  </span><span class="k" data-group-id="8349423715-9">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">banned</span><span class="w"> </span><span class="k" data-group-id="8349423715-9">end</span><span class="w">  </span><span class="c1"># Unary predicate</span><span class="w">
</span><span class="p" data-group-id="8349423715-7">]</span><span class="p" data-group-id="8349423715-6">)</span></code></pre><pre><code class="makeup elixir" translate="no"><span class="c1"># Efficient layered validation (cheap checks first)</span><span class="w">
</span><span class="n">basic_validation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="1573999236-1">(</span><span class="p" data-group-id="1573999236-2">[</span><span class="w">
  </span><span class="k" data-group-id="1573999236-3">fn</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">is_nil</span><span class="p" data-group-id="1573999236-4">(</span><span class="n">data</span><span class="o">.</span><span class="n">id</span><span class="p" data-group-id="1573999236-4">)</span><span class="w"> </span><span class="k" data-group-id="1573999236-3">end</span><span class="p">,</span><span class="w">        </span><span class="c1"># Cheap null check</span><span class="w">
  </span><span class="k" data-group-id="1573999236-5">fn</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">String</span><span class="o">.</span><span class="n">length</span><span class="p" data-group-id="1573999236-6">(</span><span class="n">data</span><span class="o">.</span><span class="n">name</span><span class="p" data-group-id="1573999236-6">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k" data-group-id="1573999236-5">end</span><span class="w"> </span><span class="c1"># String length check</span><span class="w">
</span><span class="p" data-group-id="1573999236-2">]</span><span class="p" data-group-id="1573999236-1">)</span><span class="w">

</span><span class="n">expensive_validation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="1573999236-7">fn</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
  </span><span class="c1"># Expensive database check only after basic validation passes</span><span class="w">
  </span><span class="ow">not</span><span class="w"> </span><span class="nc">Database</span><span class="o">.</span><span class="n">user_exists?</span><span class="p" data-group-id="1573999236-8">(</span><span class="n">data</span><span class="o">.</span><span class="n">id</span><span class="p" data-group-id="1573999236-8">)</span><span class="w">
</span><span class="k" data-group-id="1573999236-7">end</span><span class="w">

</span><span class="n">full_validation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="1573999236-9">(</span><span class="p" data-group-id="1573999236-10">[</span><span class="n">basic_validation</span><span class="p">,</span><span class="w"> </span><span class="n">expensive_validation</span><span class="p" data-group-id="1573999236-10">]</span><span class="p" data-group-id="1573999236-9">)</span></code></pre><h2 id="llm-code-templates" class="section-heading">
  <a href="#llm-code-templates" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">LLM Code Templates</span>
</h2>
<h3 id="basic-validation-template" class="section-heading">
  <a href="#basic-validation-template" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Basic Validation Template</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="kd">def</span><span class="w"> </span><span class="nf">build_user_validator</span><span class="p" data-group-id="7136173942-1">(</span><span class="p" data-group-id="7136173942-1">)</span><span class="w"> </span><span class="k" data-group-id="7136173942-2">do</span><span class="w">
  </span><span class="c1"># Define individual validation predicates</span><span class="w">
  </span><span class="n">validations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="7136173942-3">%{</span><span class="w">
    </span><span class="ss">has_name</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="7136173942-4">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> 
      </span><span class="ow">not</span><span class="w"> </span><span class="n">is_nil</span><span class="p" data-group-id="7136173942-5">(</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="p" data-group-id="7136173942-5">)</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nc">String</span><span class="o">.</span><span class="n">length</span><span class="p" data-group-id="7136173942-6">(</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="p" data-group-id="7136173942-6">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> 
    </span><span class="k" data-group-id="7136173942-4">end</span><span class="p">,</span><span class="w">
    
    </span><span class="ss">valid_email</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="7136173942-7">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
      </span><span class="nc">String</span><span class="o">.</span><span class="n">contains?</span><span class="p" data-group-id="7136173942-8">(</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;@&quot;</span><span class="p" data-group-id="7136173942-8">)</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="nc">String</span><span class="o">.</span><span class="n">contains?</span><span class="p" data-group-id="7136173942-9">(</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;.&quot;</span><span class="p" data-group-id="7136173942-9">)</span><span class="w">
    </span><span class="k" data-group-id="7136173942-7">end</span><span class="p">,</span><span class="w">
    
    </span><span class="ss">adult_age</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="7136173942-10">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
      </span><span class="n">is_integer</span><span class="p" data-group-id="7136173942-11">(</span><span class="n">user</span><span class="o">.</span><span class="n">age</span><span class="p" data-group-id="7136173942-11">)</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">age</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">18</span><span class="w">
    </span><span class="k" data-group-id="7136173942-10">end</span><span class="p">,</span><span class="w">
    
    </span><span class="ss">active_status</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="7136173942-12">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
      </span><span class="n">user</span><span class="o">.</span><span class="n">status</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="p" data-group-id="7136173942-13">[</span><span class="ss">:active</span><span class="p">,</span><span class="w"> </span><span class="ss">:verified</span><span class="p" data-group-id="7136173942-13">]</span><span class="w">
    </span><span class="k" data-group-id="7136173942-12">end</span><span class="w">
  </span><span class="p" data-group-id="7136173942-3">}</span><span class="w">
  
  </span><span class="c1"># Compose basic validation (cheap checks)</span><span class="w">
  </span><span class="n">basic_validation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="7136173942-14">(</span><span class="p" data-group-id="7136173942-15">[</span><span class="w">
    </span><span class="n">validations</span><span class="o">.</span><span class="n">has_name</span><span class="p">,</span><span class="w">
    </span><span class="n">validations</span><span class="o">.</span><span class="n">adult_age</span><span class="p">,</span><span class="w">
    </span><span class="n">validations</span><span class="o">.</span><span class="n">active_status</span><span class="w">
  </span><span class="p" data-group-id="7136173942-15">]</span><span class="p" data-group-id="7136173942-14">)</span><span class="w">
  
  </span><span class="c1"># Compose expensive validation</span><span class="w">
  </span><span class="n">expensive_validation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="7136173942-16">(</span><span class="p" data-group-id="7136173942-17">[</span><span class="w">
    </span><span class="n">validations</span><span class="o">.</span><span class="n">valid_email</span><span class="p">,</span><span class="w">
    </span><span class="k" data-group-id="7136173942-18">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nc">UserRepo</span><span class="o">.</span><span class="n">email_exists?</span><span class="p" data-group-id="7136173942-19">(</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p" data-group-id="7136173942-19">)</span><span class="w"> </span><span class="k" data-group-id="7136173942-18">end</span><span class="w">  </span><span class="c1"># Database check</span><span class="w">
  </span><span class="p" data-group-id="7136173942-17">]</span><span class="p" data-group-id="7136173942-16">)</span><span class="w">
  
  </span><span class="c1"># Final composed validator</span><span class="w">
  </span><span class="n">complete_validator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="7136173942-20">(</span><span class="p" data-group-id="7136173942-21">[</span><span class="n">basic_validation</span><span class="p">,</span><span class="w"> </span><span class="n">expensive_validation</span><span class="p" data-group-id="7136173942-21">]</span><span class="p" data-group-id="7136173942-20">)</span><span class="w">
  
  </span><span class="c1"># Usage function</span><span class="w">
  </span><span class="k" data-group-id="7136173942-22">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="n">complete_validator</span><span class="o">.</span><span class="p" data-group-id="7136173942-23">(</span><span class="n">user</span><span class="p" data-group-id="7136173942-23">)</span><span class="w"> </span><span class="k" data-group-id="7136173942-24">do</span><span class="w">
      </span><span class="no">true</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p" data-group-id="7136173942-25">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p" data-group-id="7136173942-25">}</span><span class="w">
      </span><span class="no">false</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p" data-group-id="7136173942-26">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;User validation failed&quot;</span><span class="p" data-group-id="7136173942-26">}</span><span class="w">
    </span><span class="k" data-group-id="7136173942-24">end</span><span class="w">
  </span><span class="k" data-group-id="7136173942-22">end</span><span class="w">
</span><span class="k" data-group-id="7136173942-2">end</span><span class="w">

</span><span class="c1"># Usage</span><span class="w">
</span><span class="n">validator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">build_user_validator</span><span class="p" data-group-id="7136173942-27">(</span><span class="p" data-group-id="7136173942-27">)</span><span class="w">
</span><span class="n">validator</span><span class="o">.</span><span class="p" data-group-id="7136173942-28">(</span><span class="p" data-group-id="7136173942-29">%{</span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">email</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;alice@example.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">age</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span><span class="w"> </span><span class="ss">status</span><span class="p">:</span><span class="w"> </span><span class="ss">:active</span><span class="p" data-group-id="7136173942-29">}</span><span class="p" data-group-id="7136173942-28">)</span></code></pre><h3 id="access-control-template" class="section-heading">
  <a href="#access-control-template" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Access Control Template</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="kd">def</span><span class="w"> </span><span class="nf">build_access_control_system</span><span class="p" data-group-id="9569564617-1">(</span><span class="p" data-group-id="9569564617-1">)</span><span class="w"> </span><span class="k" data-group-id="9569564617-2">do</span><span class="w">
  </span><span class="c1"># Role-based predicates</span><span class="w">
  </span><span class="n">roles</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="9569564617-3">%{</span><span class="w">
    </span><span class="ss">is_admin</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="9569564617-4">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">role</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">:admin</span><span class="w"> </span><span class="k" data-group-id="9569564617-4">end</span><span class="p">,</span><span class="w">
    </span><span class="ss">is_moderator</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="9569564617-5">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">role</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">:moderator</span><span class="w"> </span><span class="k" data-group-id="9569564617-5">end</span><span class="p">,</span><span class="w">
    </span><span class="ss">is_owner</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="9569564617-6">fn</span><span class="w"> </span><span class="n">resource</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">resource</span><span class="o">.</span><span class="n">owner_id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="w"> </span><span class="k" data-group-id="9569564617-6">end</span><span class="p">,</span><span class="w">
    </span><span class="ss">is_collaborator</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="9569564617-7">fn</span><span class="w"> </span><span class="n">resource</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> 
      </span><span class="nc">Enum</span><span class="o">.</span><span class="n">member?</span><span class="p" data-group-id="9569564617-8">(</span><span class="n">resource</span><span class="o">.</span><span class="n">collaborator_ids</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p" data-group-id="9569564617-8">)</span><span class="w">
    </span><span class="k" data-group-id="9569564617-7">end</span><span class="w">
  </span><span class="p" data-group-id="9569564617-3">}</span><span class="w">
  
  </span><span class="c1"># Permission predicates</span><span class="w">
  </span><span class="n">permissions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="9569564617-9">%{</span><span class="w">
    </span><span class="ss">can_read</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="9569564617-10">fn</span><span class="w"> </span><span class="n">resource</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
      </span><span class="n">resource</span><span class="o">.</span><span class="n">visibility</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">:public</span><span class="w"> </span><span class="ow">or</span><span class="w">
      </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">or_any</span><span class="p" data-group-id="9569564617-11">(</span><span class="p" data-group-id="9569564617-12">[</span><span class="w">
        </span><span class="n">roles</span><span class="o">.</span><span class="n">is_admin</span><span class="p">,</span><span class="w">
        </span><span class="n">roles</span><span class="o">.</span><span class="n">is_owner</span><span class="o">.</span><span class="p" data-group-id="9569564617-13">(</span><span class="n">resource</span><span class="p" data-group-id="9569564617-13">)</span><span class="p">,</span><span class="w">
        </span><span class="n">roles</span><span class="o">.</span><span class="n">is_collaborator</span><span class="o">.</span><span class="p" data-group-id="9569564617-14">(</span><span class="n">resource</span><span class="p" data-group-id="9569564617-14">)</span><span class="w">
      </span><span class="p" data-group-id="9569564617-12">]</span><span class="p" data-group-id="9569564617-11">)</span><span class="o">.</span><span class="p" data-group-id="9569564617-15">(</span><span class="n">user</span><span class="p" data-group-id="9569564617-15">)</span><span class="w">
    </span><span class="k" data-group-id="9569564617-10">end</span><span class="p">,</span><span class="w">
    
    </span><span class="ss">can_write</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="9569564617-16">fn</span><span class="w"> </span><span class="n">resource</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
      </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">or_any</span><span class="p" data-group-id="9569564617-17">(</span><span class="p" data-group-id="9569564617-18">[</span><span class="w">
        </span><span class="n">roles</span><span class="o">.</span><span class="n">is_admin</span><span class="p">,</span><span class="w">
        </span><span class="n">roles</span><span class="o">.</span><span class="n">is_moderator</span><span class="p">,</span><span class="w">
        </span><span class="n">roles</span><span class="o">.</span><span class="n">is_owner</span><span class="o">.</span><span class="p" data-group-id="9569564617-19">(</span><span class="n">resource</span><span class="p" data-group-id="9569564617-19">)</span><span class="w">
      </span><span class="p" data-group-id="9569564617-18">]</span><span class="p" data-group-id="9569564617-17">)</span><span class="o">.</span><span class="p" data-group-id="9569564617-20">(</span><span class="n">user</span><span class="p" data-group-id="9569564617-20">)</span><span class="w">
    </span><span class="k" data-group-id="9569564617-16">end</span><span class="p">,</span><span class="w">
    
    </span><span class="ss">can_delete</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="9569564617-21">fn</span><span class="w"> </span><span class="n">resource</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
      </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">or_any</span><span class="p" data-group-id="9569564617-22">(</span><span class="p" data-group-id="9569564617-23">[</span><span class="w">
        </span><span class="n">roles</span><span class="o">.</span><span class="n">is_admin</span><span class="p">,</span><span class="w">
        </span><span class="n">roles</span><span class="o">.</span><span class="n">is_owner</span><span class="o">.</span><span class="p" data-group-id="9569564617-24">(</span><span class="n">resource</span><span class="p" data-group-id="9569564617-24">)</span><span class="w">
      </span><span class="p" data-group-id="9569564617-23">]</span><span class="p" data-group-id="9569564617-22">)</span><span class="o">.</span><span class="p" data-group-id="9569564617-25">(</span><span class="n">user</span><span class="p" data-group-id="9569564617-25">)</span><span class="w">
    </span><span class="k" data-group-id="9569564617-21">end</span><span class="w">
  </span><span class="p" data-group-id="9569564617-9">}</span><span class="w">
  
  </span><span class="c1"># Context-aware validation</span><span class="w">
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">authorize_action</span><span class="p" data-group-id="9569564617-26">(</span><span class="n">action</span><span class="p">,</span><span class="w"> </span><span class="n">resource</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p" data-group-id="9569564617-26">)</span><span class="w"> </span><span class="k" data-group-id="9569564617-27">do</span><span class="w">
    </span><span class="n">action_predicate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="n">action</span><span class="w"> </span><span class="k" data-group-id="9569564617-28">do</span><span class="w">
      </span><span class="ss">:read</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">permissions</span><span class="o">.</span><span class="n">can_read</span><span class="o">.</span><span class="p" data-group-id="9569564617-29">(</span><span class="n">resource</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p" data-group-id="9569564617-29">)</span><span class="w">
      </span><span class="ss">:write</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">permissions</span><span class="o">.</span><span class="n">can_write</span><span class="o">.</span><span class="p" data-group-id="9569564617-30">(</span><span class="n">resource</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p" data-group-id="9569564617-30">)</span><span class="w">
      </span><span class="ss">:delete</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">permissions</span><span class="o">.</span><span class="n">can_delete</span><span class="o">.</span><span class="p" data-group-id="9569564617-31">(</span><span class="n">resource</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p" data-group-id="9569564617-31">)</span><span class="w">
    </span><span class="k" data-group-id="9569564617-28">end</span><span class="w">
    
    </span><span class="c1"># Additional context checks</span><span class="w">
    </span><span class="n">context_checks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="9569564617-32">(</span><span class="p" data-group-id="9569564617-33">[</span><span class="w">
      </span><span class="k" data-group-id="9569564617-34">fn</span><span class="w"> </span><span class="bp">_</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">:active</span><span class="w"> </span><span class="k" data-group-id="9569564617-34">end</span><span class="p">,</span><span class="w">
      </span><span class="k" data-group-id="9569564617-35">fn</span><span class="w"> </span><span class="bp">_</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">banned</span><span class="w"> </span><span class="k" data-group-id="9569564617-35">end</span><span class="p">,</span><span class="w">
      </span><span class="k" data-group-id="9569564617-36">fn</span><span class="w"> </span><span class="bp">_</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">resource</span><span class="o">.</span><span class="n">status</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="ss">:archived</span><span class="w"> </span><span class="k" data-group-id="9569564617-36">end</span><span class="w">
    </span><span class="p" data-group-id="9569564617-33">]</span><span class="p" data-group-id="9569564617-32">)</span><span class="w">
    
    </span><span class="n">final_check</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="9569564617-37">(</span><span class="p" data-group-id="9569564617-38">[</span><span class="w">
      </span><span class="k" data-group-id="9569564617-39">fn</span><span class="w"> </span><span class="bp">_</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">action_predicate</span><span class="w"> </span><span class="k" data-group-id="9569564617-39">end</span><span class="p">,</span><span class="w">
      </span><span class="n">context_checks</span><span class="w">
    </span><span class="p" data-group-id="9569564617-38">]</span><span class="p" data-group-id="9569564617-37">)</span><span class="w">
    
    </span><span class="n">final_check</span><span class="o">.</span><span class="p" data-group-id="9569564617-40">(</span><span class="n">user</span><span class="p" data-group-id="9569564617-40">)</span><span class="w">
  </span><span class="k" data-group-id="9569564617-27">end</span><span class="w">
  
  </span><span class="p" data-group-id="9569564617-41">%{</span><span class="ss">authorize</span><span class="p">:</span><span class="w"> </span><span class="o">&amp;</span><span class="n">authorize_action</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="ss">permissions</span><span class="p">:</span><span class="w"> </span><span class="n">permissions</span><span class="p">,</span><span class="w"> </span><span class="ss">roles</span><span class="p">:</span><span class="w"> </span><span class="n">roles</span><span class="p" data-group-id="9569564617-41">}</span><span class="w">
</span><span class="k" data-group-id="9569564617-2">end</span></code></pre><h3 id="filtering-pipeline-template" class="section-heading">
  <a href="#filtering-pipeline-template" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Filtering Pipeline Template</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="kd">def</span><span class="w"> </span><span class="nf">build_data_filtering_pipeline</span><span class="p" data-group-id="9712715286-1">(</span><span class="p" data-group-id="9712715286-1">)</span><span class="w"> </span><span class="k" data-group-id="9712715286-2">do</span><span class="w">
  </span><span class="c1"># Stage 1: Basic data quality filters</span><span class="w">
  </span><span class="n">quality_filters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="9712715286-3">%{</span><span class="w">
    </span><span class="ss">not_nil</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="9712715286-4">fn</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">is_nil</span><span class="p" data-group-id="9712715286-5">(</span><span class="n">item</span><span class="p" data-group-id="9712715286-5">)</span><span class="w"> </span><span class="k" data-group-id="9712715286-4">end</span><span class="p">,</span><span class="w">
    </span><span class="ss">has_required_fields</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="9712715286-6">fn</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> 
      </span><span class="p" data-group-id="9712715286-7">[</span><span class="ss">:id</span><span class="p">,</span><span class="w"> </span><span class="ss">:name</span><span class="p">,</span><span class="w"> </span><span class="ss">:created_at</span><span class="p" data-group-id="9712715286-7">]</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">all?</span><span class="p" data-group-id="9712715286-8">(</span><span class="k" data-group-id="9712715286-9">fn</span><span class="w"> </span><span class="n">field</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> 
        </span><span class="nc">Map</span><span class="o">.</span><span class="n">has_key?</span><span class="p" data-group-id="9712715286-10">(</span><span class="n">item</span><span class="p">,</span><span class="w"> </span><span class="n">field</span><span class="p" data-group-id="9712715286-10">)</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">is_nil</span><span class="p" data-group-id="9712715286-11">(</span><span class="n">item</span><span class="p" data-group-id="9712715286-12">[</span><span class="n">field</span><span class="p" data-group-id="9712715286-12">]</span><span class="p" data-group-id="9712715286-11">)</span><span class="w">
      </span><span class="k" data-group-id="9712715286-9">end</span><span class="p" data-group-id="9712715286-8">)</span><span class="w">
    </span><span class="k" data-group-id="9712715286-6">end</span><span class="p">,</span><span class="w">
    </span><span class="ss">valid_timestamps</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="9712715286-13">fn</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
      </span><span class="n">is_struct</span><span class="p" data-group-id="9712715286-14">(</span><span class="n">item</span><span class="o">.</span><span class="n">created_at</span><span class="p">,</span><span class="w"> </span><span class="nc">DateTime</span><span class="p" data-group-id="9712715286-14">)</span><span class="w"> </span><span class="ow">and</span><span class="w"> 
      </span><span class="nc">DateTime</span><span class="o">.</span><span class="n">compare</span><span class="p" data-group-id="9712715286-15">(</span><span class="n">item</span><span class="o">.</span><span class="n">created_at</span><span class="p">,</span><span class="w"> </span><span class="nc">DateTime</span><span class="o">.</span><span class="n">utc_now</span><span class="p" data-group-id="9712715286-16">(</span><span class="p" data-group-id="9712715286-16">)</span><span class="p" data-group-id="9712715286-15">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">:lt</span><span class="w">
    </span><span class="k" data-group-id="9712715286-13">end</span><span class="w">
  </span><span class="p" data-group-id="9712715286-3">}</span><span class="w">
  
  </span><span class="c1"># Stage 2: Business logic filters  </span><span class="w">
  </span><span class="n">business_filters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="9712715286-17">%{</span><span class="w">
    </span><span class="ss">active_status</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="9712715286-18">fn</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">item</span><span class="o">.</span><span class="n">status</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="p" data-group-id="9712715286-19">[</span><span class="ss">:active</span><span class="p">,</span><span class="w"> </span><span class="ss">:published</span><span class="p" data-group-id="9712715286-19">]</span><span class="w"> </span><span class="k" data-group-id="9712715286-18">end</span><span class="p">,</span><span class="w">
    </span><span class="ss">within_date_range</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="9712715286-20">fn</span><span class="w"> </span><span class="n">start_date</span><span class="p">,</span><span class="w"> </span><span class="n">end_date</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
      </span><span class="k" data-group-id="9712715286-21">fn</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
        </span><span class="nc">DateTime</span><span class="o">.</span><span class="n">compare</span><span class="p" data-group-id="9712715286-22">(</span><span class="n">item</span><span class="o">.</span><span class="n">created_at</span><span class="p">,</span><span class="w"> </span><span class="n">start_date</span><span class="p" data-group-id="9712715286-22">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="ss">:lt</span><span class="w"> </span><span class="ow">and</span><span class="w">
        </span><span class="nc">DateTime</span><span class="o">.</span><span class="n">compare</span><span class="p" data-group-id="9712715286-23">(</span><span class="n">item</span><span class="o">.</span><span class="n">created_at</span><span class="p">,</span><span class="w"> </span><span class="n">end_date</span><span class="p" data-group-id="9712715286-23">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="ss">:gt</span><span class="w">
      </span><span class="k" data-group-id="9712715286-21">end</span><span class="w">
    </span><span class="k" data-group-id="9712715286-20">end</span><span class="p">,</span><span class="w">
    </span><span class="ss">meets_threshold</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="9712715286-24">fn</span><span class="w"> </span><span class="n">threshold_field</span><span class="p">,</span><span class="w"> </span><span class="n">min_value</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
      </span><span class="k" data-group-id="9712715286-25">fn</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
        </span><span class="nc">Map</span><span class="o">.</span><span class="n">get</span><span class="p" data-group-id="9712715286-26">(</span><span class="n">item</span><span class="p">,</span><span class="w"> </span><span class="n">threshold_field</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="9712715286-26">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">min_value</span><span class="w">
      </span><span class="k" data-group-id="9712715286-25">end</span><span class="w">
    </span><span class="k" data-group-id="9712715286-24">end</span><span class="w">
  </span><span class="p" data-group-id="9712715286-17">}</span><span class="w">
  
  </span><span class="c1"># Stage 3: User-specific filters</span><span class="w">
  </span><span class="n">user_filters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="9712715286-27">%{</span><span class="w">
    </span><span class="ss">user_can_see</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="9712715286-28">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
      </span><span class="k" data-group-id="9712715286-29">fn</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
        </span><span class="n">item</span><span class="o">.</span><span class="n">visibility</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">:public</span><span class="w"> </span><span class="ow">or</span><span class="w"> 
        </span><span class="n">item</span><span class="o">.</span><span class="n">owner_id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="w"> </span><span class="ow">or</span><span class="w">
        </span><span class="n">user</span><span class="o">.</span><span class="n">role</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="p" data-group-id="9712715286-30">[</span><span class="ss">:admin</span><span class="p">,</span><span class="w"> </span><span class="ss">:moderator</span><span class="p" data-group-id="9712715286-30">]</span><span class="w">
      </span><span class="k" data-group-id="9712715286-29">end</span><span class="w">
    </span><span class="k" data-group-id="9712715286-28">end</span><span class="p">,</span><span class="w">
    </span><span class="ss">not_blocked_by_user</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="9712715286-31">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
      </span><span class="k" data-group-id="9712715286-32">fn</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
        </span><span class="ow">not</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">member?</span><span class="p" data-group-id="9712715286-33">(</span><span class="n">user</span><span class="o">.</span><span class="n">blocked_ids</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p" data-group-id="9712715286-34">[</span><span class="p" data-group-id="9712715286-34">]</span><span class="p">,</span><span class="w"> </span><span class="n">item</span><span class="o">.</span><span class="n">owner_id</span><span class="p" data-group-id="9712715286-33">)</span><span class="w">
      </span><span class="k" data-group-id="9712715286-32">end</span><span class="w">
    </span><span class="k" data-group-id="9712715286-31">end</span><span class="w">
  </span><span class="p" data-group-id="9712715286-27">}</span><span class="w">
  
  </span><span class="c1"># Compose filtering pipeline</span><span class="w">
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">create_filter_pipeline</span><span class="p" data-group-id="9712715286-35">(</span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="n">options</span><span class="w"> </span><span class="o">\\</span><span class="w"> </span><span class="p" data-group-id="9712715286-36">%{</span><span class="p" data-group-id="9712715286-36">}</span><span class="p" data-group-id="9712715286-35">)</span><span class="w"> </span><span class="k" data-group-id="9712715286-37">do</span><span class="w">
    </span><span class="c1"># Basic quality checks (always applied)</span><span class="w">
    </span><span class="n">basic_quality</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="9712715286-38">(</span><span class="p" data-group-id="9712715286-39">[</span><span class="w">
      </span><span class="n">quality_filters</span><span class="o">.</span><span class="n">not_nil</span><span class="p">,</span><span class="w">
      </span><span class="n">quality_filters</span><span class="o">.</span><span class="n">has_required_fields</span><span class="p">,</span><span class="w">
      </span><span class="n">quality_filters</span><span class="o">.</span><span class="n">valid_timestamps</span><span class="w">
    </span><span class="p" data-group-id="9712715286-39">]</span><span class="p" data-group-id="9712715286-38">)</span><span class="w">
    
    </span><span class="c1"># Business logic filters</span><span class="w">
    </span><span class="n">business_logic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="9712715286-40">[</span><span class="w">
      </span><span class="n">business_filters</span><span class="o">.</span><span class="n">active_status</span><span class="p">,</span><span class="w">
      </span><span class="n">business_filters</span><span class="o">.</span><span class="n">within_date_range</span><span class="o">.</span><span class="p" data-group-id="9712715286-41">(</span><span class="w">
        </span><span class="n">options</span><span class="p" data-group-id="9712715286-42">[</span><span class="ss">:start_date</span><span class="p" data-group-id="9712715286-42">]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nc">DateTime</span><span class="o">.</span><span class="n">add</span><span class="p" data-group-id="9712715286-43">(</span><span class="nc">DateTime</span><span class="o">.</span><span class="n">utc_now</span><span class="p" data-group-id="9712715286-44">(</span><span class="p" data-group-id="9712715286-44">)</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="ss">:day</span><span class="p" data-group-id="9712715286-43">)</span><span class="p">,</span><span class="w">
        </span><span class="n">options</span><span class="p" data-group-id="9712715286-45">[</span><span class="ss">:end_date</span><span class="p" data-group-id="9712715286-45">]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nc">DateTime</span><span class="o">.</span><span class="n">utc_now</span><span class="p" data-group-id="9712715286-46">(</span><span class="p" data-group-id="9712715286-46">)</span><span class="w">
      </span><span class="p" data-group-id="9712715286-41">)</span><span class="p">,</span><span class="w">
      </span><span class="n">business_filters</span><span class="o">.</span><span class="n">meets_threshold</span><span class="o">.</span><span class="p" data-group-id="9712715286-47">(</span><span class="ss">:score</span><span class="p">,</span><span class="w"> </span><span class="n">options</span><span class="p" data-group-id="9712715286-48">[</span><span class="ss">:min_score</span><span class="p" data-group-id="9712715286-48">]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="9712715286-47">)</span><span class="w">
    </span><span class="p" data-group-id="9712715286-40">]</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="9712715286-49">(</span><span class="p" data-group-id="9712715286-49">)</span><span class="w">
    
    </span><span class="c1"># User-specific filters</span><span class="w">
    </span><span class="n">user_specific</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="9712715286-50">(</span><span class="p" data-group-id="9712715286-51">[</span><span class="w">
      </span><span class="n">user_filters</span><span class="o">.</span><span class="n">user_can_see</span><span class="o">.</span><span class="p" data-group-id="9712715286-52">(</span><span class="n">user</span><span class="p" data-group-id="9712715286-52">)</span><span class="p">,</span><span class="w">
      </span><span class="n">user_filters</span><span class="o">.</span><span class="n">not_blocked_by_user</span><span class="o">.</span><span class="p" data-group-id="9712715286-53">(</span><span class="n">user</span><span class="p" data-group-id="9712715286-53">)</span><span class="w">
    </span><span class="p" data-group-id="9712715286-51">]</span><span class="p" data-group-id="9712715286-50">)</span><span class="w">
    
    </span><span class="c1"># Complete pipeline</span><span class="w">
    </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="9712715286-54">(</span><span class="p" data-group-id="9712715286-55">[</span><span class="n">basic_quality</span><span class="p">,</span><span class="w"> </span><span class="n">business_logic</span><span class="p">,</span><span class="w"> </span><span class="n">user_specific</span><span class="p" data-group-id="9712715286-55">]</span><span class="p" data-group-id="9712715286-54">)</span><span class="w">
  </span><span class="k" data-group-id="9712715286-37">end</span><span class="w">
  
  </span><span class="c1"># Usage helper</span><span class="w">
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">filter_data</span><span class="p" data-group-id="9712715286-56">(</span><span class="n">data_list</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="n">options</span><span class="w"> </span><span class="o">\\</span><span class="w"> </span><span class="p" data-group-id="9712715286-57">%{</span><span class="p" data-group-id="9712715286-57">}</span><span class="p" data-group-id="9712715286-56">)</span><span class="w"> </span><span class="k" data-group-id="9712715286-58">do</span><span class="w">
    </span><span class="n">pipeline</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">create_filter_pipeline</span><span class="p" data-group-id="9712715286-59">(</span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="n">options</span><span class="p" data-group-id="9712715286-59">)</span><span class="w">
    </span><span class="nc">Enum</span><span class="o">.</span><span class="n">filter</span><span class="p" data-group-id="9712715286-60">(</span><span class="n">data_list</span><span class="p">,</span><span class="w"> </span><span class="n">pipeline</span><span class="p" data-group-id="9712715286-60">)</span><span class="w">
  </span><span class="k" data-group-id="9712715286-58">end</span><span class="w">
  
  </span><span class="p" data-group-id="9712715286-61">%{</span><span class="w">
    </span><span class="ss">create_pipeline</span><span class="p">:</span><span class="w"> </span><span class="o">&amp;</span><span class="n">create_filter_pipeline</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="w">
    </span><span class="ss">filter_data</span><span class="p">:</span><span class="w"> </span><span class="o">&amp;</span><span class="n">filter_data</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span><span class="w">
    </span><span class="ss">individual_filters</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="9712715286-62">%{</span><span class="w">
      </span><span class="ss">quality</span><span class="p">:</span><span class="w"> </span><span class="n">quality_filters</span><span class="p">,</span><span class="w">
      </span><span class="ss">business</span><span class="p">:</span><span class="w"> </span><span class="n">business_filters</span><span class="p">,</span><span class="w">
      </span><span class="ss">user</span><span class="p">:</span><span class="w"> </span><span class="n">user_filters</span><span class="w">
    </span><span class="p" data-group-id="9712715286-62">}</span><span class="w">
  </span><span class="p" data-group-id="9712715286-61">}</span><span class="w">
</span><span class="k" data-group-id="9712715286-2">end</span></code></pre><h3 id="business-rules-template" class="section-heading">
  <a href="#business-rules-template" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Business Rules Template</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="kd">def</span><span class="w"> </span><span class="nf">build_business_rules_engine</span><span class="p" data-group-id="0596200886-1">(</span><span class="p" data-group-id="0596200886-1">)</span><span class="w"> </span><span class="k" data-group-id="0596200886-2">do</span><span class="w">
  </span><span class="c1"># Domain-specific predicates</span><span class="w">
  </span><span class="n">customer_rules</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="0596200886-3">%{</span><span class="w">
    </span><span class="ss">is_premium</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="0596200886-4">fn</span><span class="w"> </span><span class="n">customer</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">customer</span><span class="o">.</span><span class="n">tier</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">:premium</span><span class="w"> </span><span class="k" data-group-id="0596200886-4">end</span><span class="p">,</span><span class="w">
    </span><span class="ss">account_in_good_standing</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="0596200886-5">fn</span><span class="w"> </span><span class="n">customer</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> 
      </span><span class="n">customer</span><span class="o">.</span><span class="n">balance</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">customer</span><span class="o">.</span><span class="n">past_due_count</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">3</span><span class="w">
    </span><span class="k" data-group-id="0596200886-5">end</span><span class="p">,</span><span class="w">
    </span><span class="ss">region_eligible</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="0596200886-6">fn</span><span class="w"> </span><span class="n">allowed_regions</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
      </span><span class="k" data-group-id="0596200886-7">fn</span><span class="w"> </span><span class="n">customer</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">member?</span><span class="p" data-group-id="0596200886-8">(</span><span class="n">allowed_regions</span><span class="p">,</span><span class="w"> </span><span class="n">customer</span><span class="o">.</span><span class="n">region</span><span class="p" data-group-id="0596200886-8">)</span><span class="w"> </span><span class="k" data-group-id="0596200886-7">end</span><span class="w">
    </span><span class="k" data-group-id="0596200886-6">end</span><span class="p">,</span><span class="w">
    </span><span class="ss">loyalty_member</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="0596200886-9">fn</span><span class="w"> </span><span class="n">min_months</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
      </span><span class="k" data-group-id="0596200886-10">fn</span><span class="w"> </span><span class="n">customer</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
        </span><span class="n">months_active</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">DateTime</span><span class="o">.</span><span class="n">diff</span><span class="p" data-group-id="0596200886-11">(</span><span class="nc">DateTime</span><span class="o">.</span><span class="n">utc_now</span><span class="p" data-group-id="0596200886-12">(</span><span class="p" data-group-id="0596200886-12">)</span><span class="p">,</span><span class="w"> </span><span class="n">customer</span><span class="o">.</span><span class="n">signup_date</span><span class="p">,</span><span class="w"> </span><span class="ss">:day</span><span class="p" data-group-id="0596200886-11">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">30</span><span class="w">
        </span><span class="n">months_active</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">min_months</span><span class="w">
      </span><span class="k" data-group-id="0596200886-10">end</span><span class="w">
    </span><span class="k" data-group-id="0596200886-9">end</span><span class="w">
  </span><span class="p" data-group-id="0596200886-3">}</span><span class="w">
  
  </span><span class="n">order_rules</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="0596200886-13">%{</span><span class="w">
    </span><span class="ss">within_limits</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="0596200886-14">fn</span><span class="w"> </span><span class="n">customer</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
      </span><span class="k" data-group-id="0596200886-15">fn</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
        </span><span class="n">daily_total</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">CustomerService</span><span class="o">.</span><span class="n">daily_order_total</span><span class="p" data-group-id="0596200886-16">(</span><span class="n">customer</span><span class="o">.</span><span class="n">id</span><span class="p" data-group-id="0596200886-16">)</span><span class="w">
        </span><span class="p" data-group-id="0596200886-17">(</span><span class="n">daily_total</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">order</span><span class="o">.</span><span class="n">amount</span><span class="p" data-group-id="0596200886-17">)</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">customer</span><span class="o">.</span><span class="n">daily_limit</span><span class="w">
      </span><span class="k" data-group-id="0596200886-15">end</span><span class="w">
    </span><span class="k" data-group-id="0596200886-14">end</span><span class="p">,</span><span class="w">
    </span><span class="ss">valid_items</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="0596200886-18">fn</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
      </span><span class="nc">Enum</span><span class="o">.</span><span class="n">all?</span><span class="p" data-group-id="0596200886-19">(</span><span class="n">order</span><span class="o">.</span><span class="n">items</span><span class="p">,</span><span class="w"> </span><span class="k" data-group-id="0596200886-20">fn</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
        </span><span class="n">item</span><span class="o">.</span><span class="n">quantity</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">item</span><span class="o">.</span><span class="n">price</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">item</span><span class="o">.</span><span class="n">discontinued</span><span class="w">
      </span><span class="k" data-group-id="0596200886-20">end</span><span class="p" data-group-id="0596200886-19">)</span><span class="w">
    </span><span class="k" data-group-id="0596200886-18">end</span><span class="p">,</span><span class="w">
    </span><span class="ss">shipping_available</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="0596200886-21">fn</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
      </span><span class="nc">ShippingService</span><span class="o">.</span><span class="n">can_ship_to?</span><span class="p" data-group-id="0596200886-22">(</span><span class="n">order</span><span class="o">.</span><span class="n">shipping_address</span><span class="p" data-group-id="0596200886-22">)</span><span class="w">
    </span><span class="k" data-group-id="0596200886-21">end</span><span class="w">
  </span><span class="p" data-group-id="0596200886-13">}</span><span class="w">
  
  </span><span class="c1"># Compose complex business rules</span><span class="w">
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">create_order_validation_rules</span><span class="p" data-group-id="0596200886-23">(</span><span class="n">promotions</span><span class="w"> </span><span class="o">\\</span><span class="w"> </span><span class="p" data-group-id="0596200886-24">[</span><span class="p" data-group-id="0596200886-24">]</span><span class="p" data-group-id="0596200886-23">)</span><span class="w"> </span><span class="k" data-group-id="0596200886-25">do</span><span class="w">
    </span><span class="c1"># Base eligibility rules</span><span class="w">
    </span><span class="n">customer_eligible</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="0596200886-26">(</span><span class="p" data-group-id="0596200886-27">[</span><span class="w">
      </span><span class="n">customer_rules</span><span class="o">.</span><span class="n">account_in_good_standing</span><span class="p">,</span><span class="w">
      </span><span class="n">customer_rules</span><span class="o">.</span><span class="n">region_eligible</span><span class="o">.</span><span class="p" data-group-id="0596200886-28">(</span><span class="p" data-group-id="0596200886-29">[</span><span class="ss">:us</span><span class="p">,</span><span class="w"> </span><span class="ss">:ca</span><span class="p">,</span><span class="w"> </span><span class="ss">:uk</span><span class="p" data-group-id="0596200886-29">]</span><span class="p" data-group-id="0596200886-28">)</span><span class="w">
    </span><span class="p" data-group-id="0596200886-27">]</span><span class="p" data-group-id="0596200886-26">)</span><span class="w">
    
    </span><span class="c1"># Order validation rules</span><span class="w">
    </span><span class="n">order_valid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="0596200886-30">(</span><span class="p" data-group-id="0596200886-31">[</span><span class="w">
      </span><span class="n">order_rules</span><span class="o">.</span><span class="n">valid_items</span><span class="p">,</span><span class="w">
      </span><span class="n">order_rules</span><span class="o">.</span><span class="n">shipping_available</span><span class="w">
    </span><span class="p" data-group-id="0596200886-31">]</span><span class="p" data-group-id="0596200886-30">)</span><span class="w">
    
    </span><span class="c1"># Dynamic promotion rules</span><span class="w">
    </span><span class="n">promotion_rules</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">promotions</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">map</span><span class="p" data-group-id="0596200886-32">(</span><span class="k" data-group-id="0596200886-33">fn</span><span class="w"> </span><span class="n">promo</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
      </span><span class="k">case</span><span class="w"> </span><span class="n">promo</span><span class="o">.</span><span class="n">type</span><span class="w"> </span><span class="k" data-group-id="0596200886-34">do</span><span class="w">
        </span><span class="ss">:loyalty</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> 
          </span><span class="n">customer_rules</span><span class="o">.</span><span class="n">loyalty_member</span><span class="o">.</span><span class="p" data-group-id="0596200886-35">(</span><span class="n">promo</span><span class="o">.</span><span class="n">min_months</span><span class="p" data-group-id="0596200886-35">)</span><span class="w">
        </span><span class="ss">:premium</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> 
          </span><span class="n">customer_rules</span><span class="o">.</span><span class="n">is_premium</span><span class="w">
        </span><span class="ss">:volume</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
          </span><span class="k" data-group-id="0596200886-36">fn</span><span class="w"> </span><span class="n">customer</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> 
            </span><span class="k" data-group-id="0596200886-37">fn</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> 
              </span><span class="n">order</span><span class="o">.</span><span class="n">amount</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">promo</span><span class="o">.</span><span class="n">min_amount</span><span class="w">
            </span><span class="k" data-group-id="0596200886-37">end</span><span class="w">
          </span><span class="k" data-group-id="0596200886-36">end</span><span class="w">
      </span><span class="k" data-group-id="0596200886-34">end</span><span class="w">
    </span><span class="k" data-group-id="0596200886-33">end</span><span class="p" data-group-id="0596200886-32">)</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">or_any</span><span class="p" data-group-id="0596200886-38">(</span><span class="p" data-group-id="0596200886-38">)</span><span class="w">  </span><span class="c1"># Any promotion can apply</span><span class="w">
    
    </span><span class="c1"># Combine all rules</span><span class="w">
    </span><span class="p" data-group-id="0596200886-39">%{</span><span class="w">
      </span><span class="ss">can_place_order</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="0596200886-40">fn</span><span class="w"> </span><span class="n">customer</span><span class="p">,</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
        </span><span class="n">basic_rules</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="0596200886-41">(</span><span class="p" data-group-id="0596200886-42">[</span><span class="w">
          </span><span class="k" data-group-id="0596200886-43">fn</span><span class="w"> </span><span class="bp">_</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">customer_eligible</span><span class="o">.</span><span class="p" data-group-id="0596200886-44">(</span><span class="n">customer</span><span class="p" data-group-id="0596200886-44">)</span><span class="w"> </span><span class="k" data-group-id="0596200886-43">end</span><span class="p">,</span><span class="w">
          </span><span class="k" data-group-id="0596200886-45">fn</span><span class="w"> </span><span class="bp">_</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">order_valid</span><span class="o">.</span><span class="p" data-group-id="0596200886-46">(</span><span class="n">order</span><span class="p" data-group-id="0596200886-46">)</span><span class="w"> </span><span class="k" data-group-id="0596200886-45">end</span><span class="p">,</span><span class="w">
          </span><span class="n">order_rules</span><span class="o">.</span><span class="n">within_limits</span><span class="o">.</span><span class="p" data-group-id="0596200886-47">(</span><span class="n">customer</span><span class="p" data-group-id="0596200886-47">)</span><span class="w">
        </span><span class="p" data-group-id="0596200886-42">]</span><span class="p" data-group-id="0596200886-41">)</span><span class="w">
        </span><span class="n">basic_rules</span><span class="o">.</span><span class="p" data-group-id="0596200886-48">(</span><span class="n">order</span><span class="p" data-group-id="0596200886-48">)</span><span class="w">
      </span><span class="k" data-group-id="0596200886-40">end</span><span class="p">,</span><span class="w">
      
      </span><span class="ss">eligible_for_promotions</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="0596200886-49">fn</span><span class="w"> </span><span class="n">customer</span><span class="p">,</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
        </span><span class="n">promotion_check</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">promotion_rules</span><span class="o">.</span><span class="p" data-group-id="0596200886-50">(</span><span class="n">customer</span><span class="p" data-group-id="0596200886-50">)</span><span class="w">
        </span><span class="n">promotion_check</span><span class="o">.</span><span class="p" data-group-id="0596200886-51">(</span><span class="n">order</span><span class="p" data-group-id="0596200886-51">)</span><span class="w">
      </span><span class="k" data-group-id="0596200886-49">end</span><span class="p">,</span><span class="w">
      
      </span><span class="ss">complete_validation</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="0596200886-52">fn</span><span class="w"> </span><span class="n">customer</span><span class="p">,</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
        </span><span class="n">all_rules</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="0596200886-53">(</span><span class="p" data-group-id="0596200886-54">[</span><span class="w">
          </span><span class="k" data-group-id="0596200886-55">fn</span><span class="w"> </span><span class="bp">_</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">customer_eligible</span><span class="o">.</span><span class="p" data-group-id="0596200886-56">(</span><span class="n">customer</span><span class="p" data-group-id="0596200886-56">)</span><span class="w"> </span><span class="k" data-group-id="0596200886-55">end</span><span class="p">,</span><span class="w">
          </span><span class="k" data-group-id="0596200886-57">fn</span><span class="w"> </span><span class="bp">_</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">order_valid</span><span class="o">.</span><span class="p" data-group-id="0596200886-58">(</span><span class="n">order</span><span class="p" data-group-id="0596200886-58">)</span><span class="w"> </span><span class="k" data-group-id="0596200886-57">end</span><span class="p">,</span><span class="w">
          </span><span class="n">order_rules</span><span class="o">.</span><span class="n">within_limits</span><span class="o">.</span><span class="p" data-group-id="0596200886-59">(</span><span class="n">customer</span><span class="p" data-group-id="0596200886-59">)</span><span class="w">
        </span><span class="p" data-group-id="0596200886-54">]</span><span class="p" data-group-id="0596200886-53">)</span><span class="w">
        
        </span><span class="p" data-group-id="0596200886-60">{</span><span class="n">all_rules</span><span class="o">.</span><span class="p" data-group-id="0596200886-61">(</span><span class="n">order</span><span class="p" data-group-id="0596200886-61">)</span><span class="p">,</span><span class="w"> </span><span class="n">promotion_rules</span><span class="o">.</span><span class="p" data-group-id="0596200886-62">(</span><span class="n">customer</span><span class="p" data-group-id="0596200886-62">)</span><span class="o">.</span><span class="p" data-group-id="0596200886-63">(</span><span class="n">order</span><span class="p" data-group-id="0596200886-63">)</span><span class="p" data-group-id="0596200886-60">}</span><span class="w">
      </span><span class="k" data-group-id="0596200886-52">end</span><span class="w">
    </span><span class="p" data-group-id="0596200886-39">}</span><span class="w">
  </span><span class="k" data-group-id="0596200886-25">end</span><span class="w">
  
  </span><span class="p" data-group-id="0596200886-64">%{</span><span class="w">
    </span><span class="ss">customer_rules</span><span class="p">:</span><span class="w"> </span><span class="n">customer_rules</span><span class="p">,</span><span class="w">
    </span><span class="ss">order_rules</span><span class="p">:</span><span class="w"> </span><span class="n">order_rules</span><span class="p">,</span><span class="w">
    </span><span class="ss">create_validation</span><span class="p">:</span><span class="w"> </span><span class="o">&amp;</span><span class="n">create_order_validation_rules</span><span class="o">/</span><span class="mi">1</span><span class="w">
  </span><span class="p" data-group-id="0596200886-64">}</span><span class="w">
</span><span class="k" data-group-id="0596200886-2">end</span></code></pre><h2 id="llm-performance-considerations" class="section-heading">
  <a href="#llm-performance-considerations" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">LLM Performance Considerations</span>
</h2>
<h3 id="short-circuiting-behavior" class="section-heading">
  <a href="#short-circuiting-behavior" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Short-Circuiting Behavior</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="c1"># ✅ Good: Cheap predicates first</span><span class="w">
</span><span class="n">efficient_validation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="8668392500-1">(</span><span class="p" data-group-id="8668392500-2">[</span><span class="w">
  </span><span class="k" data-group-id="8668392500-3">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">is_nil</span><span class="p" data-group-id="8668392500-4">(</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p" data-group-id="8668392500-4">)</span><span class="w"> </span><span class="k" data-group-id="8668392500-3">end</span><span class="p">,</span><span class="w">           </span><span class="c1"># Very fast</span><span class="w">
  </span><span class="k" data-group-id="8668392500-5">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">String</span><span class="o">.</span><span class="n">length</span><span class="p" data-group-id="8668392500-6">(</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p" data-group-id="8668392500-6">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="k" data-group-id="8668392500-5">end</span><span class="p">,</span><span class="w"> </span><span class="c1"># Fast</span><span class="w">
  </span><span class="k" data-group-id="8668392500-7">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">Database</span><span class="o">.</span><span class="n">user_exists?</span><span class="p" data-group-id="8668392500-8">(</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p" data-group-id="8668392500-8">)</span><span class="w"> </span><span class="k" data-group-id="8668392500-7">end</span><span class="w">  </span><span class="c1"># Expensive - last</span><span class="w">
</span><span class="p" data-group-id="8668392500-2">]</span><span class="p" data-group-id="8668392500-1">)</span><span class="w">

</span><span class="c1"># ❌ Less efficient: Expensive predicate first</span><span class="w">
</span><span class="n">inefficient_validation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="8668392500-9">(</span><span class="p" data-group-id="8668392500-10">[</span><span class="w">
  </span><span class="k" data-group-id="8668392500-11">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">Database</span><span class="o">.</span><span class="n">user_exists?</span><span class="p" data-group-id="8668392500-12">(</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p" data-group-id="8668392500-12">)</span><span class="w"> </span><span class="k" data-group-id="8668392500-11">end</span><span class="p">,</span><span class="w"> </span><span class="c1"># Expensive - runs every time</span><span class="w">
  </span><span class="k" data-group-id="8668392500-13">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">is_nil</span><span class="p" data-group-id="8668392500-14">(</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p" data-group-id="8668392500-14">)</span><span class="w"> </span><span class="k" data-group-id="8668392500-13">end</span><span class="w">            </span><span class="c1"># Fast - but too late</span><span class="w">
</span><span class="p" data-group-id="8668392500-10">]</span><span class="p" data-group-id="8668392500-9">)</span></code></pre><h3 id="predicate-memoization" class="section-heading">
  <a href="#predicate-memoization" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Predicate Memoization</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="c1"># For expensive predicates that are reused</span><span class="w">
</span><span class="kd">def</span><span class="w"> </span><span class="nf">create_memoized_predicate</span><span class="p" data-group-id="9187430751-1">(</span><span class="n">expensive_fn</span><span class="p" data-group-id="9187430751-1">)</span><span class="w"> </span><span class="k" data-group-id="9187430751-2">do</span><span class="w">
  </span><span class="n">cache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Agent</span><span class="o">.</span><span class="n">start_link</span><span class="p" data-group-id="9187430751-3">(</span><span class="k" data-group-id="9187430751-4">fn</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p" data-group-id="9187430751-5">%{</span><span class="p" data-group-id="9187430751-5">}</span><span class="w"> </span><span class="k" data-group-id="9187430751-4">end</span><span class="p" data-group-id="9187430751-3">)</span><span class="w">
  
  </span><span class="k" data-group-id="9187430751-6">fn</span><span class="w"> </span><span class="n">input</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
    </span><span class="nc">Agent</span><span class="o">.</span><span class="n">get_and_update</span><span class="p" data-group-id="9187430751-7">(</span><span class="n">cache</span><span class="p">,</span><span class="w"> </span><span class="k" data-group-id="9187430751-8">fn</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
      </span><span class="k">case</span><span class="w"> </span><span class="nc">Map</span><span class="o">.</span><span class="n">get</span><span class="p" data-group-id="9187430751-9">(</span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="n">input</span><span class="p" data-group-id="9187430751-9">)</span><span class="w"> </span><span class="k" data-group-id="9187430751-10">do</span><span class="w">
        </span><span class="no">nil</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> 
          </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">expensive_fn</span><span class="o">.</span><span class="p" data-group-id="9187430751-11">(</span><span class="n">input</span><span class="p" data-group-id="9187430751-11">)</span><span class="w">
          </span><span class="p" data-group-id="9187430751-12">{</span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="nc">Map</span><span class="o">.</span><span class="n">put</span><span class="p" data-group-id="9187430751-13">(</span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="n">input</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p" data-group-id="9187430751-13">)</span><span class="p" data-group-id="9187430751-12">}</span><span class="w">
        </span><span class="n">cached_result</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> 
          </span><span class="p" data-group-id="9187430751-14">{</span><span class="n">cached_result</span><span class="p">,</span><span class="w"> </span><span class="n">state</span><span class="p" data-group-id="9187430751-14">}</span><span class="w">
      </span><span class="k" data-group-id="9187430751-10">end</span><span class="w">
    </span><span class="k" data-group-id="9187430751-8">end</span><span class="p" data-group-id="9187430751-7">)</span><span class="w">
  </span><span class="k" data-group-id="9187430751-6">end</span><span class="w">
</span><span class="k" data-group-id="9187430751-2">end</span><span class="w">

</span><span class="c1"># Usage</span><span class="w">
</span><span class="n">expensive_check</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">create_memoized_predicate</span><span class="p" data-group-id="9187430751-15">(</span><span class="k" data-group-id="9187430751-16">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> 
  </span><span class="c1"># Expensive operation here</span><span class="w">
  </span><span class="nc">ExternalAPI</span><span class="o">.</span><span class="n">validate_user</span><span class="p" data-group-id="9187430751-17">(</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p" data-group-id="9187430751-17">)</span><span class="w">
</span><span class="k" data-group-id="9187430751-16">end</span><span class="p" data-group-id="9187430751-15">)</span><span class="w">

</span><span class="n">validation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="9187430751-18">(</span><span class="p" data-group-id="9187430751-19">[</span><span class="n">basic_checks</span><span class="p">,</span><span class="w"> </span><span class="n">expensive_check</span><span class="p" data-group-id="9187430751-19">]</span><span class="p" data-group-id="9187430751-18">)</span></code></pre><h2 id="llm-interop-patterns" class="section-heading">
  <a href="#llm-interop-patterns" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">LLM Interop Patterns</span>
</h2>
<h3 id="with-funx-utils" class="section-heading">
  <a href="#with-funx-utils" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">With Funx.Utils</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="kd">def</span><span class="w"> </span><span class="nf">build_utils_integration</span><span class="p" data-group-id="7818416715-1">(</span><span class="p" data-group-id="7818416715-1">)</span><span class="w"> </span><span class="k" data-group-id="7818416715-2">do</span><span class="w">
  </span><span class="c1"># Create predicate functions for pipeline use</span><span class="w">
  </span><span class="c1"># Note: Predicates are functions that can be called directly</span><span class="w">
  
  </span><span class="c1"># Create reusable predicates</span><span class="w">
  </span><span class="n">test_adult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="7818416715-3">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">age</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">18</span><span class="w"> </span><span class="k" data-group-id="7818416715-3">end</span><span class="w">
  </span><span class="n">test_active</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="7818416715-4">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">:active</span><span class="w"> </span><span class="k" data-group-id="7818416715-4">end</span><span class="w">
  </span><span class="n">test_verified</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="7818416715-5">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">verified</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">true</span><span class="w"> </span><span class="k" data-group-id="7818416715-5">end</span><span class="w">
  
  </span><span class="c1"># Use in pipelines</span><span class="w">
  </span><span class="n">users</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="7818416715-6">[</span><span class="p" data-group-id="7818416715-7">%{</span><span class="ss">age</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span><span class="w"> </span><span class="ss">status</span><span class="p">:</span><span class="w"> </span><span class="ss">:active</span><span class="p">,</span><span class="w"> </span><span class="ss">verified</span><span class="p">:</span><span class="w"> </span><span class="no">true</span><span class="p" data-group-id="7818416715-7">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7818416715-8">%{</span><span class="ss">age</span><span class="p">:</span><span class="w"> </span><span class="mi">17</span><span class="p">,</span><span class="w"> </span><span class="ss">status</span><span class="p">:</span><span class="w"> </span><span class="ss">:inactive</span><span class="p">,</span><span class="w"> </span><span class="ss">verified</span><span class="p">:</span><span class="w"> </span><span class="no">false</span><span class="p" data-group-id="7818416715-8">}</span><span class="p" data-group-id="7818416715-6">]</span><span class="w">
  
  </span><span class="n">adults</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">filter</span><span class="p" data-group-id="7818416715-9">(</span><span class="n">test_adult</span><span class="p" data-group-id="7818416715-9">)</span><span class="w">
  </span><span class="n">active_users</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">filter</span><span class="p" data-group-id="7818416715-10">(</span><span class="n">test_active</span><span class="p" data-group-id="7818416715-10">)</span><span class="w">
  
  </span><span class="c1"># Compose with other Utils functions</span><span class="w">
  </span><span class="n">filter_by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Funx.Utils</span><span class="o">.</span><span class="n">flip</span><span class="p" data-group-id="7818416715-11">(</span><span class="o">&amp;</span><span class="nc">Enum</span><span class="o">.</span><span class="n">filter</span><span class="o">/</span><span class="mi">2</span><span class="p" data-group-id="7818416715-11">)</span><span class="w">
  
  </span><span class="c1"># Create specialized filters</span><span class="w">
  </span><span class="n">filter_adults</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">filter_by</span><span class="o">.</span><span class="p" data-group-id="7818416715-12">(</span><span class="n">test_adult</span><span class="p" data-group-id="7818416715-12">)</span><span class="w">
  </span><span class="n">filter_active</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">filter_by</span><span class="o">.</span><span class="p" data-group-id="7818416715-13">(</span><span class="n">test_active</span><span class="p" data-group-id="7818416715-13">)</span><span class="w">
  
  </span><span class="n">users</span><span class="w"> 
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">filter_adults</span><span class="o">.</span><span class="p" data-group-id="7818416715-14">(</span><span class="p" data-group-id="7818416715-14">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">filter_active</span><span class="o">.</span><span class="p" data-group-id="7818416715-15">(</span><span class="p" data-group-id="7818416715-15">)</span><span class="w">
</span><span class="k" data-group-id="7818416715-2">end</span></code></pre><h3 id="with-maybe-either-bind" class="section-heading">
  <a href="#with-maybe-either-bind" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">With Maybe/Either Bind</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="kd">def</span><span class="w"> </span><span class="nf">build_monadic_validation</span><span class="p" data-group-id="8108156523-1">(</span><span class="p" data-group-id="8108156523-1">)</span><span class="w"> </span><span class="k" data-group-id="8108156523-2">do</span><span class="w">
  </span><span class="c1"># Convert predicates to Maybe-returning validators</span><span class="w">
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">predicate_to_maybe</span><span class="p" data-group-id="8108156523-3">(</span><span class="n">predicate</span><span class="p">,</span><span class="w"> </span><span class="n">error_msg</span><span class="p" data-group-id="8108156523-3">)</span><span class="w"> </span><span class="k" data-group-id="8108156523-4">do</span><span class="w">
    </span><span class="k" data-group-id="8108156523-5">fn</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
      </span><span class="k">if</span><span class="w"> </span><span class="n">predicate</span><span class="o">.</span><span class="p" data-group-id="8108156523-6">(</span><span class="n">value</span><span class="p" data-group-id="8108156523-6">)</span><span class="w"> </span><span class="k" data-group-id="8108156523-7">do</span><span class="w">
        </span><span class="nc">Maybe</span><span class="o">.</span><span class="n">just</span><span class="p" data-group-id="8108156523-8">(</span><span class="n">value</span><span class="p" data-group-id="8108156523-8">)</span><span class="w">
      </span><span class="k" data-group-id="8108156523-7">else</span><span class="w">
        </span><span class="nc">Maybe</span><span class="o">.</span><span class="n">nothing</span><span class="p" data-group-id="8108156523-9">(</span><span class="p" data-group-id="8108156523-9">)</span><span class="w">
      </span><span class="k" data-group-id="8108156523-7">end</span><span class="w">
    </span><span class="k" data-group-id="8108156523-5">end</span><span class="w">
  </span><span class="k" data-group-id="8108156523-4">end</span><span class="w">
  
  </span><span class="c1"># Convert predicates to Either-returning validators</span><span class="w">
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">predicate_to_either</span><span class="p" data-group-id="8108156523-10">(</span><span class="n">predicate</span><span class="p">,</span><span class="w"> </span><span class="n">error_msg</span><span class="p" data-group-id="8108156523-10">)</span><span class="w"> </span><span class="k" data-group-id="8108156523-11">do</span><span class="w">
    </span><span class="k" data-group-id="8108156523-12">fn</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
      </span><span class="k">if</span><span class="w"> </span><span class="n">predicate</span><span class="o">.</span><span class="p" data-group-id="8108156523-13">(</span><span class="n">value</span><span class="p" data-group-id="8108156523-13">)</span><span class="w"> </span><span class="k" data-group-id="8108156523-14">do</span><span class="w">
        </span><span class="nc">Either</span><span class="o">.</span><span class="n">right</span><span class="p" data-group-id="8108156523-15">(</span><span class="n">value</span><span class="p" data-group-id="8108156523-15">)</span><span class="w">
      </span><span class="k" data-group-id="8108156523-14">else</span><span class="w">
        </span><span class="nc">Either</span><span class="o">.</span><span class="n">left</span><span class="p" data-group-id="8108156523-16">(</span><span class="n">error_msg</span><span class="p" data-group-id="8108156523-16">)</span><span class="w">
      </span><span class="k" data-group-id="8108156523-14">end</span><span class="w">
    </span><span class="k" data-group-id="8108156523-12">end</span><span class="w">
  </span><span class="k" data-group-id="8108156523-11">end</span><span class="w">
  
  </span><span class="c1"># Create validators</span><span class="w">
  </span><span class="n">age_predicate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="8108156523-17">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">age</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">18</span><span class="w"> </span><span class="k" data-group-id="8108156523-17">end</span><span class="w">
  </span><span class="n">email_predicate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="8108156523-18">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">String</span><span class="o">.</span><span class="n">contains?</span><span class="p" data-group-id="8108156523-19">(</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;@&quot;</span><span class="p" data-group-id="8108156523-19">)</span><span class="w"> </span><span class="k" data-group-id="8108156523-18">end</span><span class="w">
  
  </span><span class="n">age_validator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">predicate_to_either</span><span class="p" data-group-id="8108156523-20">(</span><span class="n">age_predicate</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Must be adult&quot;</span><span class="p" data-group-id="8108156523-20">)</span><span class="w">
  </span><span class="n">email_validator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">predicate_to_either</span><span class="p" data-group-id="8108156523-21">(</span><span class="n">email_predicate</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Invalid email&quot;</span><span class="p" data-group-id="8108156523-21">)</span><span class="w">
  
  </span><span class="c1"># Use in monadic pipeline</span><span class="w">
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">validate_user</span><span class="p" data-group-id="8108156523-22">(</span><span class="n">user</span><span class="p" data-group-id="8108156523-22">)</span><span class="w"> </span><span class="k" data-group-id="8108156523-23">do</span><span class="w">
    </span><span class="nc">Either</span><span class="o">.</span><span class="n">right</span><span class="p" data-group-id="8108156523-24">(</span><span class="n">user</span><span class="p" data-group-id="8108156523-24">)</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Either</span><span class="o">.</span><span class="n">bind</span><span class="p" data-group-id="8108156523-25">(</span><span class="n">age_validator</span><span class="p" data-group-id="8108156523-25">)</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Either</span><span class="o">.</span><span class="n">bind</span><span class="p" data-group-id="8108156523-26">(</span><span class="n">email_validator</span><span class="p" data-group-id="8108156523-26">)</span><span class="w">
  </span><span class="k" data-group-id="8108156523-23">end</span><span class="w">
  
  </span><span class="n">validate_user</span><span class="p" data-group-id="8108156523-27">(</span><span class="p" data-group-id="8108156523-28">%{</span><span class="ss">age</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span><span class="w"> </span><span class="ss">email</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;user@example.com&quot;</span><span class="p" data-group-id="8108156523-28">}</span><span class="p" data-group-id="8108156523-27">)</span><span class="w">  </span><span class="c1"># Right(user)</span><span class="w">
  </span><span class="n">validate_user</span><span class="p" data-group-id="8108156523-29">(</span><span class="p" data-group-id="8108156523-30">%{</span><span class="ss">age</span><span class="p">:</span><span class="w"> </span><span class="mi">16</span><span class="p">,</span><span class="w"> </span><span class="ss">email</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;invalid&quot;</span><span class="p" data-group-id="8108156523-30">}</span><span class="p" data-group-id="8108156523-29">)</span><span class="w">          </span><span class="c1"># Left(&quot;Must be adult&quot;)</span><span class="w">
</span><span class="k" data-group-id="8108156523-2">end</span></code></pre><h3 id="with-enum-functions" class="section-heading">
  <a href="#with-enum-functions" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">With Enum Functions</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="kd">def</span><span class="w"> </span><span class="nf">build_enum_integration</span><span class="p" data-group-id="5213557290-1">(</span><span class="p" data-group-id="5213557290-1">)</span><span class="w"> </span><span class="k" data-group-id="5213557290-2">do</span><span class="w">
  </span><span class="c1"># Predicate-based collection operations</span><span class="w">
  
  </span><span class="n">users</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="5213557290-3">[</span><span class="w">
    </span><span class="p" data-group-id="5213557290-4">%{</span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">role</span><span class="p">:</span><span class="w"> </span><span class="ss">:admin</span><span class="p">,</span><span class="w"> </span><span class="ss">active</span><span class="p">:</span><span class="w"> </span><span class="no">true</span><span class="p" data-group-id="5213557290-4">}</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="5213557290-5">%{</span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Bob&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">role</span><span class="p">:</span><span class="w"> </span><span class="ss">:user</span><span class="p">,</span><span class="w"> </span><span class="ss">active</span><span class="p">:</span><span class="w"> </span><span class="no">false</span><span class="p" data-group-id="5213557290-5">}</span><span class="p">,</span><span class="w"> 
    </span><span class="p" data-group-id="5213557290-6">%{</span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Carol&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">role</span><span class="p">:</span><span class="w"> </span><span class="ss">:moderator</span><span class="p">,</span><span class="w"> </span><span class="ss">active</span><span class="p">:</span><span class="w"> </span><span class="no">true</span><span class="p" data-group-id="5213557290-6">}</span><span class="w">
  </span><span class="p" data-group-id="5213557290-3">]</span><span class="w">
  
  </span><span class="c1"># Create predicates</span><span class="w">
  </span><span class="n">is_admin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="5213557290-7">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">role</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">:admin</span><span class="w"> </span><span class="k" data-group-id="5213557290-7">end</span><span class="w">
  </span><span class="n">is_active</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="5213557290-8">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">active</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">true</span><span class="w"> </span><span class="k" data-group-id="5213557290-8">end</span><span class="w">
  </span><span class="n">is_staff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">or_any</span><span class="p" data-group-id="5213557290-9">(</span><span class="p" data-group-id="5213557290-10">[</span><span class="w">
    </span><span class="k" data-group-id="5213557290-11">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">role</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">:admin</span><span class="w"> </span><span class="k" data-group-id="5213557290-11">end</span><span class="p">,</span><span class="w">
    </span><span class="k" data-group-id="5213557290-12">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">role</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">:moderator</span><span class="w"> </span><span class="k" data-group-id="5213557290-12">end</span><span class="w">
  </span><span class="p" data-group-id="5213557290-10">]</span><span class="p" data-group-id="5213557290-9">)</span><span class="w">
  
  </span><span class="c1"># Use with Enum functions</span><span class="w">
  </span><span class="n">active_users</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">filter</span><span class="p" data-group-id="5213557290-13">(</span><span class="n">users</span><span class="p">,</span><span class="w"> </span><span class="n">is_active</span><span class="p" data-group-id="5213557290-13">)</span><span class="w">
  </span><span class="n">staff_members</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">filter</span><span class="p" data-group-id="5213557290-14">(</span><span class="n">users</span><span class="p">,</span><span class="w"> </span><span class="n">is_staff</span><span class="p" data-group-id="5213557290-14">)</span><span class="w">
  
  </span><span class="c1"># Combine predicates for complex filtering</span><span class="w">
  </span><span class="n">active_staff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">filter</span><span class="p" data-group-id="5213557290-15">(</span><span class="n">users</span><span class="p">,</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="5213557290-16">(</span><span class="p" data-group-id="5213557290-17">[</span><span class="n">is_staff</span><span class="p">,</span><span class="w"> </span><span class="n">is_active</span><span class="p" data-group-id="5213557290-17">]</span><span class="p" data-group-id="5213557290-16">)</span><span class="p" data-group-id="5213557290-15">)</span><span class="w">
  
  </span><span class="c1"># Partition based on predicates</span><span class="w">
  </span><span class="p" data-group-id="5213557290-18">{</span><span class="n">staff</span><span class="p">,</span><span class="w"> </span><span class="n">regular_users</span><span class="p" data-group-id="5213557290-18">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">split_with</span><span class="p" data-group-id="5213557290-19">(</span><span class="n">users</span><span class="p">,</span><span class="w"> </span><span class="n">is_staff</span><span class="p" data-group-id="5213557290-19">)</span><span class="w">
  
  </span><span class="c1"># Count matching items</span><span class="w">
  </span><span class="n">staff_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">count</span><span class="p" data-group-id="5213557290-20">(</span><span class="n">users</span><span class="p">,</span><span class="w"> </span><span class="n">is_staff</span><span class="p" data-group-id="5213557290-20">)</span><span class="w">
  
  </span><span class="c1"># Find items</span><span class="w">
  </span><span class="n">first_admin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">find</span><span class="p" data-group-id="5213557290-21">(</span><span class="n">users</span><span class="p">,</span><span class="w"> </span><span class="n">is_admin</span><span class="p" data-group-id="5213557290-21">)</span><span class="w">
  </span><span class="n">all_active</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">all?</span><span class="p" data-group-id="5213557290-22">(</span><span class="n">users</span><span class="p">,</span><span class="w"> </span><span class="n">is_active</span><span class="p" data-group-id="5213557290-22">)</span><span class="w">
  </span><span class="n">any_admins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">any?</span><span class="p" data-group-id="5213557290-23">(</span><span class="n">users</span><span class="p">,</span><span class="w"> </span><span class="n">is_admin</span><span class="p" data-group-id="5213557290-23">)</span><span class="w">
  
  </span><span class="p" data-group-id="5213557290-24">%{</span><span class="w">
    </span><span class="ss">active_users</span><span class="p">:</span><span class="w"> </span><span class="n">active_users</span><span class="p">,</span><span class="w">
    </span><span class="ss">staff_members</span><span class="p">:</span><span class="w"> </span><span class="n">staff_members</span><span class="p">,</span><span class="w">
    </span><span class="ss">active_staff</span><span class="p">:</span><span class="w"> </span><span class="n">active_staff</span><span class="p">,</span><span class="w">
    </span><span class="ss">counts</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="5213557290-25">%{</span><span class="ss">staff</span><span class="p">:</span><span class="w"> </span><span class="n">staff_count</span><span class="p" data-group-id="5213557290-25">}</span><span class="p">,</span><span class="w">
    </span><span class="ss">checks</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="5213557290-26">%{</span><span class="ss">all_active</span><span class="p">:</span><span class="w"> </span><span class="n">all_active</span><span class="p">,</span><span class="w"> </span><span class="ss">any_admins</span><span class="p">:</span><span class="w"> </span><span class="n">any_admins</span><span class="p" data-group-id="5213557290-26">}</span><span class="w">
  </span><span class="p" data-group-id="5213557290-24">}</span><span class="w">
</span><span class="k" data-group-id="5213557290-2">end</span></code></pre><h3 id="with-case-statements" class="section-heading">
  <a href="#with-case-statements" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">With Case Statements</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="kd">def</span><span class="w"> </span><span class="nf">build_case_integration</span><span class="p" data-group-id="3282173322-1">(</span><span class="p" data-group-id="3282173322-1">)</span><span class="w"> </span><span class="k" data-group-id="3282173322-2">do</span><span class="w">
  </span><span class="c1"># Use predicates in case statement guards</span><span class="w">
  
  </span><span class="n">is_admin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="3282173322-3">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">role</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">:admin</span><span class="w"> </span><span class="k" data-group-id="3282173322-3">end</span><span class="w">
  </span><span class="n">is_owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="3282173322-4">fn</span><span class="w"> </span><span class="n">resource</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">resource</span><span class="o">.</span><span class="n">owner_id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="w"> </span><span class="k" data-group-id="3282173322-4">end</span><span class="w">
  </span><span class="n">is_collaborator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="3282173322-5">fn</span><span class="w"> </span><span class="n">resource</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> 
    </span><span class="nc">Enum</span><span class="o">.</span><span class="n">member?</span><span class="p" data-group-id="3282173322-6">(</span><span class="n">resource</span><span class="o">.</span><span class="n">collaborators</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p" data-group-id="3282173322-6">)</span><span class="w">
  </span><span class="k" data-group-id="3282173322-5">end</span><span class="w">
  
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">authorize_action</span><span class="p" data-group-id="3282173322-7">(</span><span class="n">action</span><span class="p">,</span><span class="w"> </span><span class="n">resource</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p" data-group-id="3282173322-7">)</span><span class="w"> </span><span class="k" data-group-id="3282173322-8">do</span><span class="w">
    </span><span class="k">case</span><span class="w"> </span><span class="p" data-group-id="3282173322-9">{</span><span class="n">action</span><span class="p">,</span><span class="w"> </span><span class="n">is_admin</span><span class="o">.</span><span class="p" data-group-id="3282173322-10">(</span><span class="n">user</span><span class="p" data-group-id="3282173322-10">)</span><span class="p" data-group-id="3282173322-9">}</span><span class="w"> </span><span class="k" data-group-id="3282173322-11">do</span><span class="w">
      </span><span class="p" data-group-id="3282173322-12">{</span><span class="bp">_</span><span class="p">,</span><span class="w"> </span><span class="no">true</span><span class="p" data-group-id="3282173322-12">}</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> 
        </span><span class="c1"># Admins can do anything</span><span class="w">
        </span><span class="ss">:authorized</span><span class="w">
        
      </span><span class="p" data-group-id="3282173322-13">{</span><span class="ss">:read</span><span class="p">,</span><span class="w"> </span><span class="no">false</span><span class="p" data-group-id="3282173322-13">}</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
        </span><span class="c1"># Non-admins need specific read permissions</span><span class="w">
        </span><span class="k">case</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">or_any</span><span class="p" data-group-id="3282173322-14">(</span><span class="p" data-group-id="3282173322-15">[</span><span class="n">is_owner</span><span class="o">.</span><span class="p" data-group-id="3282173322-16">(</span><span class="n">resource</span><span class="p" data-group-id="3282173322-16">)</span><span class="p">,</span><span class="w"> </span><span class="n">is_collaborator</span><span class="o">.</span><span class="p" data-group-id="3282173322-17">(</span><span class="n">resource</span><span class="p" data-group-id="3282173322-17">)</span><span class="p" data-group-id="3282173322-15">]</span><span class="p" data-group-id="3282173322-14">)</span><span class="o">.</span><span class="p" data-group-id="3282173322-18">(</span><span class="n">user</span><span class="p" data-group-id="3282173322-18">)</span><span class="w"> </span><span class="k" data-group-id="3282173322-19">do</span><span class="w">
          </span><span class="no">true</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="ss">:authorized</span><span class="w">
          </span><span class="no">false</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p" data-group-id="3282173322-20">{</span><span class="ss">:unauthorized</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;No read access&quot;</span><span class="p" data-group-id="3282173322-20">}</span><span class="w">
        </span><span class="k" data-group-id="3282173322-19">end</span><span class="w">
        
      </span><span class="p" data-group-id="3282173322-21">{</span><span class="ss">:write</span><span class="p">,</span><span class="w"> </span><span class="no">false</span><span class="p" data-group-id="3282173322-21">}</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
        </span><span class="c1"># Non-admins need ownership for writes</span><span class="w">
        </span><span class="k">case</span><span class="w"> </span><span class="n">is_owner</span><span class="o">.</span><span class="p" data-group-id="3282173322-22">(</span><span class="n">resource</span><span class="p" data-group-id="3282173322-22">)</span><span class="o">.</span><span class="p" data-group-id="3282173322-23">(</span><span class="n">user</span><span class="p" data-group-id="3282173322-23">)</span><span class="w"> </span><span class="k" data-group-id="3282173322-24">do</span><span class="w">
          </span><span class="no">true</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="ss">:authorized</span><span class="w">
          </span><span class="no">false</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p" data-group-id="3282173322-25">{</span><span class="ss">:unauthorized</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Must be owner to modify&quot;</span><span class="p" data-group-id="3282173322-25">}</span><span class="w">
        </span><span class="k" data-group-id="3282173322-24">end</span><span class="w">
        
      </span><span class="p" data-group-id="3282173322-26">{</span><span class="ss">:delete</span><span class="p">,</span><span class="w"> </span><span class="no">false</span><span class="p" data-group-id="3282173322-26">}</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
        </span><span class="c1"># Only owners and admins can delete</span><span class="w">
        </span><span class="p" data-group-id="3282173322-27">{</span><span class="ss">:unauthorized</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Insufficient permissions for delete&quot;</span><span class="p" data-group-id="3282173322-27">}</span><span class="w">
    </span><span class="k" data-group-id="3282173322-11">end</span><span class="w">
  </span><span class="k" data-group-id="3282173322-8">end</span><span class="w">
  
  </span><span class="p" data-group-id="3282173322-28">%{</span><span class="ss">authorize</span><span class="p">:</span><span class="w"> </span><span class="o">&amp;</span><span class="n">authorize_action</span><span class="o">/</span><span class="mi">3</span><span class="p" data-group-id="3282173322-28">}</span><span class="w">
</span><span class="k" data-group-id="3282173322-2">end</span></code></pre><h3 id="with-guard-clauses" class="section-heading">
  <a href="#with-guard-clauses" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">With Guard Clauses</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="kd">def</span><span class="w"> </span><span class="nf">build_guard_integration</span><span class="p" data-group-id="4023829609-1">(</span><span class="p" data-group-id="4023829609-1">)</span><span class="w"> </span><span class="k" data-group-id="4023829609-2">do</span><span class="w">
  </span><span class="c1"># Convert predicates to guard-compatible expressions</span><span class="w">
  
  </span><span class="c1"># Note: These need to be guard-safe functions</span><span class="w">
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">process_user</span><span class="p" data-group-id="4023829609-3">(</span><span class="n">user</span><span class="p" data-group-id="4023829609-3">)</span><span class="w"> </span><span class="ow">when</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">age</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">18</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">active</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">true</span><span class="w"> </span><span class="k" data-group-id="4023829609-4">do</span><span class="w">
    </span><span class="p" data-group-id="4023829609-5">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Processing adult active user: </span><span class="si" data-group-id="4023829609-6">#{</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="si" data-group-id="4023829609-6">}</span><span class="s">&quot;</span><span class="p" data-group-id="4023829609-5">}</span><span class="w">
  </span><span class="k" data-group-id="4023829609-4">end</span><span class="w">
  
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">process_user</span><span class="p" data-group-id="4023829609-7">(</span><span class="n">user</span><span class="p" data-group-id="4023829609-7">)</span><span class="w"> </span><span class="ow">when</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">role</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">:admin</span><span class="w"> </span><span class="k" data-group-id="4023829609-8">do</span><span class="w">
    </span><span class="p" data-group-id="4023829609-9">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Processing admin user: </span><span class="si" data-group-id="4023829609-10">#{</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="si" data-group-id="4023829609-10">}</span><span class="s">&quot;</span><span class="p" data-group-id="4023829609-9">}</span><span class="w">
  </span><span class="k" data-group-id="4023829609-8">end</span><span class="w">
  
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">process_user</span><span class="p" data-group-id="4023829609-11">(</span><span class="c">_user</span><span class="p" data-group-id="4023829609-11">)</span><span class="w"> </span><span class="k" data-group-id="4023829609-12">do</span><span class="w">
    </span><span class="p" data-group-id="4023829609-13">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;User does not meet processing criteria&quot;</span><span class="p" data-group-id="4023829609-13">}</span><span class="w">
  </span><span class="k" data-group-id="4023829609-12">end</span><span class="w">
  
  </span><span class="c1"># For more complex predicates, use function heads</span><span class="w">
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">handle_request</span><span class="p" data-group-id="4023829609-14">(</span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p" data-group-id="4023829609-14">)</span><span class="w"> </span><span class="k" data-group-id="4023829609-15">do</span><span class="w">
    </span><span class="k">cond</span><span class="w"> </span><span class="k" data-group-id="4023829609-16">do</span><span class="w">
      </span><span class="n">is_admin_user</span><span class="p" data-group-id="4023829609-17">(</span><span class="p" data-group-id="4023829609-17">)</span><span class="o">.</span><span class="p" data-group-id="4023829609-18">(</span><span class="n">user</span><span class="p" data-group-id="4023829609-18">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
        </span><span class="n">handle_admin_request</span><span class="p" data-group-id="4023829609-19">(</span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p" data-group-id="4023829609-19">)</span><span class="w">
        
      </span><span class="n">is_premium_user</span><span class="p" data-group-id="4023829609-20">(</span><span class="p" data-group-id="4023829609-20">)</span><span class="o">.</span><span class="p" data-group-id="4023829609-21">(</span><span class="n">user</span><span class="p" data-group-id="4023829609-21">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
        </span><span class="n">handle_premium_request</span><span class="p" data-group-id="4023829609-22">(</span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p" data-group-id="4023829609-22">)</span><span class="w">
        
      </span><span class="n">basic_user_requirements</span><span class="p" data-group-id="4023829609-23">(</span><span class="p" data-group-id="4023829609-23">)</span><span class="o">.</span><span class="p" data-group-id="4023829609-24">(</span><span class="n">user</span><span class="p" data-group-id="4023829609-24">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
        </span><span class="n">handle_basic_request</span><span class="p" data-group-id="4023829609-25">(</span><span class="n">request</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p" data-group-id="4023829609-25">)</span><span class="w">
        
      </span><span class="no">true</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
        </span><span class="p" data-group-id="4023829609-26">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;User not authorized for any request type&quot;</span><span class="p" data-group-id="4023829609-26">}</span><span class="w">
    </span><span class="k" data-group-id="4023829609-16">end</span><span class="w">
  </span><span class="k" data-group-id="4023829609-15">end</span><span class="w">
  
  </span><span class="kd">defp</span><span class="w"> </span><span class="nf">is_admin_user</span><span class="p" data-group-id="4023829609-27">(</span><span class="p" data-group-id="4023829609-27">)</span><span class="p">,</span><span class="w"> </span><span class="ss">do</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="4023829609-28">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">role</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">:admin</span><span class="w"> </span><span class="k" data-group-id="4023829609-28">end</span><span class="w">
  </span><span class="kd">defp</span><span class="w"> </span><span class="nf">is_premium_user</span><span class="p" data-group-id="4023829609-29">(</span><span class="p" data-group-id="4023829609-29">)</span><span class="p">,</span><span class="w"> </span><span class="ss">do</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="4023829609-30">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">subscription</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">:premium</span><span class="w"> </span><span class="k" data-group-id="4023829609-30">end</span><span class="w">
  </span><span class="kd">defp</span><span class="w"> </span><span class="nf">basic_user_requirements</span><span class="p" data-group-id="4023829609-31">(</span><span class="p" data-group-id="4023829609-31">)</span><span class="w"> </span><span class="k" data-group-id="4023829609-32">do</span><span class="w">
    </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="4023829609-33">(</span><span class="p" data-group-id="4023829609-34">[</span><span class="w">
      </span><span class="k" data-group-id="4023829609-35">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">verified</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">true</span><span class="w"> </span><span class="k" data-group-id="4023829609-35">end</span><span class="p">,</span><span class="w">
      </span><span class="k" data-group-id="4023829609-36">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">:active</span><span class="w"> </span><span class="k" data-group-id="4023829609-36">end</span><span class="w">
    </span><span class="p" data-group-id="4023829609-34">]</span><span class="p" data-group-id="4023829609-33">)</span><span class="w">
  </span><span class="k" data-group-id="4023829609-32">end</span><span class="w">
  
  </span><span class="p" data-group-id="4023829609-37">%{</span><span class="ss">process_user</span><span class="p">:</span><span class="w"> </span><span class="o">&amp;</span><span class="n">process_user</span><span class="o">/</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="ss">handle_request</span><span class="p">:</span><span class="w"> </span><span class="o">&amp;</span><span class="n">handle_request</span><span class="o">/</span><span class="mi">2</span><span class="p" data-group-id="4023829609-37">}</span><span class="w">
</span><span class="k" data-group-id="4023829609-2">end</span></code></pre><h2 id="llm-testing-guidance" class="section-heading">
  <a href="#llm-testing-guidance" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">LLM Testing Guidance</span>
</h2>
<h3 id="test-individual-predicates" class="section-heading">
  <a href="#test-individual-predicates" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Test Individual Predicates</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="kd">defmodule</span><span class="w"> </span><span class="nc">PredicateTest</span><span class="w"> </span><span class="k" data-group-id="6020117623-1">do</span><span class="w">
  </span><span class="kn">use</span><span class="w"> </span><span class="nc">ExUnit.Case</span><span class="w">
  
  </span><span class="n">test</span><span class="w"> </span><span class="s">&quot;individual predicates work correctly&quot;</span><span class="w"> </span><span class="k" data-group-id="6020117623-2">do</span><span class="w">
    </span><span class="n">is_adult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="6020117623-3">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">age</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">18</span><span class="w"> </span><span class="k" data-group-id="6020117623-3">end</span><span class="w">
    </span><span class="n">has_email</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="6020117623-4">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">String</span><span class="o">.</span><span class="n">contains?</span><span class="p" data-group-id="6020117623-5">(</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;@&quot;</span><span class="p" data-group-id="6020117623-5">)</span><span class="w"> </span><span class="k" data-group-id="6020117623-4">end</span><span class="w">
    
    </span><span class="n">adult_user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="6020117623-6">%{</span><span class="ss">age</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span><span class="w"> </span><span class="ss">email</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;user@example.com&quot;</span><span class="p" data-group-id="6020117623-6">}</span><span class="w">
    </span><span class="n">minor_user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="6020117623-7">%{</span><span class="ss">age</span><span class="p">:</span><span class="w"> </span><span class="mi">16</span><span class="p">,</span><span class="w"> </span><span class="ss">email</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;teen@example.com&quot;</span><span class="p" data-group-id="6020117623-7">}</span><span class="w">
    
    </span><span class="n">assert</span><span class="w"> </span><span class="n">is_adult</span><span class="o">.</span><span class="p" data-group-id="6020117623-8">(</span><span class="n">adult_user</span><span class="p" data-group-id="6020117623-8">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">true</span><span class="w">
    </span><span class="n">assert</span><span class="w"> </span><span class="n">is_adult</span><span class="o">.</span><span class="p" data-group-id="6020117623-9">(</span><span class="n">minor_user</span><span class="p" data-group-id="6020117623-9">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">false</span><span class="w">
    
    </span><span class="n">assert</span><span class="w"> </span><span class="n">has_email</span><span class="o">.</span><span class="p" data-group-id="6020117623-10">(</span><span class="n">adult_user</span><span class="p" data-group-id="6020117623-10">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">true</span><span class="w">
    </span><span class="n">assert</span><span class="w"> </span><span class="n">has_email</span><span class="o">.</span><span class="p" data-group-id="6020117623-11">(</span><span class="p" data-group-id="6020117623-12">%{</span><span class="ss">age</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span><span class="w"> </span><span class="ss">email</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;invalid&quot;</span><span class="p" data-group-id="6020117623-12">}</span><span class="p" data-group-id="6020117623-11">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">false</span><span class="w">
  </span><span class="k" data-group-id="6020117623-2">end</span><span class="w">
  
  </span><span class="n">test</span><span class="w"> </span><span class="s">&quot;predicate composition works&quot;</span><span class="w"> </span><span class="k" data-group-id="6020117623-13">do</span><span class="w">
    </span><span class="n">is_adult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="6020117623-14">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">age</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">18</span><span class="w"> </span><span class="k" data-group-id="6020117623-14">end</span><span class="w">
    </span><span class="n">has_email</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="6020117623-15">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">String</span><span class="o">.</span><span class="n">contains?</span><span class="p" data-group-id="6020117623-16">(</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;@&quot;</span><span class="p" data-group-id="6020117623-16">)</span><span class="w"> </span><span class="k" data-group-id="6020117623-15">end</span><span class="w">
    </span><span class="n">is_active</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="6020117623-17">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">active</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">true</span><span class="w"> </span><span class="k" data-group-id="6020117623-17">end</span><span class="w">
    
    </span><span class="c1"># Test AND composition</span><span class="w">
    </span><span class="n">valid_user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="6020117623-18">(</span><span class="p" data-group-id="6020117623-19">[</span><span class="n">is_adult</span><span class="p">,</span><span class="w"> </span><span class="n">has_email</span><span class="p">,</span><span class="w"> </span><span class="n">is_active</span><span class="p" data-group-id="6020117623-19">]</span><span class="p" data-group-id="6020117623-18">)</span><span class="w">
    
    </span><span class="n">fully_valid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="6020117623-20">%{</span><span class="ss">age</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span><span class="w"> </span><span class="ss">email</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;user@example.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">active</span><span class="p">:</span><span class="w"> </span><span class="no">true</span><span class="p" data-group-id="6020117623-20">}</span><span class="w">
    </span><span class="n">invalid_email</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="6020117623-21">%{</span><span class="ss">age</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span><span class="w"> </span><span class="ss">email</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;invalid&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">active</span><span class="p">:</span><span class="w"> </span><span class="no">true</span><span class="p" data-group-id="6020117623-21">}</span><span class="w">
    </span><span class="n">inactive_user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="6020117623-22">%{</span><span class="ss">age</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span><span class="w"> </span><span class="ss">email</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;user@example.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">active</span><span class="p">:</span><span class="w"> </span><span class="no">false</span><span class="p" data-group-id="6020117623-22">}</span><span class="w">
    
    </span><span class="n">assert</span><span class="w"> </span><span class="n">valid_user</span><span class="o">.</span><span class="p" data-group-id="6020117623-23">(</span><span class="n">fully_valid</span><span class="p" data-group-id="6020117623-23">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">true</span><span class="w">
    </span><span class="n">assert</span><span class="w"> </span><span class="n">valid_user</span><span class="o">.</span><span class="p" data-group-id="6020117623-24">(</span><span class="n">invalid_email</span><span class="p" data-group-id="6020117623-24">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">false</span><span class="w">
    </span><span class="n">assert</span><span class="w"> </span><span class="n">valid_user</span><span class="o">.</span><span class="p" data-group-id="6020117623-25">(</span><span class="n">inactive_user</span><span class="p" data-group-id="6020117623-25">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">false</span><span class="w">
    
    </span><span class="c1"># Test OR composition  </span><span class="w">
    </span><span class="n">admin_or_owner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">or_any</span><span class="p" data-group-id="6020117623-26">(</span><span class="p" data-group-id="6020117623-27">[</span><span class="w">
      </span><span class="k" data-group-id="6020117623-28">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">role</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">:admin</span><span class="w"> </span><span class="k" data-group-id="6020117623-28">end</span><span class="p">,</span><span class="w">
      </span><span class="k" data-group-id="6020117623-29">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">owner</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">true</span><span class="w"> </span><span class="k" data-group-id="6020117623-29">end</span><span class="w">
    </span><span class="p" data-group-id="6020117623-27">]</span><span class="p" data-group-id="6020117623-26">)</span><span class="w">
    
    </span><span class="n">admin_user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="6020117623-30">%{</span><span class="ss">role</span><span class="p">:</span><span class="w"> </span><span class="ss">:admin</span><span class="p">,</span><span class="w"> </span><span class="ss">owner</span><span class="p">:</span><span class="w"> </span><span class="no">false</span><span class="p" data-group-id="6020117623-30">}</span><span class="w">
    </span><span class="n">owner_user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="6020117623-31">%{</span><span class="ss">role</span><span class="p">:</span><span class="w"> </span><span class="ss">:user</span><span class="p">,</span><span class="w"> </span><span class="ss">owner</span><span class="p">:</span><span class="w"> </span><span class="no">true</span><span class="p" data-group-id="6020117623-31">}</span><span class="w">
    </span><span class="n">regular_user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="6020117623-32">%{</span><span class="ss">role</span><span class="p">:</span><span class="w"> </span><span class="ss">:user</span><span class="p">,</span><span class="w"> </span><span class="ss">owner</span><span class="p">:</span><span class="w"> </span><span class="no">false</span><span class="p" data-group-id="6020117623-32">}</span><span class="w">
    
    </span><span class="n">assert</span><span class="w"> </span><span class="n">admin_or_owner</span><span class="o">.</span><span class="p" data-group-id="6020117623-33">(</span><span class="n">admin_user</span><span class="p" data-group-id="6020117623-33">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">true</span><span class="w">
    </span><span class="n">assert</span><span class="w"> </span><span class="n">admin_or_owner</span><span class="o">.</span><span class="p" data-group-id="6020117623-34">(</span><span class="n">owner_user</span><span class="p" data-group-id="6020117623-34">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">true</span><span class="w">
    </span><span class="n">assert</span><span class="w"> </span><span class="n">admin_or_owner</span><span class="o">.</span><span class="p" data-group-id="6020117623-35">(</span><span class="n">regular_user</span><span class="p" data-group-id="6020117623-35">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">false</span><span class="w">
  </span><span class="k" data-group-id="6020117623-13">end</span><span class="w">
  
  </span><span class="n">test</span><span class="w"> </span><span class="s">&quot;predicate negation works&quot;</span><span class="w"> </span><span class="k" data-group-id="6020117623-36">do</span><span class="w">
    </span><span class="n">is_admin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="6020117623-37">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">role</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">:admin</span><span class="w"> </span><span class="k" data-group-id="6020117623-37">end</span><span class="w">
    </span><span class="n">is_not_admin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="ow">not</span><span class="p" data-group-id="6020117623-38">(</span><span class="n">is_admin</span><span class="p" data-group-id="6020117623-38">)</span><span class="w">
    
    </span><span class="n">admin_user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="6020117623-39">%{</span><span class="ss">role</span><span class="p">:</span><span class="w"> </span><span class="ss">:admin</span><span class="p" data-group-id="6020117623-39">}</span><span class="w">
    </span><span class="n">regular_user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="6020117623-40">%{</span><span class="ss">role</span><span class="p">:</span><span class="w"> </span><span class="ss">:user</span><span class="p" data-group-id="6020117623-40">}</span><span class="w">
    
    </span><span class="n">assert</span><span class="w"> </span><span class="n">is_admin</span><span class="o">.</span><span class="p" data-group-id="6020117623-41">(</span><span class="n">admin_user</span><span class="p" data-group-id="6020117623-41">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">true</span><span class="w">
    </span><span class="n">assert</span><span class="w"> </span><span class="n">is_not_admin</span><span class="o">.</span><span class="p" data-group-id="6020117623-42">(</span><span class="n">admin_user</span><span class="p" data-group-id="6020117623-42">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">false</span><span class="w">
    
    </span><span class="n">assert</span><span class="w"> </span><span class="n">is_admin</span><span class="o">.</span><span class="p" data-group-id="6020117623-43">(</span><span class="n">regular_user</span><span class="p" data-group-id="6020117623-43">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">false</span><span class="w">
    </span><span class="n">assert</span><span class="w"> </span><span class="n">is_not_admin</span><span class="o">.</span><span class="p" data-group-id="6020117623-44">(</span><span class="n">regular_user</span><span class="p" data-group-id="6020117623-44">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">true</span><span class="w">
  </span><span class="k" data-group-id="6020117623-36">end</span><span class="w">
</span><span class="k" data-group-id="6020117623-1">end</span></code></pre><h3 id="test-composed-predicates" class="section-heading">
  <a href="#test-composed-predicates" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Test Composed Predicates</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="kd">defmodule</span><span class="w"> </span><span class="nc">ComposedPredicateTest</span><span class="w"> </span><span class="k" data-group-id="1817145247-1">do</span><span class="w">
  </span><span class="kn">use</span><span class="w"> </span><span class="nc">ExUnit.Case</span><span class="w">
  
  </span><span class="n">setup</span><span class="w"> </span><span class="k" data-group-id="1817145247-2">do</span><span class="w">
    </span><span class="n">users</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="1817145247-3">[</span><span class="w">
      </span><span class="p" data-group-id="1817145247-4">%{</span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">age</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="ss">role</span><span class="p">:</span><span class="w"> </span><span class="ss">:admin</span><span class="p">,</span><span class="w"> </span><span class="ss">active</span><span class="p">:</span><span class="w"> </span><span class="no">true</span><span class="p">,</span><span class="w"> </span><span class="ss">verified</span><span class="p">:</span><span class="w"> </span><span class="no">true</span><span class="p" data-group-id="1817145247-4">}</span><span class="p">,</span><span class="w">
      </span><span class="p" data-group-id="1817145247-5">%{</span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Bob&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">age</span><span class="p">:</span><span class="w"> </span><span class="mi">17</span><span class="p">,</span><span class="w"> </span><span class="ss">role</span><span class="p">:</span><span class="w"> </span><span class="ss">:user</span><span class="p">,</span><span class="w"> </span><span class="ss">active</span><span class="p">:</span><span class="w"> </span><span class="no">true</span><span class="p">,</span><span class="w"> </span><span class="ss">verified</span><span class="p">:</span><span class="w"> </span><span class="no">false</span><span class="p" data-group-id="1817145247-5">}</span><span class="p">,</span><span class="w">
      </span><span class="p" data-group-id="1817145247-6">%{</span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Carol&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">age</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span><span class="w"> </span><span class="ss">role</span><span class="p">:</span><span class="w"> </span><span class="ss">:moderator</span><span class="p">,</span><span class="w"> </span><span class="ss">active</span><span class="p">:</span><span class="w"> </span><span class="no">false</span><span class="p">,</span><span class="w"> </span><span class="ss">verified</span><span class="p">:</span><span class="w"> </span><span class="no">true</span><span class="p" data-group-id="1817145247-6">}</span><span class="p">,</span><span class="w">
      </span><span class="p" data-group-id="1817145247-7">%{</span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Dave&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">age</span><span class="p">:</span><span class="w"> </span><span class="mi">35</span><span class="p">,</span><span class="w"> </span><span class="ss">role</span><span class="p">:</span><span class="w"> </span><span class="ss">:user</span><span class="p">,</span><span class="w"> </span><span class="ss">active</span><span class="p">:</span><span class="w"> </span><span class="no">true</span><span class="p">,</span><span class="w"> </span><span class="ss">verified</span><span class="p">:</span><span class="w"> </span><span class="no">true</span><span class="p" data-group-id="1817145247-7">}</span><span class="w">
    </span><span class="p" data-group-id="1817145247-3">]</span><span class="w">
    
    </span><span class="p" data-group-id="1817145247-8">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="ss">users</span><span class="p">:</span><span class="w"> </span><span class="n">users</span><span class="p" data-group-id="1817145247-8">}</span><span class="w">
  </span><span class="k" data-group-id="1817145247-2">end</span><span class="w">
  
  </span><span class="n">test</span><span class="w"> </span><span class="s">&quot;complex business rule validation&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1817145247-9">%{</span><span class="ss">users</span><span class="p">:</span><span class="w"> </span><span class="n">users</span><span class="p" data-group-id="1817145247-9">}</span><span class="w"> </span><span class="k" data-group-id="1817145247-10">do</span><span class="w">
    </span><span class="c1"># Build complex business rules</span><span class="w">
    </span><span class="n">basic_requirements</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="1817145247-11">(</span><span class="p" data-group-id="1817145247-12">[</span><span class="w">
      </span><span class="k" data-group-id="1817145247-13">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">age</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">18</span><span class="w"> </span><span class="k" data-group-id="1817145247-13">end</span><span class="p">,</span><span class="w">
      </span><span class="k" data-group-id="1817145247-14">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">active</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">true</span><span class="w"> </span><span class="k" data-group-id="1817145247-14">end</span><span class="p">,</span><span class="w">
      </span><span class="k" data-group-id="1817145247-15">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">verified</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">true</span><span class="w"> </span><span class="k" data-group-id="1817145247-15">end</span><span class="w">
    </span><span class="p" data-group-id="1817145247-12">]</span><span class="p" data-group-id="1817145247-11">)</span><span class="w">
    
    </span><span class="n">elevated_access</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">or_any</span><span class="p" data-group-id="1817145247-16">(</span><span class="p" data-group-id="1817145247-17">[</span><span class="w">
      </span><span class="k" data-group-id="1817145247-18">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">role</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">:admin</span><span class="w"> </span><span class="k" data-group-id="1817145247-18">end</span><span class="p">,</span><span class="w">
      </span><span class="k" data-group-id="1817145247-19">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">role</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">:moderator</span><span class="w"> </span><span class="k" data-group-id="1817145247-19">end</span><span class="w">
    </span><span class="p" data-group-id="1817145247-17">]</span><span class="p" data-group-id="1817145247-16">)</span><span class="w">
    
    </span><span class="n">can_moderate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="1817145247-20">(</span><span class="p" data-group-id="1817145247-21">[</span><span class="n">basic_requirements</span><span class="p">,</span><span class="w"> </span><span class="n">elevated_access</span><span class="p" data-group-id="1817145247-21">]</span><span class="p" data-group-id="1817145247-20">)</span><span class="w">
    
    </span><span class="c1"># Test against known data</span><span class="w">
    </span><span class="p" data-group-id="1817145247-22">[</span><span class="n">alice</span><span class="p">,</span><span class="w"> </span><span class="n">bob</span><span class="p">,</span><span class="w"> </span><span class="n">carol</span><span class="p">,</span><span class="w"> </span><span class="n">dave</span><span class="p" data-group-id="1817145247-22">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">users</span><span class="w">
    
    </span><span class="n">assert</span><span class="w"> </span><span class="n">can_moderate</span><span class="o">.</span><span class="p" data-group-id="1817145247-23">(</span><span class="n">alice</span><span class="p" data-group-id="1817145247-23">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">true</span><span class="w">   </span><span class="c1"># Admin, meets requirements</span><span class="w">
    </span><span class="n">assert</span><span class="w"> </span><span class="n">can_moderate</span><span class="o">.</span><span class="p" data-group-id="1817145247-24">(</span><span class="n">bob</span><span class="p" data-group-id="1817145247-24">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">false</span><span class="w">    </span><span class="c1"># Minor, unverified</span><span class="w">
    </span><span class="n">assert</span><span class="w"> </span><span class="n">can_moderate</span><span class="o">.</span><span class="p" data-group-id="1817145247-25">(</span><span class="n">carol</span><span class="p" data-group-id="1817145247-25">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">false</span><span class="w">  </span><span class="c1"># Inactive</span><span class="w">
    </span><span class="n">assert</span><span class="w"> </span><span class="n">can_moderate</span><span class="o">.</span><span class="p" data-group-id="1817145247-26">(</span><span class="n">dave</span><span class="p" data-group-id="1817145247-26">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">false</span><span class="w">   </span><span class="c1"># No elevated role</span><span class="w">
  </span><span class="k" data-group-id="1817145247-10">end</span><span class="w">
  
  </span><span class="n">test</span><span class="w"> </span><span class="s">&quot;filtering with composed predicates&quot;</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1817145247-27">%{</span><span class="ss">users</span><span class="p">:</span><span class="w"> </span><span class="n">users</span><span class="p" data-group-id="1817145247-27">}</span><span class="w"> </span><span class="k" data-group-id="1817145247-28">do</span><span class="w">
    </span><span class="c1"># Create filtering predicates</span><span class="w">
    </span><span class="n">is_adult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="1817145247-29">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">age</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">18</span><span class="w"> </span><span class="k" data-group-id="1817145247-29">end</span><span class="w">
    </span><span class="n">is_staff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">or_any</span><span class="p" data-group-id="1817145247-30">(</span><span class="p" data-group-id="1817145247-31">[</span><span class="w">
      </span><span class="k" data-group-id="1817145247-32">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">role</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">:admin</span><span class="w"> </span><span class="k" data-group-id="1817145247-32">end</span><span class="p">,</span><span class="w">
      </span><span class="k" data-group-id="1817145247-33">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">role</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">:moderator</span><span class="w"> </span><span class="k" data-group-id="1817145247-33">end</span><span class="w">
    </span><span class="p" data-group-id="1817145247-31">]</span><span class="p" data-group-id="1817145247-30">)</span><span class="w">
    
    </span><span class="n">active_staff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="1817145247-34">(</span><span class="p" data-group-id="1817145247-35">[</span><span class="w">
      </span><span class="n">is_adult</span><span class="p">,</span><span class="w">
      </span><span class="n">is_staff</span><span class="p">,</span><span class="w">
      </span><span class="k" data-group-id="1817145247-36">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">active</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">true</span><span class="w"> </span><span class="k" data-group-id="1817145247-36">end</span><span class="w">
    </span><span class="p" data-group-id="1817145247-35">]</span><span class="p" data-group-id="1817145247-34">)</span><span class="w">
    
    </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">filter</span><span class="p" data-group-id="1817145247-37">(</span><span class="n">users</span><span class="p">,</span><span class="w"> </span><span class="n">active_staff</span><span class="p" data-group-id="1817145247-37">)</span><span class="w">
    
    </span><span class="c1"># Only Alice should match (adult, admin, active)</span><span class="w">
    </span><span class="n">assert</span><span class="w"> </span><span class="n">length</span><span class="p" data-group-id="1817145247-38">(</span><span class="n">result</span><span class="p" data-group-id="1817145247-38">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w">
    </span><span class="n">assert</span><span class="w"> </span><span class="n">hd</span><span class="p" data-group-id="1817145247-39">(</span><span class="n">result</span><span class="p" data-group-id="1817145247-39">)</span><span class="o">.</span><span class="n">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span><span class="w">
  </span><span class="k" data-group-id="1817145247-28">end</span><span class="w">
  
  </span><span class="n">test</span><span class="w"> </span><span class="s">&quot;short-circuiting behavior&quot;</span><span class="w"> </span><span class="k" data-group-id="1817145247-40">do</span><span class="w">
    </span><span class="n">call_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Agent</span><span class="o">.</span><span class="n">start_link</span><span class="p" data-group-id="1817145247-41">(</span><span class="k" data-group-id="1817145247-42">fn</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k" data-group-id="1817145247-42">end</span><span class="p">,</span><span class="w"> </span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="ss">:test_counter</span><span class="p" data-group-id="1817145247-41">)</span><span class="w">
    
    </span><span class="n">expensive_predicate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="1817145247-43">fn</span><span class="w"> </span><span class="c">_user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
      </span><span class="nc">Agent</span><span class="o">.</span><span class="n">update</span><span class="p" data-group-id="1817145247-44">(</span><span class="ss">:test_counter</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="p" data-group-id="1817145247-45">(</span><span class="ni">&amp;1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="1817145247-45">)</span><span class="p" data-group-id="1817145247-44">)</span><span class="w">
      </span><span class="no">true</span><span class="w">
    </span><span class="k" data-group-id="1817145247-43">end</span><span class="w">
    
    </span><span class="c1"># This should short-circuit after the first false</span><span class="w">
    </span><span class="n">short_circuit_predicate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="1817145247-46">(</span><span class="p" data-group-id="1817145247-47">[</span><span class="w">
      </span><span class="k" data-group-id="1817145247-48">fn</span><span class="w"> </span><span class="c">_user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">false</span><span class="w"> </span><span class="k" data-group-id="1817145247-48">end</span><span class="p">,</span><span class="w">  </span><span class="c1"># Always false - should short-circuit here</span><span class="w">
      </span><span class="n">expensive_predicate</span><span class="w">    </span><span class="c1"># Should not be called</span><span class="w">
    </span><span class="p" data-group-id="1817145247-47">]</span><span class="p" data-group-id="1817145247-46">)</span><span class="w">
    
    </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="1817145247-49">%{</span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Test&quot;</span><span class="p" data-group-id="1817145247-49">}</span><span class="w">
    </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">short_circuit_predicate</span><span class="o">.</span><span class="p" data-group-id="1817145247-50">(</span><span class="n">user</span><span class="p" data-group-id="1817145247-50">)</span><span class="w">
    </span><span class="n">call_count_after</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Agent</span><span class="o">.</span><span class="n">get</span><span class="p" data-group-id="1817145247-51">(</span><span class="ss">:test_counter</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="ni">&amp;1</span><span class="p" data-group-id="1817145247-51">)</span><span class="w">
    
    </span><span class="n">assert</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">false</span><span class="w">
    </span><span class="n">assert</span><span class="w"> </span><span class="n">call_count_after</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w">  </span><span class="c1"># Expensive predicate was not called</span><span class="w">
  </span><span class="k" data-group-id="1817145247-40">end</span><span class="w">
</span><span class="k" data-group-id="1817145247-1">end</span></code></pre><h3 id="test-edge-cases" class="section-heading">
  <a href="#test-edge-cases" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Test Edge Cases</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="kd">defmodule</span><span class="w"> </span><span class="nc">PredicateEdgeCaseTest</span><span class="w"> </span><span class="k" data-group-id="2882848239-1">do</span><span class="w">
  </span><span class="kn">use</span><span class="w"> </span><span class="nc">ExUnit.Case</span><span class="w">
  
  </span><span class="n">test</span><span class="w"> </span><span class="s">&quot;empty predicate lists&quot;</span><span class="w"> </span><span class="k" data-group-id="2882848239-2">do</span><span class="w">
    </span><span class="c1"># Empty and_all should return true (identity element)</span><span class="w">
    </span><span class="n">always_true</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="2882848239-3">(</span><span class="p" data-group-id="2882848239-4">[</span><span class="p" data-group-id="2882848239-4">]</span><span class="p" data-group-id="2882848239-3">)</span><span class="w">
    </span><span class="n">assert</span><span class="w"> </span><span class="n">always_true</span><span class="o">.</span><span class="p" data-group-id="2882848239-5">(</span><span class="ss">:anything</span><span class="p" data-group-id="2882848239-5">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">true</span><span class="w">
    
    </span><span class="c1"># Empty or_any should return false (identity element)</span><span class="w">
    </span><span class="n">always_false</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">or_any</span><span class="p" data-group-id="2882848239-6">(</span><span class="p" data-group-id="2882848239-7">[</span><span class="p" data-group-id="2882848239-7">]</span><span class="p" data-group-id="2882848239-6">)</span><span class="w">
    </span><span class="n">assert</span><span class="w"> </span><span class="n">always_false</span><span class="o">.</span><span class="p" data-group-id="2882848239-8">(</span><span class="ss">:anything</span><span class="p" data-group-id="2882848239-8">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">false</span><span class="w">
  </span><span class="k" data-group-id="2882848239-2">end</span><span class="w">
  
  </span><span class="n">test</span><span class="w"> </span><span class="s">&quot;single predicate in composition&quot;</span><span class="w"> </span><span class="k" data-group-id="2882848239-9">do</span><span class="w">
    </span><span class="n">single_pred</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="2882848239-10">fn</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="k" data-group-id="2882848239-10">end</span><span class="w">
    
    </span><span class="n">and_single</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="2882848239-11">(</span><span class="p" data-group-id="2882848239-12">[</span><span class="n">single_pred</span><span class="p" data-group-id="2882848239-12">]</span><span class="p" data-group-id="2882848239-11">)</span><span class="w">
    </span><span class="n">or_single</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">or_any</span><span class="p" data-group-id="2882848239-13">(</span><span class="p" data-group-id="2882848239-14">[</span><span class="n">single_pred</span><span class="p" data-group-id="2882848239-14">]</span><span class="p" data-group-id="2882848239-13">)</span><span class="w">
    
    </span><span class="n">assert</span><span class="w"> </span><span class="n">and_single</span><span class="o">.</span><span class="p" data-group-id="2882848239-15">(</span><span class="mi">10</span><span class="p" data-group-id="2882848239-15">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">true</span><span class="w">
    </span><span class="n">assert</span><span class="w"> </span><span class="n">or_single</span><span class="o">.</span><span class="p" data-group-id="2882848239-16">(</span><span class="mi">10</span><span class="p" data-group-id="2882848239-16">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">true</span><span class="w">
    </span><span class="n">assert</span><span class="w"> </span><span class="n">and_single</span><span class="o">.</span><span class="p" data-group-id="2882848239-17">(</span><span class="mi">3</span><span class="p" data-group-id="2882848239-17">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">false</span><span class="w">
    </span><span class="n">assert</span><span class="w"> </span><span class="n">or_single</span><span class="o">.</span><span class="p" data-group-id="2882848239-18">(</span><span class="mi">3</span><span class="p" data-group-id="2882848239-18">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">false</span><span class="w">
  </span><span class="k" data-group-id="2882848239-9">end</span><span class="w">
  
  </span><span class="n">test</span><span class="w"> </span><span class="s">&quot;nested composition&quot;</span><span class="w"> </span><span class="k" data-group-id="2882848239-19">do</span><span class="w">
    </span><span class="c1"># Build nested predicate structure</span><span class="w">
    </span><span class="n">inner_and</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="2882848239-20">(</span><span class="p" data-group-id="2882848239-21">[</span><span class="w">
      </span><span class="k" data-group-id="2882848239-22">fn</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k" data-group-id="2882848239-22">end</span><span class="p">,</span><span class="w">
      </span><span class="k" data-group-id="2882848239-23">fn</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="k" data-group-id="2882848239-23">end</span><span class="w">
    </span><span class="p" data-group-id="2882848239-21">]</span><span class="p" data-group-id="2882848239-20">)</span><span class="w">
    
    </span><span class="n">inner_or</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">or_any</span><span class="p" data-group-id="2882848239-24">(</span><span class="p" data-group-id="2882848239-25">[</span><span class="w">
      </span><span class="k" data-group-id="2882848239-26">fn</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="k" data-group-id="2882848239-26">end</span><span class="p">,</span><span class="w">  </span><span class="c1"># Special case</span><span class="w">
      </span><span class="n">inner_and</span><span class="w">             </span><span class="c1"># Or within normal range</span><span class="w">
    </span><span class="p" data-group-id="2882848239-25">]</span><span class="p" data-group-id="2882848239-24">)</span><span class="w">
    
    </span><span class="n">outer_predicate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="2882848239-27">(</span><span class="p" data-group-id="2882848239-28">[</span><span class="w">
      </span><span class="k" data-group-id="2882848239-29">fn</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">is_integer</span><span class="p" data-group-id="2882848239-30">(</span><span class="n">x</span><span class="p" data-group-id="2882848239-30">)</span><span class="w"> </span><span class="k" data-group-id="2882848239-29">end</span><span class="p">,</span><span class="w">
      </span><span class="n">inner_or</span><span class="w">
    </span><span class="p" data-group-id="2882848239-28">]</span><span class="p" data-group-id="2882848239-27">)</span><span class="w">
    
    </span><span class="n">assert</span><span class="w"> </span><span class="n">outer_predicate</span><span class="o">.</span><span class="p" data-group-id="2882848239-31">(</span><span class="mi">50</span><span class="p" data-group-id="2882848239-31">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">true</span><span class="w">    </span><span class="c1"># Integer in range</span><span class="w">
    </span><span class="n">assert</span><span class="w"> </span><span class="n">outer_predicate</span><span class="o">.</span><span class="p" data-group-id="2882848239-32">(</span><span class="o">-</span><span class="mi">1</span><span class="p" data-group-id="2882848239-32">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">true</span><span class="w">    </span><span class="c1"># Special case</span><span class="w">
    </span><span class="n">assert</span><span class="w"> </span><span class="n">outer_predicate</span><span class="o">.</span><span class="p" data-group-id="2882848239-33">(</span><span class="mi">150</span><span class="p" data-group-id="2882848239-33">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">false</span><span class="w">  </span><span class="c1"># Out of range</span><span class="w">
    </span><span class="n">assert</span><span class="w"> </span><span class="n">outer_predicate</span><span class="o">.</span><span class="p" data-group-id="2882848239-34">(</span><span class="mf">5.5</span><span class="p" data-group-id="2882848239-34">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">false</span><span class="w">  </span><span class="c1"># Not integer</span><span class="w">
  </span><span class="k" data-group-id="2882848239-19">end</span><span class="w">
  
  </span><span class="n">test</span><span class="w"> </span><span class="s">&quot;nil and error handling&quot;</span><span class="w"> </span><span class="k" data-group-id="2882848239-35">do</span><span class="w">
    </span><span class="n">safe_predicate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="2882848239-36">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
      </span><span class="c1"># Safely handle potential nil values</span><span class="w">
      </span><span class="ow">not</span><span class="w"> </span><span class="n">is_nil</span><span class="p" data-group-id="2882848239-37">(</span><span class="n">user</span><span class="p" data-group-id="2882848239-37">)</span><span class="w"> </span><span class="ow">and</span><span class="w"> 
      </span><span class="nc">Map</span><span class="o">.</span><span class="n">has_key?</span><span class="p" data-group-id="2882848239-38">(</span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="ss">:age</span><span class="p" data-group-id="2882848239-38">)</span><span class="w"> </span><span class="ow">and</span><span class="w"> 
      </span><span class="ow">not</span><span class="w"> </span><span class="n">is_nil</span><span class="p" data-group-id="2882848239-39">(</span><span class="n">user</span><span class="o">.</span><span class="n">age</span><span class="p" data-group-id="2882848239-39">)</span><span class="w"> </span><span class="ow">and</span><span class="w">
      </span><span class="n">user</span><span class="o">.</span><span class="n">age</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">18</span><span class="w">
    </span><span class="k" data-group-id="2882848239-36">end</span><span class="w">
    
    </span><span class="n">assert</span><span class="w"> </span><span class="n">safe_predicate</span><span class="o">.</span><span class="p" data-group-id="2882848239-40">(</span><span class="p" data-group-id="2882848239-41">%{</span><span class="ss">age</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="p" data-group-id="2882848239-41">}</span><span class="p" data-group-id="2882848239-40">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">true</span><span class="w">
    </span><span class="n">assert</span><span class="w"> </span><span class="n">safe_predicate</span><span class="o">.</span><span class="p" data-group-id="2882848239-42">(</span><span class="p" data-group-id="2882848239-43">%{</span><span class="p" data-group-id="2882848239-43">}</span><span class="p" data-group-id="2882848239-42">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">false</span><span class="w">
    </span><span class="n">assert</span><span class="w"> </span><span class="n">safe_predicate</span><span class="o">.</span><span class="p" data-group-id="2882848239-44">(</span><span class="no">nil</span><span class="p" data-group-id="2882848239-44">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">false</span><span class="w">
  </span><span class="k" data-group-id="2882848239-35">end</span><span class="w">
</span><span class="k" data-group-id="2882848239-1">end</span></code></pre><h2 id="llm-debugging-tips" class="section-heading">
  <a href="#llm-debugging-tips" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">LLM Debugging Tips</span>
</h2>
<h3 id="named-predicates-for-clarity" class="section-heading">
  <a href="#named-predicates-for-clarity" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Named Predicates for Clarity</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="kd">def</span><span class="w"> </span><span class="nf">build_debuggable_predicates</span><span class="p" data-group-id="6426784252-1">(</span><span class="p" data-group-id="6426784252-1">)</span><span class="w"> </span><span class="k" data-group-id="6426784252-2">do</span><span class="w">
  </span><span class="c1"># Create named predicates for easier debugging</span><span class="w">
  </span><span class="n">predicates</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="6426784252-3">%{</span><span class="w">
    </span><span class="ss">is_adult</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="6426784252-4">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> 
      </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">age</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">18</span><span class="w">
      </span><span class="nc">IO</span><span class="o">.</span><span class="n">puts</span><span class="p" data-group-id="6426784252-5">(</span><span class="s">&quot;is_adult(</span><span class="si" data-group-id="6426784252-6">#{</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="si" data-group-id="6426784252-6">}</span><span class="s">): </span><span class="si" data-group-id="6426784252-7">#{</span><span class="n">result</span><span class="si" data-group-id="6426784252-7">}</span><span class="s">&quot;</span><span class="p" data-group-id="6426784252-5">)</span><span class="w">
      </span><span class="n">result</span><span class="w">
    </span><span class="k" data-group-id="6426784252-4">end</span><span class="p">,</span><span class="w">
    
    </span><span class="ss">has_valid_email</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="6426784252-8">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
      </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">String</span><span class="o">.</span><span class="n">contains?</span><span class="p" data-group-id="6426784252-9">(</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;@&quot;</span><span class="p" data-group-id="6426784252-9">)</span><span class="w">
      </span><span class="nc">IO</span><span class="o">.</span><span class="n">puts</span><span class="p" data-group-id="6426784252-10">(</span><span class="s">&quot;has_valid_email(</span><span class="si" data-group-id="6426784252-11">#{</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="si" data-group-id="6426784252-11">}</span><span class="s">): </span><span class="si" data-group-id="6426784252-12">#{</span><span class="n">result</span><span class="si" data-group-id="6426784252-12">}</span><span class="s">&quot;</span><span class="p" data-group-id="6426784252-10">)</span><span class="w">
      </span><span class="n">result</span><span class="w">
    </span><span class="k" data-group-id="6426784252-8">end</span><span class="p">,</span><span class="w">
    
    </span><span class="ss">is_active</span><span class="p">:</span><span class="w"> </span><span class="k" data-group-id="6426784252-13">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
      </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">active</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">true</span><span class="w">
      </span><span class="nc">IO</span><span class="o">.</span><span class="n">puts</span><span class="p" data-group-id="6426784252-14">(</span><span class="s">&quot;is_active(</span><span class="si" data-group-id="6426784252-15">#{</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="si" data-group-id="6426784252-15">}</span><span class="s">): </span><span class="si" data-group-id="6426784252-16">#{</span><span class="n">result</span><span class="si" data-group-id="6426784252-16">}</span><span class="s">&quot;</span><span class="p" data-group-id="6426784252-14">)</span><span class="w">  
      </span><span class="n">result</span><span class="w">
    </span><span class="k" data-group-id="6426784252-13">end</span><span class="w">
  </span><span class="p" data-group-id="6426784252-3">}</span><span class="w">
  
  </span><span class="c1"># Compose with logging</span><span class="w">
  </span><span class="n">user_validator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="6426784252-17">(</span><span class="p" data-group-id="6426784252-18">[</span><span class="w">
    </span><span class="n">predicates</span><span class="o">.</span><span class="n">is_adult</span><span class="p">,</span><span class="w">
    </span><span class="n">predicates</span><span class="o">.</span><span class="n">has_valid_email</span><span class="p">,</span><span class="w">
    </span><span class="n">predicates</span><span class="o">.</span><span class="n">is_active</span><span class="w">
  </span><span class="p" data-group-id="6426784252-18">]</span><span class="p" data-group-id="6426784252-17">)</span><span class="w">
  
  </span><span class="c1"># Test user</span><span class="w">
  </span><span class="n">test_user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="6426784252-19">%{</span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Alice&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">age</span><span class="p">:</span><span class="w"> </span><span class="mi">25</span><span class="p">,</span><span class="w"> </span><span class="ss">email</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;alice@test.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">active</span><span class="p">:</span><span class="w"> </span><span class="no">true</span><span class="p" data-group-id="6426784252-19">}</span><span class="w">
  
  </span><span class="nc">IO</span><span class="o">.</span><span class="n">puts</span><span class="p" data-group-id="6426784252-20">(</span><span class="s">&quot;Testing user validation:&quot;</span><span class="p" data-group-id="6426784252-20">)</span><span class="w">
  </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">user_validator</span><span class="o">.</span><span class="p" data-group-id="6426784252-21">(</span><span class="n">test_user</span><span class="p" data-group-id="6426784252-21">)</span><span class="w">
  </span><span class="nc">IO</span><span class="o">.</span><span class="n">puts</span><span class="p" data-group-id="6426784252-22">(</span><span class="s">&quot;Final result: </span><span class="si" data-group-id="6426784252-23">#{</span><span class="n">result</span><span class="si" data-group-id="6426784252-23">}</span><span class="s">&quot;</span><span class="p" data-group-id="6426784252-22">)</span><span class="w">
  
  </span><span class="n">result</span><span class="w">
</span><span class="k" data-group-id="6426784252-2">end</span></code></pre><h3 id="component-testing" class="section-heading">
  <a href="#component-testing" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Component Testing</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="kd">def</span><span class="w"> </span><span class="nf">debug_predicate_composition</span><span class="p" data-group-id="4492047591-1">(</span><span class="p" data-group-id="4492047591-1">)</span><span class="w"> </span><span class="k" data-group-id="4492047591-2">do</span><span class="w">
  </span><span class="c1"># Test individual components first</span><span class="w">
  </span><span class="n">predicates</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="4492047591-3">[</span><span class="w">
    </span><span class="p" data-group-id="4492047591-4">{</span><span class="s">&quot;age_check&quot;</span><span class="p">,</span><span class="w"> </span><span class="k" data-group-id="4492047591-5">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">age</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">18</span><span class="w"> </span><span class="k" data-group-id="4492047591-5">end</span><span class="p" data-group-id="4492047591-4">}</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="4492047591-6">{</span><span class="s">&quot;email_check&quot;</span><span class="p">,</span><span class="w"> </span><span class="k" data-group-id="4492047591-7">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">String</span><span class="o">.</span><span class="n">contains?</span><span class="p" data-group-id="4492047591-8">(</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;@&quot;</span><span class="p" data-group-id="4492047591-8">)</span><span class="w"> </span><span class="k" data-group-id="4492047591-7">end</span><span class="p" data-group-id="4492047591-6">}</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="4492047591-9">{</span><span class="s">&quot;active_check&quot;</span><span class="p">,</span><span class="w"> </span><span class="k" data-group-id="4492047591-10">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">active</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">true</span><span class="w"> </span><span class="k" data-group-id="4492047591-10">end</span><span class="p" data-group-id="4492047591-9">}</span><span class="w">
  </span><span class="p" data-group-id="4492047591-3">]</span><span class="w">
  
  </span><span class="n">test_user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="4492047591-11">%{</span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Bob&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">age</span><span class="p">:</span><span class="w"> </span><span class="mi">17</span><span class="p">,</span><span class="w"> </span><span class="ss">email</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bob@test.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">active</span><span class="p">:</span><span class="w"> </span><span class="no">false</span><span class="p" data-group-id="4492047591-11">}</span><span class="w">
  
  </span><span class="nc">IO</span><span class="o">.</span><span class="n">puts</span><span class="p" data-group-id="4492047591-12">(</span><span class="s">&quot;Individual predicate results:&quot;</span><span class="p" data-group-id="4492047591-12">)</span><span class="w">
  </span><span class="n">individual_results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">predicates</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">map</span><span class="p" data-group-id="4492047591-13">(</span><span class="k" data-group-id="4492047591-14">fn</span><span class="w"> </span><span class="p" data-group-id="4492047591-15">{</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">pred</span><span class="p" data-group-id="4492047591-15">}</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
    </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pred</span><span class="o">.</span><span class="p" data-group-id="4492047591-16">(</span><span class="n">test_user</span><span class="p" data-group-id="4492047591-16">)</span><span class="w">
    </span><span class="nc">IO</span><span class="o">.</span><span class="n">puts</span><span class="p" data-group-id="4492047591-17">(</span><span class="s">&quot;</span><span class="si" data-group-id="4492047591-18">#{</span><span class="n">name</span><span class="si" data-group-id="4492047591-18">}</span><span class="s">: </span><span class="si" data-group-id="4492047591-19">#{</span><span class="n">result</span><span class="si" data-group-id="4492047591-19">}</span><span class="s">&quot;</span><span class="p" data-group-id="4492047591-17">)</span><span class="w">
    </span><span class="p" data-group-id="4492047591-20">{</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p" data-group-id="4492047591-20">}</span><span class="w">
  </span><span class="k" data-group-id="4492047591-14">end</span><span class="p" data-group-id="4492047591-13">)</span><span class="w">
  
  </span><span class="c1"># Test composition</span><span class="w">
  </span><span class="n">composed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">predicates</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">map</span><span class="p" data-group-id="4492047591-21">(</span><span class="k" data-group-id="4492047591-22">fn</span><span class="w"> </span><span class="p" data-group-id="4492047591-23">{</span><span class="bp">_</span><span class="p">,</span><span class="w"> </span><span class="n">pred</span><span class="p" data-group-id="4492047591-23">}</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">pred</span><span class="w"> </span><span class="k" data-group-id="4492047591-22">end</span><span class="p" data-group-id="4492047591-21">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">p_all</span><span class="p" data-group-id="4492047591-24">(</span><span class="p" data-group-id="4492047591-24">)</span><span class="w">
  </span><span class="n">composed_result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">composed</span><span class="o">.</span><span class="p" data-group-id="4492047591-25">(</span><span class="n">test_user</span><span class="p" data-group-id="4492047591-25">)</span><span class="w">
  
  </span><span class="nc">IO</span><span class="o">.</span><span class="n">puts</span><span class="p" data-group-id="4492047591-26">(</span><span class="s">&quot;Composed result: </span><span class="si" data-group-id="4492047591-27">#{</span><span class="n">composed_result</span><span class="si" data-group-id="4492047591-27">}</span><span class="s">&quot;</span><span class="p" data-group-id="4492047591-26">)</span><span class="w">
  
  </span><span class="c1"># Analyze results</span><span class="w">
  </span><span class="n">failing_predicates</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">individual_results</span><span class="w"> 
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">filter</span><span class="p" data-group-id="4492047591-28">(</span><span class="k" data-group-id="4492047591-29">fn</span><span class="w"> </span><span class="p" data-group-id="4492047591-30">{</span><span class="bp">_</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p" data-group-id="4492047591-30">}</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="k" data-group-id="4492047591-29">end</span><span class="p" data-group-id="4492047591-28">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">map</span><span class="p" data-group-id="4492047591-31">(</span><span class="k" data-group-id="4492047591-32">fn</span><span class="w"> </span><span class="p" data-group-id="4492047591-33">{</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="bp">_</span><span class="p" data-group-id="4492047591-33">}</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k" data-group-id="4492047591-32">end</span><span class="p" data-group-id="4492047591-31">)</span><span class="w">
  
  </span><span class="nc">IO</span><span class="o">.</span><span class="n">puts</span><span class="p" data-group-id="4492047591-34">(</span><span class="s">&quot;Failing predicates: </span><span class="si" data-group-id="4492047591-35">#{</span><span class="n">inspect</span><span class="p" data-group-id="4492047591-36">(</span><span class="n">failing_predicates</span><span class="p" data-group-id="4492047591-36">)</span><span class="si" data-group-id="4492047591-35">}</span><span class="s">&quot;</span><span class="p" data-group-id="4492047591-34">)</span><span class="w">
  
  </span><span class="p" data-group-id="4492047591-37">%{</span><span class="ss">individual</span><span class="p">:</span><span class="w"> </span><span class="n">individual_results</span><span class="p">,</span><span class="w"> </span><span class="ss">composed</span><span class="p">:</span><span class="w"> </span><span class="n">composed_result</span><span class="p">,</span><span class="w"> </span><span class="ss">failing</span><span class="p">:</span><span class="w"> </span><span class="n">failing_predicates</span><span class="p" data-group-id="4492047591-37">}</span><span class="w">
</span><span class="k" data-group-id="4492047591-2">end</span></code></pre><h2 id="llm-error-message-design" class="section-heading">
  <a href="#llm-error-message-design" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">LLM Error Message Design</span>
</h2>
<h3 id="providing-context-for-failures" class="section-heading">
  <a href="#providing-context-for-failures" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Providing Context for Failures</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="kd">def</span><span class="w"> </span><span class="nf">build_descriptive_validation</span><span class="p" data-group-id="7687231632-1">(</span><span class="p" data-group-id="7687231632-1">)</span><span class="w"> </span><span class="k" data-group-id="7687231632-2">do</span><span class="w">
  </span><span class="c1"># Create predicates with error context</span><span class="w">
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">create_validating_predicate</span><span class="p" data-group-id="7687231632-3">(</span><span class="n">predicate_fn</span><span class="p">,</span><span class="w"> </span><span class="n">description</span><span class="p" data-group-id="7687231632-3">)</span><span class="w"> </span><span class="k" data-group-id="7687231632-4">do</span><span class="w">
    </span><span class="k" data-group-id="7687231632-5">fn</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
      </span><span class="k">case</span><span class="w"> </span><span class="n">predicate_fn</span><span class="o">.</span><span class="p" data-group-id="7687231632-6">(</span><span class="n">value</span><span class="p" data-group-id="7687231632-6">)</span><span class="w"> </span><span class="k" data-group-id="7687231632-7">do</span><span class="w">
        </span><span class="no">true</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p" data-group-id="7687231632-8">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p" data-group-id="7687231632-8">}</span><span class="w">
        </span><span class="no">false</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p" data-group-id="7687231632-9">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;</span><span class="si" data-group-id="7687231632-10">#{</span><span class="n">description</span><span class="si" data-group-id="7687231632-10">}</span><span class="s"> failed for </span><span class="si" data-group-id="7687231632-11">#{</span><span class="n">inspect</span><span class="p" data-group-id="7687231632-12">(</span><span class="n">value</span><span class="p" data-group-id="7687231632-12">)</span><span class="si" data-group-id="7687231632-11">}</span><span class="s">&quot;</span><span class="p" data-group-id="7687231632-9">}</span><span class="w">
      </span><span class="k" data-group-id="7687231632-7">end</span><span class="w">
    </span><span class="k" data-group-id="7687231632-5">end</span><span class="w">
  </span><span class="k" data-group-id="7687231632-4">end</span><span class="w">
  
  </span><span class="c1"># Build contextual validators</span><span class="w">
  </span><span class="n">validators</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="7687231632-13">%{</span><span class="w">
    </span><span class="ss">age_validator</span><span class="p">:</span><span class="w"> </span><span class="n">create_validating_predicate</span><span class="p" data-group-id="7687231632-14">(</span><span class="w">
      </span><span class="k" data-group-id="7687231632-15">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">age</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">18</span><span class="w"> </span><span class="k" data-group-id="7687231632-15">end</span><span class="p">,</span><span class="w">
      </span><span class="s">&quot;Age requirement (&gt;=18)&quot;</span><span class="w">
    </span><span class="p" data-group-id="7687231632-14">)</span><span class="p">,</span><span class="w">
    
    </span><span class="ss">email_validator</span><span class="p">:</span><span class="w"> </span><span class="n">create_validating_predicate</span><span class="p" data-group-id="7687231632-16">(</span><span class="w">
      </span><span class="k" data-group-id="7687231632-17">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">String</span><span class="o">.</span><span class="n">contains?</span><span class="p" data-group-id="7687231632-18">(</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;@&quot;</span><span class="p" data-group-id="7687231632-18">)</span><span class="w"> </span><span class="k" data-group-id="7687231632-17">end</span><span class="p">,</span><span class="w">
      </span><span class="s">&quot;Email format validation&quot;</span><span class="w">
    </span><span class="p" data-group-id="7687231632-16">)</span><span class="p">,</span><span class="w">
    
    </span><span class="ss">status_validator</span><span class="p">:</span><span class="w"> </span><span class="n">create_validating_predicate</span><span class="p" data-group-id="7687231632-19">(</span><span class="w">
      </span><span class="k" data-group-id="7687231632-20">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">:active</span><span class="w"> </span><span class="k" data-group-id="7687231632-20">end</span><span class="p">,</span><span class="w">
      </span><span class="s">&quot;Active status requirement&quot;</span><span class="w">
    </span><span class="p" data-group-id="7687231632-19">)</span><span class="w">
  </span><span class="p" data-group-id="7687231632-13">}</span><span class="w">
  
  </span><span class="c1"># Compose with error accumulation</span><span class="w">
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">validate_user_with_errors</span><span class="p" data-group-id="7687231632-21">(</span><span class="n">user</span><span class="p" data-group-id="7687231632-21">)</span><span class="w"> </span><span class="k" data-group-id="7687231632-22">do</span><span class="w">
    </span><span class="n">results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="7687231632-23">[</span><span class="w">
      </span><span class="n">validators</span><span class="o">.</span><span class="n">age_validator</span><span class="o">.</span><span class="p" data-group-id="7687231632-24">(</span><span class="n">user</span><span class="p" data-group-id="7687231632-24">)</span><span class="p">,</span><span class="w">
      </span><span class="n">validators</span><span class="o">.</span><span class="n">email_validator</span><span class="o">.</span><span class="p" data-group-id="7687231632-25">(</span><span class="n">user</span><span class="p" data-group-id="7687231632-25">)</span><span class="p">,</span><span class="w">
      </span><span class="n">validators</span><span class="o">.</span><span class="n">status_validator</span><span class="o">.</span><span class="p" data-group-id="7687231632-26">(</span><span class="n">user</span><span class="p" data-group-id="7687231632-26">)</span><span class="w">
    </span><span class="p" data-group-id="7687231632-23">]</span><span class="w">
    
    </span><span class="n">errors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">results</span><span class="w"> 
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">filter</span><span class="p" data-group-id="7687231632-27">(</span><span class="k" data-group-id="7687231632-28">fn</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">elem</span><span class="p" data-group-id="7687231632-29">(</span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="7687231632-29">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">:error</span><span class="w"> </span><span class="k" data-group-id="7687231632-28">end</span><span class="p" data-group-id="7687231632-27">)</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">map</span><span class="p" data-group-id="7687231632-30">(</span><span class="k" data-group-id="7687231632-31">fn</span><span class="w"> </span><span class="p" data-group-id="7687231632-32">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="n">msg</span><span class="p" data-group-id="7687231632-32">}</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">msg</span><span class="w"> </span><span class="k" data-group-id="7687231632-31">end</span><span class="p" data-group-id="7687231632-30">)</span><span class="w">
    
    </span><span class="k">case</span><span class="w"> </span><span class="n">errors</span><span class="w"> </span><span class="k" data-group-id="7687231632-33">do</span><span class="w">
      </span><span class="p" data-group-id="7687231632-34">[</span><span class="p" data-group-id="7687231632-34">]</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p" data-group-id="7687231632-35">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p" data-group-id="7687231632-35">}</span><span class="w">
      </span><span class="n">error_list</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p" data-group-id="7687231632-36">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Validation failed: &quot;</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">join</span><span class="p" data-group-id="7687231632-37">(</span><span class="n">error_list</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;, &quot;</span><span class="p" data-group-id="7687231632-37">)</span><span class="p" data-group-id="7687231632-36">}</span><span class="w">
    </span><span class="k" data-group-id="7687231632-33">end</span><span class="w">
  </span><span class="k" data-group-id="7687231632-22">end</span><span class="w">
  
  </span><span class="p" data-group-id="7687231632-38">%{</span><span class="ss">validate</span><span class="p">:</span><span class="w"> </span><span class="o">&amp;</span><span class="n">validate_user_with_errors</span><span class="o">/</span><span class="mi">1</span><span class="p" data-group-id="7687231632-38">}</span><span class="w">
</span><span class="k" data-group-id="7687231632-2">end</span></code></pre><h2 id="llm-common-mistakes-to-avoid" class="section-heading">
  <a href="#llm-common-mistakes-to-avoid" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">LLM Common Mistakes to Avoid</span>
</h2>
<h3 id="don-t-use-side-effects-in-predicates" class="section-heading">
  <a href="#don-t-use-side-effects-in-predicates" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">❌ Don't Use Side Effects in Predicates</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="c1"># ❌ Wrong: predicates with side effects</span><span class="w">
</span><span class="n">bad_predicate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="5583590763-1">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
  </span><span class="nc">Logger</span><span class="o">.</span><span class="n">info</span><span class="p" data-group-id="5583590763-2">(</span><span class="s">&quot;Checking user </span><span class="si" data-group-id="5583590763-3">#{</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="si" data-group-id="5583590763-3">}</span><span class="s">&quot;</span><span class="p" data-group-id="5583590763-2">)</span><span class="w">  </span><span class="c1"># Side effect!</span><span class="w">
  </span><span class="nc">Database</span><span class="o">.</span><span class="n">log_access</span><span class="p" data-group-id="5583590763-4">(</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p" data-group-id="5583590763-4">)</span><span class="w">             </span><span class="c1"># Side effect!</span><span class="w">
  </span><span class="n">user</span><span class="o">.</span><span class="n">age</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">18</span><span class="w">
</span><span class="k" data-group-id="5583590763-1">end</span><span class="w">

</span><span class="c1"># ✅ Correct: pure predicates, side effects elsewhere</span><span class="w">
</span><span class="n">good_predicate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="5583590763-5">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">age</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">18</span><span class="w"> </span><span class="k" data-group-id="5583590763-5">end</span><span class="w">

</span><span class="kd">def</span><span class="w"> </span><span class="nf">validate_and_log</span><span class="p" data-group-id="5583590763-6">(</span><span class="n">user</span><span class="p" data-group-id="5583590763-6">)</span><span class="w"> </span><span class="k" data-group-id="5583590763-7">do</span><span class="w">
  </span><span class="nc">Logger</span><span class="o">.</span><span class="n">info</span><span class="p" data-group-id="5583590763-8">(</span><span class="s">&quot;Checking user </span><span class="si" data-group-id="5583590763-9">#{</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="si" data-group-id="5583590763-9">}</span><span class="s">&quot;</span><span class="p" data-group-id="5583590763-8">)</span><span class="w">    </span><span class="c1"># Side effects separate</span><span class="w">
  </span><span class="n">is_valid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">good_predicate</span><span class="o">.</span><span class="p" data-group-id="5583590763-10">(</span><span class="n">user</span><span class="p" data-group-id="5583590763-10">)</span><span class="w">
  </span><span class="k">if</span><span class="w"> </span><span class="n">is_valid</span><span class="p">,</span><span class="w"> </span><span class="ss">do</span><span class="p">:</span><span class="w"> </span><span class="nc">Database</span><span class="o">.</span><span class="n">log_access</span><span class="p" data-group-id="5583590763-11">(</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p" data-group-id="5583590763-11">)</span><span class="w">
  </span><span class="n">is_valid</span><span class="w">
</span><span class="k" data-group-id="5583590763-7">end</span></code></pre><h3 id="don-t-put-expensive-operations-first" class="section-heading">
  <a href="#don-t-put-expensive-operations-first" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">❌ Don't Put Expensive Operations First</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="c1"># ❌ Wrong: expensive check first</span><span class="w">
</span><span class="n">inefficient_validation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="9778358186-1">(</span><span class="p" data-group-id="9778358186-2">[</span><span class="w">
  </span><span class="k" data-group-id="9778358186-3">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">ExternalAPI</span><span class="o">.</span><span class="n">verify_identity</span><span class="p" data-group-id="9778358186-4">(</span><span class="n">user</span><span class="o">.</span><span class="n">ssn</span><span class="p" data-group-id="9778358186-4">)</span><span class="w"> </span><span class="k" data-group-id="9778358186-3">end</span><span class="p">,</span><span class="w">  </span><span class="c1"># Expensive!</span><span class="w">
  </span><span class="k" data-group-id="9778358186-5">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">is_nil</span><span class="p" data-group-id="9778358186-6">(</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="p" data-group-id="9778358186-6">)</span><span class="w"> </span><span class="k" data-group-id="9778358186-5">end</span><span class="p">,</span><span class="w">                  </span><span class="c1"># Cheap</span><span class="w">
  </span><span class="k" data-group-id="9778358186-7">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">String</span><span class="o">.</span><span class="n">length</span><span class="p" data-group-id="9778358186-8">(</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p" data-group-id="9778358186-8">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k" data-group-id="9778358186-7">end</span><span class="w">          </span><span class="c1"># Cheap  </span><span class="w">
</span><span class="p" data-group-id="9778358186-2">]</span><span class="p" data-group-id="9778358186-1">)</span><span class="w">

</span><span class="c1"># ✅ Correct: cheap checks first, expensive last</span><span class="w">
</span><span class="n">efficient_validation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="9778358186-9">(</span><span class="p" data-group-id="9778358186-10">[</span><span class="w">
  </span><span class="k" data-group-id="9778358186-11">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">is_nil</span><span class="p" data-group-id="9778358186-12">(</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="p" data-group-id="9778358186-12">)</span><span class="w"> </span><span class="k" data-group-id="9778358186-11">end</span><span class="p">,</span><span class="w">                  </span><span class="c1"># Cheap first</span><span class="w">
  </span><span class="k" data-group-id="9778358186-13">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">String</span><span class="o">.</span><span class="n">length</span><span class="p" data-group-id="9778358186-14">(</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p" data-group-id="9778358186-14">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k" data-group-id="9778358186-13">end</span><span class="p">,</span><span class="w">         </span><span class="c1"># Still cheap</span><span class="w">
  </span><span class="k" data-group-id="9778358186-15">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">ExternalAPI</span><span class="o">.</span><span class="n">verify_identity</span><span class="p" data-group-id="9778358186-16">(</span><span class="n">user</span><span class="o">.</span><span class="n">ssn</span><span class="p" data-group-id="9778358186-16">)</span><span class="w"> </span><span class="k" data-group-id="9778358186-15">end</span><span class="w">  </span><span class="c1"># Expensive last</span><span class="w">
</span><span class="p" data-group-id="9778358186-10">]</span><span class="p" data-group-id="9778358186-9">)</span></code></pre><h3 id="don-t-return-non-boolean-values" class="section-heading">
  <a href="#don-t-return-non-boolean-values" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">❌ Don't Return Non-Boolean Values</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="c1"># ❌ Wrong: returning non-boolean</span><span class="w">
</span><span class="n">bad_predicate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="3841861890-1">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
  </span><span class="k">case</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">age</span><span class="w"> </span><span class="k" data-group-id="3841861890-2">do</span><span class="w">
    </span><span class="n">age</span><span class="w"> </span><span class="ow">when</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">18</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="ss">:adult</span><span class="w">
    </span><span class="n">age</span><span class="w"> </span><span class="ow">when</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">13</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="ss">:teen</span><span class="w">  
    </span><span class="bp">_</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="ss">:child</span><span class="w">
  </span><span class="k" data-group-id="3841861890-2">end</span><span class="w">
</span><span class="k" data-group-id="3841861890-1">end</span><span class="w">

</span><span class="c1"># ✅ Correct: always return boolean</span><span class="w">
</span><span class="n">good_adult_predicate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="3841861890-3">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">age</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">18</span><span class="w"> </span><span class="k" data-group-id="3841861890-3">end</span><span class="w">
</span><span class="n">good_teen_predicate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="3841861890-4">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">age</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">13</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">age</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">18</span><span class="w"> </span><span class="k" data-group-id="3841861890-4">end</span><span class="w">

</span><span class="c1"># If you need the classification, use a separate function</span><span class="w">
</span><span class="kd">def</span><span class="w"> </span><span class="nf">classify_user</span><span class="p" data-group-id="3841861890-5">(</span><span class="n">user</span><span class="p" data-group-id="3841861890-5">)</span><span class="w"> </span><span class="k" data-group-id="3841861890-6">do</span><span class="w">
  </span><span class="k">cond</span><span class="w"> </span><span class="k" data-group-id="3841861890-7">do</span><span class="w">
    </span><span class="n">good_adult_predicate</span><span class="o">.</span><span class="p" data-group-id="3841861890-8">(</span><span class="n">user</span><span class="p" data-group-id="3841861890-8">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="ss">:adult</span><span class="w">
    </span><span class="n">good_teen_predicate</span><span class="o">.</span><span class="p" data-group-id="3841861890-9">(</span><span class="n">user</span><span class="p" data-group-id="3841861890-9">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="ss">:teen</span><span class="w">
    </span><span class="no">true</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="ss">:child</span><span class="w">
  </span><span class="k" data-group-id="3841861890-7">end</span><span class="w">
</span><span class="k" data-group-id="3841861890-6">end</span></code></pre><h3 id="don-t-mix-types-in-composition" class="section-heading">
  <a href="#don-t-mix-types-in-composition" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">❌ Don't Mix Types in Composition</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="c1"># ❌ Wrong: predicates expecting different types  </span><span class="w">
</span><span class="n">mixed_predicates</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="5318580641-1">(</span><span class="p" data-group-id="5318580641-2">[</span><span class="w">
  </span><span class="k" data-group-id="5318580641-3">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">age</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">18</span><span class="w"> </span><span class="k" data-group-id="5318580641-3">end</span><span class="p">,</span><span class="w">           </span><span class="c1"># Expects user struct</span><span class="w">
  </span><span class="k" data-group-id="5318580641-4">fn</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">String</span><span class="o">.</span><span class="n">length</span><span class="p" data-group-id="5318580641-5">(</span><span class="n">name</span><span class="p" data-group-id="5318580641-5">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k" data-group-id="5318580641-4">end</span><span class="w">   </span><span class="c1"># Expects string</span><span class="w">
</span><span class="p" data-group-id="5318580641-2">]</span><span class="p" data-group-id="5318580641-1">)</span><span class="w">

</span><span class="c1"># ✅ Correct: consistent input types</span><span class="w">
</span><span class="n">user_predicates</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="5318580641-6">(</span><span class="p" data-group-id="5318580641-7">[</span><span class="w">
  </span><span class="k" data-group-id="5318580641-8">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">age</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">18</span><span class="w"> </span><span class="k" data-group-id="5318580641-8">end</span><span class="p">,</span><span class="w">
  </span><span class="k" data-group-id="5318580641-9">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">String</span><span class="o">.</span><span class="n">length</span><span class="p" data-group-id="5318580641-10">(</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="p" data-group-id="5318580641-10">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k" data-group-id="5318580641-9">end</span><span class="p">,</span><span class="w">  </span><span class="c1"># Extract field first</span><span class="w">
  </span><span class="k" data-group-id="5318580641-11">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">is_nil</span><span class="p" data-group-id="5318580641-12">(</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p" data-group-id="5318580641-12">)</span><span class="w"> </span><span class="k" data-group-id="5318580641-11">end</span><span class="w">
</span><span class="p" data-group-id="5318580641-7">]</span><span class="p" data-group-id="5318580641-6">)</span></code></pre><h3 id="don-t-ignore-error-cases" class="section-heading">
  <a href="#don-t-ignore-error-cases" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">❌ Don't Ignore Error Cases</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="c1"># ❌ Wrong: not handling potential errors</span><span class="w">
</span><span class="n">unsafe_predicate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="1499792515-1">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
  </span><span class="n">user</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">notifications</span><span class="o">.</span><span class="n">email</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">true</span><span class="w">  </span><span class="c1"># Could crash!</span><span class="w">
</span><span class="k" data-group-id="1499792515-1">end</span><span class="w">

</span><span class="c1"># ✅ Correct: safe field access</span><span class="w">
</span><span class="n">safe_predicate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="1499792515-2">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
  </span><span class="n">get_in</span><span class="p" data-group-id="1499792515-3">(</span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1499792515-4">[</span><span class="ss">:profile</span><span class="p">,</span><span class="w"> </span><span class="ss">:preferences</span><span class="p">,</span><span class="w"> </span><span class="ss">:notifications</span><span class="p">,</span><span class="w"> </span><span class="ss">:email</span><span class="p" data-group-id="1499792515-4">]</span><span class="p" data-group-id="1499792515-3">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">true</span><span class="w">
</span><span class="k" data-group-id="1499792515-2">end</span><span class="w">

</span><span class="c1"># ✅ Even better: with nil checks</span><span class="w">
</span><span class="n">better_predicate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="1499792515-5">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
  </span><span class="k">case</span><span class="w"> </span><span class="n">get_in</span><span class="p" data-group-id="1499792515-6">(</span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1499792515-7">[</span><span class="ss">:profile</span><span class="p">,</span><span class="w"> </span><span class="ss">:preferences</span><span class="p">,</span><span class="w"> </span><span class="ss">:notifications</span><span class="p">,</span><span class="w"> </span><span class="ss">:email</span><span class="p" data-group-id="1499792515-7">]</span><span class="p" data-group-id="1499792515-6">)</span><span class="w"> </span><span class="k" data-group-id="1499792515-8">do</span><span class="w">
    </span><span class="no">true</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">true</span><span class="w">
    </span><span class="bp">_</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="no">false</span><span class="w">
  </span><span class="k" data-group-id="1499792515-8">end</span><span class="w">
</span><span class="k" data-group-id="1499792515-5">end</span></code></pre><h3 id="don-t-create-overly-complex-single-predicates" class="section-heading">
  <a href="#don-t-create-overly-complex-single-predicates" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">❌ Don't Create Overly Complex Single Predicates</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="c1"># ❌ Wrong: overly complex single predicate</span><span class="w">
</span><span class="n">complex_predicate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k" data-group-id="4716807472-1">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
  </span><span class="n">user</span><span class="o">.</span><span class="n">age</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">18</span><span class="w"> </span><span class="ow">and</span><span class="w"> 
  </span><span class="n">user</span><span class="o">.</span><span class="n">active</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">true</span><span class="w"> </span><span class="ow">and</span><span class="w">
  </span><span class="n">user</span><span class="o">.</span><span class="n">verified</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">true</span><span class="w"> </span><span class="ow">and</span><span class="w">
  </span><span class="nc">String</span><span class="o">.</span><span class="n">contains?</span><span class="p" data-group-id="4716807472-2">(</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;@&quot;</span><span class="p" data-group-id="4716807472-2">)</span><span class="w"> </span><span class="ow">and</span><span class="w">
  </span><span class="n">user</span><span class="o">.</span><span class="n">role</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="p" data-group-id="4716807472-3">[</span><span class="ss">:admin</span><span class="p">,</span><span class="w"> </span><span class="ss">:moderator</span><span class="p">,</span><span class="w"> </span><span class="ss">:user</span><span class="p" data-group-id="4716807472-3">]</span><span class="w"> </span><span class="ow">and</span><span class="w">
  </span><span class="n">length</span><span class="p" data-group-id="4716807472-4">(</span><span class="n">user</span><span class="o">.</span><span class="n">permissions</span><span class="p" data-group-id="4716807472-4">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="ow">and</span><span class="w">
  </span><span class="ow">not</span><span class="w"> </span><span class="n">is_nil</span><span class="p" data-group-id="4716807472-5">(</span><span class="n">user</span><span class="o">.</span><span class="n">last_login</span><span class="p" data-group-id="4716807472-5">)</span><span class="w"> </span><span class="ow">and</span><span class="w">
  </span><span class="nc">DateTime</span><span class="o">.</span><span class="n">diff</span><span class="p" data-group-id="4716807472-6">(</span><span class="nc">DateTime</span><span class="o">.</span><span class="n">utc_now</span><span class="p" data-group-id="4716807472-7">(</span><span class="p" data-group-id="4716807472-7">)</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">last_login</span><span class="p">,</span><span class="w"> </span><span class="ss">:day</span><span class="p" data-group-id="4716807472-6">)</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">30</span><span class="w">
</span><span class="k" data-group-id="4716807472-1">end</span><span class="w">

</span><span class="c1"># ✅ Correct: break down into composable parts</span><span class="w">
</span><span class="n">basic_checks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="4716807472-8">(</span><span class="p" data-group-id="4716807472-9">[</span><span class="w">
  </span><span class="k" data-group-id="4716807472-10">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">age</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">18</span><span class="w"> </span><span class="k" data-group-id="4716807472-10">end</span><span class="p">,</span><span class="w">
  </span><span class="k" data-group-id="4716807472-11">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">active</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">true</span><span class="w"> </span><span class="k" data-group-id="4716807472-11">end</span><span class="p">,</span><span class="w">
  </span><span class="k" data-group-id="4716807472-12">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">verified</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="no">true</span><span class="w"> </span><span class="k" data-group-id="4716807472-12">end</span><span class="w">
</span><span class="p" data-group-id="4716807472-9">]</span><span class="p" data-group-id="4716807472-8">)</span><span class="w">

</span><span class="n">account_checks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="4716807472-13">(</span><span class="p" data-group-id="4716807472-14">[</span><span class="w">
  </span><span class="k" data-group-id="4716807472-15">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">String</span><span class="o">.</span><span class="n">contains?</span><span class="p" data-group-id="4716807472-16">(</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;@&quot;</span><span class="p" data-group-id="4716807472-16">)</span><span class="w"> </span><span class="k" data-group-id="4716807472-15">end</span><span class="p">,</span><span class="w">
  </span><span class="k" data-group-id="4716807472-17">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">role</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="p" data-group-id="4716807472-18">[</span><span class="ss">:admin</span><span class="p">,</span><span class="w"> </span><span class="ss">:moderator</span><span class="p">,</span><span class="w"> </span><span class="ss">:user</span><span class="p" data-group-id="4716807472-18">]</span><span class="w"> </span><span class="k" data-group-id="4716807472-17">end</span><span class="p">,</span><span class="w">
  </span><span class="k" data-group-id="4716807472-19">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">length</span><span class="p" data-group-id="4716807472-20">(</span><span class="n">user</span><span class="o">.</span><span class="n">permissions</span><span class="p" data-group-id="4716807472-20">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k" data-group-id="4716807472-19">end</span><span class="w">
</span><span class="p" data-group-id="4716807472-14">]</span><span class="p" data-group-id="4716807472-13">)</span><span class="w">

</span><span class="n">activity_checks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="4716807472-21">(</span><span class="p" data-group-id="4716807472-22">[</span><span class="w">
  </span><span class="k" data-group-id="4716807472-23">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">is_nil</span><span class="p" data-group-id="4716807472-24">(</span><span class="n">user</span><span class="o">.</span><span class="n">last_login</span><span class="p" data-group-id="4716807472-24">)</span><span class="w"> </span><span class="k" data-group-id="4716807472-23">end</span><span class="p">,</span><span class="w">
  </span><span class="k" data-group-id="4716807472-25">fn</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nc">DateTime</span><span class="o">.</span><span class="n">diff</span><span class="p" data-group-id="4716807472-26">(</span><span class="nc">DateTime</span><span class="o">.</span><span class="n">utc_now</span><span class="p" data-group-id="4716807472-27">(</span><span class="p" data-group-id="4716807472-27">)</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">last_login</span><span class="p">,</span><span class="w"> </span><span class="ss">:day</span><span class="p" data-group-id="4716807472-26">)</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="k" data-group-id="4716807472-25">end</span><span class="w">
</span><span class="p" data-group-id="4716807472-22">]</span><span class="p" data-group-id="4716807472-21">)</span><span class="w">

</span><span class="n">complete_validation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="4716807472-28">(</span><span class="p" data-group-id="4716807472-29">[</span><span class="n">basic_checks</span><span class="p">,</span><span class="w"> </span><span class="n">account_checks</span><span class="p">,</span><span class="w"> </span><span class="n">activity_checks</span><span class="p" data-group-id="4716807472-29">]</span><span class="p" data-group-id="4716807472-28">)</span></code></pre><h2 id="llm-integration-with-monoids" class="section-heading">
  <a href="#llm-integration-with-monoids" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">LLM Integration with Monoids</span>
</h2>
<p>Understanding the monoid connection helps with advanced predicate composition:</p><pre><code class="makeup elixir" translate="no"><span class="c1"># Predicates use All and Any monoids internally</span><span class="w">
</span><span class="kd">def</span><span class="w"> </span><span class="nf">demonstrate_monoid_connection</span><span class="p" data-group-id="6910408077-1">(</span><span class="p" data-group-id="6910408077-1">)</span><span class="w"> </span><span class="k" data-group-id="6910408077-2">do</span><span class="w">
  </span><span class="c1"># All monoid (AND behavior) - identity is true</span><span class="w">
  </span><span class="n">all_monoid_example</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">and_all</span><span class="p" data-group-id="6910408077-3">(</span><span class="p" data-group-id="6910408077-4">[</span><span class="w">
    </span><span class="k" data-group-id="6910408077-5">fn</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k" data-group-id="6910408077-5">end</span><span class="p">,</span><span class="w">    </span><span class="c1"># First check</span><span class="w">
    </span><span class="k" data-group-id="6910408077-6">fn</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="k" data-group-id="6910408077-6">end</span><span class="w">   </span><span class="c1"># Second check  </span><span class="w">
  </span><span class="p" data-group-id="6910408077-4">]</span><span class="p" data-group-id="6910408077-3">)</span><span class="w">
  </span><span class="c1"># Equivalent to: All.concat([predicate1, predicate2])</span><span class="w">
  
  </span><span class="c1"># Any monoid (OR behavior) - identity is false  </span><span class="w">
  </span><span class="n">any_monoid_example</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Predicate</span><span class="o">.</span><span class="n">or_any</span><span class="p" data-group-id="6910408077-7">(</span><span class="p" data-group-id="6910408077-8">[</span><span class="w">
    </span><span class="k" data-group-id="6910408077-9">fn</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">:admin</span><span class="w"> </span><span class="k" data-group-id="6910408077-9">end</span><span class="p">,</span><span class="w">     </span><span class="c1"># First check</span><span class="w">
    </span><span class="k" data-group-id="6910408077-10">fn</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">:moderator</span><span class="w"> </span><span class="k" data-group-id="6910408077-10">end</span><span class="w">  </span><span class="c1"># Second check</span><span class="w">
  </span><span class="p" data-group-id="6910408077-8">]</span><span class="p" data-group-id="6910408077-7">)</span><span class="w">
  </span><span class="c1"># Equivalent to: Any.concat([predicate1, predicate2])</span><span class="w">
  
  </span><span class="c1"># Direct monoid usage (advanced)</span><span class="w">
  </span><span class="kn">alias</span><span class="w"> </span><span class="nc">Funx.Monoid.All</span><span class="w">
  </span><span class="kn">alias</span><span class="w"> </span><span class="nc">Funx.Monoid.Any</span><span class="w">
  
  </span><span class="c1"># Build using monoids directly</span><span class="w">
  </span><span class="n">manual_all</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">All</span><span class="o">.</span><span class="n">concat</span><span class="p" data-group-id="6910408077-11">(</span><span class="p" data-group-id="6910408077-12">[</span><span class="w">
    </span><span class="nc">All</span><span class="o">.</span><span class="n">new</span><span class="p" data-group-id="6910408077-13">(</span><span class="k" data-group-id="6910408077-14">fn</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k" data-group-id="6910408077-14">end</span><span class="p" data-group-id="6910408077-13">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">All</span><span class="o">.</span><span class="n">new</span><span class="p" data-group-id="6910408077-15">(</span><span class="k" data-group-id="6910408077-16">fn</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">100</span><span class="w"> </span><span class="k" data-group-id="6910408077-16">end</span><span class="p" data-group-id="6910408077-15">)</span><span class="w">
  </span><span class="p" data-group-id="6910408077-12">]</span><span class="p" data-group-id="6910408077-11">)</span><span class="w">
  
  </span><span class="n">manual_any</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Any</span><span class="o">.</span><span class="n">concat</span><span class="p" data-group-id="6910408077-17">(</span><span class="p" data-group-id="6910408077-18">[</span><span class="w">
    </span><span class="nc">Any</span><span class="o">.</span><span class="n">new</span><span class="p" data-group-id="6910408077-19">(</span><span class="k" data-group-id="6910408077-20">fn</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">:admin</span><span class="w"> </span><span class="k" data-group-id="6910408077-20">end</span><span class="p" data-group-id="6910408077-19">)</span><span class="p">,</span><span class="w">
    </span><span class="nc">Any</span><span class="o">.</span><span class="n">new</span><span class="p" data-group-id="6910408077-21">(</span><span class="k" data-group-id="6910408077-22">fn</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">:moderator</span><span class="w"> </span><span class="k" data-group-id="6910408077-22">end</span><span class="p" data-group-id="6910408077-21">)</span><span class="w">
  </span><span class="p" data-group-id="6910408077-18">]</span><span class="p" data-group-id="6910408077-17">)</span><span class="w">
  
  </span><span class="c1"># Extract predicates from monoids</span><span class="w">
  </span><span class="n">all_pred</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">All</span><span class="o">.</span><span class="n">get_value</span><span class="p" data-group-id="6910408077-23">(</span><span class="n">manual_all</span><span class="p" data-group-id="6910408077-23">)</span><span class="w">
  </span><span class="n">any_pred</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Any</span><span class="o">.</span><span class="n">get_value</span><span class="p" data-group-id="6910408077-24">(</span><span class="n">manual_any</span><span class="p" data-group-id="6910408077-24">)</span><span class="w">
  
  </span><span class="p" data-group-id="6910408077-25">%{</span><span class="w">
    </span><span class="ss">standard_and</span><span class="p">:</span><span class="w"> </span><span class="n">all_monoid_example</span><span class="p">,</span><span class="w">
    </span><span class="ss">standard_or</span><span class="p">:</span><span class="w"> </span><span class="n">any_monoid_example</span><span class="p">,</span><span class="w">
    </span><span class="ss">manual_all</span><span class="p">:</span><span class="w"> </span><span class="n">all_pred</span><span class="p">,</span><span class="w">
    </span><span class="ss">manual_any</span><span class="p">:</span><span class="w"> </span><span class="n">any_pred</span><span class="w">
  </span><span class="p" data-group-id="6910408077-25">}</span><span class="w">
</span><span class="k" data-group-id="6910408077-2">end</span></code></pre><h2 id="summary" class="section-heading">
  <a href="#summary" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Summary</span>
</h2>
<p><a href="Funx.Predicate.html"><code class="inline">Funx.Predicate</code></a> provides composable boolean logic for validation, filtering, and conditional operations. It's built on solid mathematical foundations with monoid backing for efficient composition.</p><p><strong>Key capabilities:</strong></p><ul><li><strong>Composable validation</strong>: Build complex logic from simple predicates</li><li><strong>Monoid-backed operations</strong>: Mathematically sound with proper identity elements</li><li><strong>Short-circuiting evaluation</strong>: Efficient <code class="inline">and_all</code> and <code class="inline">or_any</code> operations</li><li><strong>Cross-module integration</strong>: Works seamlessly with Utils, Maybe, Either, and Enum</li><li><strong>Performance optimization</strong>: Put cheap predicates first for efficiency</li></ul><p><strong>Core patterns:</strong></p><ul><li>Use <code class="inline">and_all/1</code> when all conditions must be true</li><li>Use <code class="inline">or_any/1</code> when any condition can be true  </li><li>Use <a href="https://hexdocs.pm/elixir/Kernel.html#not/1"><code class="inline">not/1</code></a> for logical negation</li><li>Compose predicates rather than building complex single functions</li><li>Order predicates from cheapest to most expensive</li></ul><p><strong>Integration points:</strong></p><ul><li><strong>Utils</strong>: Curry predicates for pipeline use</li><li><strong>Monads</strong>: Convert predicates to Maybe/Either validators</li><li><strong>Collections</strong>: Use with Enum filtering and testing functions</li><li><strong>Monoids</strong>: Direct monoid usage for advanced composition patterns</li></ul><p><strong>Canon</strong>: Build from simple predicates, compose with monoid operations, optimize with short-circuiting, integrate across functional abstractions.</p>
</div>

<div class="bottom-actions" id="bottom-actions">
  <div class="bottom-actions-item">

      <a href="ord-usage-rules.html" class="bottom-actions-button" rel="prev">
        <span class="subheader">
          ← Previous Page
        </span>
        <span class="title">
Funx.Ord Usage Rules
        </span>
      </a>

  </div>
  <div class="bottom-actions-item">

      <a href="utils-usage-rules.html" class="bottom-actions-button" rel="next">
        <span class="subheader">
          Next Page →
        </span>
        <span class="title">
Funx.Utils Usage Rules
        </span>
      </a>

  </div>
</div>
    <footer class="footer">
      <p>

          <span class="line">
            <a href="https://hex.pm/packages/funx/0.1.5" class="footer-hex-package">Hex Package</a>

            <a href="https://preview.hex.pm/preview/funx/0.1.5">Hex Preview</a>

              (<a href="https://preview.hex.pm/preview/funx/0.1.5/show/lib/predicate/usage-rules.md">current file</a>)

          </span>

        <span class="line">
          <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
            Search HexDocs
          </button>

            <a href="funx.epub" title="ePub version">
              Download ePub version
            </a>

        </span>
      </p>

      <p class="built-using">
        Built using
        <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.34.2) for the

          <a href="https://elixir-lang.org" title="Elixir" target="_blank" translate="no">Elixir programming language</a>

      </p>

    </footer>
  </div>
</main>
</div>

  </body>
</html>
